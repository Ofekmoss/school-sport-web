define(["templates/registration","services/access","dialog","utils"],function(t,e,n,o){function a(t,e){for(var i=0;i<t.length;i++){var n=t[i];if(n.id===e)return n}return null}function r(i,e,n){!function(i,n){i.sports.splice(0,i.sports.length),Vue.http.get("/api/v2/registration/league/competitions").then(function(t){for(var e=0;e<t.body.sports.length;e++)i.sports.push(t.body.sports[e]);n()},function(t){n(t)})}(i,function(t){t||Vue.http.get("/api/v2/registration/league/teams/"+encodeURIComponent(e)).then(function(t){var e=t.body;e.sport=a(i.sports,e.sport),e.sport&&(e.category=a(e.sport.categories,e.competition),e.category)?n(null,e):n()},function(t){console.log(t),n()})})}return Vue.extend({template:t["league-details"],data:function(){return{user:e.user,teamId:null,inputsValid:!1,school:{},principal:{},representative:{},coordinator:{},association:{},sports:[],inactiveSeason:!1}},mounted:function(){function s(t){n.open("registration/league/league-first-confirmation-dialog",{sportName:t.sport.name,dates:function(t){return 16===t?"ספטמבר 2021 ועד מרץ 2022":"ספטמבר 2021 ועד ינואר 2022"}(t.sport.id)})}var i=this;i.teamId=window.location.hash.split("=")[1],window.setTimeout(function(){o.trimAllInputs("pnlLeagueDetails")},1e3),Vue.http.get("/api/v2/registration/league/details").then(function(t){i.school=t.data.school||{},i.principal=t.data.principal||{},i.representative=t.data.representative||{},i.association=t.data.association||{},i.firstConfirmation=t.data.firstConfirmation,i.firstConfirmation||r(i,i.teamId,function(t,o){if(i.checkInputsValid(),o){var a="league-team-"+o.id;Vue.http.get("/api/v2/registration/school-confirmations").then(function(t){for(var e=null,i=0;i<t.body.length;i++){var n=t.body[i];if(n.Form===a){e=n.DateConfirmed;break}}null==e&&s(o)},function(t){console.log(t),s(o)})}})},function(t){console.log(t)}),i.inactiveSeason=o.inactiveSeason(i),i.inactiveSeason&&o.checkSeasonAuthorization(i.user,function(t,e){1==e&&(i.inactiveSeason=!1)})},computed:{isValid:function(){return this.school.name&&this.school.phoneNumber&&this.school.symbol&&this.school.fax&&this.school.type&&this.school.email&&this.school.address&&this.principal.name&&this.principal.phoneNumber&&this.principal.email&&this.principal.gender&&this.representative.name&&this.representative.phoneNumber&&this.representative.email&&this.representative.gender&&this.inputsValid}},methods:{resetGender:function(t){t.gender=null},checkInputsValid:function(){this.inputsValid=0==document.querySelectorAll("#form :invalid").length},next:function(){var e=this;Vue.http.post("/api/v2/registration/league/details",{school:e.school,principal:e.principal,representative:e.representative,confirmationA:e.confirmationA,confirmationB:e.confirmationB,confirmationC:e.confirmationC,confirmationD:e.confirmationD}).then(function(t){e.$emit("next",t.data.stage)},function(t){n.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof t.body?t.body:"כשלון בעדכון נתונים"})})}}})});