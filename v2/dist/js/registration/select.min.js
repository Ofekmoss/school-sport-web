define(["templates/registration","views","services/access","dialog","utils","consts"],function(e,s,n,t,a,i){function o(o,t){!function(n,o){n.sports.splice(0,n.sports.length),Vue.http.get("/api/v2/registration/league/competitions").then(function(e){for(var s=0;s<e.body.sports.length;s++)n.sports.push(e.body.sports[s]);o()},function(e){o(e)})}(o,function(e){e?t(e):Vue.http.get("/api/v2/registration/league/teams").then(function(e){for(var s=0;s<e.body.length;s++){var n=e.body[s];n.sport=a.getById(o.sports,n.sport),n.sport&&(n.category=a.getById(n.sport.categories,n.competition)),n.category&&(n.league=!0,o.teams.push(n))}t()},function(e){t(e)})})}function r(t){o(t,function(){Vue.http.get("/api/v2/registration").then(function(e){t.groups.splice(0,t.groups.length),t.seasons=[],t.season=null;for(var s=0;s<e.data.groups.length;s++)t.groups.push(e.data.groups[s]);if(e.data.seasons){for(s=0;s<e.data.seasons.length;s++){var n=e.data.seasons[s];t.seasons.push(n),n.SeasonId==e.data.currentSeason&&(t.currentSeasonName=n.SeasonName)}t.season=e.data.currentSeason,t.$watch("season",t.seasonChanged)}t.active.splice(0,t.active.length);for(s=0;s<e.data.active.length;s++)t.active.push(e.data.active[s]);t.groups&&0<t.groups.length&&t.groups[0].links&&0<t.groups[0].links.length&&t.groups[0].links[0].name.indexOf("תכנית")<0&&Vue.http.get("/api/v2/login").then(function(e){var o=e.data.region;if(0===t.teams.length){var s=i.coordinators[o],n="אינך מוגדר בליגת תיכונים, אנא פנה לרכז המחוז "+s.name+" בטלפון "+s.phone;t.groups&&1<t.groups.length&&t.groups[2].links&&0<t.groups[2].links.length&&(t.groups[2].links[0].enabled=!1,t.groups[2].links[0].tooltip=n)}Vue.http.get("/api/v2/registration/club/competitions").then(function(e){if(0===e.body.sports.length){var s=i.coordinators[o],n="אינך מוגדר ברישום מועדונים, אנא פנה לרכז המחוז "+s.name+" בטלפון "+s.phone;t.groups&&0<t.groups.length&&t.groups[0].links&&0<t.groups[0].links.length&&(t.groups[0].links[0].enabled=!1,t.groups[0].links[0].tooltip=n)}})})},function(e){console.log(e)})})}return Vue.extend({template:e.select,data:function(){return{user:n.user,active:[],prevGroups:null,sports:[],teams:[],groups:[],seasons:[],season:null,peleUser:!1,currentSeasonName:"",seasonPanelVisible:!1,inactiveSeason:!1}},mounted:function(){var e=this;e.peleUser=e.user.roles&&1===e.user.roles.length&&"city"===e.user.roles[0],e.inactiveSeason=a.inactiveSeason(e),r(e)},methods:{toggleSeasonPanel:function(){this.seasonPanelVisible=!this.seasonPanelVisible},seasonChanged:function(){var s=this;Vue.http.post("/api/v2/registration/season",{season:s.season}).then(function(e){r(s),document.location.reload()},function(e){console.log("error")})},resetSeason:function(){var n=this,o=n.seasons.find(function(e){return e.SeasonId==n.user.activeSeason});if(null!=o){var e="האם להחליף לעונת רישום פעילה "+o.SeasonName+"?";t.open("general/message-box",{caption:"החלפת עונה",message:e,alert:!0,confirmText:"אישור",cancelText:"ביטול"},function(e,s){if(s){Vue.http.post("/api/v2/registration/season",{season:o.SeasonId}).then(function(e){r(n),document.location.reload()},function(e){console.log("error")})}})}else alert("עונה פעילה לא נמצאה")},goTo:function(e){e.links?(this.prevGroups=this.groups,this.groups=[{links:e.links}]):e.onclick?(this.prevGroups=this.groups,e.onclick(this)):s.openView(e.route)},logout:function(){n.logout()},back:function(){this.groups=this.prevGroups,this.prevGroups=null}}})});