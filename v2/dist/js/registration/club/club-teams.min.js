define(["templates/registration","services/access","services/products","dialog","consts","utils"],function(t,e,i,r,o,a){var s={};function c(t,e){for(var i=0;i<t.length;i++){var o=t[i];if(o.id===e)return o}return null}function n(n){!function(o,n){Vue.http.get("/api/v2/registration/club/competitions").then(function(t){for(var e=[],i=0;i<t.body.sports.length;i++)e.push(t.body.sports[i]);o.sports=e,n()},function(t){n(t)})}(n,function(t){t||Vue.http.get("/api/v2/registration/club/teams").then(function(t){for(var e=[],i=0;i<t.body.length;i++){var o=t.body[i];o.sport=c(n.sports,o.sport),o.sport&&(o.category=c(o.sport.categories,o.competition)),o.category&&(null!=o.payment&&n.paidTeams++,o.createdAt=new Date(o.createdAt),e.push(o)),2==o.adminStatus&&(o.tooltip="קבוצה אושרה על ידי רכז התאחדות הספורט, לא ניתן לערוך פרטים")}n.totalPayment=n.getTotalPrice(e),n.teams=e},function(t){console.log(t)})})}return Vue.extend({template:t["club-teams"],data:function(){return{user:e.user,teams:[],facilities:[],sports:[],paidTeams:0,products:null,selectAll:!1,selectionCount:0,adminApprovedSelectionCount:0,totalPayment:0,inactiveSeason:!1,currentSeasonName:"",priceWithTotoSupport:0,priceWithoutTotoSupport:0}},mounted:function(){var o=this;!function(o){Vue.http.get("/api/v2/facilities/-").then(function(t){for(var e=[],i=0;i<t.body.length;i++)e.push(t.body[i]);o.facilities=e},function(t){console.log(t)})}(this),i.get(function(t,e){if(t)console.log(t);else{for(var i in e)s[i]=e[i].price;o.reloadComponent()}}),o.inactiveSeason=a.inactiveSeason(o),o.inactiveSeason&&a.checkSeasonAuthorization(o.user,function(t,e){1==e&&(o.inactiveSeason=!1)});var n=o.user.season;n&&Vue.http.get("/api/v2/seasons").then(function(t){for(var e=0;e<t.body.length;e++){var i=t.body[e];if(i.id==n){o.currentSeasonName=i.name;break}}Vue.http.get("/api/v2/registration/club/basic-prices").then(function(t){t.body&&(o.priceWithTotoSupport=t.body.WithTotoSupport||0,o.priceWithoutTotoSupport=t.body.NoTotoSupport||0)})})},methods:{reloadComponent:function(){n(this)},handleSelectionChange:function(){var t=this;t.selectionCount=0;for(var e=t.adminApprovedSelectionCount=0;e<t.teams.length;e++){var i=t.teams[e];i.selected&&(t.selectionCount++,2==i.adminStatus&&t.adminApprovedSelectionCount++)}t.selectAll=t.selectionCount===t.teams.length},handleSelectAll:function(){var t=this;if(t.selectAll){for(var e=0;e<t.teams.length;e++)t.teams[e].selected=!0;t.selectionCount=t.teams.length,t.adminApprovedSelectionCount=t.teams.filter(function(t){return 2==t.adminStatus}).length}else{for(e=0;e<t.teams.length;e++)t.teams[e].selected=!1;t.selectionCount=0,t.adminApprovedSelectionCount=0}},getActivityText:a.getActivityText,newTeam:function(){var i=this;r.open("registration/club/club-team-dialog",{facilities:i.facilities,sports:i.sports,teams:i.teams},function(t,e){null!=e&&Vue.http.post("/api/v2/registration/club/teams",{sport:e.sport.id,competition:e.category.id,teamNumber:e.teamNumber,coach:e.coach,facility:e.facility,activity:e.activity,hostingHours:e.hostingHours}).then(function(t){i.reloadComponent()},function(t){r.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof t.body?t.body:"שגיאה בהכנסת קבוצה"})})})},editTeam:function(){for(var i=this,t=null,e=0;e<this.teams.length;e++){var o=this.teams[e];if(o.selected){if(t)return;e,t={id:o.id,sport:o.sport,category:o.category,teamNumber:o.teamNumber,coach:{name:o.coach.name,phoneNumber:o.coach.phoneNumber,email:o.coach.email,certification:o.coach.certification,certificationTypes:o.coach.certificationTypes,sexOffenseClearance:o.coach.sexOffenseClearance},facility:o.facility,activity:o.activity&&0<o.activity.length?o.activity.map(function(t){return{day:t.day,startTime:t.startTime,endTime:t.endTime}}):[],hostingHours:o.hostingHours&&0<o.hostingHours.length?o.hostingHours.map(function(t){return{day:t.day,startTime:t.startTime,endTime:t.endTime}}):[]}}}r.open("registration/club/club-team-dialog",{facilities:i.facilities,sports:i.sports,team:t,teams:i.teams},function(t,e){null!=e&&Vue.http.put("/api/v2/registration/club/teams/"+encodeURIComponent(e.id),{sport:e.sport.id,competition:e.category.id,teamNumber:e.teamNumber,coach:e.coach,facility:e.facility,activity:e.activity,hostingHours:e.hostingHours}).then(function(t){i.reloadComponent()},function(t){r.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof t.body?t.body:"שגיאה בעריכת קבוצה"})})})},duplicateTeam:function(){for(var i=this,t=null,e=0;e<this.teams.length;e++){var o=this.teams[e];if(o.selected){if(t)return;e,t={sport:o.sport,category:o.category,coach:{name:o.coach.name,phoneNumber:o.coach.phoneNumber,email:o.coach.email},facility:o.facility,activity:o.activity&&0<o.activity.length?o.activity.map(function(t){return{day:t.day,startTime:t.startTime,endTime:t.endTime}}):[],hostingHours:o.hostingHours&&0<o.hostingHours.length?o.hostingHours.map(function(t){return{day:t.day,startTime:t.startTime,endTime:t.endTime}}):[]}}}r.open("registration/club/club-team-dialog",{facilities:i.facilities,sports:i.sports,team:t,duplicate:!0,teams:i.teams},function(t,e){null!=e&&Vue.http.post("/api/v2/registration/club/teams",{sport:e.sport.id,competition:e.category.id,teamNumber:e.teamNumber,coach:e.coach,facility:e.facility,activity:e.activity,hostingHours:e.hostingHours}).then(function(t){i.reloadComponent()},function(t){r.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof t.body?t.body:"שגיאה בהכנסת קבוצה"})})})},deleteTeam:function(){for(var i=this,o=[],t=0;t<i.teams.length;t++){var e=i.teams[t];e.selected&&o.push(e)}0!==o.length&&r.open("general/message-box",{caption:"מחיקת קבוצה",message:1===o.length?"האם להסיר את רישום הקבוצה מהמועדון?":"האם להסיר את רישום הקבוצות מהמועדון?",alert:!0,confirmText:"כן",cancelText:"לא"},function(t,e){!0===e&&(!function i(o,n){if(n.length){var a=n[0];n.splice(0,1),Vue.http.delete("/api/v2/registration/club/teams/"+encodeURIComponent(a.id)).then(function(t){for(var e=0;e<o.teams.length;e++)if(o.teams[e]===a){o.teams.splice(e,1);break}i(o,n)},function(t){r.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof t.body?t.body:"שגיאה במחיקת קבוצה"})})}}(i,o),i.reloadComponent())})},getFacilityName:function(t){if(null!=t.facilityName&&0<t.facilityName.length)return t.facilityName;for(var e=t.facility,i=0;i<this.facilities.length;i++){var o=this.facilities[i];if(o.id===e)return o.name}return null},next:function(){var e=this;Vue.http.post("/api/v2/registration/club/teams/approve").then(function(t){e.$emit("next",t.data.stage)},function(t){r.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof t.body?t.body:"כשלון בעדכון נתונים"})})},getTotalPrice:function(t){var o={};return t.reduce(function(t,e){if(e.sport.isOnePaymentPerCategory){var i=[e.category.id,e.category.category].join("_");if(o[i])return e.removePayment=!0,t;o[i]=!0}return e.payment?t:t+=e.price},0)}}})});