define(["templates/registration","services/access","dialog","utils"],function(i,n,a,t){return Vue.extend({template:i["club-details"],data:function(){return{user:n.user,school:{},principal:{},chairman:{},coordinator:{},representative:{},association:{},confirmation:!1,confirmedAt:null,formValidations:{},inactiveSeason:!1}},watch:{school:{handler:function(){this.formValidations.school=this.school.name&&this.school.phoneNumber&&this.school.symbol&&this.school.fax&&this.school.email&&this.school.address},deep:!0},principal:{handler:function(){this.formValidations.principal=this.principal.name&&this.principal.phoneNumber&&this.principal.email&&this.principal.gender},deep:!0},chairman:{handler:function(){this.formValidations.chairman=this.chairman.name&&this.chairman.phoneNumber&&this.chairman.email&&this.chairman.gender},deep:!0},coordinator:{handler:function(){this.formValidations.coordinator=this.coordinator.name&&this.coordinator.phoneNumber&&this.coordinator.email&&this.coordinator.gender},deep:!0},representative:{handler:function(){this.formValidations.representative=this.representative.name&&this.representative.phoneNumber&&this.representative.email&&this.representative.gender},deep:!0}},mounted:function(){function o(i){a.open("registration/club/club-first-confirmation-dialog",{},function(i,n){})}var e=this;window.setTimeout(function(){t.trimAllInputs("pnlClubDetails")},1e3),Vue.http.get("/api/v2/registration/club/details").then(function(i){e.school=i.data.school||{},e.principal=i.data.principal||{},e.chairman=i.data.chairman||{},e.coordinator=i.data.coordinator||{},e.representative=i.data.representative||{},e.association=i.data.association||{},null!=e.association.set&&(e.association.set=e.association.set?1:0,e.association.validForThisYear=e.association.validForThisYear?1:0),Vue.http.get("/api/v2/registration/school-confirmations").then(function(i){for(var n=0;n<i.body.length;n++){var t=i.body[n];if("club-details"===t.Form){e.confirmation=!0,e.confirmedAt=t.DateConfirmed;break}}e.confirmedAt||o()},function(i){console.log(i),o()})},function(i){console.log(i)}),e.inactiveSeason=t.inactiveSeason(e),e.inactiveSeason&&t.checkSeasonAuthorization(e.user,function(i,n){1==n&&(e.inactiveSeason=!1)})},methods:{resetGender:function(i){i.gender=null},next:function(){var t=this,i=null==t.confirmedAt?"אישור קריאת הצהרה":"אימות סיסמא";a.open("general/password-validation",{caption:i},function(i,n){!function(n,i){Vue.http.post("/api/v2/registration/club/details",{school:n.school,principal:n.principal,chairman:n.chairman,coordinator:n.coordinator,representative:n.representative,association:{set:parseInt(n.association.set),validForThisYear:n.association.set?parseInt(n.association.validForThisYear):0,number:n.association.number},password:i}).then(function(i){n.$emit("next",i.data.stage),n.confirmedAt||Vue.http.post("/api/v2/registration/confirmation",{Form:"club-details"}).then(function(i){n.confirmedAt=new Date},function(i){console.log(i)})},function(i){a.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof i.body?i.body:"כשלון בעדכון נתונים"})})}(t,n)})}}})});