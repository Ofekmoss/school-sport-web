define(["templates/registration","utils","dialog"],function(t,a,e){var s={notLoaded:1,new:2,edit:3,import:4,loading:5};return Vue.extend({template:t["league-player-dialog"],data:function(){return{idNumber:"",firstName:"",lastName:"",birthDate:"",birthDateText:"",grade:"",picture:"",idSlip:"",medicalApproval:"",pictureLoaded:!1,idSlipLoaded:!1,medicalApprovalLoaded:!1,isIdValid:!1,state:s.notLoaded,states:s,external:!1}},created:function(){this.files={picture:null,idSlip:null,medicalApproval:null}},mounted:function(){if(this.idNumber&&(this.isIdValid=!0),this.birthDate){var t=new Date(this.birthDate);this.birthDateText=t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()}this.pictureInput=document.getElementById("picture-input"),this.idSlipInput=document.getElementById("id-slip-input"),this.medicalApprovalInput=document.getElementById("medical-approval-input")},methods:{transfer:function(){this.external&&this.$emit("close",{idNumber:this.idNumber,external:this.external})},confirm:function(){this.external||this.$emit("close",{student:this.student,idNumber:this.idNumber,firstName:this.firstName,lastName:this.lastName,birthDate:this.birthDate,grade:this.grade,gender:this.gender,picture:this.files.picture,idSlip:this.files.idSlip,medicalApproval:this.files.medicalApproval})},cancel:function(){this.$emit("close")},isIdValidCheck:function(){this.isIdValid=a.isIdValid(this.idNumber)},convertBirthDate:function(){this.birthDate=a.parseDate(this.birthDateText)},sendId:function(t){t.preventDefault();var i=this;this.isIdValid&&(i.state=s.loading,Vue.http.post("/api/v2/registration/league/playerId",{id:i.idNumber}).then(function(t){i.state=s.new;var e=t.body;i.student=e.student,i.firstName=e.firstName,i.lastName=e.lastName,i.birthDate=a.parseDate(e.birthDate),i.birthDateText=i.birthDate?i.birthDate.getDate()+"/"+(i.birthDate.getMonth()+1)+"/"+i.birthDate.getFullYear():"",i.grade=e.grade,i.gender=e.gender,i.pictureLoaded=null!=e.picture,i.idSlipLoaded=null!=e.idSlip,i.medicalApprovalLoaded=null!=e.medicalApproval,e.external&&(i.external=!0)},function(t){i.state=s.new,e.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof t.body?t.body:"כשלון בעדכון נתונים"})}))},clearId:function(t){t.preventDefault(),this.state=s.notLoaded,this.isIdValid=!1,this.idNumber="",this.firstName="",this.lastName="",this.birthDate="",this.grade="",this.pictureLoaded=!1,this.idSlipLoaded=!1,this.medicalApprovalLoaded=!1,this.files.picture=null,this.files.idSlip=null,this.files.medicalApproval=null,this.external=!1},uploadPicture:function(){this.state==this.states.notLoaded||this.state==this.states.loading||this.external||this.pictureInput.click()},uploadIdSlip:function(){this.state==this.states.notLoaded||this.state==this.states.loading||this.external||this.idSlipInput.click()},uploadMedicalApproval:function(){this.state==this.states.notLoaded||this.state==this.states.loading||this.external||this.medicalApprovalInput.click()},handlePicture:function(){this.files.picture=this.pictureInput.files[0],this.pictureLoaded=!!this.files.picture},handleIdSlip:function(){this.files.idSlip=this.idSlipInput.files[0],this.idSlipLoaded=!!this.files.idSlip},handleMedicalApproval:function(){this.files.medicalApproval=this.medicalApprovalInput.files[0],this.medicalApprovalLoaded=!!this.files.medicalApproval}}})});