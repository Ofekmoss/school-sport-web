define(["templates/registration","dialog","generic/data-table"],function(e,a){return Vue.extend({template:e["zuzu-classes"],data:function(){return{updating:!1,selectionCount:0,schools:[],grades:[{value:5,name:"ה'"},{value:6,name:"ו'"}],gradeClasses:[{value:0,name:"1'"},{value:1,name:"2'"},{value:2,name:"3'"},{value:3,name:"4'"},{value:4,name:"5'"},{value:5,name:"6'"},{value:6,name:"7'"},{value:7,name:"8'"},{value:8,name:"9'"},{value:9,name:"10'"}],gradeClassesTypes:[{value:0,name:"כיתה רגילה"},{value:1,name:"חינוך מיוחד"},{value:2,name:"כיתה קטנה"}],classColumns:[{key:"gradeIndex.name",name:"שכבה",active:!0},{key:"gradeClass",name:"כיתה",active:!0},{key:"gradeClassType",name:"סוג כיתה",active:!0},{key:"studentCount",name:"מספר תלמידים",active:!0},{key:"part1",name:"שליש א'",active:!0},{key:"part2",name:"שליש ב'",active:!0},{key:"part3",name:"שליש ג'",active:!0}],items:[],selectedTeam:null}},computed:{},mounted:function(){var a=this;(function(i,m,p){return Vue.http.get("/api/v2/registration/project/1?withTeams=1").then(function(e){for(var a=e.body.schools,t=[{value:0,name:e.data.item1},{value:1,name:e.data.item2},{value:2,name:e.data.item3}],s=0;s<a.length;s++){var n=a[s];n.teams||(n.teams=[]);for(var r=0;r<n.teams.length;r++){var o=n.teams[r];o.part1=JSON.parse(o.item1),o.part2=JSON.parse(o.item2),o.part3=JSON.parse(o.item3),o.part1.sportName=void 0!==o.part1.sport?t[o.part1.sport].name:"",o.part2.sportName=void 0!==o.part2.sport?t[o.part2.sport].name:"",o.part3.sportName=void 0!==o.part3.sport?t[o.part3.sport].name:"";var l=o.ages+"";o.gradeIndex=i[l[1]],o.gradeClass=i[l[1]].name+m[l[2]].name,o.gradeClassType=p[l[3]].name}}return{schools:a,items:t}})})(this.grades,this.gradeClasses,this.gradeClassesTypes).then(function(e){a.items=e.items,a.schools=e.schools})},methods:{togglePanel:function(e){e.__panelOpen=!e.__panelOpen,this.schools=this.schools.slice()},handleSelectionChange:function(e){for(var a=e.selectionCount=0;a<e.teams.length;a++)e.teams[a].selected&&e.selectionCount++;e.selectAll=e.selectionCount==e.teams.length},handleSelectAll:function(e){if(e.selectAll){for(var a=0;a<e.teams.length;a++)e.teams[a].selected=!0;e.selectionCount=e.teams.length}else{for(a=0;a<e.teams.length;a++)e.teams[a].selected=!1;e.selectionCount=0}},newClass:function(r){var o=this;a.open("registration/project/project-team-dialog",{items:o.items,school:r.id},function(e,a){if(null!=a){var t=a.gradeIndex,s=a.gradeClass,n=a.gradeClassType;a.gradeIndex=o.grades[t],a.gradeClass=o.grades[t].name+o.gradeClasses[s].name,a.gradeClassType=o.gradeClassesTypes[n].name,a.part1=JSON.parse(a.item1),a.part2=JSON.parse(a.item2),a.part3=JSON.parse(a.item3),a.part1.sportName=o.items[a.part1.sport].name,a.part2.sportName=o.items[a.part2.sport].name,a.part3.sportName=o.items[a.part3.sport].name,r.teams.push(a),o.schools=o.schools.slice()}})},editClass:function(o){var l=this,e=o.teams.find(function(e){return e.selected}),i=JSON.parse(JSON.stringify(e));a.open("registration/project/project-team-dialog",{items:l.items,school:o.id,team:i},function(e,a){if(null!=a){var t=a.gradeIndex,s=a.gradeClass,n=a.gradeClassType;a.gradeIndex=l.grades[t],a.gradeClass=l.grades[t].name+l.gradeClasses[s].name,a.gradeClassType=l.gradeClassesTypes[n].name;var r=o.teams.find(function(e){return e.id==i.id});a.part1=JSON.parse(a.item1),a.part2=JSON.parse(a.item2),a.part3=JSON.parse(a.item3),a.part1.sportName=l.items[a.part1.sport].name,a.part2.sportName=l.items[a.part2.sport].name,a.part3.sportName=l.items[a.part3.sport].name,Object.assign(r,a),l.schools=l.schools.slice()}})},deleteClasses:function(t){var s=t.teams.filter(function(e){return e.selected}).map(function(e){return e.id});0!==s.length&&a.open("general/message-box",{caption:"מחיקת כיתה",message:1===s.length?"האם להסיר את רישום הכיתה מבית הספר?":"האם להסיר את רישום הכיתות מבית הספר?",alert:!0,confirmText:"כן",cancelText:"לא"},function(e,a){!0===a&&function(e){return Vue.http.post("/api/v2/registration/project/1/teams/",e)}(s).then(function(){for(var e=0;e<t.teams.length;)0<=s.indexOf(t.teams[e].id)?t.teams.splice(e,1):e++})})}},watch:{}})});