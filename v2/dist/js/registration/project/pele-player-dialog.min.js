define(["templates/registration","utils","dialog"],function(e,r,s){return Vue.extend({template:e["pele-player-dialog"],el:"#validated-form",data:function(){return{player:{id:"",firstName:"",lastName:"",idNumberType:"",idNumber:"",gender:"",birthDate:"",isPele:"",peleJoinDate:""},newPlayer:!1,team:null,validYear:!0,error:""}},watch:{yearOfBirth:function(){var e=(new Date).getFullYear()-this.player.yearOfBirth;this.validYear=9<=e&&e<=19},isPele:function(){null==this.player.peleJoinDate||this.player.peleJoinDate}},computed:{yearOfBirth:function(){return this.player.yearOfBirth},isPele:function(){return this.player.isPele}},mounted:function(){var e=this;null==e.player.id?(e.newPlayer=!0,e.player.idNumberType=1):e.player=Object.assign({},e.player)},methods:{isValidIdNumber:function(){if("1"==this.player.idNumberType){var e=this.player.idNumber;if(0<e.toString().length)return r.isIdValid(e)}return!0},cancel:function(){this.$emit("close")},confirm:function(){var l=this,e="/api/v2/registration/project/3/player/"+l.player.idNumber+"/teams",p=l.team.id;l.error="",Vue.http.get(e).then(function(e){var r=e.data.filter(function(e){return e!=p});if(2<=r.length){var t=(1==l.player.gender?"ספורטאי זה כבר רשום ":"ספורטאית זו כבר רשומה ")+"ל-"+r.length+" קבוצות אחרות לא ניתן להוסיף לקבוצה זו";l.error=t}else{var a=l.player.isPele?1:0,i={isPele:a};1==a&&(i.peleJoinDate=l.player.peleJoinDate);var n={id:l.player.id,firstName:l.player.firstName,lastName:l.player.lastName,idNumberType:parseInt(l.player.idNumberType),idNumber:l.player.idNumber,birthDate:new Date(parseInt(l.player.yearOfBirth),0,1),gender:l.player.gender,item1:JSON.stringify(i),isPele:l.player.isPele?1:0,peleJoinDate:l.player.isPele?l.player.peleJoinDate:""};Vue.http.put("/api/v2/registration/project/3/teams/"+encodeURIComponent(l.team.id)+"/players",n).then(function(e){e.data.id&&(n.id=e.data.id),l.$emit("close",{team:l.team,player:n})}).catch(function(e){s.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof e.body?e.body:"שגיאה בשמירת קבוצה"})})}}).catch(function(e){s.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof e.body?e.body:"שגיאה בשמירת קבוצה"})})},validateForm:function(){var e=this.player;return!!(""!=e.firstName&&""!=e.lastName&&""!==e.idNumberType&&""!=e.idNumber&&e.yearOfBirth&&this.validYear&&void 0!==e.gender&&this.isValidIdNumber())}}})});