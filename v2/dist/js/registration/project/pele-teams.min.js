define(["templates/registration","services/access","dialog","utils"],function(e,t,i,s){var n=1,l=2;function r(o){Vue.http.get("/api/v2/registration/project/3/teams?players=1").then(function(e){o.teams=e.body,o.selectionCount=0,o.selectAll=!1,o.teams.forEach(function(e,t){if(e.index=t+1,e.sport=JSON.parse(e.item1),e.association=JSON.parse(e.item2),e.item3){var n=JSON.parse(e.item3);e.alternativeFacility=n.alternativeFacility,e.startDate=n.startDate,e.endDate=n.endDate}var a=Math.round(100*e.peleCount/e.players.length);e.isOk=e.activity&&1<e.activity.length&&9<e.players.length&&e.players.length<16&&20<=a&&a<=40,e.approvedByAdminAndSupervisor=0!=(e.approved&l)&&0!=(e.approved&l);for(var i=!1,s=0;!i&&s<o.sports.length;s++){var r=o.sports[s];i=r.name===e.sport.name&&!!r.team==!!e.sport.team}i||o.sports.push({name:e.sport.name,team:e.sport.team})}),o.totalTeams=o.teams.length,o.totalOkTeams=o.teams.filter(function(e){return e.isOk}).length,o.totalNotOkTeams=o.teams.filter(function(e){return!e.isOk}).length,o.totalApprovedTeams=o.teams.filter(function(e){return e.approvedByAdminAndSupervisor}).length})}function a(e){var t=e%60;return("0"+(e-t)/60).slice(-2)+":"+("0"+t).slice(-2)}function o(e,t){if(0==(e.approved&t))return"";var n=e.approvals?e.approvals["project-team:"+t]:null;if(n){var a=new Date(n.time);return("0"+a.getDate()).slice(-2)+"/"+("0"+(a.getMonth()+1)).slice(-2)+"/"+("000"+a.getFullYear()).slice(-4)+" "+("0"+a.getHours()).slice(-2)+":"+("0"+a.getMinutes()).slice(-2)+" "+n.firstName+" "+n.lastName}return"אושר"}return Vue.extend({template:e["pele-teams"],data:function(){return{user:t.user,teams:[],selectionCount:0,selectAll:!1,days:["א'","ב'","ג'","ד'","ה'","ו'"],sports:[{name:"כדורגל",team:!0},{name:"כדורסל",team:!0},{name:"אתלטיקה"},{name:"טניס"},{name:"ג׳ודו"},{name:"האבקות"},{name:"טקאוונדו"},{name:"קארטה"},{name:"איגרוף"},{name:"סיוף"},{name:"שחיה"},{name:"כדורעף",team:!0},{name:"כדוריד",team:!0},{name:"טניס שולחן",team:!0},{name:"החלקה אמנותית"},{name:"כדור ים"},{name:"טריאתלון"},{name:"התעמלות"},{name:"הרמת משקולות"},{name:"בדמינטון"},{name:"אופניים"},{name:"איגרוף"},{name:"היאבקות"},{name:"כדור יד"},{name:"טניס שולחן"}],facilityTypes:[{id:0,name:"מגרש"},{id:1,name:"אולם"},{id:2,name:"סטודיו"},{id:3,name:"בריכה"},{id:4,name:"אצטדיון"},{id:999,name:"אחר..."}],totalTeams:0,totalOkTeams:0,totalNotOkTeams:0,totalApprovedTeams:0,currentSeasonName:"",teamRegistrationDisabled:!1}},mounted:function(){var i=this;Vue.http.get("/api/v2/seasons").then(function(e){var t=e.body;if(null!=t)for(var n=0;n<t.length;n++){var a=t[n];if(a.id==i.user.season){i.currentSeasonName=a.name;break}}s.readServerCache("pele-team-registration",!0,function(e,t){i.teamRegistrationDisabled=!s.isTrue(t)})}),r(i)},methods:{handleSelectionChange:function(e){for(var t=this.selectionCount=0;t<this.teams.length;t++)this.teams[t].selected&&this.selectionCount++;this.selectAll=this.selectionCount==this.teams.length},handleSelectAll:function(){if(this.selectAll){for(var e=0;e<this.teams.length;e++)this.teams[e].selected=!0;this.selectionCount=this.teams.length}else{for(e=0;e<this.teams.length;e++)this.teams[e].selected=!1;this.selectionCount=0}},isFormValid:function(){return!0},next:function(){console.log("next")},getActivityText:function(e){var t=this.days;return e.map(function(e){return null!=e.day?t[e.day]+(null!=e.startTime?" "+a(e.startTime):"")+(null!=e.endTime?"-"+a(e.endTime):""):""}).join("; ")},getAgesText:function(e){for(var t=e.toString(2),n=["10","11","12","13","14","15","16","17","18"],a=[],i=t.length-1;0<=i;i--)"0"!=t[i]&&a.push(n[t.length-1-i]);return a.join(", ")},getSportName:function(t){if(0!=this.sports.length)return this.sports.find(function(e){return e.id===t}).name},getCertificationText:function(e){return 0===e?"מדריך":"מאמן"},getGender:function(e){switch(parseInt(e,10)){case 1:return"ספורטאים";case 2:return"ספורטאיות";case 3:return"מעורב";default:return""}},newTeam:function(){var n=this;i.open("registration/project/pele-team-dialog",{facilityTypes:n.facilityTypes,sports:n.sports},function(e,t){null!=t&&r(n)})},editTeam:function(){var n=this,e=this.teams.find(function(e){return e.selected});i.open("registration/project/pele-team-dialog",{facilityTypes:n.facilityTypes,sports:n.sports,team:e},function(e,t){null!=t&&r(n)})},deleteTeam:function(){var n=this,a=n.teams.filter(function(e){return e.selected}).map(function(e){return e.id});0!==a.length&&i.open("general/message-box",{caption:"מחיקת קבוצה",message:1===a.length?"האם להסיר את רישום הקבוצה מהרשות?":"האם להסיר את רישום הקבוצות מהרשות?",alert:!0,confirmText:"כן",cancelText:"לא"},function(e,t){!0===t&&function(e){return Vue.http.post("/api/v2/registration/project/3/teams/delete",e)}(a).then(function(){r(n)}).catch(function(e){i.open("general/message-box",{caption:"מחיקת קבוצה",message:"אירעה שגיאה במחיקת קבוצה, יש לוודא שלא משויכים שחקנים לקבוצה לפני מחיקתה",alert:!0})})})},next:function(){Vue.http.put("/api/v2/registration/project/3/status/2",{}),this.$emit("next")},isApprovedByAdmin:function(e){return o(e,n)},isApprovedBySportAdmin:function(e){return o(e,l)},isApproved:function(e){return e.approvedByAdminAndSupervisor?" כן":"לא"}},watch:{}})});