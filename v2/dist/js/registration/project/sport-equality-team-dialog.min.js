define(["templates/registration","dialog"],function(t,s){return Vue.extend({template:t["sport-equality-team-dialog"],el:"#validated-form",data:function(){return{team:{coach:{},activity:[{},{}],facility:{},sport:{name:"",team:!1,gender:0,sportType:0},association:{name:null}},ages:{a10:!1,a11:!1,a12:!1,a13:!1,a14:!1,a15:!1},newTeam:!1,selectedSport:null,selectedFacility:null,selectedFacilityType:null,otherFacilityType:"",newSport:!1,sports:[],startHours:[],endHours:[],duplicate:!1,facilityTypes:[],facilities:[],newFacility:!1,newFacilityType:!1,endDate:"",startDate:"",validationError:""}},watch:{selectedSport:function(){-1===this.selectedSport?(this.newSport=!0,this.team.sport={name:"",team:!1}):(this.newSport=!1,this.team.sport=this.sports[this.selectedSport])},selectedFacility:function(){-1==this.selectedFacility?this.newFacility=!0:(this.newFacility=!1,this.team.facility.id=this.facilities[this.selectedFacility].id)},selectedFacilityType:function(){this.selectedFacilityType==this.facilityTypes.length-1?this.newFacilityType=!0:(this.newFacilityType=!1,this.team.facility.type=this.facilityTypes[this.selectedFacilityType].id)},otherFacilityType:function(){this.team.facility.type=this.otherFacilityType},ages:{handler:function(){this.validateForm()},deep:!0}},mounted:function(){var a=this;a.sports=a.sports.slice(),a.team.sport&&a.sports.forEach(function(t){t.name===a.team.sport.name&&(a.team.sport.gender&&(t.gender=a.team.sport.gender),a.team.sport.sportType&&(t.sportType=a.team.sport.sportType))}),a.newTeam=null==a.team.id;for(var t=15;t<=23;t++)this.startHours.push({value:60*t,text:("0"+t).slice(-2)+":00"}),23!=t&&this.startHours.push({value:60*t+30,text:("0"+t).slice(-2)+":30"});for(t=16;t<=23;t++)this.endHours.push({value:60*t,text:("0"+t).slice(-2)+":00"}),23!=t&&this.endHours.push({value:60*t+30,text:("0"+t).slice(-2)+":30"});if(!a.newTeam){a.team={activity:a.team.activity.slice().map(function(t){return Object.assign({},t)}),ages:a.team.ages,association:Object.assign({},a.team.association),coach:Object.assign({},a.team.coach),facility:Object.assign({},a.team.facility),alternativeFacility:a.team.alternativeFacility,startDate:a.team.startDate,endDate:a.team.endDate,id:a.team.id,sport:Object.assign({},a.team.sport)},function(t,e){if(e)for(var a=e.toString(2),i=a.length-1;0<=i;i--)"1"==a[i]&&(t["a1"+(a.length-i-1)]=!0)}(a.ages,a.team.ages);for(var e=0;e<a.sports.length;e++){var i=a.sports[e];if(i.name===a.team.sport.name&&!!i.team==!!a.team.sport.team){a.selectedSport=e;break}}a.team.association.name&&0<a.team.association.name.trim().length&&(a.team.associationApprove=!0)}this.team.activity.forEach(function(t,e){a.computeEndTime(e)}),Vue.http.get("/api/v2/facilities").then(function(t){a.facilities=t.body;for(var e=0;e<a.facilities.length;e++)a.facilities[e].id===a.team.facility.id&&(a.selectedFacility=e)})},methods:{addActivityDay:function(){this.team.activity.push({})},removeActivityDay:function(t){this.team.activity.splice(t,1)},cancel:function(){this.$emit("close")},confirm:function(){var e=this,t={};e.newFacility?(t.name=e.team.facility.name,t.address=e.team.facility.address,t.type=e.team.facility.type):t.id=e.team.facility.id;var a={name:e.team.sport.name,team:e.team.sport.team,gender:e.team.sport.gender,sportType:e.team.sport.sportType},i={name:e.team.association.name,type:e.team.association.type},r={alternativeFacility:e.team.alternativeFacility,startDate:e.team.startDate,endDate:e.team.endDate},n={team:{isGroupSport:e.team.isGroupSport,ages:e.team.agesResult,item1:JSON.stringify(a),item2:JSON.stringify(i),item3:JSON.stringify(r),facility:t,activity:e.team.activity.map(function(t){return{day:t.day,endTime:t.endTime,startTime:t.startTime}}),coach:{name:e.team.coach.name,phoneNumber:e.team.coach.phoneNumber,email:e.team.coach.email,gender:e.team.coach.gender,certification:e.team.coach.certification},id:e.team.id}};Vue.http.put("/api/v2/registration/project/5/teams",n).then(function(t){e.$emit("close",e.team)}).catch(function(t){s.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof t.body?t.body:"שגיאה בשמירת קבוצה"})})},validateForm:function(){var t=this,e=t.team;return e.agesResult=function(t){var e=0;return t.a10&&(e|=1),t.a11&&(e|=2),t.a12&&(e|=4),t.a13&&(e|=8),t.a14&&(e|=16),t.a15&&(e|=32),t.a16&&(e|=64),t.a17&&(e|=128),t.a18&&(e|=256),e}(t.ages),function(t,e){if(""===e.sport.name.trim())return!(t.validationError="יש לבחור ענף ספורט");if(null==e.sport.gender||e.sport.gender<1)return!(t.validationError="יש לבחור מגדר");if(0===e.agesResult)return!(t.validationError="יש לבחור גילאים");if(null==e.association.type)return!(t.validationError="יש לבחור שיוך לאגודה");if(5==e.association.type&&(!e.association.name||""===e.association.name.trim()))return!(t.validationError="יש להזין שם אגודה");if(0<e.association.type&&!e.associationApprove)return!(t.validationError="יש להצהיר שהקבוצה שייכת לאגודה");if(!function(t,e){for(var a=!0,i=0;i<e.length;i++){var r=t[e[i]];if(void 0===r||null==r){a=!1;break}if(0===r.toString().length){a=!1;break}}return a}(e.coach,["phoneNumber","email","name","gender","certification"]))return!(t.validationError="יש להזין פרטי מאמן מלאים");var a=function(t){if(t.length<2)return!1;var e=!0;for(var a in t)if(!t[a].day||!t[a].startTime||!t[a].endTime){e=!1;break}return e}(e.activity);return t.validationError=a?"":"יש להזין זמני פעילות תקינים",a}(t,e)},computeEndTime:function(t){var e=this.team.activity[t],a=this.startHours.findIndex(function(t){return t.value==e.startTime});e.endHours=this.endHours.slice(a)}}})});