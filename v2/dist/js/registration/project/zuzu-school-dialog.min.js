define(["templates/registration","utils","dialog","consts"],function(e,o,s,t){var i={notLoaded:1,new:2,edit:3,import:4,loading:5};function c(e){return Vue.http.put("/api/v2/registration/project/1/schools/"+e.id,e)}function l(e){return Vue.http.post("/api/v2/registration/project/1/schools",e)}return Vue.extend({template:e["zuzu-school-dialog"],data:function(){return{symbol:"",name:"",fax:"",email:"",id:"",city:"",classes:"",address:"",phoneNumber:"",school:{},coordinator:{},principal:{},schemeDescription:"",scheme:"",state:i.notLoaded,states:i,availableSchools:[],filteredSchools:[],selectedSchools:[],search:""}},mounted:function(){var s=this;s.state!=i.edit?function(e){return Vue.http.get("/api/v2/schools?region="+e)}().then(function(e){s.availableSchools=e.data,s.filteredSchools=e.data},function(e){console.log(e)}):(this.symbol=this.school.symbol,this.name=this.school.name,this.fax=this.school.details.fax,this.email=this.school.details.email,this.id=this.school.id,this.classes="",this.address=this.school.details.address,this.phoneNumber=this.school.details.phoneNumber,this.coordinator=this.school.coordinator,this.principal=this.school.principal,this.scheme=this.school.scheme,this.schemeDescription=this.school.schemeDescription)},watch:{},methods:{symbolValid:function(){return!0},searchButtonClicked:function(e){e.preventDefault();var s=this.search,o=this;o.filteredSchools=[],s?(o.availableSchools.forEach(function(e){0<=e.symbol.toString().indexOf(s)&&o.filteredSchools.push(e)}),o.filteredSchools=o.filteredSchools.slice()):o.filteredSchools=o.availableSchools},handleSelectionChange:function(){var s=this;s.selectedSchools=[],s.availableSchools.forEach(function(e){e.selected&&s.selectedSchools.push(e)}),s.selectedSchools=s.selectedSchools.slice()},cancel:function(){this.$emit("close")},sendSelectedSchools:function(){var s=this;0<s.selectedSchools.length&&function(e){var s=[];return e.forEach(function(e){s.push(Vue.http.post("/api/v2/registration/project/1/schools",{school:e.id,city:e.city.id}))}),o.promiseAll(s)}(s.selectedSchools).then(function(e){s.$emit("close",{schools:s.selectedSchools})},function(e){console.log(e)})},addButtonClicked:function(){this.state=i.new},save:function(){var e=this,s={symbol:this.symbol,id:this.id,name:this.name,fax:this.fax,email:this.email,classes:this.classes,address:this.address,phoneNumber:this.phoneNumber,coordinator:this.coordinator,principal:this.principal,scheme:this.scheme,schemeDescription:2==this.scheme?this.schemeDescription:null};(s.id?c:l)(s).then(function(){e.$emit("close",s)})},validateForm:function(){return 0==document.querySelectorAll("#dialog-form :invalid").length}}})});