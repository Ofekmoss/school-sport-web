define(["templates/registration","dialog"],function(e,t){var r=1,g=2;return Vue.extend({template:e["pele-players"],data:function(){return{teams:[],maxTeamPlayers:15,selectionCount:0,totalPlayers:0}},computed:{},mounted:function(){var r=this;!function(f,d){Vue.http.get("/api/v2/registration/project/3/teams?players=true").then(function(e){for(var t=e.body,r={},n=f.totalPlayers=0;n<t.length;n++){var a=t[n];if(a.approvedByAdminAndSupervisor=0!=(a.approved&g)&&0!=(a.approved&g),a.item1){var l=JSON.parse(a.item1);a.sport=l.name,a.gender=l.gender,a.isGroup=l.team}f.totalPlayers+=a.players.length;for(var i=0;i<a.players.length;i++){var o=a.players[i];if(l=null,o.item1&&(l=JSON.parse(o.item1)),l&&(o.isPele=l.isPele,o.peleJoinDate=l.peleJoinDate),!o.yearOfBirth&&o.birthDate&&(o.yearOfBirth=new Date(o.birthDate).getFullYear()),o.idNumber){var s=o.idNumber.toString();r[s]||(r[s]=[]),null==r[s].find(function(e){return e.id===a.id})&&r[s].push(a)}}}for(var p in r){var u=r[p];if(1<u.length){var c=u.map(function(e){return e.sport+" "+f.getTeamGender(e.gender)+" - "+e.id});u.forEach(function(e){e.players.forEach(function(e){if(e.idNumber==p){var t=1==e.gender;e.multipleTeams=!0,e.tooltip=(t?"ספורטאי זה רשום ":"ספורטאית זו רשומה")+"לקבוצות הבאות: "+c.join(", ")}})})}}$(".cloned-table").remove(),window.setTimeout(function(){var e=$(".pele-players").first(),t=e.clone(!0);t.css("max-width","600px"),t.css("margin-right","150px"),t.addClass("cloned-table"),t.insertAfter($("#target")),t.find("tr").not(":last").hide(),e.find("tr").last().hide(),window.setInterval(function(){e.is(":visible")?(t.show(),$(".cloned-table").last().find("tr").last().show()):t.hide()},200)},500),d(null,t)})}(r,function(e,t){r.teams=t})},methods:{togglePanel:function(e){e.__panelOpen=!e.__panelOpen,this.teams=this.teams.slice()},toggleAllPanels:function(){var t=this;t.teams.forEach(function(e){t.togglePanel(e)})},getIdType:function(e){return 1==e?"תעודת זהות":"דרכון"},getGender:function(e){return 1==e?"זכר":"נקבה"},getTeamGender:function(e){switch(parseInt(e,10)){case 1:return"ספורטאים";case 2:return"ספורטאיות";case 3:return"מעורב";default:return""}},getIsPele:function(e){return 1===e?"כן":"לא"},handleSelectionChange:function(e){for(var t=e.selectionCount=0;t<e.players.length;t++)e.players[t].selected&&e.selectionCount++;e.selectAll=e.selectionCount==e.players.length},handleSelectAll:function(e){if(e.selectAll){for(var t=0;t<e.players.length;t++)e.players[t].selected=!0;e.selectionCount=e.players.length}else{for(t=0;t<e.players.length;t++)e.players[t].selected=!1;e.selectionCount=0}},newPlayer:function(r){t.open("registration/project/pele-player-dialog",{team:r},function(e,t){null!=t&&(t.player.yearOfBirth=t.player.birthDate.getFullYear(),r.players.push(t.player))})},editPlayer:function(n){var e=n.players.find(function(e){return e.selected});t.open("registration/project/pele-player-dialog",{team:n,player:e},function(e,t){if(null!=t){t.player.yearOfBirth=t.player.birthDate.getFullYear();for(var r=0;r<n.players.length;r++){if(n.players[r].id==t.player.id){n.players.splice(r,1,t.player);break}}}})},deletePlayers:function(r){var n=r.players.filter(function(e){return e.selected}).map(function(e){return e.id});0!==n.length&&t.open("general/message-box",{caption:"מחיקת שחקן",message:1===n.length?"האם להסיר את רישום השחקן מהקבוצה?":"האם להסיר את רישום השחקנים מהקבוצה?",alert:!0,confirmText:"כן",cancelText:"לא"},function(e,t){!0===t&&function(e,t){return Vue.http.post("/api/v2/registration/project/3/teams/"+encodeURIComponent(e)+"/players/delete",t)}(r.id,n).then(function(){for(var e=0;e<r.players.length;)0<=n.indexOf(r.players[e].id)?r.players.splice(e,1):e++})})},getPelePercentPopulation:function(e){var t=null==e?this.totalPlayers:e.players.length,r=this.peleCount(e);return 0<t?(r/t*100).toFixed(2):-1},peleCount:function(e){var t=this;if(null!=e)return e.players.filter(function(e){return e.isPele}).length;var r=0;return t.teams&&t.teams.forEach(function(e){r+=t.peleCount(e)}),r},checkAges:function(e){var r=(new Date).getFullYear(),n=[10,12],a=[13,18],l={ageGroup1:0,ageGroup2:0};return e.players.forEach(function(e){var t=r-e.yearOfBirth;n[0]<=t&&t<=n[1]?l.ageGroup1++:a[0]<=t&&t<=a[1]&&l.ageGroup2++}),0<l.ageGroup1&&0<l.ageGroup2},isApprovedBySportAdmin:function(e){return 0!=(e.approved&g)},isApprovedByAdmin:function(e){return 0!=(e.approved&r)},isApproved:function(e){return e.approvedByAdminAndSupervisor}},watch:{}})});