define(["templates/registration","dialog"],function(e,i){return Vue.extend({template:e["project-school-details"],props:["project","school"],data:function(){return{principal:{},coordinator:{},scheme:null,schemeDescription:null,name:null,symbol:null,details:{},updating:!1,isFormValid:!1}},mounted:function(){var t=this;t.project&&t.school&&Vue.http.get("/api/v2/registration/project/"+encodeURIComponent(t.project.id)+"/schools/"+encodeURIComponent(t.school.id)).then(function(e){t.name=e.data.name,t.symbol=e.data.symbol,t.details=e.data.details||{canChange:!0},t.principal=e.data.principal||{canChange:!0},t.coordinator=e.data.coordinator||{};var i=null;if(e.data.item1)try{i=JSON.parse(e.data.item1)}catch(e){i=null}null==i?(t.scheme=null,t.schemeDescription=null):"number"==typeof i?(t.scheme=i,t.schemeDescription=null):(t.scheme=3,t.schemeDescription=i)},function(e){console.log(e)})},methods:{checkIsEmpty:function(e){return!e||0===e.trim().length},checkIsContactValid:function(e){return!this.checkIsEmpty(e.name)&&!this.checkIsEmpty(e.phoneNumber)&&!this.checkIsEmpty(e.email)},updateIsFormValid:function(){if(this.details.canChange&&(this.checkIsEmpty(this.details.phoneNumber)||this.checkIsEmpty(this.details.fax)||this.checkIsEmpty(this.details.address)))return console.log(this.details),void(this.isFormValid=!1);if(this.principal.canChange&&!this.checkIsContactValid(this.principal))return console.log("principal invalid"),void(this.isFormValid=!1);if(!this.checkIsContactValid(this.coordinator))return console.log("coordinator invalid"),void(this.isFormValid=!1);var e=parseInt(this.scheme);console.log("scheme?"),this.isFormValid=1===e||2===e||3===e&&!this.checkIsEmpty(this.schemeDescription)},next:function(){var i=this,e=parseInt(this.scheme),t={coordinator:{name:this.coordinator.name,phoneNumber:this.coordinator.phoneNumber,email:this.coordinator.email},item1:JSON.stringify(3===e?this.schemeDescription:e)};this.details.canChange&&(t.details={address:this.details.address,phoneNumber:this.details.phoneNumber,fax:this.details.fax,email:this.details.email}),this.principal.canChange&&(t.principal={name:this.principal.name,phoneNumber:this.principal.phoneNumber,email:this.principal.email}),Vue.http.put("/api/v2/registration/project/"+encodeURIComponent(i.project.id)+"/schools/"+encodeURIComponent(i.school.id),t).then(function(e){i.school={id:i.school.id,name:i.school.name,symbol:i.school.symbol,stage:1},i.$emit("update:school",i.school)},function(e){console.log(e)})}},watch:{details:{handler:function(){this.updateIsFormValid()},deep:!0},principal:{handler:function(){this.updateIsFormValid()},deep:!0},coordinator:{handler:function(){this.updateIsFormValid()},deep:!0},scheme:function(){this.updateIsFormValid()},schemeDescription:function(){this.updateIsFormValid()}}})});