define(["templates/registration","dialog"],function(e,a){return Vue.extend({template:e["project-teams"],props:["project","school"],data:function(){return{updating:!1,selectionCount:0,teams:[],grades:[{value:5,name:"ה'"},{value:6,name:"ו'"}],gradeClasses:[{value:0,name:"1'"},{value:1,name:"2'"},{value:2,name:"3'"},{value:3,name:"4'"},{value:4,name:"5'"},{value:5,name:"6'"},{value:6,name:"7'"},{value:7,name:"8'"},{value:8,name:"9'"},{value:9,name:"10'"}],gradeClassesTypes:[{value:0,name:"כיתה רגילה"},{value:1,name:"חינוך מיוחד"},{value:2,name:"כיתה קטנה"}],teamColumns:[{key:"gradeIndex.name",name:"שכבה",active:!0},{key:"gradeClass",name:"כיתה",active:!0},{key:"gradeClassType",name:"סוג כיתה",active:!0},{key:"studentCount",name:"מספר תלמידים",active:!0},{key:"part1",name:"שליש א'",active:!0},{key:"part2",name:"שליש ב'",active:!0},{key:"part3",name:"שליש ג'",active:!0}],items:[],selectedTeam:null}},mounted:function(){var a=this;a.project&&a.school&&(Vue.http.get("/api/v2/registration/project/"+a.project.id).then(function(e){a.items.push({value:0,name:e.data.item1}),a.items.push({value:1,name:e.data.item2}),a.items.push({value:2,name:e.data.item3})},function(e){console.log(e)}),Vue.http.get("/api/v2/registration/project/"+encodeURIComponent(a.project.id)+"/schools/"+encodeURIComponent(a.school.id)).then(function(e){a.teams=function(e,t,s,n){return e.forEach(function(e){e.part1=JSON.parse(e.item1),e.part2=JSON.parse(e.item2),e.part3=JSON.parse(e.item3);var a=e.ages+"";e.gradeIndex=t[a[1]],e.gradeClass=t[a[1]].name+s[a[2]].name,e.gradeClassType=n[a[3]].name}),e}(e.data.teams,a.grades,a.gradeClasses,a.gradeClassesTypes)},function(e){console.log(e)}))},methods:{handleSelectionChange:function(){this.selectionCount=this.teams.filter(function(e){return e.selected}).length},addTeam:function(){var r=this;a.open("registration/project/project-team-dialog",{items:r.items,school:r.school.id,teams:r.teams},function(e,a){if(null!=a){var t=a.gradeIndex,s=a.gradeClass,n=a.gradeClassType;a.gradeIndex=r.grades[t],a.gradeClass=r.grades[t].name+r.gradeClasses[s].name,a.gradeClassType=r.gradeClassesTypes[n].name,r.teams.push(a)}})},editTeam:function(){var i=this,e=this.teams.find(function(e){return e.selected}),m=JSON.parse(JSON.stringify(e));a.open("registration/project/project-team-dialog",{items:i.items,school:i.school.id,teams:i.teams,team:m},function(e,a){if(null!=a){var t=a.gradeIndex,s=a.gradeClass,n=a.gradeClassType;a.gradeIndex=i.grades[t],a.gradeClass=i.grades[t].name+i.gradeClasses[s].name,a.gradeClassType=i.gradeClassesTypes[n].name;var r=i.teams.find(function(e){return e.id==m.id});a.part1=JSON.parse(a.item1),a.part2=JSON.parse(a.item1),a.part3=JSON.parse(a.item1),Object.assign(r,a),i.teams=i.teams.slice()}})},deleteTeams:function(){},complete:function(){}}})});