function imageError(e){$(e).replaceWith("<span>הורדה</span>")}define(["templates/registration","dialog","utils"],function(e,c,t){var r=1,m=2;function n(e,p,s,u){var t={projectId:5,projectName:"שווים בספורט",projectTeam:p.sport+" "+e.getTeamGender(p.gender),existingTeamPlayers:p.players||[]};if(null!=s)for(var r in s)s.hasOwnProperty(r)&&(t[r]=s[r]);c.open("registration/player-dialog",t,function(e,t){if(null!=t){var r={projectJoinDate:t.projectJoinDate},n={id:s?s.id:-1,firstName:t.firstName,lastName:t.lastName,idNumber:s?s.idNumber:t.idNumber,yearOfBirth:t.yearOfBirth,birthDate:new Date(parseInt(t.yearOfBirth),0,1),gender:t.gender,item1:JSON.stringify(r),projectJoinDate:t.projectJoinDate,picture:t.picture,idSlip:t.idSlip,medicalApproval:t.medicalApproval},a=new FormData;for(var i in n){var o=n[i];null!=o&&(parseInt(o,10)===o&&(o=o.toString()),a.append(i,o))}var l="/api/v2/registration/project/5/teams/"+encodeURIComponent(p.id)+"/players";Vue.http.put(l,a).then(function(e){e.data.id&&(n.id=e.data.id),t.id=e.data.id,t.picture=e.data.picture,t.idSlip=e.data.idSlip,t.medicalApproval=e.data.medicalApproval,u(t)}).catch(function(e){c.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof e.body?e.body:"שגיאה בשמירת קבוצה"})})}})}return Vue.extend({template:e["sport-equality-players"],data:function(){return{teams:[],maxTeamPlayers:15,selectionCount:0,totalPlayers:0}},computed:{},mounted:function(){var r=this;!function(d,f){Vue.http.get("/api/v2/registration/project/5/teams?players=true").then(function(e){for(var t=e.body,r={},n=d.totalPlayers=0;n<t.length;n++){var a=t[n];if(a.approvedByAdminAndSupervisor=0!=(a.approved&m)&&0!=(a.approved&m),a.item1){var i=JSON.parse(a.item1);a.sport=i.name,a.gender=i.gender,a.isGroup=i.team}d.totalPlayers+=a.players.length;for(var o=0;o<a.players.length;o++){var l=a.players[o];if(l.item1&&(i=JSON.parse(l.item1)).projectJoinDate&&(l.projectJoinDate=new Date(i.projectJoinDate)),!l.yearOfBirth&&l.birthDate&&(l.yearOfBirth=new Date(l.birthDate).getFullYear()),l.idNumber){var p=l.idNumber.toString();r[p]||(r[p]=[]),null==r[p].find(function(e){return e.id===a.id})&&r[p].push(a)}}}for(var s in r){var u=r[s];if(1<u.length){var c=u.map(function(e){return e.sport+" "+d.getTeamGender(e.gender)+" - "+e.id});u.forEach(function(e){e.players.forEach(function(e){if(e.idNumber==s){var t=1==e.gender;e.multipleTeams=!0,e.tooltip=(t?"ספורטאי זה רשום ":"ספורטאית זו רשומה")+"לקבוצות הבאות: "+c.join(", ")}})})}}$(".cloned-table").remove(),window.setTimeout(function(){},500),f(null,t)})}(r,function(e,t){r.teams=t})},methods:{togglePanel:function(e){e.__panelOpen=!e.__panelOpen,this.teams=this.teams.slice()},toggleAllPanels:function(){var t=this;t.teams.forEach(function(e){t.togglePanel(e)})},getIdType:function(e){return 1==e?"תעודת זהות":"דרכון"},getGender:function(e){switch(parseInt(e,10)){case 0:case 2:return"נקבה";case 1:return"זכר";default:return""}},formatDate:function(e){return t.formatDate(e,"dd/MM/yyyy")},getTeamGender:function(e){switch(parseInt(e,10)){case 1:return"ספורטאים";case 2:return"ספורטאיות";case 3:return"מעורב";default:return""}},getIsPele:function(e){return 1===e?"כן":"לא"},handleSelectionChange:function(e){for(var t=e.selectionCount=0;t<e.players.length;t++)e.players[t].selected&&e.selectionCount++;e.selectAll=e.selectionCount==e.players.length},handleSelectAll:function(e){if(e.selectAll){for(var t=0;t<e.players.length;t++)e.players[t].selected=!0;e.selectionCount=e.players.length}else{for(t=0;t<e.players.length;t++)e.players[t].selected=!1;e.selectionCount=0}},newPlayer:function(t){n(this,t,null,function(e){t.players.push(e)})},editPlayer:function(e){var t=e.players.find(function(e){return e.selected});if(null!=t){n(this,e,t,function(e){t.firstName=e.firstName,t.lastName=e.lastName,t.yearOfBirth=e.yearOfBirth,t.gender=e.gender,t.projectJoinDate=e.projectJoinDate,null!=e.picture&&0<e.picture.length&&(t.picture=e.picture),null!=e.idSlip&&0<e.idSlip.length&&(t.idSlip=e.idSlip),null!=e.medicalApproval&&0<e.medicalApproval.length&&(t.medicalApproval=e.medicalApproval)})}},deletePlayers:function(r){var n=r.players.filter(function(e){return e.selected}).map(function(e){return e.id});0!==n.length&&c.open("general/message-box",{caption:"מחיקת שחקן",message:1===n.length?"האם להסיר את רישום השחקן מהקבוצה?":"האם להסיר את רישום השחקנים מהקבוצה?",alert:!0,confirmText:"כן",cancelText:"לא"},function(e,t){!0===t&&function(e,t){return Vue.http.post("/api/v2/registration/project/5/teams/"+encodeURIComponent(e)+"/players/delete",t)}(r.id,n).then(function(){for(var e=0;e<r.players.length;)0<=n.indexOf(r.players[e].id)?r.players.splice(e,1):e++})})},checkAges:function(e){var r=(new Date).getFullYear(),n=[10,12],a=[13,18],i={ageGroup1:0,ageGroup2:0};return e.players.forEach(function(e){var t=r-e.yearOfBirth;n[0]<=t&&t<=n[1]?i.ageGroup1++:a[0]<=t&&t<=a[1]&&i.ageGroup2++}),0<i.ageGroup1&&0<i.ageGroup2},isApprovedBySportAdmin:function(e){return 0!=(e.approved&m)},isApprovedByAdmin:function(e){return 0!=(e.approved&r)},isApproved:function(e){return e.approvedByAdminAndSupervisor}},watch:{}})});