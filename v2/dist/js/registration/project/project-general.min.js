define(["templates/registration","dialog","components/selectex","generic/data-table"],function(t,e){return Vue.extend({template:t["project-general"],props:["project","school"],data:function(){return{item1:null,item2:null,item3:null,stage:null,schools:null,newSchool:null,selectedSchool:null,projectSchools:[],schoolColumns:[{key:"symbol",name:"סמל בית ספר",active:!0},{key:"name",name:"שם בתי ספר",active:!0},{key:"teamCount",name:"כיתות",active:!0},{key:"studentCount",name:"תלמידים",active:!0}],updating:!1}},mounted:function(){var s=this;s.project&&Vue.http.get("/api/v2/schools").then(function(t){s.schools=t.data,Vue.http.get("/api/v2/registration/project/"+s.project.id).then(function(t){if(s.stage=t.data.stage||0,s.item1=t.data.item1,s.item2=t.data.item2,s.item3=t.data.item3,t.data.schools)for(var e=0;e<t.data.schools.length;e++){var o=t.data.schools[e];s.projectSchools.push(o);for(var i=0;i<s.schools.length;i++)if(s.schools[i].id==o.id){s.schools.splice(i,1);break}}},function(t){console.log(t)})},function(t){console.log(t)})},methods:{getSchoolHtml:function(t){return"<small>"+t.symbol+"</small><span> "+t.name+" </span>"},updateItems:function(){if((0==this.stage||1==this.stage&&0==this.schoos.length)&&null!=this.item1&&0<this.item1.length&&null!=this.item2&&0<this.item2.length&&null!=this.item3&&0<this.item3.length){var e=this,t=e.stage;0==e.stage&&(t=1),e.updating=!0,Vue.http.put("/api/v2/registration/project/"+e.project.id,{item1:e.item1,item2:e.item2,item3:e.item3,stage:t}).then(function(t){e.updating=!1,e.stage=t.data.stage},function(t){e.updating=!1,console.log(t)})}},editItems:function(){1==this.stage&&0==this.projectSchools.length&&(this.stage=0)},addSchool:function(){if(this.newSchool){var o=this;o.updating=!0,Vue.http.post("/api/v2/registration/project/"+o.project.id+"/schools",{school:this.newSchool.id}).then(function(t){o.updating=!1,o.projectSchools.push(o.newSchool);for(var e=0;e<o.schools.length;e++)if(o.schools[e].id==o.newSchool.id){o.schools.splice(e,1);break}o.school=o.newSchool,o.newSchool=null,o.$emit("update:school",o.school)},function(t){o.updating=!1,console.log(t)})}},handleSelectionChange:function(t){this.selectedSchool=t},editSchool:function(){this.school=this.selectedSchool,this.$emit("update:school",this.school)}}})});