define(["templates/registration","dialog"],function(t,a){return Vue.extend({template:t["pele-team-dialog"],el:"#validated-form",data:function(){return{team:{coach:{},activity:[{},{}],facility:{},sport:{name:"",team:!1,gender:0},association:{name:null}},ages:{a10:!1,a11:!1,a12:!1,a13:!1,a14:!1,a15:!1,a16:!1,a17:!1,a18:!1},newTeam:!1,selectedSport:null,selectedFacility:null,selectedFacilityType:null,otherFacilityType:"",newSport:!1,sports:[],startHours:[],endHours:[],duplicate:!1,facilityTypes:[],facilities:[],newFacility:!1,newFacilityType:!1,endDate:"",startDate:""}},watch:{selectedSport:function(){-1===this.selectedSport?(this.newSport=!0,this.team.sport={name:"",team:!1}):(this.newSport=!1,this.team.sport=this.sports[this.selectedSport])},selectedFacility:function(){-1==this.selectedFacility?this.newFacility=!0:(this.newFacility=!1,this.team.facility.id=this.facilities[this.selectedFacility].id)},selectedFacilityType:function(){this.selectedFacilityType==this.facilityTypes.length-1?this.newFacilityType=!0:(this.newFacilityType=!1,this.team.facility.type=this.facilityTypes[this.selectedFacilityType].id)},otherFacilityType:function(){this.team.facility.type=this.otherFacilityType},ages:{handler:function(){this.validateForm()},deep:!0}},mounted:function(){this.sports=this.sports.slice();var i=this;i.team.sport&&i.team.sport.gender&&i.sports.forEach(function(t){t.name===i.team.sport.name&&(t.gender=i.team.sport.gender)}),i.sports.sort(function(t,e){var i=t.name.localeCompare(e.name);return 0==i?(t.team?1:0)-(e.team?1:0):i}),i.newTeam=null==i.team.id;for(var t=15;t<=23;t++)this.startHours.push({value:60*t,text:("0"+t).slice(-2)+":00"}),23!=t&&this.startHours.push({value:60*t+30,text:("0"+t).slice(-2)+":30"});for(t=16;t<=23;t++)this.endHours.push({value:60*t,text:("0"+t).slice(-2)+":00"}),23!=t&&this.endHours.push({value:60*t+30,text:("0"+t).slice(-2)+":30"});if(!i.newTeam){i.team={activity:i.team.activity.slice().map(function(t){return Object.assign({},t)}),ages:i.team.ages,association:Object.assign({},i.team.association),coach:Object.assign({},i.team.coach),facility:Object.assign({},i.team.facility),alternativeFacility:i.team.alternativeFacility,startDate:i.team.startDate,endDate:i.team.endDate,id:i.team.id,sport:Object.assign({},i.team.sport)},function(t,e){if(e)for(var i=e.toString(2),a=i.length-1;0<=a;a--)"1"==i[a]&&(t["a1"+(i.length-a-1)]=!0)}(i.ages,i.team.ages);for(var e=0;e<i.sports.length;e++){var a=i.sports[e];if(a.name===i.team.sport.name&&!!a.team==!!i.team.sport.team){i.selectedSport=e;break}}i.team.association.name&&0<i.team.association.name.trim().length&&(i.team.associationApprove=!0)}this.team.activity.forEach(function(t,e){i.computeEndTime(e)}),Vue.http.get("/api/v2/facilities").then(function(t){i.facilities=t.body;for(var e=0;e<i.facilities.length;e++)i.facilities[e].id===i.team.facility.id&&(i.selectedFacility=e)})},methods:{addActivityDay:function(){this.team.activity.push({})},removeActivityDay:function(t){this.team.activity.splice(t,1)},cancel:function(){this.$emit("close")},confirm:function(){var e=this,t={};this.newFacility?(t.name=this.team.facility.name,t.address=this.team.facility.address,t.type=this.team.facility.type):t.id=this.team.facility.id;var i={team:{isGroupSport:this.team.isGroupSport,ages:this.team.agesResult,item1:JSON.stringify({name:this.team.sport.name,team:this.team.sport.team,gender:this.team.sport.gender}),item2:JSON.stringify({name:this.team.association.name}),item3:JSON.stringify({alternativeFacility:this.team.alternativeFacility,startDate:this.team.startDate,endDate:this.team.endDate}),facility:t,activity:this.team.activity.map(function(t){return{day:t.day,endTime:t.endTime,startTime:t.startTime}}),coach:{name:this.team.coach.name,phoneNumber:this.team.coach.phoneNumber,email:this.team.coach.email,gender:this.team.coach.gender,certification:this.team.coach.certification},id:this.team.id}};Vue.http.put("/api/v2/registration/project/3/teams",i).then(function(t){e.$emit("close",e.team)}).catch(function(t){a.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof t.body?t.body:"שגיאה בשמירת קבוצה"})})},validateForm:function(){var t=this.team;return t.agesResult=function(t){var e=0;return t.a10&&(e|=1),t.a11&&(e|=2),t.a12&&(e|=4),t.a13&&(e|=8),t.a14&&(e|=16),t.a15&&(e|=32),t.a16&&(e|=64),t.a17&&(e|=128),t.a18&&(e|=256),e}(this.ages),!!(""!==t.sport.name.trim()&&(!t.sport.team||0<t.sport.gender)&&0!==t.agesResult&&(!t.association.name||t.association.name&&t.associationApprove)&&t.coach.phoneNumber&&t.coach.email&&t.coach.name&&void 0!==t.coach.gender&&void 0!==t.coach.certification&&function(t){if(t.length<2)return!1;var e=!0;for(var i in t)if(!t[i].day||!t[i].startTime||!t[i].endTime){e=!1;break}return e}(t.activity))},computeEndTime:function(t){var e=this.team.activity[t],i=this.startHours.findIndex(function(t){return t.value==e.startTime});e.endHours=this.endHours.slice(i)}}})});