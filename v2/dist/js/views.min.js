define([],function(){var f=null,l={};var u={views:[],tabs:[],selected:null,openView:function(e,t){if(t){var n=Object.keys(t).map(function(e){var n=t[e];return encodeURIComponent(e)+(null!=n?"="+encodeURIComponent(n):"")}).join("&");0<n.length&&(e+="?"+n)}var i=e.toString();location.hash&&0<=location.hash.indexOf("login?token=")?Vue.http.get("/api/v2/login").then(function(e){var n=!1;if(e.body.roles)for(var t=0;t<e.body.roles.length;t++){if(0<e.body.roles[t].indexOf("-approval")){n=!0;break}}if(n)location.hash="/"+i;else{var o=e.body.name;confirm("הנך מחובר למערכת בתור "+o+", האם לבצע ניתוק?")?Vue.http.post("/api/v2/logout").then(function(){console.log("logged out")}):location.hash="/"+i}}):location.hash="/"+i},updateParam:function(e,n,t){var o=location.hash;if(o){var i=0;"#"===o[0]&&i++,"/"===o[i]&&i++,0<i&&(o=o.slice(i));var s=o.indexOf("?"),l={};if(0<=s){for(var a=o.slice(s+1).split("&"),r=0;r<a.length;r++){var c=a[r],d=c.indexOf("=");0<d?l[decodeURIComponent(c.slice(0,d))]=decodeURIComponent(c.slice(d+1)):l[decodeURIComponent(c)]=!0}o=o.slice(0,s)}if(e.def||(console.log("no def"),console.log(e)),o===e.def.route&&l[n]!==t){if(l[n]=t,e.params[n]=t,l)0<(a=Object.keys(l).map(function(e){var n=l[e];return encodeURIComponent(e)+(null!=n?"="+encodeURIComponent(n):"")}).join("&")).length&&(o+="?"+a);f="#/"+o,location.hash=f}}},reset:function(){for(var e=0;e<u.views.length;e++){var n=u.views[e];n.component&&(n.component.$destroy(),n.component=null)}u.views.splice(0,u.views.length),u.tabs.splice(0,u.tabs.length),l={}},selectView:function(e){this.openView(e.def.route,e.params)},closeView:function(n){var e=this.views.findIndex(function(e){return e.def.route===n.def.route});if(0<=e){this.views.splice(e,1);for(var t=0;t<this.tabs.length;t++){var o=this.tabs[t],i=o.views.indexOf(n);if(0<=i){o.last==n&&(o.last=null),o.views.splice(i,1),0===o.views.length&&this.tabs.splice(t,1);break}}n.selected&&(n.component&&(n.component.$destroy(),n.component=null),0<e?this.selectView(u.views[e-1]):e<u.views.length&&this.selectView(u.views[e]))}}};function h(e){if(e.selected=!0,e.component.tabName)for(var n=e.component.tabName,t=0;t<u.tabs.length;t++){var o=u.tabs[t];o.name===n?(o.selected=!0,o.last=e):o.selected=!1}u.selected=e}function t(){var r=location.hash;if(r){var e=0;"#"===r[0]&&e++,"/"===r[e]&&e++,0<e&&(r=r.slice(e));var c=r,n=r.indexOf("?"),d={};if(0<=n){for(var t=r.slice(n+1).split("&"),o=0;o<t.length;o++){var i=t[o],s=i.indexOf("=");0<s&&(d[decodeURIComponent(i.slice(0,s))]=decodeURIComponent(i.slice(s+1)))}r=r.slice(0,n)}!function(n,t){var o=l[n];o?!1===o?t("Failed to load route "+n):t(null,o):require([n],function(e){l[n]=o={route:n,component:e},t(null,o)},function(e){l[n]=!1,t("Failed to load route "+n+"\n"+e),requirejs.undef(n)})}(r,function(e,n){if(e)console.log(e);else{if(u.selected&&u.selected.def.route===r&&u.selected.component&&u.selected.component.updateView instanceof Function&&u.selected.component.updateView(d))return void(u.selected.link=c);for(var t=0;t<u.views.length;t++){var o=u.views[t];if(o.def.route===r){var i=!0;for(var s in d)if(d[s]!=o.params[s]){i=!1;break}if(i)for(var s in o.params)if(void 0===d[s]){i=!1;break}if(i){if(o.component){for(var l=0;l<u.views.length;l++){(a=u.views[l])!==o&&a.component&&(a.component.$el.style.display="none",a.selected=!1)}o.component.$el.style.display=null,h(o)}return}}}u.name=r;for(l=0;l<u.views.length;l++){var a;(a=u.views[l]).component&&(a.component.$el.style?a.component.$el.style.display="none":(console.log("no style"),console.log(a.component))),a.selected=!1}u.views.push({component:null,selected:!1,link:c,def:n,params:d})}})}}window.addEventListener("hashchange",function(){location.hash!==f&&(f=location.hash,t())});var e=Vue.extend({template:'<div id="target" class="view-slot"></div>',props:["name"],data:function(){return u},watch:{route:function(){for(var n=u.route,e=this.$el;e.firstChild;)e.removeChild(e.firstChild);var t=document.createElement("div");this.$el.appendChild(t);var o=new n.view.component({el:t,created:function(){for(var e in this.$routePath=n.def.route,n.params)this[e]=n.params[e]}});this.current&&this.current.$destroy(),this.current=o},views:function(){for(var e=[],n=this.$el.firstChild;n;)e.push(n),n=n.nextSibling;for(var t=!1,o=null,i=0;i<this.views.length;i++){var s=this.views[i];if(s.component){var l=e.indexOf(s.component.$el);0<=l&&e.splice(l,1),s.selected&&(o=s)}else{var a=document.createElement("div");this.$el.appendChild(a);var r={el:a,created:function(n){return function(){for(var e in this.$routePath=n.def.route,n.params)this[e]=n.params[e]}}(s),watch:{}};for(var c in s.def.component.options.props)r.watch[c]=function(e,n){return function(){u.updateParam(e,n,this[n])}}(s,c);if(s.component=new s.def.component(r),s.component.tabName){for(var d=s.component.tabName,f=null,p=0;!f&&p<u.tabs.length;p++){var v=u.tabs[p];v.name===d&&(f=v)}f||(f={selected:!0,name:d,last:null,views:[]},u.tabs.push(f)),f.views.push(s)}h(s),t=!0}}t&&o&&(o.selected=!1,o.component.$el.style.display="none");for(i=0;i<e.length;i++)this.$el.removeChild(e[i])}},mounted:function(){for(var e=0;e<u.views.length;e++){var n=u.views[e];n.component&&this.$el.appendChild(n.component.$el)}t()}});return Vue.component("view-slot",e),u});