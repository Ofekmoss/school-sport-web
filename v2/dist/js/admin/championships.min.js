define(["templates/admin","utils","dialog","services/access","consts","components/multiselect","generic/data-table"],function(e,t,i,s,a){function n(s){var e="";if(0===s.competitionType.toString().length)e="type=all";else switch(parseInt(s.competitionType)){case 1:e="clubs=1";break;case 2:e="league=1"}0<=s.region&&(0<e.length&&(e+="&"),e+="region="+s.region),0<s.competitionSport&&(0<e.length&&(e+="&"),e+="sport="+s.competitionSport),s.season&&(0<e.length&&(e+="&"),e+="season="+s.season),s.allCategories=[a.allCategoriesHebName],Vue.http.get("/api/v2/admin/championships?"+e).then(function(e){s.championships=[];for(var t=[],i=0;i<e.body.length;i++){var n=e.body[i];s.championships.push(n),n.categories.split(", ").forEach(function(e){t.indexOf(e)<0&&t.push(e)})}t.sort(),t.forEach(function(e){s.allCategories.push(e)}),s.allChampionships=s.championships.filter(function(e){return!0}),s.competitionCategory=a.allCategoriesHebName},function(e){console.log(e)})}var o=[{key:"id",name:"זיהוי אליפות",active:!0},{key:"name",name:"שם אליפות",active:!0},{key:"region.name",name:"מחוז",active:!0},{key:"sport.name",name:"ענף ספורט",active:!0},{key:"isOpen",name:"סוג אליפות",active:!0},{key:"status",name:"סטטוס אליפות",active:!0},{key:"categories",name:"קטגוריות",active:!0},{key:"ruleset.name",name:"תקנון",active:!0},{key:"remarks",name:"הערות",active:!0},{key:"supervisor.name",name:"שם אחראי אליפות",active:!0},{key:"supervisor.email",name:"מייל אחראי אליפות",active:!0},{key:"dates.lastRegistration",name:"תאריך רישום אחרון",type:"date",active:!1},{key:"dates.start",name:"מועד פתיחת אליפות",type:"date",active:!1},{key:"dates.end",name:"מועד סיום אליפות",type:"date",active:!1},{key:"dates.finals",name:"מועד גמר",type:"date",active:!1},{key:"alternativeDates.start",name:"מועד פתיחה חלופי",type:"date",active:!1},{key:"alternativeDates.end",name:"מועד סיום חלופי",type:"date",active:!1},{key:"alternativeDates.finals",name:"מועד גמר חלופי",type:"date",active:!1}];return Vue.extend({template:e.championships,props:{},data:function(){return{tabName:"אליפויות",caption:"אליפויות",competitionType:1,competitionSport:-1,competitionCategory:a.allCategoriesHebName,championships:[],allChampionships:[],allCategories:[],regions:[],sports:[],seasons:[],season:null,region:null,columns:o,searchText:"",isSelectAll:!1,selectedChampionships:[]}},mounted:function(){null==this.region&&(this.region=0<s.user.region?s.user.region:null),n(this),function(n){n.regions=[],0===s.user.region&&n.regions.push({id:null,name:"כל המחוזות"}),Vue.http.get("/api/v2/regions").then(function(e){for(var t=0;t<e.body.length;t++){var i=e.body[t];n.regions.push(i)}n.updateCaption()},function(e){console.log(e)})}(this),function(n){n.sports=[],n.sports.push({id:-1,name:"כל הענפים"}),Vue.http.get("/api/sportsman/sports").then(function(e){for(var t=0;t<e.body.length;t++){var i=e.body[t];n.sports.push({id:i.SPORT_ID,name:i.SPORT_NAME})}n.updateCaption()},function(e){console.log(e)})}(this),function(i){i.seasons.splice(0,i.seasons.length),Vue.http.get("/api/v2/manage/seasons").then(function(e){for(var t=0;t<e.body.length;t++)i.seasons.push(e.body[t]);Vue.http.get("/api/v2/cache?key=season").then(function(e){var t=e.body.Value;null!=t?i.season=t:Vue.http.get("/api/v2/season").then(function(e){var t=e.body.season;t&&(i.season=t)})})})}(this),this.updateCaption()},watch:{competitionType:function(){n(this)},region:function(){this.updateCaption(),n(this)},competitionSport:function(){this.updateCaption(),n(this)},competitionCategory:function(){var t=this.competitionCategory;this.championships=this.allChampionships.filter(function(e){return t===a.allCategoriesHebName||0<=e.categories.indexOf(t)})},season:function(){n(this)}},methods:{updateCaption:function(){var e="אליפויות";if(null!=this.region&&0<=this.region&&this.regions)for(var t=0;t<this.regions.length;t++){var i=this.regions[t];if(i.id==this.region){e+=" - "+i.name;break}}if(null!=this.competitionSport&&0<=this.competitionSport&&this.sports)for(t=0;t<this.sports.length;t++){var n=this.sports[t];if(n.id==this.competitionSport){e+=" - "+n.name;break}}this.caption=e},handleSelectionChange:function(){this.selectedChampionships.splice(0,this.selectedChampionships.length);for(var e=0;e<this.championships.length;e++){var t=this.championships[e];t.selected&&this.selectedChampionships.push(t)}}}})});