define(["templates/admin","dialog","generic/data-table"],function(i,e){function n(t){!function(t,o){t.regions.splice(0,t.regions.length),Vue.http.get("/api/v2/regions").then(function(i){for(var e=0;e<i.body.length;e++){var n=i.body[e];0<n.id&&t.regions.push(n)}o()},function(i){o(i)})}(t,function(){Vue.http.get("/api/v2/cities").then(function(i){t.cityMap={},t.cities.splice(0,t.cities.length);for(var e=0;e<i.data.length;e++){var n=i.data[e];n.user||(n.user=null),t.cityMap[n.id]=n,t.cities.push(n)}t.cities.sort(function(i,e){return i.name.localeCompare(e.name)}),t.updateCaption()},function(i){console.log(i)})})}return Vue.extend({template:i.cities,props:{region:{}},data:function(){return{tabName:"כללי",caption:"רשויות",image:"img/cities.svg",updating:!1,columns:[{key:"name",name:"שם רשות",active:!0},{key:"region.name",name:"מחוז",active:!0},{key:"user.login",name:"שם משתמש",active:!0}],cities:[],regions:[],filter:null,city:null}},mounted:function(){n(this)},methods:{updateCaption:function(){var i="רשויות",e=this;if(0<e.region&&e.regions)for(var n=0;n<e.regions.length;n++){var t=e.regions[n];if(t.id==e.region){i+=" - "+t.name;break}}e.caption=i},handleSelectionChange:function(i){this.city=i},editUser:function(){var n=this;n.city&&e.open("admin/edit-city-user",{city:n.city},function(i,e){!i&&e&&(n.city.user=e)})}},watch:{region:function(){var e,i=this;null==i.region||""===i.region?i.filter=null:i.filter=(e=parseInt(i.region),function(i){return i.region&&i.region.id===e}),this.updateCaption()}}})});