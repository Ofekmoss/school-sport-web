define(["templates/admin","utils","dialog","services/access","consts","views","components/multiselect","generic/data-table"],function(e,i,t,n,o,s){function a(e){var i="";return null!=e.region&&(0<i.length&&(i+="&"),i+="region="+e.region),0<e.competitionSport&&(0<i.length&&(i+="&"),i+="sport="+e.competitionSport),e.season&&(0<i.length&&(i+="&"),i+="season="+e.season),i}function c(e){var t=e.competitionSport,o=e.competitionChampionship,s=-1==t,a=-1==o;e.categories=e.allCategories.filter(function(e){var i=s||e.sport.id==t,n=a||e.championship.id==o;return i&&n})}function r(t,o){void 0!==o&&null!=o||(o=new Function);var e=a(t);Vue.http.get("/api/v2/admin/competitions?"+e).then(function(e){t.allCategories=[],t.sports=[],t.sports.push({id:-1,name:"כל הענפים"});for(var i=0;i<e.body.sports.length;i++){var n=e.body.sports[i];n.categories.forEach(function(e){e.sport={id:n.id,name:n.name},t.allCategories.push(e)}),t.sports.push(n)}t.categories=t.allCategories.slice(0),o()},function(e){console.log(e),o()})}function p(t,o){void 0!==o&&null!=o||(o=new Function);var e=a(t);Vue.http.get("/api/v2/admin/championships?"+e).then(function(e){t.championships=[],t.championship=-1,t.championships.push({id:-1,name:"כל האליפויות"});for(var i=0;i<e.body.length;i++){var n=e.body[i];t.championships.push(n)}o()},function(e){console.log(e),o()})}return Vue.extend({template:e.categories,props:{},data:function(){return{tabName:"אליפויות",caption:"תחרויות",competitionSport:-1,competitionChampionship:-1,allCategories:[],categories:[],championships:[],regions:[],sports:[],seasons:[],season:null,region:null,columns:[{key:"id",name:"זיהוי תחרות",active:!0},{key:"region.name",name:"מחוז",active:!0},{key:"sport.name",name:"ענף ספורט",active:!0},{key:"championship.name",name:"שם אליפות",active:!0},{key:"name",name:"קטגוריית אליפות",active:!0},{key:"registrationPrice",name:"תעריף רישום",type:"NIS",active:!0},{key:"chargeSeason.name",name:"עונה לחיוב",active:!0},{key:"teams",name:"קבוצות",active:!0,click:function(e){var i={region:e.region.id,sport:e.sport.id,championship:e.championship.id,category:e.id};s.openView("manage/teams",i)}},{key:"phases",name:"שלבים",active:!0},{name:"פעולות",key:"manageCompetition",type:"button",active:!0,onclick:this.manageCompetitionClicked,getText:function(e,i){return"ניהול תחרות"}}],searchText:"",isSelectAll:!1,selectedCategories:[]}},mounted:function(){null==this.region&&(this.region=0<n.user.region?n.user.region:null);var e=this;p(e,function(){!function(t,o){void 0!==o&&null!=o||(o=new Function),t.regions=[],t.sport=-1,t.championship=-1,0===n.user.region&&t.regions.push({id:null,name:"כל המחוזות"}),Vue.http.get("/api/v2/regions").then(function(e){for(var i=0;i<e.body.length;i++){var n=e.body[i];t.regions.push(n)}t.updateCaption(),o()},function(e){console.log(e),o()})}(e,function(){!function(n,t){void 0!==t&&null!=t||(t=new Function),n.seasons.splice(0,n.seasons.length),Vue.http.get("/api/v2/manage/seasons").then(function(e){for(var i=0;i<e.body.length;i++)n.seasons.push(e.body[i]);Vue.http.get("/api/v2/cache?key=season").then(function(e){var i=e.body.Value;null!=i?(n.season=i,t()):Vue.http.get("/api/v2/season").then(function(e){var i=e.body.season;i&&(n.season=i),t()})})})}(e,function(){r(e,function(){e.updateCaption()})})})})},watch:{region:function(){var e=this;p(e,function(){r(e,function(){0<e.competitionSport&&c(e),e.updateCaption()})})},competitionSport:function(){var e=this;p(e,function(){r(e,function(){c(e),e.updateCaption()})})},competitionChampionship:function(){var e=this;r(e,function(){c(e),e.updateCaption()})},season:function(){var e=this;p(e,function(){r(e,function(){e.updateCaption()})})}},methods:{manageCompetitionClicked:function(e){s.openView("competitions/competition",{id:e.id})},updateCaption:function(){var e="תחרויות";if(null!=this.region&&0<=this.region&&this.regions)for(var i=0;i<this.regions.length;i++){var n=this.regions[i];if(n.id==this.region){e+=" - "+n.name;break}}if(null!=this.competitionSport&&0<=this.competitionSport&&this.sports)for(i=0;i<this.sports.length;i++){var t=this.sports[i];if(t.id==this.competitionSport){e+=" - "+t.name;break}}this.caption=e},handleSelectionChange:function(){this.selectedCategories=[];for(var e=0;e<this.categories.length;e++){var i=this.categories[e];i.selected&&this.selectedCategories.push(i)}},editSelectedCategory:function(){if(null!=this.selectedCategories&&1===this.selectedCategories.length){var n=this.selectedCategories[0];t.open("admin/category-dialog",{category:n.id,disableClickOutside:!0},function(e,i){null==e&&null!=i&&(n.chargeSeason=i.chargeSeason,n.registrationPrice=i.price)})}else console.log("must have only one selected")},linkLogligCompetition:function(){if(null!=this.selectedCategories&&1===this.selectedCategories.length){var e=this.selectedCategories[0];t.open("admin/link-loglig-dialog",{category:e.id,categoryName:e.championship.name+" "+e.name,competition:e.logligId,disableClickOutside:!0},function(e,i){})}else console.log("must have only one selected")}}})});