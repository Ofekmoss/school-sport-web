define(["templates/admin","utils","dialog","consts","components/multiselect","generic/data-table"],function(e,t,s,o){function r(e,t){for(var n=0;n<e.length;n++){var a=e[n];if(a.id===t)return a}return null}function a(a){!function(n,a){n.sports.splice(0,n.sports.length),Vue.http.get("/api/v2/admin/competitions?season="+n.season).then(function(e){for(var t=0;t<e.body.sports.length;t++)n.sports.push(e.body.sports[t]);a()},function(e){a(e)})}(a,function(e){e||Vue.http.get("/api/v2/admin/players/transfers?season="+a.season).then(function(e){a.players.splice(0,a.players.length);for(var t=0;t<e.body.length;t++){var n=e.body[t];n.sport=r(a.sports,n.sport),n.sport&&(n.category=r(n.sport.categories,n.competition)),o.coordinators&&(null!=n.school.region&&o.coordinators[n.school.region]&&(n.school.region=o.coordinators[n.school.region].areaName),n.currentSchool&&null!=n.currentSchool.region&&o.coordinators[n.currentSchool.region]&&(n.currentSchool.region=o.coordinators[n.currentSchool.region].areaName)),a.players.push(n)}},function(e){console.log(e)})})}return Vue.extend({template:e["transfer-requests"],data:function(){return{tabName:"שחקנים",caption:"אישורי העברות",players:[],columns:[{key:"idNumber",name:"ת.ז.",active:!0},{key:"firstName",name:"שם פרטי",active:!0},{key:"lastName",name:"שם משפחה",active:!0},{key:"birthDate",name:"תאריך לידה",type:"date",active:!0},{key:"grade",name:"כיתה",active:!0,lookup:{0:"א'",1:"ב'",2:"ג'",3:"ד'",4:"ה'",5:"ו'",6:"ז'",7:"ח'",8:"ט'",9:"י'",10:'י"א',11:'י"ב'}},{key:"school.name",name:"בית ספר מבקש",active:!0},{key:"city",name:"רשות מבקשת",active:!0},{key:"sport.name",name:"ענף ספורט",active:!0},{key:"championship.name",name:"אליפות",active:!0},{key:"championship.category.name",name:"קטגוריית גיל",active:!0},{key:"school.region",name:"מחוז מבקש",active:!0},{key:"school.symbol",name:"סמל מבקש",active:!0},{key:"school.principal",name:"מנהל בית ספר מבקש",active:!1},{key:"teacher.name",name:"מורה",active:!1},{key:"teacher.phoneNumber",name:"טלפון מורה",active:!1},{key:"teacher.email",name:"מייל מורה",active:!1},{key:"currentSchool.name",name:"בית ספר נוכחי",active:!0},{key:"currentCity",name:"רשות נוכחית",active:!0},{key:"currentSchool.region",name:"מחוז נוכחי",active:!0},{key:"currentSchool.symbol",name:"סמל נוכחי",active:!0}],sports:[],seasons:[],season:null,searchText:"",isSelectAll:!1,selectedStatus:null,selectedPlayers:[]}},mounted:function(){var n=this;n.seasons=[],Vue.http.get("/api/v2/manage/seasons").then(function(e){for(var t=0;t<e.body.length;t++)n.seasons.push(e.body[t]);Vue.http.get("/api/v2/season").then(function(e){var t=e.body.season;t&&(n.season=t),a(n)})})},watch:{season:function(){a(this)}},methods:{handleSelectionChange:function(){this.selectedPlayers.splice(0,this.selectedPlayers.length);for(var e=0;e<this.players.length;e++){var t=this.players[e];t.selected&&this.selectedPlayers.push(t)}},approveTransfer:function(){var a=this,o=this.selectedPlayers.slice();s.open("general/message-box",{caption:"העברת שחקנים",message:"האם לבצע העברת שחקנים?",alert:!0,confirmText:"כן",cancelText:"לא"},function(e,t){if(!0===t){var n=o.map(function(e){return{team:e.team,school:e.school.id,idNumber:e.idNumber}});0<n.length&&Vue.http.post("/api/v2/admin/players/transfers",n).then(function(e){a.selectedPlayers.splice(0,a.selectedPlayers.length);for(var t=0;t<o.length;t++){var n=a.players.indexOf(o[t]);0<=n&&a.players.splice(n,1)}},function(e){s.open("general/error-message",{caption:"פעולה נכשלה",message:"string"==typeof e.body?e.body:"שגיאה בהעברת שחקנים"})})}})}}})});