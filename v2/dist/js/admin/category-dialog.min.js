define(["templates/admin","dialog","utils","components/selectex"],function(e,n,o){return Vue.extend({template:e["category-dialog"],data:function(){return{category:null,error:null,chargeSeason:null,price:0,name:"",championship:null,categoryProgress:{editing:!1,edited:!1,failed:!1},seasons:[],season:null,mounting:!1,isValid:!0,changed:!1,confirmClosure:!1}},mounted:function(){var e=this;e.error="",e.mounting=!0,o.intOrDefault(e.category,0)<=0?e.error="זיהוי תחרות חסר או שגוי":function(n,o){void 0!==o&&null!=o||(o=new Function),n.seasons=[],n.mounting||(n.season=null),Vue.http.get("/api/v2/manage/seasons").then(function(e){e.body.forEach(function(e){n.seasons.push({id:e.Id,name:e.Name})}),o()},function(e){console.log(e),o()})}(e,function(){!function(o,t){void 0!==t&&null!=t||(t=new Function);var e="/api/v2/manage/categories/"+o.category;Vue.http.get(e).then(function(e){var n=e.body;null==n||null==n.Id?o.error="לא נמצאו נתוני תחרות":(o.chargeSeason=null!=n.ChargeSeason?n.ChargeSeason.Id:null,o.price=n.RegistrationPrice,o.name=n.Name,o.championship={id:n.Championship.Id,name:n.Championship.Name}),t()},function(e){console.log(e),t()})}(e,function(){!function(e){window.setTimeout(function(){e.mounting=!1,e.$forceUpdate()},500)}(e)})})},methods:{resetChargeSeason:function(){this.chargeSeason=null},dataChanged:function(e){this.mounting||(this.changed=!0)},saveCategory:function(){var n=this,e={id:n.category,chargeSeason:n.chargeSeason,price:n.price};n.categoryProgress.editing=!0,Vue.http.post("/api/v2/manage/categories",e).then(function(e){!function(e){e.categoryProgress.editing=!1,e.categoryProgress.edited=!0,e.changed=!1,window.setTimeout(function(){e.confirm()},3e3)}(n)},function(e){!function(e,n){e.categoryProgress.editing=!1,e.categoryProgress.failed=!0,console.log(n),window.setTimeout(function(){e.categoryProgress.failed=!1},3e3)}(n,e)})},cancel:function(){var e=this;e.categoryProgress.edited?e.confirm():e.changed?e.confirmClosure=!0:e.$emit("close")},confirm:function(){var n=this,e=n.seasons.find(function(e){return e.id==n.chargeSeason});this.$emit("close",{id:n.category,chargeSeason:e,price:n.price})},reallyCancel:function(){this.$emit("close")},abortCancel:function(){this.confirmClosure=!1}},computed:{},watch:{}})});