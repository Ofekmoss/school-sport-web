define(["templates/admin","utils","dialog","services/access","consts","components/multiselect","generic/data-table"],function(e,n,t,i,o){function a(o){var e=1===parseInt(o.competitionType)?"clubs=1":"league=1";o.season&&(e+="&season="+o.season),0<=o.region&&(e+="&region="+o.region),o.schools=[],Vue.http.get("/api/v2/admin/schools?"+e).then(function(e){for(var n=0;n<e.body.length;n++){var t=e.body[n];t.isClub&&(t.schoolSummaryLink="/api/v2/registration/club/summary/download/"+["school",t.id,o.season,"summary"].join("-")+".pdf"),o.schools.push(t)}},function(e){console.log(e)})}function s(t,e){return{key:"tokens."+t+".Token",name:"לינק "+e,active:!1,getter:function(e){if(e.tokens&&e.tokens[t]&&0<(e.tokens[t].Token||"").length)return"קיים";return"לא קיים לינק"},link:function(e){if(e.tokens&&e.tokens[t]){var n=e.tokens[t].Token||"";if(0<n.length)return"https://www.schoolsport.org.il/v2/#/login?token="+n}return null}}}var c=[{key:"name",name:"שם בית ספר",active:!0},{key:"symbol",name:"סימול בית ספר",active:!0},{key:"region.name",name:"מחוז",active:!0},{key:"city.name",name:"רשות",active:!0},s("Principal","מנהל"),{key:"tokens.Principal.Code",name:"סיסמת מנהל",active:!1,type:"password"},s("Representative","נציג רשות"),{key:"tokens.Representative.Code",name:"סיסמת נציג רשות",active:!1,type:"password"},{key:"gradeType",name:"הגדרת כיתות",active:!0},{key:"address",name:"כתובת",active:!0},{key:"phoneNumber",name:"טלפון",active:!0},{key:"fax",name:"פקס",active:!0},{key:"email",name:"מייל",active:!0},{key:"principal.name",name:"שם מנהל/ת בית הספר",active:!0},{key:"principal.phoneNumber",name:"טלפון מנהל/ת בית הספר",active:!0},{key:"principal.email",name:"מייל מנהל/ת בית הספר",active:!0},{key:"chairman.name",name:'שם יו"ר',active:!0},{key:"chairman.phoneNumber",name:'טלפון יו"ר',active:!0},{key:"chairman.email",name:'מייל יו"ר',active:!0},{key:"coordinator.name",name:"שם רכז/ת מועדון",active:!0,clubOnly:!0},{key:"coordinator.phoneNumber",name:"טלפון רכז/ת מועדון",active:!0,clubOnly:!0},{key:"coordinator.email",name:"מייל רכז/ת מועדון",active:!0,clubOnly:!0},{key:"representative.name",name:"שם נציג ברשות",active:!0},{key:"representative.phoneNumber",name:"טלפון נציג ברשות",active:!0},{key:"representative.email",name:"מייל נציג ברשות",active:!0},{key:"association.set",name:"האם המועדון משויך לעמותה?",active:!0,clubOnly:!0},{key:"association.approved",name:"אישור ניהול תקין לעמותה?",active:!0,clubOnly:!0},{key:"association.number",name:"מספר עמותה",active:!0,clubOnly:!0},{key:"schoolSummaryLink",name:"אסמכתא",type:"link",active:!0},{key:"id",name:"התחברות",type:"login",active:!0}];return Vue.extend({template:e.schools,props:{region:{}},data:function(){return{tabName:"כללי",caption:"בתי ספר",competitionType:1,teams:[],schools:[],columns:c,sports:[],seasons:[],season:null,searchText:"",isSelectAll:!1,selectedSchools:[],regions:[]}},mounted:function(){a(this),function(o){o.regions=[],o.regions.push({id:null,name:"כל המחוזות"}),Vue.http.get("/api/v2/regions").then(function(e){for(var n=0;n<e.body.length;n++){var t=e.body[n];o.regions.push(t)}0<i.user.region&&(o.region=i.user.region),o.updateCaption()},function(e){console.log(e)})}(this),function(t){t.seasons.splice(0,t.seasons.length),Vue.http.get("/api/v2/manage/seasons").then(function(e){for(var n=0;n<e.body.length;n++)t.seasons.push(e.body[n]);Vue.http.get("/api/v2/cache?key=season").then(function(e){var n=e.body.Value;null!=n?t.season=n:Vue.http.get("/api/v2/season").then(function(e){var n=e.body.season;n&&(t.season=n)})})})}(this)},watch:{competitionType:function(){1===parseInt(this.competitionType)?this.columns=c:this.columns=c.filter(function(e){return!e.clubOnly}),a(this)},region:function(){this.updateCaption(),a(this)},season:function(){a(this)}},methods:{updateCaption:function(){var e="בתי ספר";if(0<this.region&&this.regions)for(var n=0;n<this.regions.length;n++){var t=this.regions[n];if(t.id==this.region){e+=" - "+t.name;break}}this.caption=e},handleSelectionChange:function(){this.selectedSchools.splice(0,this.selectedSchools.length);for(var e=0;e<this.schools.length;e++){var n=this.schools[e];n.selected&&this.selectedSchools.push(n)}},generateClubReport:function(){var e=1===parseInt(this.competitionType)?"clubs=1":"league=1";this.season&&(e+="&season="+this.season),0<=this.region&&(e+="&region="+this.region),Vue.http.get("/api/v2/admin/schools/clubReport?"+e).then(function(e){n.excelReport(e.body.FileName,null,null,e.body.Rows)},function(e){console.log(e)})}}})});