define(["templates/supervisor","utils","dialog","services/access","components/multiselect","generic/data-table"],function(e,t,n,i){function s(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i.id===t)return i}return null}function o(e){return 16<=e?"לא אושר":8<=e?"אושר":"ממתין לאישור"}function a(i){var e="/api/v2/admin/teams",t=function(e){var t=[];return 0<e.selectedRegion&&t.push("region="+e.selectedRegion),t}(i);0<t.length&&(e+="?"+t.join("&")),i.teams=[],Vue.http.get(e).then(function(e){for(var t=0;t<e.body.length;t++){var n=e.body[t];n.sport=s(i.sports,n.sport),n.parsedStatus=o(n.approved),n.sport&&(n.category=s(n.sport.categories,n.competition)),n.category&&(10!=n.approved&&15!=n.approved||(n.green=!0),i.teams.push(n))}i.teams.sort(function(e,t){return new Date(t.createdAt)-new Date(e.createdAt)}),i.sportFields=[],i.championships=[],i.categories=[],i.allTeams=i.teams.slice(0),i.teams.forEach(function(t){null==i.sportFields.find(function(e){return e.id===t.sport.id})&&i.sportFields.push({id:t.sport.id,name:t.sport.name}),null==i.championships.find(function(e){return e.id===t.championship.id})&&(i.championships.push({id:t.championship.id,name:t.championship.name}),i.championshipSportFieldMapping[t.championship.id.toString()]=t.sport.id),null==i.categories.find(function(e){return e.name===t.category.name})&&i.categories.push({id:t.category.id,name:t.category.name})})},function(e){console.log(e)})}function c(e){var s=parseInt(e.selectedSportField,10),o=parseInt(e.selectedChampionship,10),a=e.selectedCategory;e.teams=e.allTeams.filter(function(e){var t=0===s||0<s&&e.sport.id===s,n=0===o||0<o&&e.championship.id===o,i=0===a.length||0<a.length&&e.category.name===a;return t&&n&&i})}function r(){window.setTimeout(function(){window.changedByCode=!1},250)}return Vue.extend({template:e["club-teams-approval"],data:function(){return{user:i.user,teams:[],columns:[{key:"school.name",name:"בית ספר",active:!0},{key:"school.regionName",name:"מחוז",active:!0},{key:"school.symbol",name:"סימול בית ספר",active:!0},{key:"sport.name",name:"ענף ספורט",active:!0},{key:"championship.name",name:"שם אליפות",active:!0},{key:"category.name",name:"קטגוריה",active:!0},{name:"סטטוס",key:"parsedStatus",active:!0}],sports:[],regions:[],loggedUser:null,searchText:"",isSelectAll:!1,statuses:[{id:1,name:"אושר"},{id:2,name:"לא אושר"},{id:3,name:"ממתין לאישור"}],selectedStatus:null,selectedRegion:-1,selectedTeams:[],sportFields:[],selectedSportField:0,championships:[],selectedChampionship:0,categories:[],selectedCategory:"",allTeams:[],championshipSportFieldMapping:{}}},mounted:function(){var t=this;!function(n,i){Vue.http.get("/api/v2/admin/competitions").then(function(e){for(var t=0;t<e.body.sports.length;t++)n.sports.push(e.body.sports[t]);i()},function(e){i(e)})}(t,function(e){e||(a(t),Vue.http.get("/api/v2/login").then(function(e){t.loggedUser=e.data,Vue.http.get("/api/v2/regions").then(function(e){t.regions=e.data.filter(function(e){return 0<e.id}),0<t.loggedUser.region&&(t.loggedUser.regionName=t.regions.find(function(e){return e.id===t.loggedUser.region}).name)},function(e){console.log(e)})},function(e){console.log(e)}))})},watch:{selectedRegion:function(){a(this)},selectedSportField:function(){window.changedByCode||(window.changedByCode=!0,this.selectedChampionship=0,this.selectedCategory="",r(),c(this))},selectedChampionship:function(){window.changedByCode||(window.changedByCode=!0,this.selectedSportField=0<this.selectedChampionship?this.championshipSportFieldMapping[this.selectedChampionship.toString()]:0,this.selectedCategory="",c(this),r())},selectedCategory:function(){window.changedByCode||c(this)}},methods:{handleSelectionChange:function(){this.selectedTeams.splice(0,this.selectedTeams.length),this.selectedStatus=null;for(var e=0;e<this.teams.length;e++){var t=this.teams[e];t.selected&&this.selectedTeams.push(t)}},changeStatus:function(e){var n=this;Vue.http.post("/api/v2/admin/teams/status/supervisor",{teams:n.selectedTeams.map(function(e){return e.id}),status:e}).then(function(){var t=0;switch(e){case-1:t=16;break;case 1:t=8;break;case 0:t=1}n.selectedStatus=e,n.selectedTeams.forEach(function(e){e.approved=t,e.parsedStatus=o(e.approved)})},function(e){console.log(e)})},logout:function(){i.logout()}}})});