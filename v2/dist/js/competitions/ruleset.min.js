define(["templates/competitions","services/competitions","utils"],function(e,h){var t={ScoreTable:function(e){for(null==e.direction&&(e.direction=0),null==e.scores&&(e.scores=[]);e.scores.length<100;)e.scores.push(null)}};return Vue.extend({template:e.ruleset,props:{id:{}},data:function(){return{tabName:"אליפויות",caption:"תקנון",rules:[{id:"GameScore",name:"ניקוד משחק",match:!0},{id:"RankingTables",name:"טבלאות דירוג",match:!0,array:!0},{id:"TeamRanking",name:"דירוג קבוצות",match:!0,array:!0},{id:"TechnicalResult",name:"תוצאת טכני",match:!0},{id:"GameStructure",name:"מבנה משחק",match:!0},{id:"ScoreTable",name:"טבלת ניקוד",individual:!0},{id:"Functionaries",name:"בעלי תפקידים",match:!0,individual:!0,array:!0}],rankingMethods:{Score:"ניקוד",PointsRatio:"יחס נקודות",PointsDifference:"הפרש נקודות",MostPoints:"נקודות זכות",MostSmallPoints:"נקודות קטנות זכות",Wins:"נצחונות",SmallPointsRatio:"יחס נקודות קטנות",SmallPointsDifference:"הפרש נקודות קטנות"},disciplines:null,selectedRule:null,selectedScope:null,scopeData:null,changed:!1,competition:null,sport:null,ruleset:null,error:""}},mounted:function(){var r=this;h.ruleset(this.id,function(e,i){if(!e&&(r.caption="תקנון - "+i.name,r.ruleset=i,!r.sport||r.ruleset.sport.id!==r.sport.id)){if(r.sport=r.ruleset.sport,r.disciplines)for(var t in r.disciplines)delete r.disciplines[t];h.disciplines(r.sport.id,function(e,i){if(!e){r.disciplines||(r.disciplines={});for(var n={},t=0;t<i.length;t++){var s=i[t];n[s.identifier]=s,r.disciplines[s.id]=s}function l(e){if(null==e.level){var i=e.identifier.lastIndexOf(".",e.identifier.length-2),t=null;0<i&&(t=n[e.identifier.slice(0,i+1)]),t?(l(t),e.level=t.level+1,e.parent=t):e.level=0}}for(var a in r.disciplines)l(r.disciplines[a])}})}})},methods:{onChange:function(){this.changed=!0},shouldShowRule:function(e){return!(!this.ruleset||!(this.ruleset.sport.match&&e.match||this.ruleset.sport.individual&&e.individual))},selectRule:function(e){if(!this.changed&&this.disciplines){this.selectedRule={rule:e,scopes:[{description:"כללי",category:null,discipline:null,inherited:!1}]};for(var i=this.ruleset,t=!1;i;){var n=i.rules[e.id];if(n)for(var s=0;s<n.length;s++){for(var l=n[s],a=null,r=0;!a&&r<this.selectedRule.scopes.length;r++){var c=this.selectedRule.scopes[r];c.category==l.category&&c.discipline==l.discipline&&(a=c)}if(a)null==a.data&&(a.data=l.data);else{var o=null;if(l.category&&(o=h.getCategoryName(l.category)),l.discipline){var u="",d=this.disciplines[l.discipline];if(d)for(var p=d;p;)u=0<u.length?p.name+" / "+u:p.name,p=p.parent;else u=l.discipline;o=o?o+" - "+u:u}this.selectedRule.scopes.push({description:o,category:l.category,discipline:null,data:l.data,inherited:t})}}i=i.base,t=!0}this.selectScope(this.selectedRule.scopes[0])}},selectScope:function(e){if((this.selectedScope=e)&&this.selectedRule){this.scopeData=e.data?function i(e){if(null==e)return null;if(Array.isArray(e))return e.map(function(e){return i(e)});if("object"!=typeof e)return e;var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=i(e[n]));return t}(e.data):this.selectedRule.rule.array?[]:{};var i=t[this.selectedRule.rule.id];i&&i(this.scopeData)}},getRange:function(e,i){var t=[];if(e<i)for(var n=e;n<=i;n++)t.push(n);else for(n=e;i<=n;n--)t.push(n);return t},getRankingName:function(e,i){var t=this.rankingMethods[e]||"???";return i?t+" (קבוצות שוויון)":t},isRankingSet:function(i,t){return!(!this.scopeData||!Array.isArray(this.scopeData))&&null!=this.scopeData.find(function(e){return e.method==i&&e.matchedOpponents==t})},removeRanking:function(e){this.changed=!0,this.scopeData.splice(e,1)},addRanking:function(e,i){this.changed=!0,this.scopeData.push({method:e,matchedOpponents:i})},close:function(){this.$emit("close")}}})});