define(["templates/generic","views"],function(t,i){function n(c){function t(t){var s={},h=t[0];for(var a in s.columns=[],h)h.hasOwnProperty(a)&&s.columns.push({key:"col-"+a,name:a,isMoreInfo:"פרטים נוספים"===a,active:!0});return s.rows=[],s.tooltips=[],t.forEach(function(t){var a={},r={},n=!c.searchText||0===c.searchText.length;for(var e in h)if(t.hasOwnProperty(e)){var l=(t[e]||"").toString(),i="";if(0<l.indexOf(" | ")){var o=l.split(" | ");l=o[0],i=o[1]}c.searchText&&0<c.searchText.length&&0<=l.indexOf(c.searchText)&&(n=!0),a["col-"+e]=l,r["col-"+e]=i}n&&(s.rows.push(a),s.tooltips.push(r))}),0<s.rows.length&&(s.columns=s.columns.filter(function(r){return s.rows.filter(function(t){var a=t[r.key];return null==a||0===a.toString().length}).length<s.rows.length}),s.columns=s.columns.filter(function(t){for(var a=t.name,r=!0,n=0;n<a.length;n++){var e=a.charAt(n);if("_"!==e&&(e<"A"||"Z"<e)){r=!1;break}}return!r})),s}c.tables=[];for(var a=0;a<c.dataArrays.length;a++){var r=t(c.dataArrays[a]);c.tables.push(r)}c.loading=!1,window.setTimeout(function(){var t=$("#dataContainer");if(1===t.length){var a=t.parents(".dialog").first();if(1===a.length){var r=t.width(),n=t[0].scrollWidth;if(r<n){var e=n-r,l=parseInt(a.css("width"),10);a.css("width",l+e+20+"px")}}}},500)}return Vue.extend({template:t["data-dialog"],data:function(){return{caption:"",tables:[],dataArray:null,dataArrays:[],dataUrl:null,hideSearch:!1,loading:null,error:null,searchText:""}},mounted:function(){var r=this;r.loading=!0,null!=r.dataArrays&&0<r.dataArrays.length?n(r):null!=r.dataArray&&0<r.dataArray.length?(r.dataArrays=[r.dataArray],n(r)):null!=r.dataUrl&&0<r.dataUrl.length?Vue.http.get(r.dataUrl).then(function(t){r.dataArrays=[];var a=t.body;0<a.length&&Array.isArray(a[0])?a.forEach(function(t){r.dataArrays.push(t)}):r.dataArrays.push(a),n(r)},function(t){r.loading=!1,r.error="שגיאה בעת טעינת נתונים מהשרת, נא לנסות שוב מאוחר יותר"}):r.loading=!1},watch:{searchText:function(){n(this)}},methods:{handleMoreInfo:function(t,a){var r=t[a];if(null!=r&&0<r.length){var n=r.split("?"),e=n[0],l={};if(1<n.length)n[1].split("&").forEach(function(t){0<t.length&&2===(n=t.split("=")).length&&(l[n[0]]=n[1])});i.openView(e,l),this.$emit("close")}},close:function(){this.$emit("close")},cancel:function(){this.$emit("close")}}})});