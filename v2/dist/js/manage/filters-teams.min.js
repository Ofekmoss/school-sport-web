define(["templates/manage","manage/dal","utils","services/access","components/multiselect-search","components/selectex"],function(i,o,r,t){function e(s,e){void 0!==e&&null!=e||(e=new Function),r.promiseAll([o.getRegionsWithChampionships(),o.getSportsWithChampionships(),o.getChampionships()]).then(function(i){if(s.regions=i[0],s.sports=i[1],s.championships=i[2],console.log(s.initFilters),s.initFilters){var t=[];s.initFilters.region&&t.push(function(){var i=r.getById(s.regions,s.initFilters.region);s.result.region=i||null}),s.initFilters.sport&&t.push(function(){var i=r.getById(s.sports,s.initFilters.sport);s.result.sport=i||null}),s.initFilters.championship&&t.push(function(){var i=r.getById(s.championships,s.initFilters.championship);s.result.championship=i||{}}),s.initFilters.championship?t.push(function(){o.getCategories({championship:s.initFilters.championship}).then(function(i){if(s.categories=i.map(function(i){return{id:i.Id,name:i.Name}}),s.initFilters.category){var t=r.getById(s.categories,s.initFilters.category);s.result.category=t||{}}s.upCount++,window.setTimeout(function(){s.load("init"),e()},500)})}):t.push(function(){s.upCount++,s.load("init"),e()});var n=function(i){i>=t.length?0===t.length&&(s.upCount++,s.load("init"),e()):((0,t[i])(),window.setTimeout(function(){n(i+1)},300))};window.setTimeout(function(){n(0)},300)}else e()})}var n=Vue.extend({template:i["filters-teams"],props:{initFilters:Object,upCount:0},data:function(){return{loggedUser:null,regions:[],sports:[],championships:[],categories:[],seasons:[],changed:!1,loaded:!1,mounting:!0,result:{season:null,region:null,sport:null,championship:null,category:null}}},mounted:function(){var s=this;t.get(function(i,t){s.loggedUser=t,o.getSeasons().then(function(i){s.seasons=i;var t=0;if(s.loggedUser.season&&(t=s.loggedUser.season),t){var n=r.getById(s.seasons,t);window.setTimeout(function(){s.result.season=n||null},250)}s.$watch("result.season",s.seasonChanged),e(s,function(){window.setTimeout(function(){s.mounting=!1},1e3)})})})},methods:{seasonChanged:function(){var t=this;if(!t.mounting){var i=t.result.season?t.result.season.id:null;if(i){Vue.http.post("/api/v2/registration/season",{season:i}).then(function(i){t.initFilters=null,e(t,function(){})},function(i){console.log("error")})}}},load:function(i){this.result.description="קבוצות",this.result.region&&(this.result.description+="-"+this.result.region.name),this.result.sport&&(this.result.description+="-"+this.result.sport.name),this.result.championship&&(this.result.description+="-"+this.result.championship.name),this.result.category&&(this.result.description+="-"+this.result.category.name),"click"!==i&&"init"!==i||this.$emit("change",this.result),this.changed=!1,0==this.loaded&&(this.loaded=!0)}},watch:{"result.championship":function(i){var t=this;i&&i.id?o.getCategories({championship:i.id}).then(function(i){t.categories=i.map(function(i){return{id:i.Id,name:i.Name}})}):this.categories=[]},"result.sport":function(i){var t=this;if(i&&i.id){var n={sport:i.id,region:this.result.region?this.result.region.id:null};o.getChampionships(n).then(function(i){t.championships=i})}},"result.region":function(i){var t=this;if(i&&i.id){var n={sport:this.result.sport?this.result.sport.id:null,region:i.id};r.promiseAll([o.getSportsWithChampionships(i.id),o.getChampionships(n)]).then(function(i){t.result.category=null,t.result.championship=null,t.sports=i[0],t.championships=i[1],t.championships.forEach(function(i){i.name=i.Name,0<i.Region.Id&&(i.name+=" ("+i.Region.Name+")")})})}},result:{deep:!0,handler:function(){this.loaded&&(this.changed=!0)}}}});Vue.component("filters-teams",n)});