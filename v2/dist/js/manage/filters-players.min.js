define(["templates/manage","manage/dal","utils","services/access","components/multiselect-search","components/selectex"],function(i,a,r,t){function s(n){"undefined"!=typeof callback&&null!=callback||(callback=new Function);var i=[a.getRegionsWithChampionships(),a.getSportsWithChampionships(),a.getChampionships()],s=-1,o=-1;n.initFilters&&n.initFilters.championship&&(i.push(a.getCategories({championship:n.initFilters.championship})),s=3,n.initFilters.category&&(i.push(a.getTeams({championship:n.initFilters.championship,category:n.initFilters.category})),o=4)),r.promiseAll(i).then(function(i){if(n.regions=i[0],n.sports=i[1],n.championships=i[2],n.categories=0<s?i[s].map(function(i){return{id:i.Id,name:i.Name}}):[],n.teams=0<o?i[o].map(function(i){var t=i.DisplayName;return"new"===i.Type&&(t+=" [רישום]"),{id:i.TeamId||i.Id,team:i.Id||i.TeamId,name:t}}):[],n.championships.forEach(function(i){i.name=i.Name,0<i.Region.Id&&(i.name+=" ("+i.Region.Name+")")}),n.initFilters){var t=[];n.initFilters.region&&t.push(function(){var i=r.getById(n.regions,n.initFilters.region);n.result.region=i||null}),n.initFilters.sport&&t.push(function(){var i=r.getById(n.sports,n.initFilters.sport);n.result.sport=i||null}),n.initFilters.championship&&t.push(function(){var i=r.getById(n.championships,n.initFilters.championship);n.result.championship=i||null}),n.initFilters.category&&(t.push(function(){var i=r.getById(n.categories,n.initFilters.category);n.result.category=i||null}),n.initFilters.team&&t.push(function(){var i=r.getById(n.teams,n.initFilters.team);null==i&&(i=r.getById(n.teams,n.initFilters.team,"team")),n.result.team=i||null}));var e=function(i){i>=t.length?(n.upCount++,n.load("init"),callback()):((0,t[i])(),window.setTimeout(function(){e(i+1)},300))};window.setTimeout(function(){e(0)},300)}})}var e=Vue.extend({template:i["filters-players"],props:{initFilters:Object,upCount:0},data:function(){return{loggedUser:null,regions:[],sports:[],championships:[],categories:[],seasons:[],teams:[],changed:!1,loaded:!1,mounting:!0,result:{season:null,region:null,sport:null,championship:null,category:null,team:null},initialized:!1}},mounted:function(){var n=this;t.get(function(i,t){n.loggedUser=t,a.getSeasons().then(function(i){n.seasons=i;var t=0;if(n.loggedUser.season&&(t=n.loggedUser.season),t){var e=r.getById(n.seasons,t);window.setTimeout(function(){n.result.season=e||null},250)}n.$watch("result.season",n.seasonChanged),s(n)})})},methods:{seasonChanged:function(){var t=this;if(!t.mounting){var i=t.result.season?t.result.season.id:null;if(i){Vue.http.post("/api/v2/registration/season",{season:i}).then(function(i){t.initFilters=null,s(t)},function(i){console.log("error")})}}},load:function(i){this.initialized=!0,this.result.description="שחקנים",this.result.region&&(this.result.description+="-"+this.result.region.name),this.result.sport&&(this.result.description+="-"+this.result.sport.name),this.result.championship&&(this.result.description+="-"+this.result.championship.name),this.result.category&&(this.result.description+="-"+this.result.category.name),this.result.team&&(this.result.description+="-"+this.result.team.name),"click"!==i&&"init"!==i||this.$emit("change",this.result)}},watch:{"result.region":function(i){if(this.initialized){var t=this,e=(t.result.region||{}).id;r.promiseAll([a.getSportsWithChampionships(e),a.getChampionships({region:e})]).then(function(i){t.result.category=null,t.result.championship=null,t.sports=i[0],t.championships=i[1],t.championships.forEach(function(i){i.name=i.Name,0<i.Region.Id&&(i.name+=" ("+i.Region.Name+")")}),t.load()})}},"result.sport":function(i){if(this.initialized){var t=this,e=(t.result.region||{}).id,n=(t.result.sport||{}).id;r.promiseAll([a.getChampionships({region:e,sport:n})]).then(function(i){t.result.category=null,t.result.championship=null,t.championships=i[0],t.championships.forEach(function(i){i.name=i.Name,0<i.Region.Id&&(i.name+=" ("+i.Region.Name+")")}),t.load()})}},"result.championship":function(i){if(this.initialized){var t=this;i&&-1!=i.id?a.getCategories({championship:i.id}).then(function(i){t.categories=i.map(function(i){return{id:i.Id,name:i.Name}})}):this.categories=[]}},"result.category":function(i){if(this.initialized){var t=this;i&&-1!=i.id?a.getTeams({championship:t.result.championship.id,category:i.id}).then(function(i){t.teams=i.map(function(i){var t=i.DisplayName;return"new"===i.Type&&(t+=" [רישום]"),{id:i.TeamId||i.Id,name:t}})}):this.teams=[]}}}});Vue.component("filters-players",e)});