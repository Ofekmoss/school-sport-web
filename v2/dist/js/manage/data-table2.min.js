define(["templates/manage","utils","views"],function(t,o,e){var n=Vue.extend({template:t["data-table2"],props:{records:Array,columns:Array,showSummary:Number,showMoreInfo:Number},data:function(){return{selectedRecords:[],rawData:[],allRawData:[],hasHiddenColumns:!1}},mounted:function(){for(var t=0;t<this.columns.length;t++)if(!this.columns[t].active){this.hasHiddenColumns=!0;break}},watch:{records:function(){this.allRawData=this.records.map(function(t){return t.__show=!0,t}),this.rawData=this.allRawData.slice()},columns:function(){var n=this;this.columns.forEach(function(e){if(!e.textFilterOptions){var r=[];n.allRawData.forEach(function(t){r.push({title:n.getValue(t,e),value:!1,isActive:!0})}),r=r.filter(function(t,e){for(var n=0;n<r.length;n++)if(r[n].title===t.title)return n==e}),e.textFilterOptions=r}})}},methods:{filter:function(t){t.openFilter||this.columns.forEach(function(t){t.openFilter=!1}),t.openFilter=!t.openFilter,this.columns=this.columns.slice().map(function(t){return o.mergeDeep({},t)})},onFilterSearch:function(e){e.searchText?e.textFilterOptions.forEach(function(t){(t.title+"").indexOf(e.searchText)<0?t.isActive=!1:t.isActive=!0}):e.textFilterOptions=e.textFilterOptions.map(function(t){return t.isActive=!0,t}),this.columns=this.columns.slice()},applyToAll:function(t,e){t.textFilterOptions=t.textFilterOptions.map(function(t){return t.isActive&&(t.value=e),t}),this.filterRecords(t)},filterRecords:function(t){var e=this,n=this.getValue;t.isFilterActive=t.textFilterOptions.reduce(function(t,e){return t||e.value},!1);var r=[];t.isFilterActive?this.allRawData.forEach(function(t){(function(r,i,t){var e=t.filter(function(t){return t.isFilterActive});return e=e.reduce(function(t,n){var e=n.textFilterOptions.reduce(function(t,e){return t||e.value&&r(i,n)==e.title},!1);return t&&e},!0)})(n,t,e.columns)&&r.push(t)}):r=this.allRawData.slice(),e.rawData=r,e.columns=e.columns.slice().map(function(t){return t.textFilterOptions=t.textFilterOptions.slice(),o.mergeDeep({},t)})},sort:function(i){var o=this.getValue;this.columns.forEach(function(t){t!=i&&(t.sort=null)}),this.rawData&&(this.columns=this.columns.slice(),"a"==i.sort?(i.sort="d",this.rawData.sort(function(t,e){var n=o(t,i),r=o(e,i);return n==r?0:n<r?1:-1})):(i.sort="a",this.rawData.sort(function(t,e){var n=o(t,i),r=o(e,i);return n==r?0:r<n?1:-1})))},exportExcel:function(){o.excelReport("download","headerTable")},getValue:function(t,e){"string"==typeof e.key&&(e.key=e.key.split("."));for(var n=t,r=0;r<e.key.length&&null!=n;r++){var i=e.key[r];n=n.constructor===Array?n.map(function(t){return t[i]}):n[i]}return"activity"==e.type?n:"func"==e.type&&"function"==typeof e.func?e.func(n):"date"==e.type?o.formatDate(n,e.format):(null!=n&&n.constructor===Array?(e.lookup&&(n=n.map(function(t){return e.lookup[t]})),n=n.map(function(t){return t.toString()}).join(", ")):e.lookup&&(n=e.lookup[n]),n)},toggleRecordSelect:function(t){this.setSelected(t),this.$emit("record-select",this.selectedRecords)},moreInfo:function(t,e){t.stopPropagation(),this.$emit("record-more-info",e)},getPaymentRequestUrl:function(t,e){var n=this.getValue(t,e),r="תעודת חיוב "+o.ParsePaymentOrder(n).replace("/","-")+".pdf";return"/content/PaymentNotifications/"+encodeURIComponent(r)},setSelected:function(t){t&&(t.selected=!t.selected),this.selectedRecords=this.rawData.filter(function(t){return t.selected}),this.rawData=this.rawData.slice()},openTab:function(o,a){if(a.openTab&&a.openTab.route){var s={};a.openTab.params&&Object.keys(a.openTab.params).forEach(function(t){for(var e=a.openTab.params[t].split("."),n=o,r=0;r<e.length&&null!=n;r++){var i=e[r];n=n.constructor===Array?n.map(function(t){return t[i]}):n[i],s[t]=n}}),e.openView(a.openTab.route,s)}},openChampionshipCategory:function(t){e.openView("competitions/competition",{id:t})}}});Vue.component("data-table2",n)});