var test = {
    stage: 3,
    details: {
        school: {
            name: "בית ספר לבדיקה",
            symbol: "123456",
            phoneNumber: "03-9876543",
            fax: "03-9871234",
            type: 3,
            classes: "ז'-י\"ב",
            email: "info@school.com",
            address: "רחוב הבדיקה 23, בדיקה"
        },
        principal: {
            name: "המנהל",
            phoneNumber: "050-9876543",
            email: "principal@school.com"
        },
        chairman: {
            name: "יו\"ר",
            phoneNumber: "050-9876543",
            email: "chairman@school.com"
        },
        coordinator: {
            name: "הרכז",
            phoneNumber: "050-9876543",
            email: "coordinator@school.com"
        },
        representative: {
            name: "הנציג",
            phoneNumber: "050-1234567",
            email: "representative@school.com"
        },
        association: {
            set: false,
            number: "",
            validForThisYear: false
        }
    },
    teams: [{"id":1195,"sport":17,"sportName":"כדורגל","categoryName":"ז'-ח' תלמידות","championship":{"id":6890,"name":"ליגת מועדונים בכדורגל"},"school":{"id":4552,"region":2,"regionName":"צפון"},"competition":17866,"hasTotoSupport":false,"team":1006584,"teamNumber":"א","active":true,"coach":{"name":"בדיקה","phoneNumber":"03-9999999","email":"roie@mir.co.il","certification":0},"coachHelper":{"name":null,"phoneNumber":null,"email":null},"manager":{"name":null,"phoneNumber":null,"email":null},"teacher":{"name":null,"phoneNumber":null,"email":null},"facility":null,"facilityName":null,"facilityAddress":null,"facilityAlternative":{"name":null,"address":null},"activity":[{"endHours":[{"value":600,"text":"10:00"},{"value":630,"text":"10:30"},{"value":660,"text":"11:00"},{"value":690,"text":"11:30"},{"value":720,"text":"12:00"},{"value":750,"text":"12:30"},{"value":780,"text":"13:00"},{"value":810,"text":"13:30"},{"value":840,"text":"14:00"},{"value":870,"text":"14:30"},{"value":900,"text":"15:00"},{"value":930,"text":"15:30"},{"value":960,"text":"16:00"},{"value":990,"text":"16:30"},{"value":1020,"text":"17:00"},{"value":1050,"text":"17:30"},{"value":1080,"text":"18:00"},{"value":1110,"text":"18:30"},{"value":1140,"text":"19:00"},{"value":1170,"text":"19:30"},{"value":1200,"text":"20:00"}],"day":"1","startTime":540,"endTime":1080}],"approved":21,"createdAt":"2019-08-22T12:23:01.496Z","payment":null,"paymentAmount":0,"paymentPayerName":null,"paymentPaidAmount":0,"players":[{"student":1889673,"idNumber":123412348,"firstName":"שדגכשדגכש","lastName":"דגכשדגכ","birthDate":"1970-01-01T00:00:00.000Z","shirtNumber":null,"grade":8,"gender":null,"status":2,"createdAt":"2019-12-09T10:59:03.143Z","deletedAt":null,"picture":null,"idSlip":null,"medicalApproval":null},{"student":1889606,"idNumber":43424894,"firstName":"בדיקה2","lastName":"בדיקה","birthDate":"2001-03-03T00:00:00.000Z","shirtNumber":null,"grade":10,"gender":null,"status":2,"createdAt":"2019-10-27T11:19:33.830Z","deletedAt":null,"picture":"4552/students/43424894/71/picture.jpg","idSlip":"4552/students/43424894/71/id-slip.jpg","medicalApproval":"4552/students/43424894/71/medical-approval.png"},{"student":1889667,"idNumber":111111118,"firstName":"33","lastName":"33","birthDate":"1970-01-01T00:00:00.000Z","shirtNumber":null,"grade":null,"gender":null,"status":2,"createdAt":"2019-10-22T13:20:29.313Z","deletedAt":null,"picture":"4552/students/111111118/71/picture.gif","idSlip":null,"medicalApproval":null},{"student":1889670,"idNumber":121212120,"firstName":"11222","lastName":"12312","birthDate":"1970-01-01T00:00:00.000Z","shirtNumber":null,"grade":7,"gender":null,"status":2,"createdAt":"2019-10-29T18:43:08.610Z","deletedAt":null,"picture":"4552/students/121212120/71/picture.jpg","idSlip":null,"medicalApproval":null},{"student":1889671,"idNumber":100000009,"firstName":"גדכ","lastName":"עדגכ","birthDate":"1970-01-01T00:00:00.000Z","shirtNumber":null,"grade":11,"gender":null,"status":2,"createdAt":"2019-09-23T17:06:56.620Z","deletedAt":null,"picture":null,"idSlip":null,"medicalApproval":null},{"student":1889668,"idNumber":333333334,"firstName":"444","lastName":"444","birthDate":"1970-01-01T00:00:00.000Z","shirtNumber":null,"grade":11,"gender":null,"status":2,"createdAt":"2019-10-29T18:43:17.530Z","deletedAt":null,"picture":null,"idSlip":null,"medicalApproval":null},{"student":1889665,"idNumber":123456782,"firstName":"22","lastName":"22","birthDate":"1970-01-01T00:00:00.000Z","shirtNumber":null,"grade":9,"gender":null,"status":2,"createdAt":"2019-10-25T09:37:59.503Z","deletedAt":null,"picture":"4552/students/123456782/71/picture.png","idSlip":null,"medicalApproval":null},{"student":1889666,"idNumber":234567899,"firstName":"11","lastName":"11","birthDate":"1970-01-01T00:00:00.000Z","shirtNumber":null,"grade":null,"gender":null,"status":2,"createdAt":"2019-10-02T11:30:52.670Z","deletedAt":null,"picture":null,"idSlip":null,"medicalApproval":"4552/students/234567899/71/medical-approval.jpg"},{"student":1889518,"idNumber":40217804,"firstName":"בדיקה","lastName":"בדיקה","birthDate":"2003-01-01T00:00:00.000Z","shirtNumber":null,"grade":11,"gender":null,"status":2,"createdAt":"2019-10-05T20:17:45.706Z","deletedAt":null,"picture":"4552/students/40217804/71/picture.jpg","idSlip":null,"medicalApproval":"4552/students/40217804/71/medical-approval.jpeg"},{"student":1889669,"idNumber":666666664,"firstName":"43","lastName":"34","birthDate":"1970-01-01T00:00:00.000Z","shirtNumber":null,"grade":null,"gender":null,"status":2,"createdAt":"2019-09-23T17:05:43.566Z","deletedAt":null,"picture":null,"idSlip":null,"medicalApproval":null},{"student":1889672,"idNumber":234234235,"firstName":"עדכעגדכ","lastName":"גדכע","birthDate":"1970-01-01T00:00:00.000Z","shirtNumber":null,"grade":null,"gender":null,"status":2,"createdAt":"2019-09-23T17:07:30.586Z","deletedAt":null,"picture":null,"idSlip":null,"medicalApproval":null}],"maxStudentBirthday":null,"teamStatus":2,"coordinator":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"representative":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"price":500},{"id":1209,"sport":17,"sportName":"כדורגל","categoryName":"ז'-ח' תלמידים","championship":{"id":6890,"name":"ליגת מועדונים בכדורגל"},"school":{"id":4552,"region":2,"regionName":"צפון"},"competition":17867,"hasTotoSupport":false,"team":1006583,"teamNumber":"א","active":true,"coach":{"name":"ניסוי חדש","phoneNumber":"0501234567","email":"yahav@mir.co.il","certification":0},"coachHelper":{"name":null,"phoneNumber":null,"email":null},"manager":{"name":null,"phoneNumber":null,"email":null},"teacher":{"name":null,"phoneNumber":null,"email":null},"facility":null,"facilityName":null,"facilityAddress":null,"facilityAlternative":{"name":null,"address":null},"activity":[{"endHours":[{"value":690,"text":"11:30"},{"value":720,"text":"12:00"},{"value":750,"text":"12:30"},{"value":780,"text":"13:00"},{"value":810,"text":"13:30"},{"value":840,"text":"14:00"},{"value":870,"text":"14:30"},{"value":900,"text":"15:00"},{"value":930,"text":"15:30"},{"value":960,"text":"16:00"},{"value":990,"text":"16:30"},{"value":1020,"text":"17:00"},{"value":1050,"text":"17:30"},{"value":1080,"text":"18:00"},{"value":1110,"text":"18:30"},{"value":1140,"text":"19:00"},{"value":1170,"text":"19:30"},{"value":1200,"text":"20:00"}],"day":"1","startTime":630,"endTime":690}],"approved":17,"createdAt":"2019-08-26T13:28:03.550Z","payment":null,"paymentAmount":0,"paymentPayerName":null,"paymentPaidAmount":0,"players":[{"student":1891732,"idNumber":50020510,"firstName":"ינון","lastName":"כהן","birthDate":"2006-09-10T00:00:00.000Z","shirtNumber":null,"grade":11,"gender":null,"status":2,"createdAt":"2019-11-06T18:04:54.646Z","deletedAt":null,"picture":null,"idSlip":"4552/students/50020510/71/id-slip.jpg","medicalApproval":null},{"student":1889607,"idNumber":900500109,"firstName":"שחקנית","lastName":"ניסוי מועדון","birthDate":"1970-01-01T00:00:00.000Z","shirtNumber":null,"grade":10,"gender":null,"status":2,"createdAt":"2019-11-06T18:04:54.436Z","deletedAt":null,"picture":"4552/students/900500109/71/picture.gif","idSlip":null,"medicalApproval":null}],"maxStudentBirthday":null,"teamStatus":2,"coordinator":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"representative":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"price":500},{"id":1268,"sport":16,"sportName":"כדורעף","categoryName":"ז'-ח' תלמידות","championship":{"id":6777,"name":"ליגת מועדונים בכדורעף"},"school":{"id":4552,"region":2,"regionName":"צפון"},"competition":17266,"hasTotoSupport":true,"team":1005824,"teamNumber":"א","active":true,"coach":{"name":"d","phoneNumber":"0529999999","email":"guy@mir.co.il","certification":null},"coachHelper":{"name":null,"phoneNumber":null,"email":null},"manager":{"name":null,"phoneNumber":null,"email":null},"teacher":{"name":null,"phoneNumber":null,"email":null},"facility":null,"facilityName":null,"facilityAddress":null,"facilityAlternative":{"name":null,"address":null},"activity":[{"endHours":[{"value":690,"text":"11:30"},{"value":720,"text":"12:00"},{"value":750,"text":"12:30"},{"value":780,"text":"13:00"},{"value":810,"text":"13:30"},{"value":840,"text":"14:00"},{"value":870,"text":"14:30"},{"value":900,"text":"15:00"},{"value":930,"text":"15:30"},{"value":960,"text":"16:00"},{"value":990,"text":"16:30"},{"value":1020,"text":"17:00"},{"value":1050,"text":"17:30"},{"value":1080,"text":"18:00"},{"value":1110,"text":"18:30"},{"value":1140,"text":"19:00"},{"value":1170,"text":"19:30"},{"value":1200,"text":"20:00"}],"day":"1","startTime":630,"endTime":990}],"approved":17,"createdAt":"2019-09-02T11:04:44.730Z","payment":null,"paymentAmount":0,"paymentPayerName":null,"paymentPaidAmount":0,"players":[{"student":1889518,"idNumber":40217804,"firstName":"בדיקה","lastName":"בדיקה","birthDate":"2003-01-01T00:00:00.000Z","shirtNumber":null,"grade":11,"gender":null,"status":2,"createdAt":"2019-10-23T09:40:13.106Z","deletedAt":null,"picture":"4552/students/40217804/71/picture.jpg","idSlip":null,"medicalApproval":"4552/students/40217804/71/medical-approval.jpeg"},{"student":1890307,"idNumber":345200562,"firstName":"תיקון","lastName":"באג","birthDate":"2005-05-05T00:00:00.000Z","shirtNumber":null,"grade":6,"gender":null,"status":2,"createdAt":"2019-10-23T11:45:18.496Z","deletedAt":null,"picture":"4552/students/345200562/71/picture.png","idSlip":null,"medicalApproval":null}],"maxStudentBirthday":"2005-12-31T12:16:36.000Z","teamStatus":2,"coordinator":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"representative":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"price":750},{"id":1348,"sport":29,"sportName":"אופני הרים","categoryName":"ט' תלמידים","championship":{"id":6906,"name":"ליגת מועדונים באופני הרים"},"school":{"id":4552,"region":2,"regionName":"צפון"},"competition":17981,"hasTotoSupport":false,"team":1005823,"teamNumber":"א","active":true,"coach":{"name":"יהב המאמן","phoneNumber":"0501234567","email":"yahav@mir.co.il","certification":0},"coachHelper":{"name":null,"phoneNumber":null,"email":null},"manager":{"name":null,"phoneNumber":null,"email":null},"teacher":{"name":null,"phoneNumber":null,"email":null},"facility":null,"facilityName":null,"facilityAddress":null,"facilityAlternative":{"name":null,"address":null},"activity":[{"endHours":[{"value":600,"text":"10:00"},{"value":630,"text":"10:30"},{"value":660,"text":"11:00"},{"value":690,"text":"11:30"},{"value":720,"text":"12:00"},{"value":750,"text":"12:30"},{"value":780,"text":"13:00"},{"value":810,"text":"13:30"},{"value":840,"text":"14:00"},{"value":870,"text":"14:30"},{"value":900,"text":"15:00"},{"value":930,"text":"15:30"},{"value":960,"text":"16:00"},{"value":990,"text":"16:30"},{"value":1020,"text":"17:00"},{"value":1050,"text":"17:30"},{"value":1080,"text":"18:00"},{"value":1110,"text":"18:30"},{"value":1140,"text":"19:00"},{"value":1170,"text":"19:30"},{"value":1200,"text":"20:00"}],"day":"4","startTime":540,"endTime":1170}],"approved":1,"createdAt":"2019-09-19T11:15:14.106Z","payment":null,"paymentAmount":0,"paymentPayerName":null,"paymentPaidAmount":0,"players":[{"student":1889671,"idNumber":100000009,"firstName":"גדכ","lastName":"עדגכ","birthDate":"1970-01-01T00:00:00.000Z","shirtNumber":null,"grade":11,"gender":null,"status":2,"createdAt":"2019-10-25T09:38:23.300Z","deletedAt":null,"picture":null,"idSlip":null,"medicalApproval":null}],"maxStudentBirthday":null,"teamStatus":2,"coordinator":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"representative":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"price":500},{"id":1686,"sport":81,"sportName":"בוצ'יה","categoryName":"ז',י\"ב תלמידים/תלמידות","championship":{"id":6913,"name":"אליפות בוצ'יה"},"school":{"id":4552,"region":2,"regionName":"צפון"},"competition":17998,"hasTotoSupport":false,"team":null,"teamNumber":"א","active":true,"coach":{"name":"ניסוי יהב","phoneNumber":"0521234567","email":"yahav@mir.co.il","certification":0},"coachHelper":{"name":null,"phoneNumber":null,"email":null},"manager":{"name":null,"phoneNumber":null,"email":null},"teacher":{"name":null,"phoneNumber":null,"email":null},"facility":null,"facilityName":null,"facilityAddress":null,"facilityAlternative":{"name":null,"address":null},"activity":[{"endHours":[{"value":720,"text":"12:00"},{"value":750,"text":"12:30"},{"value":780,"text":"13:00"},{"value":810,"text":"13:30"},{"value":840,"text":"14:00"},{"value":870,"text":"14:30"},{"value":900,"text":"15:00"},{"value":930,"text":"15:30"},{"value":960,"text":"16:00"},{"value":990,"text":"16:30"},{"value":1020,"text":"17:00"},{"value":1050,"text":"17:30"},{"value":1080,"text":"18:00"},{"value":1110,"text":"18:30"},{"value":1140,"text":"19:00"},{"value":1170,"text":"19:30"},{"value":1200,"text":"20:00"}],"day":"0","startTime":660,"endTime":840}],"approved":1,"createdAt":"2019-12-15T12:09:58.216Z","payment":19120015,"paymentAmount":55,"paymentPayerName":"בית ספר עבור בדיקות של יהב","paymentPaidAmount":55,"players":[],"maxStudentBirthday":null,"teamStatus":null,"coordinator":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"representative":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"price":55},{"id":1702,"sport":18,"sportName":"כדוריד","categoryName":"ז'-ח' תלמידות","championship":{"id":6865,"name":"ליגת מועדונים בכדוריד"},"school":{"id":4552,"region":2,"regionName":"צפון"},"competition":17713,"hasTotoSupport":false,"team":null,"teamNumber":"א","active":true,"coach":{"name":"ניסוי יהב","phoneNumber":"050-1234567","email":"yahav@mir.co.il","certification":0},"coachHelper":{"name":null,"phoneNumber":null,"email":null},"manager":{"name":null,"phoneNumber":null,"email":null},"teacher":{"name":null,"phoneNumber":null,"email":null},"facility":null,"facilityName":null,"facilityAddress":null,"facilityAlternative":{"name":null,"address":null},"activity":[{"endHours":[{"value":660,"text":"11:00"},{"value":690,"text":"11:30"},{"value":720,"text":"12:00"},{"value":750,"text":"12:30"},{"value":780,"text":"13:00"},{"value":810,"text":"13:30"},{"value":840,"text":"14:00"},{"value":870,"text":"14:30"},{"value":900,"text":"15:00"},{"value":930,"text":"15:30"},{"value":960,"text":"16:00"},{"value":990,"text":"16:30"},{"value":1020,"text":"17:00"},{"value":1050,"text":"17:30"},{"value":1080,"text":"18:00"},{"value":1110,"text":"18:30"},{"value":1140,"text":"19:00"},{"value":1170,"text":"19:30"},{"value":1200,"text":"20:00"}],"day":"3","startTime":600,"endTime":900}],"approved":1,"createdAt":"2019-12-25T08:08:36.740Z","payment":null,"paymentAmount":0,"paymentPayerName":null,"paymentPaidAmount":0,"players":[],"maxStudentBirthday":null,"teamStatus":null,"coordinator":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"representative":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"price":500},{"id":1741,"sport":76,"sportName":"בדמינטון","categoryName":"ז'-ח' תלמידות","championship":{"id":6862,"name":"ליגת מועדונים בבדמינטון"},"school":{"id":4552,"region":2,"regionName":"צפון"},"competition":17700,"hasTotoSupport":false,"team":null,"teamNumber":"א","active":true,"coach":{"name":"Yahav Burstein","phoneNumber":"0501234567","email":"yahav@mir.co.il","certification":0},"coachHelper":{"name":null,"phoneNumber":null,"email":null},"manager":{"name":null,"phoneNumber":null,"email":null},"teacher":{"name":null,"phoneNumber":null,"email":null},"facility":null,"facilityName":null,"facilityAddress":null,"facilityAlternative":{"name":null,"address":null},"activity":[{"endHours":[{"value":660,"text":"11:00"},{"value":690,"text":"11:30"},{"value":720,"text":"12:00"},{"value":750,"text":"12:30"},{"value":780,"text":"13:00"},{"value":810,"text":"13:30"},{"value":840,"text":"14:00"},{"value":870,"text":"14:30"},{"value":900,"text":"15:00"},{"value":930,"text":"15:30"},{"value":960,"text":"16:00"},{"value":990,"text":"16:30"},{"value":1020,"text":"17:00"},{"value":1050,"text":"17:30"},{"value":1080,"text":"18:00"},{"value":1110,"text":"18:30"},{"value":1140,"text":"19:00"},{"value":1170,"text":"19:30"},{"value":1200,"text":"20:00"}],"day":"2","startTime":600,"endTime":810}],"approved":1,"createdAt":"2020-02-02T12:58:41.876Z","payment":null,"paymentAmount":0,"paymentPayerName":null,"paymentPaidAmount":0,"players":[],"maxStudentBirthday":null,"teamStatus":null,"coordinator":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"representative":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"price":500},{"id":1742,"sport":89,"sportName":"פראלימפי","categoryName":null,"championship":{"id":6971,"name":"אליפות בוצ'ה"},"school":{"id":4552,"region":2,"regionName":"צפון"},"competition":18183,"hasTotoSupport":false,"team":null,"teamNumber":"א","active":true,"coach":{"name":"ניסוי עריכת API","phoneNumber":"0507556519","email":"yahav@mir.co.il","certification":1},"coachHelper":{"name":null,"phoneNumber":null,"email":null},"manager":{"name":null,"phoneNumber":null,"email":null},"teacher":{"name":null,"phoneNumber":null,"email":null},"facility":null,"facilityName":null,"facilityAddress":null,"facilityAlternative":{"name":null,"address":null},"activity":[{"endHours":[{"value":720,"text":"12:00"},{"value":750,"text":"12:30"},{"value":780,"text":"13:00"},{"value":810,"text":"13:30"},{"value":840,"text":"14:00"},{"value":870,"text":"14:30"},{"value":900,"text":"15:00"},{"value":930,"text":"15:30"},{"value":960,"text":"16:00"},{"value":990,"text":"16:30"},{"value":1020,"text":"17:00"},{"value":1050,"text":"17:30"},{"value":1080,"text":"18:00"},{"value":1110,"text":"18:30"},{"value":1140,"text":"19:00"},{"value":1170,"text":"19:30"},{"value":1200,"text":"20:00"}],"day":"1","startTime":660,"endTime":930}],"approved":1,"createdAt":"2020-02-02T14:02:42.863Z","payment":null,"paymentAmount":0,"paymentPayerName":null,"paymentPaidAmount":0,"players":[],"maxStudentBirthday":null,"teamStatus":null,"coordinator":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"representative":{"name":"בדיקה","phoneNumber":"03-9999999","email":"yahavbr@gmail.com"},"price":500}],
    payments: [],
    students: require('./students'),
    transferRequests: [{
        idNumber : 12345,
        team : 1,
        previousSchool : 'השכונה',
        firstName : 'מישהו',
        lastName : 'שעבר',
        region: 1
    },{
        idNumber : 32465548,
        team : 2,
        previousSchool : 12345,
        firstName : 'עוד מישהו',
        lastName : 'שעבר',
        region: 21
    }]
};

var lastTeamId = 0;

function Registration() {
}

Registration.prototype.getRegistrationStatus = function (entity, callback) {
    var groups = [];
    var active = [];
    if (entity.school != null) {
        groups = [
            {
                links: [
                    {enabled: true, name: "מועדונים בית ספריים", route: "registration/club/club"}
                ]
            },
            {
                links: [
                    {enabled: true, name: "אירועי ספורט מחוזיים", route: "registration/region-championships/region-championships"},
                    {name: "תוכנית 'זוזו'"},
                    {name: "משחקים כמו פעם"}
                ]
            },
            {
                links: [
                    {
                        enabled: true,
                        name: "ליגות התיכוניים",
                        links: [
                            {
                                enabled: true,
                                name: "כדורסל ז-ח תלמידים",
                                route: "registration/league/league?team=1"
                            },
                            {
                                enabled: true,
                                name: "כדורעף ז-ח תלמידים",
                                route: "registration/league/league?team=2"
                            }
                        ]
                    },
                    {name: "אליפויות חמ\"ד"},
                    {name: "ISF"},
                    {name: "תכנית פכ\"ל"}
                ]
            },
            {
                links: [
                    {name: "אליפויות ארציות"},
                    {name: "כדורעף חופים נווה ים"}
                ]
            },
            {
                links: [
                    {name: "מחנות אימון"},
                    {name: "השתלמויות מקצועיות"},
                    {name: "כנסים"}
                ]
            }
        ];
        if (test.stage > 0) {
            /*active.push({id: "club"});

            // Adding also a league team for tests
            active.push({
                id: "league",
                team: 123
            });*/
            active.push({name: "הרשמה למועדון", route: "registration/club/club"});
            active.push({name: "כדורסל ז-ח תלמידים", route: "registration/league/league?team=1"});
        }
    }
    else if (entity.city != null) {
        groups = [
            {
                links: [
                    {enabled: true, name: "תוכנית 'זוזו'", route: "registration/project/zuzu-info"},
                    {enabled: true, name: "תכנית פכ\"ל", route: "registration/project/project?pcl"},
                    {enabled: true, name: "תכנית פל\"א", route: "registration/project/pele-info"}
                ]
            }
        ];
    }

    callback(null, {active: active, groups: groups});
};

Registration.prototype.getClubRegistrationStage = function (school, callback) {

    callback(null, {stage: test.stage});
};

Registration.prototype.getClubRegistrationDetails = function (school, callback) {
    callback(null, test.details);
};

Registration.prototype.approveFirstConfirmation = function(school, callback) {
    test.firstConfirmation = true;
    callback(null, true);
};

Registration.prototype.setClubRegistrationDetails = function (school, details, callback) {
    test.details = details;
    if (test.stage < 1) {
        test.stage = 1;
    }
    callback(null, {stage: 1});
};

Registration.prototype.getCompetitions = function (school, options, callback) {
    callback(null,
        {"sports":[{"id":29,"name":"אופני הרים","categories":[{"id":17689,"category":192,"championship":6860,"championshipName":"ליגת מועדונים באופני הרים","name":"ז'-ח' תלמידים","season":"תש\"ף","displayName":null},{"id":17690,"category":12582912,"championship":6860,"championshipName":"ליגת מועדונים באופני הרים","name":"ז'-ח' תלמידות","season":"תש\"ף","displayName":null},{"id":17691,"category":256,"championship":6860,"championshipName":"ליגת מועדונים באופני הרים","name":"ט' תלמידים","season":"תש\"ף","displayName":null},{"id":17692,"category":16777216,"championship":6860,"championshipName":"ליגת מועדונים באופני הרים","name":"ט' תלמידות","season":"תש\"ף","displayName":null}],"championships":[{"id":6860,"name":"ליגת מועדונים באופני הרים"}],"isOnePaymentPerCategory":false},{"id":24,"name":"אתלטיקה קלה","categories":[{"id":17695,"category":192,"championship":6861,"championshipName":"ליגת מועדונים באתלטיקה קלה","name":"ז'-ח' תלמידים","season":"תש\"ף","displayName":null},{"id":17696,"category":12582912,"championship":6861,"championshipName":"ליגת מועדונים באתלטיקה קלה","name":"ז'-ח' תלמידות","season":"תש\"ף","displayName":null},{"id":17697,"category":256,"championship":6861,"championshipName":"ליגת מועדונים באתלטיקה קלה","name":"ט' תלמידים","season":"תש\"ף","displayName":null},{"id":17698,"category":16777216,"championship":6861,"championshipName":"ליגת מועדונים באתלטיקה קלה","name":"ט' תלמידות","season":"תש\"ף","displayName":null}],"championships":[{"id":6861,"name":"ליגת מועדונים באתלטיקה קלה"}],"isOnePaymentPerCategory":false},{"id":76,"name":"בדמינטון","categories":[{"id":17699,"category":192,"championship":6862,"championshipName":"ליגת מועדונים בבדמינטון","name":"ז'-ח' תלמידים","season":"תש\"ף","displayName":null},{"id":17700,"category":12582912,"championship":6862,"championshipName":"ליגת מועדונים בבדמינטון","name":"ז'-ח' תלמידות","season":"תש\"ף","displayName":null}],"championships":[{"id":6862,"name":"ליגת מועדונים בבדמינטון"}],"isOnePaymentPerCategory":true},{"id":21,"name":"טניס שולחן","categories":[{"id":17701,"category":192,"championship":6863,"championshipName":"ליגת מועדונים בטניס שולחן","name":"ז'-ח' תלמידים","season":"תש\"ף","displayName":null},{"id":17702,"category":12582912,"championship":6863,"championshipName":"ליגת מועדונים בטניס שולחן","name":"ז'-ח' תלמידות","season":"תש\"ף","displayName":null},{"id":17703,"category":256,"championship":6863,"championshipName":"ליגת מועדונים בטניס שולחן","name":"ט' תלמידים","season":"תש\"ף","displayName":null},{"id":17704,"category":16777216,"championship":6863,"championshipName":"ליגת מועדונים בטניס שולחן","name":"ט' תלמידות","season":"תש\"ף","displayName":null}],"championships":[{"id":6863,"name":"ליגת מועדונים בטניס שולחן"}],"isOnePaymentPerCategory":false},{"id":17,"name":"כדורגל","categories":[{"id":17711,"category":192,"championship":6864,"championshipName":"ליגת מועדונים בקט רגל 5*5","name":"ז'-ח' תלמידים","season":"תש\"ף","displayName":null},{"id":17712,"category":12582912,"championship":6864,"championshipName":"ליגת מועדונים בקט רגל 5*5","name":"ז'-ח' תלמידות","season":"תש\"ף","displayName":null}],"championships":[{"id":6864,"name":"ליגת מועדונים בקט רגל 5*5"}],"isOnePaymentPerCategory":false},{"id":18,"name":"כדוריד","categories":[{"id":17713,"category":12582912,"championship":6865,"championshipName":"ליגת מועדונים בכדוריד","name":"ז'-ח' תלמידות","season":"תש\"ף","displayName":null},{"id":17715,"category":192,"championship":6865,"championshipName":"ליגת מועדונים בכדוריד","name":"ז'-ח' תלמידים","season":"תש\"ף","displayName":null}],"championships":[{"id":6865,"name":"ליגת מועדונים בכדוריד"}],"isOnePaymentPerCategory":false},{"id":15,"name":"כדורסל","categories":[{"id":17717,"category":12582912,"championship":6866,"championshipName":"ליגת מועדונים בכדורסל","name":"ז'-ח' תלמידות","season":"תש\"ף","displayName":null},{"id":17720,"category":192,"championship":6866,"championshipName":"ליגת מועדונים בכדורסל","name":"ז'-ח' תלמידים","season":"תש\"ף","displayName":null}],"championships":[{"id":6866,"name":"ליגת מועדונים בכדורסל"}],"isOnePaymentPerCategory":false},{"id":16,"name":"כדורעף","categories":[{"id":17721,"category":192,"championship":6867,"championshipName":"ליגת מועדונים בכדורעף","name":"ז'-ח' תלמידים","season":"תש\"ף","displayName":null},{"id":17722,"category":12582912,"championship":6867,"championshipName":"ליגת מועדונים בכדורעף","name":"ז'-ח' תלמידות","season":"תש\"ף","displayName":null},{"id":17725,"category":256,"championship":6867,"championshipName":"ליגת מועדונים בכדורעף","name":"ט' תלמידים","season":"תש\"ף","displayName":null},{"id":17726,"category":16777216,"championship":6867,"championshipName":"ליגת מועדונים בכדורעף","name":"ט' תלמידות","season":"תש\"ף","displayName":null}],"championships":[{"id":6867,"name":"ליגת מועדונים בכדורעף"}],"isOnePaymentPerCategory":false},{"id":28,"name":"נווט ספורטיבי","categories":[{"id":17731,"category":192,"championship":6868,"championshipName":"ליגת מועדונים בניווט","name":"ז'-ח' תלמידים","season":"תש\"ף","displayName":null},{"id":17732,"category":12582912,"championship":6868,"championshipName":"ליגת מועדונים בניווט","name":"ז'-ח' תלמידות","season":"תש\"ף","displayName":null},{"id":17733,"category":256,"championship":6868,"championshipName":"ליגת מועדונים בניווט","name":"ט' תלמידים","season":"תש\"ף","displayName":null},{"id":17734,"category":16777216,"championship":6868,"championshipName":"ליגת מועדונים בניווט","name":"ט' תלמידות","season":"תש\"ף","displayName":null},{"id":17735,"category":3584,"championship":6868,"championshipName":"ליגת מועדונים בניווט","name":"י'-י\"ב תלמידים","season":"תש\"ף","displayName":null},{"id":17736,"category":234881024,"championship":6868,"championshipName":"ליגת מועדונים בניווט","name":"י'-י\"ב תלמידות","season":"תש\"ף","displayName":null}],"championships":[{"id":6868,"name":"ליגת מועדונים בניווט"}],"isOnePaymentPerCategory":false},{"id":81,"name":"בוצ'יה","categories":[{"id":17998,"category":138414144,"championship":6913,"championshipName":"אליפות בוצ'יה","name":"ז', י\"ב תלמידים/ות","season":"תש\"ף","displayName":null}],"championships":[{"id":6913,"name":"אליפות בוצ'יה"}],"isOnePaymentPerCategory":false},{"id":89,"name":"פראלימפי","categories":[{"id":18181,"category":1,"championship":6971,"championshipName":"אליפות בוצ'ה","name":"א' תלמידים","season":"תש\"ף","displayName":null},{"id":18182,"category":2,"championship":6971,"championshipName":"אליפות בוצ'ה","name":"ב' תלמידים","season":"תש\"ף","displayName":null},{"id":18183,"category":4,"championship":6971,"championshipName":"אליפות בוצ'ה","name":"ג' תלמידים","season":"תש\"ף","displayName":null},{"id":18207,"category":1,"championship":6980,"championshipName":"אליפות אתלטיקה פראלימפי","name":"א' תלמידים","season":"תש\"ף","displayName":null},{"id":18208,"category":2,"championship":6980,"championshipName":"אליפות אתלטיקה פראלימפי","name":"ב' תלמידים","season":"תש\"ף","displayName":null},{"id":18209,"category":4,"championship":6980,"championshipName":"אליפות אתלטיקה פראלימפי","name":"ג' תלמידים","season":"תש\"ף","displayName":null},{"id":18210,"category":8,"championship":6980,"championshipName":"אליפות אתלטיקה פראלימפי","name":"ד' תלמידים","season":"תש\"ף","displayName":null}],"championships":[{"id":6971,"name":"אליפות בוצ'ה"},{"id":6980,"name":"אליפות אתלטיקה פראלימפי"}],"isOnePaymentPerCategory":false},{"id":91,"name":"אליפות ארצית כדורעף ז-ח","categories":[{"id":18272,"category":192,"championship":6999,"championshipName":"אליפות ארצית כדורעף ז-ח","name":"ז'-ח' תלמידים","season":"תש\"ף","displayName":null},{"id":18273,"category":12582912,"championship":6999,"championshipName":"אליפות ארצית כדורעף ז-ח","name":"ז'-ח' תלמידות","season":"תש\"ף","displayName":null}],"championships":[{"id":6999,"name":"אליפות ארצית כדורעף ז-ח"}],"isOnePaymentPerCategory":false}]}
        );
};

Registration.prototype.getClubTeams = function (school, callback) {
    callback(null, test.teams);
};

Registration.prototype.insertClubTeam = function (school, team, callback) {
    lastTeamId++;
    team.id = lastTeamId;
    team.hasTotoSupport = team.sport == 16 || team.sport == 24;
    team.createdAt = new Date();
    test.teams.push(team);
    callback(null, {id: team.id, hasTotoSupport: team.hasTotoSupport, createdAt: team.createdAt});
};

Registration.prototype.changeClubTeamStatus = function(teams, status, callback) {
    for (var i = 0; i < test.teams.length; i++) {
        if (teams.indexOf(team.id) >= 0) {
            team.status = status;
        }
    }
    callback(null, true);
};

Registration.prototype.updateClubTeam = function (school, id, team, callback) {
    for (var i = 0; i < test.teams.length; i++) {
        var t = test.teams[i];
        if (t.id === id) {
            team.id = id;
            team.hasTotoSupport = team.sport == 16 || team.sport == 24;
            test.teams[i] = team;
            callback(null, {hasTotoSupport: team.hasTotoSupport});
            return;
        }
    }
    callback({status: 404, message: "קבוצה לא נמצאה"});
};

Registration.prototype.deleteClubTeam = function (school, id, callback) {
    for (var i = 0; i < test.teams.length; i++) {
        var t = test.teams[i];
        if (t.id === id) {
            test.teams.splice(i, 1);
            callback();
            return;
        }
    }
    callback({status: 404, message: "קבוצה לא נמצאה"});
};

Registration.prototype.approveClubTeams = function (userId, school, approval, callback) {
    if (test.stage < 2) {
        test.stage = 2;
    }

    for (var i = 0; i < test.teams.length; i++) {
        var team = test.teams[i];
        if (!team.approved || team.approved < approval) {
            team.approved |= approval;
        }
    }

    callback(null, {stage: 2});
};

Registration.prototype.getClubPayments = function (school, callback) {
    /*var payments = [];
    var p = {};
    for (var t = 0; t < test.teams.length; t++) {
        var team = test.teams[t];
        if (team.payment != null && !p[team.payment]) {
            payments.push({
                id: team.payment,
                order: team.payment
            });
        }
    }*/
    callback(null, test.payments);
};

Registration.prototype.cancelOrderPayments = function(school, orderId, callback) {
    callback(null, true);
};

Registration.prototype.insertPayments = function (school, payments, callback) {
    var now = new Date();
    var month = (now.getFullYear() % 100) * 100 + (now.getMonth() + 1);
    var orderId = month * 10000 + 1;
    for (var i = 0; i < test.payments.length; i++) {
        var payment = test.payments[i];
        if (payment.order >= orderId) {
            orderId = payment.order + 1;
        }
    }
    for (var i = 0; i < payments.length; i++) {
        var payment = payments[i];
        payment.id = orderId + i;
        payment.order = orderId;
        test.payments.push(payment);
        for (var c = 0; c < payment.details.items.length; c++) {
            var item = payment.details.items[c];
            for (var t = 0; t < item.teams.length; t++) {
                var teamId = item.teams[t];
                for (var a = 0; a < test.teams.length; a++) {
                    var team = test.teams[a];
                    if (team.id === teamId) {
                        team.payment = payment.id;
                        break;
                    }
                }
            }
        }

    }
    callback(null, {order: orderId});
};

Registration.prototype.getPlayer = function(school, region, idNumber, callback){
    var student = test.students.find(function(student) {
        return student.idNumber == idNumber;
    });

    if (student) {
        if (student.region === region) {
            callback(null, student);
        }
        else {
            callback(null, { external: true, grade: student.grade }) ;
        }
    }
    else {
        callback(null, {
            student: null,
            firstName: null,
            lastName: null,
            birthDate: null,
            grade: null,
            gender: null
        });
    }
};

Registration.prototype.deleteTransferRequest = function(school, teamId, idNumber, callback){
    for (var i = 0; i < test.transferRequests.length; i++) {
        var transfer = test.transferRequests[i];
        if (transfer.team === teamId && transfer.idNumber === idNumber) {
            test.transferRequests.splice(i, 1);
            break;
        }
    }
    callback(null, true);
};

Registration.prototype.getTransferRequests = function(school, teamId, callback){
    var result = [];
    for (var i = 0; i < test.transferRequests.length; i++) {
        var transfer = test.transferRequests[i];
        if (transfer.team === teamId) {
            result.push(transfer);
        }
    }
    callback(null, result);
};

Registration.prototype.deleteTeamPlayer = function(school, teamId, studentId, callback) {
    var team = test.teams.find(function(team){
        return team.id === teamId;
    });

    for (var i = 0; i < team.players.length; i++) {
        if (team.players[i].student === studentId)
            team.players.splice(i, 1);
    }

    callback(null, true)
};

Registration.prototype.upsertTeamPlayer = function(school, teamId, data, callback) {

    if (data.external) {
        // TODO
        callback();
        return;
    }

    var team = test.teams.find(function(team){
        return team.id == teamId;
    });

    if (!team.players) {
        team.players = [];
    }

    var student;
    if (data.student != null) {
        student = test.students.find(function (student) {
            return student.student == data.student;
        });

        student.firstName = data.firstName;
        student.lastName = data.lastName;
        student.birthDate = data.birthDate;
        student.grade = data.grade;
        student.gender = data.gender;

        for (var i = 0; i < team.players.length; i++) {
            if (team.players[i].student === data.student) {
                team.players.splice(i, 1);
                break;
            }
        }
    }
    else {
        data.student = test.students.length + 1;
        data.school = school;
        student = data;
        test.students.push(student);
    }

    team.players.push(student);

    callback(null, student);
};



module.exports = new Registration();