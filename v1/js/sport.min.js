function PagingService(e,t){var n=this;this.options=void 0===t?__psDefaultOptions:t;for(var a in __psDefaultOptions)this.options.hasOwnProperty(a)||(this.options[a]=__psDefaultOptions[a]);this.__source=null,this.rawData=e,this.itemsCount=function(){return(this.rawData||[]).length},this.getAllData=function(){return(this.rawData||[]).slice(0)},this.parsePageSize=function(e){var t=parseInt(e,10);isNaN(t)&&(t=this.options.pageSize);for(var n=!1,a=this.availablePageSizes(),o=0;o<a.length;o++){if(t==a[o]){n=!0;break}}return n||(t=this.options.pageSize),t},this.availablePageSizes=function(){for(var e=[],t=0;t<__psAvailablePageSizes.length;t++)e.push(__psAvailablePageSizes[t]);for(var n=(this.rawData||[]).length,a=0,t=0;t<e.length;t++)if(e[t]>=n){a=t+1;break}return a>0&&a<e.length&&e.splice(a),e},this.getPageCount=function(e){var t=this.itemsCount(),n=Math.ceil(t/e);return n>0?n:1},this.isPageIncluded=function(e,t,n){if(1==e||e==n)return!0;var a=t;return a<3&&(a=3),a>n-2&&(a=n-2),e==a||e==a-1||e==a+1},this.getPages=function(e,t){for(var n=this.getPageCount(e),a=[],o=1;o<=n;o++){var i=o;this.isPageIncluded(i,t,n)&&a.push(i)}return a},this.parseCurrentPage=function(e,t){if(void 0===e||void 0===t)return 1;var n=parseInt(e,10),a=this.getPageCount(t);return isNaN(n)||n<1||n>a?1:n},this.changePageSize=function(e){n.pageSize=e,n.applyPaging(n.__source),n.currentPage>1&&n.changePage(1)},this.changePage=function(e){n.currentPage=e,n.applyPaging(n.__source)},this.nextPage=function(){if(!this.pagingData.isLastPage){var e=n.currentPage+1;n.changePage(e)}},this.previousPage=function(){if(!this.pagingData.isFirstPage){var e=parseInt(n.currentPage||0)-1;n.changePage(e)}},this.setData=function(e,t){this.rawData=e,void 0!==t&&t&&(this.__source=t),this.applyPaging(this.__source),this.currentPage>1&&this.changePage(1)},this.applyPaging=function(e){this.rawData||(this.rawData=[]),null==e&&(e=[]),this.__source=e,e.splice(0,e.length);var t=this.parsePageSize(this.pageSize),n=this.parseCurrentPage(this.currentPage,t);this.currentPage=n,this.pageSize=t;var a=[],o=(this.currentPage-1)*t,i=o+t;if(i>this.rawData.length&&(i=this.rawData.length),this.rawData.length>0)for(var r=o;r<i;r++)a.push(this.rawData[r]);this.pagingData={gotPaging:a.length<this.itemsCount(),firstRecord:o+1,lastRecord:o+a.length,totalRecords:this.itemsCount(),pageSizes:this.availablePageSizes(),selectedPage:this.currentPage,selectedPageSize:this.pageSize,isFirstPage:1==this.currentPage,isLastPage:this.currentPage==this.getPageCount(this.pageSize),pages:this.getPages(this.pageSize,this.currentPage),pageCount:this.getPageCount(this.pageSize)};for(var r=0;r<a.length;r++)e.push(a[r]);this.options.applyDataCallback&&this.options.applyDataCallback()}}function getBooleanValue(e){return"string"==typeof e?["1","yes","true"].indexOf(e.toLowerCase())>=0:!!e}function IntegerTextboxKeyPress(e){var t=String.fromCharCode(e.which),n=parseInt(t);isNaN(n)&&e.preventDefault()}function IntegerTextboxBlur(e){var t=$(this),n=t.val();if(n.length>0){var a=parseInt(n);isNaN(a)||t.val(a.toString())}}function _sportUtilMisc_ParseColors(e){var t=(e||"").indexOf(",");if(t>0){var n=e.substr(0,t),a=e.substring(t+1);if(n.length>0&&a.length>0)return{Valid:!0,Even:n,Odd:a}}return{Valid:!1}}function TimedFunctions(){_sportUtilMiscTimer_Counter>1e6&&(_sportUtilMiscTimer_Counter=0),_sportUtilMiscTimer_Counter++,function(){if(_sportUtilMiscTimer_Counter%5==0){var e=$(".progress-dot");0!=e.length&&e.each(function(){var e=$(this);if(e.parents("div").first().is(":visible")){var t=e.text().length;++t>3&&(t=1);var n=Array(t+1).join(".");e.text(n)}})}}(),function(){var e=$(".alternating-colors");if(0!=e.length){var t=0;e.each(function(){var e=$(this),n=_sportUtilMisc_ParseColors(e.data("colors"));if(n.Valid){var a=t%2==0?n.Even:n.Odd;e.css("background-color",a),t++}})}}(),function(){var e=$(".dependant-height");0!=e.length&&e.each(function(){var e=$(this),t=e.data("source-element");if(t){var n=$("#"+t);if(1==n.length){var a=n[0].offsetHeight;a>0&&(e.css("height",a+"px"),e.css("line-height",a+"px"),e.css("vertical-alignment","middle"))}}})}(),function(){var e=$(".check-dirty");0!=e.length&&e.each(function(){var e=$(this);"1"!=e.data("check-dirty-attached")&&(e.find("input").each(function(){$(this).change(function(){e.data("is-dirty","1")})}),e.data("check-dirty-attached","1"))})}(),function(){var e=window.page_type_mapping;if(e&&null!=e){var t=$('a[href*="/page/"]');t.length>0&&t.each(function(){var t=$(this),n=t.attr("href"),a=n.lastIndexOf("/");if(a>0&&a<n.length-1){var o=n.substr(a+1),i=e[o];if(i){var r=n.replace("/page/","/"+i+"/");t.attr("href",r),t.onclick=null}}})}}(),function(){if(sportUtils.IsMobile()){var e=$(".mobile-reverse-order");0!=e.length&&e.each(function(){var e=$(this);if("1"!=e.data("reversed")){var t=e.find("> div");e.append(t.get().reverse()),e.data("reversed","1")}})}}(),function(){$(".match-group").each(function(){var e=$(this);if("1"!=e.data("applied-same-facility")){e.data("applied-same-facility","1");for(var t=e.find(".match-date-label").first(),n=e.find(".category-facility"),a="",o=0,i=0;i<n.length;i++){var r=$.trim(n.eq(i).text());if(r.length>0){if(a.length>0&&r!=a){if(o>1){var s=n.eq(i-1).parents(".group-match").first();t.clone().insertAfter(s),s.find(".alternating-colors").css("margin-bottom","10px")}o=0}o++,a=r}}}})}(),function(){var e=document.getElementById("VOD_row"),t=document.getElementById("pnlSales");if(e&&null!=e&&null!=t){var n=e.offsetTop+e.offsetHeight,a=n-t.offsetTop;$("#pnlSales").css("height",a+"px")}}()}function CheckFinalSubmission(){return $("#lblConfirmFinalSubmission").hasClass("fa-check-square-o")}!function(){"use strict";function e(e){return function(t,n,a){function o(t,n){var a=e.defer(),o=new XMLHttpRequest,i=new FormData;return i.append("attachment",n),o.open("POST",t),o.onload=function(e){200==e.target.status?a.resolve("ok"):a.reject("שגיאה בעת העלאת  קובץ לשרת")},o.onerror=function(e){a.reject("שגיאה בעת העלאת  קובץ לשרת")},o.send(i),a.promise}function i(e){var t=e.lastIndexOf("/");return t<0&&(t=e.lastIndexOf("\\")),t<0?e:t==e.length-1?"":e.substring(t+1)}function r(e,t){++c>100&&t([]);var n=e();null!=n?t(n):window.setTimeout(function(){r(e,t)},50)}var s,l,c=0;s=t[a.dropzone],l=new Dropzone(n[0],s.options),window.setTimeout(function(){var e=n.data("player-id"),t=n.data("file-type");if(e&&t){var a=e+"_"+t;window._AllDropZones_||(window._AllDropZones_={}),window._AllDropZones_[a]=l}},500);l.uploadFiles=function(e){for(var t=this,a=0;a<e.length;a++){var i=e[a];s.eventHandlers.sending&&s.eventHandlers.sending(t,i);var r=s.options.url,l=n.data("player-id");l&&(r=r.replace("$id",l)),o(r,i).then(function(e){console.log("File "+i.name+" uploaded successfully ("+i.size+" bytes)")},function(e){console.log("Error uploading file "+i.name+": "+e)});for(var c=Math.round(Math.min(60,Math.max(6,i.size/1e5))),u=0;u<c;u++){var d=100*(u+1);setTimeout(function(e,n,a){return function(){e.upload={progress:100*(a+1)/n,total:e.size,bytesSent:(a+1)*e.size/n},t.emit("uploadprogress",e,e.upload.progress,e.upload.bytesSent),100==e.upload.progress&&(e.status=Dropzone.SUCCESS,t.emit("success",e,"success",null),t.emit("complete",e),t.processQueue())}}(i,c,u),d)}}},angular.forEach(s.eventHandlers,function(e,t){l.on(t,e)}),s.existingFiles&&r(s.existingFiles,function(e){if(e.length>0){for(var t=0;t<e.length;t++){var n=e[t],a={name:i(n.Path),size:n.Size};l.options.addedfile.call(l,a),l.options.thumbnail.call(l,a,n.Path),l.files.push(a)}window.setTimeout(function(){$(".dz-preview").each(function(){var e=$(this);e.hasClass("dz-complete")||e.addClass("dz-complete")})},500)}})}}function t(e,t,n,a,o,i,r,s){function l(){localStorage.removeItem("logged_username"),localStorage.removeItem("logged_display_name"),localStorage.removeItem("logged_role")}function c(){return r.globalData.seasons.findIndex(function(e){return e.Season==r.globalData.selectedSeason.Season})}r.globalData={regions:[],loggedUser:null,pinnedChampionships:[],contentMapping:{},sportFieldIcons:{},seasons:[],currentSeason:sportUtils.getCurrentSeason(),selectedSeason:{Name:"",Season:0},defaultSeason:{Name:"",Season:0},feedbackResult:null},r.globalMethods={},r.globalModel={feedback:{}},r.IsMobileDevice=sportUtils.IsMobile(),r.homeState=r.IsMobileDevice?"home-mobile":"home",t.get("/api/common/all-global-data").then(function(e){var t=e.data;if(null!=t.Login?r.globalData.loggedUser={Login:t.Login.name,DisplayName:t.Login.displayName,Role:t.Login.role}:l(),null!=t.Sportsman&&(r.globalData.regions=t.Sportsman.Regions,r.globalData.pinnedChampionships=t.Sportsman.PermanentChampionships,t.Sportsman.SeasonsInUse.length>0)){r.globalData.seasons=t.Sportsman.SeasonsInUse.slice(0),r.globalData.seasons.sort(function(e,t){return e.Season-t.Season});var n=r.globalData.seasons.filter(function(e){return e.IsCurrent});if(0==n.length&&(n=[r.globalData.seasons.lastItem()]),r.globalData.defaultSeason=n[0],r.globalData.currentSeason.Season){var a=t.Sportsman.SeasonsInUse.findItem(function(e){return e.Season==r.globalData.currentSeason.Season});null!=a&&(r.globalData.currentSeason.FirstDay=a.FirstDay,r.globalData.currentSeason.LastDay=a.LastDay)}else r.globalData.currentSeason=sportUtils.shallowCopy(r.globalData.defaultSeason);r.globalData.selectedSeason=sportUtils.shallowCopy(r.globalData.currentSeason)}r.globalData.contentMapping=t.ContentMapping,r.globalData.sportFieldIcons=t.SportFieldIcons,contentUtils.InitPageTypes(t.PageTypes);var o=contentUtils.GetPageTypeMapping(),i={};for(var s in o){var c=o[s];i[s.toString()]=c.Name}window.page_type_mapping=i},function(e){console.log("error loading global data"),l()}),r.$on("$stateChangeSuccess",function(e,t,n,a,o){var i=t?t.name:"";i&&i.length>0&&sportUtils.InitiateScrollToTopProcess(),window.CropperImagePath="",window.CropperImageRatio=null,sportUtils.AttachAutoClick(),window.setTimeout(function(){window["google-analytics-page-hit"]?window["google-analytics-page-hit"]=null:window.ga&&window.ga("send","pageview",document.location.hash)},500)}),r.globalMethods.loginPanelClicked=function(){e.globalData.showLogin=!e.globalData.showLogin},r.mobileLoginClicked=function(){e.globalData.showLogin=!e.globalData.showLogin},r.globalMethods.gotNextSeason=function(){return c()<r.globalData.seasons.length-1},r.globalMethods.gotPrevSeason=function(){return c()>0},r.globalMethods.changeSeason=function(e){var t=c(),n=t+e;if(n>=0&&n<r.globalData.seasons.length){var a=r.globalData.seasons[n];r.globalData.selectedSeason=sportUtils.shallowCopy(a)}},r.globalMethods.applySeason=function(){sportUtils.setCurrentSeason(r.globalData.selectedSeason),document.location.reload(!0)},r.globalMethods.resetSeason=function(){sportUtils.setCurrentSeason(null),document.location.reload(!0)},r.globalMethods.gotoYoungSportsmenEvents=function(){localStorage.EventsSportFieldFilter=sportGlobalSettings.YoungSportsmenSeq,i.go("events")},r.globalMethods.register=function(){i.go("register")},r.globalMethods.SendFeedback=function(){r.globalData.feedbackSending=!0,r.globalData.feedbackResult=null,t.post("/api/mails/feedback",r.globalModel.feedback).then(function(e){r.globalData.feedbackSending=!1,r.globalData.feedbackResult={Token:e.data.Token||""}},function(e){r.globalData.feedbackSending=!1,r.globalData.feedbackResult={Error:e.data||"שגיאה כללית בעת שליחת משוב"},a(function(){r.globalData.feedbackResult=null},5e3)})},r.globalMethods.manageClicked=function(){var e=sportUtils.IsMobile()?"edit-results":"pages.manage";i.go(e)},r.globalMethods.logout=function(){t.post("/api/logout").then(function(){l(),document.location.href=document.location.pathname},function(e){alert("שגיאה בעת התנתקות"),document.location.reload(!0)})},r.globalMethods.login=function(){r.globalData.errorMessage=null,sportUtils.Login(n,t,r.globalModel.username,r.globalModel.password).then(function(e){document.location.reload(!0)},function(e){r.globalData.errorMessage=e})}}function n(e){}function a(e,t,n){function a(t,n,a){if(e.LoggedInUser&&e.LoggedInUser.role&&a.indexOf(e.LoggedInUser.role)>=0){var o="padding: 5px 5px 5px 5px;",i="";t==e.sender&&(o+=" background-color: #00ADEE;",i="color: white;");var r="";if(0==t.indexOf("#page-")){var s=parseInt(t.replace("#page-",""));isNaN(s)||(r="#/page/"+s,t="")}e.tabs.push({ListItemStyle:o,LinkStyle:i,State:t,Link:r,Description:n})}}e.tabs=[],e.IsMobileDevice=sportUtils.IsMobile(),sportUtils.VerifyUser(t,e,[2,3],function(n){1!=e.Unauthorized&&t.get("/api/common/content-mapping").then(function(t){var n=0;t.data&&t.data.Admin&&(n=t.data.Admin.Downloads||0),a("pages.manage","ניהול עמודי תוכן",[1,3]),a("register","רישום קבוצות ושחקנים",[2]),a("banners","ניהול פרסומות",[1,3]),a("reports",'דו"חות',[1]),a("edit-results","הזנת תוצאות משחקים",[1,2]),a("upya-manage","מחנות אימון",[1]),e.LoggedInUser.isClubUser&&a("club-register","טופס רישום מועדון",[2]),a("pages.regions","מחוזות",[1]),n>0&&a("article({page: "+n+"})","הורדות",[1]);var o=e.tabs.findIndex(function(e){return"color: white;"==e.LinkStyle});window.setTimeout(function(){document.getElementById("ddlMobileManageMenu").selectedIndex=o+1},500)})}),e.mobileMenuChanged=function(){var e=$("#ddlMobileManageMenu").find(":selected"),t=e.data("state"),a=e.data("link");t?n.go(t):a&&(document.location.href=a)}}angular.module("sport",["sport.home","sport.mobile","sport.flowers","sport.content","sport.register","sport.banners","sport.UPYA","sport.club-register","sport.reports","sport.events","sport.championships","ui.bootstrap","ngSanitize","ngCookies"]).config(["$urlRouterProvider",function(e){(document.location.href||"").toLowerCase().indexOf("players-register-form.html")<0&&(document.location.href||"").toLowerCase().indexOf("club-register-form.html")<0&&e.otherwise("/home")}]).config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|waze|chrome-extension):/)}]).controller("SportMainCtrl",["$scope","$http","$q","$timeout","$interval","$state","$rootScope","SportService",t]).controller("ManageBreadcrumbsCtrl",["$scope",n]).controller("ManageTabsCtrl",["$scope","$http","$state",a]).filter("reverse",function(){return function(e){return e.slice().reverse()}}).filter("isNull",function(){return function(e,t){return void 0===e||null==e?t:e}}).filter("teamName",function(){return function(e,t){return eventsUtils.BuildTeamName(e,t)}}).filter("formatDateTime",["$filter",function(e){return function(t,n){if(null==t||!t)return"";if(!t.toISOString&&(t=new Date(t),!t.toISOString))return t;var a=t.toISOString();if(a.indexOf("-")>3&&a.indexOf("T")>9){var o=a.split("T"),i=o[0].split("-"),r=o[1].split(":");r[2]=r[2].substring(0,2);var s=i[0],l=i[1],c=i[2],u=r[0],d=r[1],p=r[2],g={dd:c,MM:l,yyyy:s,HH:u,mm:d,ss:p},h=n+"";for(var f in g)for(var m=g[f];h.indexOf(f)>=0;)h=h.replace(f,m);return h}return e("date")(t,n)}}]).directive("manageBreadcrumbs",function(){return{restrict:"E",scope:{description:"@?"},templateUrl:"views/manage-breadcrumbs.html",controller:"ManageBreadcrumbsCtrl"}}).directive("manageTabs",function(){return{restrict:"E",scope:{sender:"@?"},templateUrl:"views/manage-tabs.html",controller:"ManageTabsCtrl"}}).directive("fbComments",function(){return{restrict:"C",link:function(e,t,n){return t[0].dataset.href=document.location.href,"undefined"!=typeof FB&&null!==FB?FB.XFBML.parse(t.parent()[0]):void 0}}}).directive("changeBackground",["$animate",function(e){return{restrict:"EA",scope:{colorcode:"@?",selected:"@?"},link:function(e,t,n){t.on("mouseenter",function(){(!e.selected||0==e.selected||e.selected&&"false"==e.selected.toString())&&(t.addClass("change-color"),t.css("background-color",e.colorcode))}),t.on("mouseleave",function(){(!e.selected||0==e.selected||e.selected&&"false"==e.selected.toString())&&(t.removeClass("change-color"),t.css("background-color","transparent"))})}}}]).directive("dropzone",["$q",e])}(),function(){"use strict";angular.module("sport.banners",["components","ui.router"]).config(["$stateProvider",function(e){e.state("banners",{url:"/banners",views:{"main@":{templateUrl:"views/banners.html",controller:"BannersController"}}})}])}(),function(){"use strict";angular.module("sport.championships",["ui.router","ui.select"]).config(["$stateProvider",function(e){e.state("championships",{url:"/championships/:clubs",views:{"main@":{templateUrl:"views/championships.html",controller:"ChampionshipsController"}}}).state("championships.region",{url:"/:region",views:{"main@":{templateUrl:"views/championships.html",controller:"ChampionshipsController"}}}).state("championships.region.championship",{url:"/:category",views:{"main@":{templateUrl:"views/championships.html",controller:"ChampionshipsController"}}}).state("edit-results",{url:"/edit-results",views:{"main@":{templateUrl:"views/edit-results.html",controller:"EditResultsController"}}})}]).directive("championshipCategory",function(){return{restrict:"E",scope:{category:"=category"},templateUrl:"views/championship-category.html",controller:"ChampionshipCategoryCtrl"}}).directive("finalsTree",function(){return{restrict:"E",scope:{tree:"=tree"},templateUrl:"views/finals-tree.html",controller:"ChampionshipCategoryFinalsTreeCtrl"}})}(),function(){"use strict";angular.module("sport.club-register",["components","ui.router"]).config(["$stateProvider",function(e){e.state("club-register",{url:"/club-register",views:{"main@":{templateUrl:"views/club-register.html",controller:"ClubRegisterController"}}})}])}(),function(){"use strict";angular.module("components",[])}(),function(){"use strict";angular.module("sport.content",["ui.router","ui.select","ngTagsInput"]).config(["$stateProvider",function(e){e.state("page",{url:"/page/:page",views:{"main@":{templateUrl:"views/content.html",controller:"ContentController"}},data:{contentType:"page"}}).state("page.edit",{url:"/edit",views:{"main@":{templateUrl:"views/content-edit.html",controller:"ContentEditController"}},data:{contentType:null}}).state("videos",{url:"/videos",views:{"main@":{templateUrl:"views/content-list.html",controller:"ContentListController"}},data:{contentType:"video"}}).state("galleries",{url:"/galleries",views:{"main@":{templateUrl:"views/content-list.html",controller:"ContentListController"}},data:{contentType:"gallery"}}).state("articles",{url:"/articles",views:{"main@":{templateUrl:"views/content-list.html",controller:"ContentListController"}},data:{contentType:"article"}}).state("pages",{url:"/pages",views:{"main@":{templateUrl:"views/content-list.html",controller:"ContentListController"}},data:{contentType:null}}).state("pages.manage",{url:"/manage",views:{"main@":{templateUrl:"views/content-manage.html",controller:"ContentManageController"}}}).state("pages.regions",{url:"/regions",views:{"main@":{templateUrl:"views/content-regions.html",controller:"ContentRegionsController"}}}).state("files",{url:"/files/:page",views:{"main@":{templateUrl:"views/content.html",controller:"ContentController"}},data:{contentType:"files"}}).state("files.edit",{url:"/edit",views:{"main@":{templateUrl:"views/content-edit.html",controller:"ContentEditController"}},data:{contentType:"files"}}).state("event",{url:"/event/:page",views:{"main@":{templateUrl:"views/content.html",controller:"ContentController"}},data:{contentType:"event"}}).state("event.edit",{url:"/edit",views:{"main@":{templateUrl:"views/content-edit.html",controller:"ContentEditController"}},data:{contentType:"event"}}).state("video",{url:"/video/:page",views:{"main@":{templateUrl:"views/content.html",controller:"ContentController"}},data:{contentType:"video"}}).state("video.edit",{url:"/edit",views:{"main@":{templateUrl:"views/content-edit.html",controller:"ContentEditController"}},data:{contentType:"video"}}).state("gallery",{url:"/gallery/:page",views:{"main@":{templateUrl:"views/content.html",controller:"ContentController"}},data:{contentType:"gallery"}}).state("gallery.edit",{url:"/edit",views:{"main@":{templateUrl:"views/content-edit.html",controller:"ContentEditController"}},data:{contentType:"gallery"}}).state("article",{url:"/article/:page",views:{"main@":{templateUrl:"views/content.html",controller:"ContentController"}},data:{contentType:"article"}}).state("article.edit",{url:"/edit",views:{"main@":{templateUrl:"views/content-edit.html",controller:"ContentEditController"}},data:{contentType:"article"}})}])}(),function(){"use strict";angular.module("sport.events",["ui.router","ui.select"]).config(["$stateProvider",function(e){e.state("events",{url:"/events",views:{"main@":{templateUrl:"views/events.html",controller:"EventsController"}}}).state("events.date",{url:"/:date",views:{"main@":{templateUrl:"views/events.html",controller:"EventsController"}}})}])}(),function(){"use strict";angular.module("sport.flowers",["components","ui.router","sport.content","sport.events","sport.championships"]).config(["$stateProvider",function(e){e.state("flowers",{url:"/flowers",views:{"main@":{templateUrl:"views/flowers.html",controller:"FlowersController"}}})}])}(),function(){"use strict";angular.module("sport.home",["components","ui.router","sport.content","sport.events","sport.championships"]).config(["$stateProvider",function(e){e.state("home",{url:"/home",views:{"main@":{templateUrl:"views/home.html",controller:"HomeController"}}})}])}(),function(){"use strict";angular.module("sport.mobile",["components","ui.router","sport.content","sport.events","sport.championships"]).config(["$stateProvider",function(e){e.state("home-mobile",{url:"/m",views:{"main@":{templateUrl:"views/home-mobile.html",controller:"HomeMobileController"}}})}])}(),function(){"use strict";angular.module("sport.register",["ui.router"]).config(["$stateProvider",function(e){e.state("register",{url:"/register",views:{"main@":{templateUrl:"views/register.html",controller:"RegisterController"}}})}])}(),function(){"use strict";angular.module("sport.reports",["components","ui.router"]).config(["$stateProvider",function(e){e.state("reports",{url:"/reports",views:{"main@":{templateUrl:"views/reports.html",controller:"ReportsController"}}})}])}(),function(){"use strict";angular.module("sport.UPYA",["components","ui.router"]).config(["$stateProvider",function(e){e.state("UPYA",{url:"/UPYA",views:{"main@":{templateUrl:"views/UPYA.html",controller:"UPYA_Controller"}}}).state("upya-manage",{url:"/upya-manage",views:{"main@":{templateUrl:"views/upya-manage.html",controller:"UPYA_Manage_Controller"}}})}])}(),angular.module("sport").directive("calendar",function(){return{restrict:"E",scope:{calendar:"=source"},templateUrl:"views/calendar.html"}}),function(){"use strict";function e(){function e(e){return e.getDate?e.getDate():e.date?e.date:e.Date?e.Date:null}function t(e,t){this.year=e,this.month=t,this.monthName=i[t],this.weeks=[],this.hasItems=!1,this.itemsCount=0;var n=new Date(e,t,1);n.setDate(n.getDate()-n.getDay());for(var a=n.getMonth(),o=0;o<6;o++){for(var r={days:[],currentMonth:!1},s=0;s<7;s++){a==t&&(r.currentMonth=!0);var l=n.getDate();r.days.push({year:e,month:t,day:l,items:[],currentMonth:a==t}),n.setDate(n.getDate()+1),a=n.getMonth()}this.weeks.push(r)}}function n(e){this.year=e,this.months=[]}function a(e,t){this.years=[],this.events=e.filter(function(e){return!0}),this.selectedDate=t}function o(e,t){return new a(e,t)}var i=["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],r={};return a.prototype.BuildDayEvents=function(e,t,n){var a={};this.events.filter(function(a){return a.Date.getDate()==e&&a.Date.getMonth()==t&&a.Date.getFullYear()==n}).forEach(function(e){var t=e.SPORT_ID.toString(),n=a[t];n?n.DailyEvents.push(e):(e.DailyEvents=[e],a[t]=e)});var o=[],i=0;for(var r in a){var s=contentUtils.getSportFieldColor(parseInt(r)),l=3+10*i,c=a[r];c.style="right: "+l+"px; background-color: "+s+";",c.title=function(e){var t="",n="";return e.SPORT_ID==sportGlobalSettings.FlowersFieldSeq?(t="פרחי ספורט "+e.SportFieldName,n=e.FacilityName):(t=e.CHAMPIONSHIP_NAME+" "+e.CATEGORY_NAME,n=eventsUtils.BuildSportsmanDetails(e)),[t,n].join(", ")}(c),o.push(c),i++}return o},t.prototype.getDay=function(e){for(var t=0;t<this.weeks.length;t++)for(var n=this.weeks[t],a=0;a<n.days.length;a++)if(n.days[a].currentMonth&&n.days[a].day==e)return n.days[a]},t.prototype.addItem=function(t){var n=e(t);if(!n||n.getFullYear()!==this.year||n.getMonth()!==this.month)return!1;this.hasItems=!0,this.itemsCount++;var a=n.getDate(),o=this.getDay(a);return o?(o.items.push(t),o):null},n.prototype.makeMonth=function(e){if(0==this.months.length){var n=new t(this.year,e);return this.months=[n],n}for(;this.months[0].month>e;)this.months.splice(0,0,new t(this.year,this.months[0].month-1));for(;this.months[this.months.length-1].month<e;)this.months.push(new t(this.year,this.months[this.months.length-1].month+1));return this.months[e-this.months[0].month]},a.prototype.makeMonth=function(e,t){if(0==this.years.length){var a=new n(e);return this.years=[a],a.makeMonth(t)}for(;this.years[0].year>e;){this.years[0].makeMonth(0);var a=new n(this.years[0].year-1);a.makeMonth(11),this.years.splice(0,0,a)}for(;this.years[this.years.length-1].year<e;){this.years[this.years.length-1].makeMonth(11);var a=new n(this.years[this.years.length-1].year+1);a.makeMonth(0),this.years.push(a)}var a=this.years[e-this.years[0].year];return a.makeMonth(t)},a.prototype.getMonth=function(e,t){if(this.years.length>0)if(void 0!==t){if(e>=this.years[0].year&&e<=this.years[this.years.length-1].year){var n=this.years[e-this.years[0].year];if(n.months.length>0&&t>=n.months[0].month&&t<=n.months[n.months.length-1].month)return n.months[t-n.months[0].month]}}else for(var a=0;a<this.years.length&&e>=0;){if(e<this.years[a].months)return this.years[a].months[e];e-=this.years[a].months,a++}return null},a.prototype.addItem=function(t){var n=e(t);return n?this.makeMonth(n.getFullYear(),n.getMonth()).addItem(t):null},a.prototype.addItems=function(e,t){for(var n=0;n<e.length;n++){var a=this.addItem(e[n]);a&&t(a,e[n])}for(var o=0;o<this.years.length;o++)for(var i=this.years[o],s=0;s<i.months.length;s++){var l=i.months[s],c=l.month.toString()+"_"+l.year.toString();r[c]=l;for(var u=0;u<l.weeks.length;u++)for(var d=l.weeks[u],p=0;p<d.days.length;p++){var g=d.days[p];g.events=g.currentMonth?this.BuildDayEvents(g.day,g.month,g.year):[]}}},a.prototype.selectMonth=function(e,t){if(void 0!==t){var n=this.getMonth(e,t);n&&this.selectMonth(n)}else if(e)this.selectedMonth&&(this.selectedMonth.selected=!1,this.selectedDay&&(this.selectedDay.selected=!1,this.selectedDay=null)),this.selectedMonth=e,e.selected=!0;else if(this.selectedDate){var a=this.selectedDate,o=a.getFullYear(),t=a.getMonth(),i=this.getMonth(o,t);i||(i=this.getMonth(0)),i&&this.selectMonth(i)}},a.prototype.selectDay=function(e){this.selectedMonth&&this.selectedMonth.year==e.year&&this.selectedMonth.month==e.month||this.selectMonth(e.year,e.month),this.selectedDay&&(this.selectedDay.selected=!1),this.selectedDay=e,e.selected=!0},a.prototype.clearDaySelection=function(){this.selectedDay&&(this.selectedDay.selected=!1,this.selectedDay=null)},a.prototype.nextMonth=function(){var e={year:0};if(this.selectedMonth){var t=this.selectedMonth.month+1,n=this.selectedMonth.year;t>=12&&(t=0,n++);var a=t.toString()+"_"+n.toString();r[a]&&(e=r[a])}return e},a.prototype.selectNextMonth=function(){var e=this.nextMonth();e.year>0&&this.selectMonth(e)},a.prototype.prevMonth=function(){var e={year:0};if(this.selectedMonth){var t=this.selectedMonth.month-1,n=this.selectedMonth.year;t<0&&(t=11,n--);var a=t.toString()+"_"+n.toString();r[a]&&(e=r[a])}return e},a.prototype.selectPrevMonth=function(){var e=this.prevMonth();e.year>0&&this.selectMonth(e)},a.prototype.setCurrent=function(e){this.currentMonth&&(this.currentMonth.currentSelection=!1),this.currentDay&&(this.currentDay.currentSelection=!1),this.currentMonth=this.getMonth(e.year,e.month),this.currentMonth&&(this.currentMonth.currentSelection=!0),this.currentDay=e,this.currentDay.currentSelection=!0},{create:o}}angular.module("sport").factory("calendarService",[e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s,l,c,u,d,p,g){function h(){if(e.data.Categories.Rows=[],e.selected.Championship&&e.selected.Championship.Name){var t=e.data.Categories.All.filter(function(t){return t.Championship==e.selected.Championship.Name}),n=sportUtils.SplitArray(t,y);if(n.length>0){for(var a=n[n.length-1],o=y-a.length,i=0;i<o;i++)a.push({SportField:0,Name:"Blank_"+(i+1)});for(var i=0;i<n.length;i++){n[i].sort(function(e,t){return e.SportField-t.SportField})}}if(e.data.Categories.Rows=n,C.Category>0){var r=e.data.Categories.All.findItem(function(e){return e.CategoryId==C.Category});null!=r&&e.selectCategory(r),C.Category=0}}}function f(){var t=[];if(null==s)t=e.data.Championships.All;else{var n=e.selected.SportField?e.selected.SportField.Seq:0;t=e.data.Championships.All.filter(function(e){return e.SportField==n})}var a=sportUtils.SplitArray(t,S);if(a.length>0){for(var o=a[a.length-1],i=S-o.length,r=0;r<i;r++)o.push({SportField:0,Name:"Blank_"+(r+1)});for(var r=0;r<a.length;r++){a[r].sort(function(e,t){return e.SportField-t.SportField})}}if(e.data.Championships.Rows=a,C.Championship.length>0){if(C.SportId){var l=e.data.SportFields.All.findItem(function(e){return e.Seq==C.SportId});C.SportId=0,null!=l&&e.selectSportField(l)}var c=e.data.Championships.All.findItem(function(e){return e.Name==C.Championship});null!=c&&e.selectChampionship(c),C.Championship=""}}function m(){e.data.Championships.All=[],e.data.Championships.Rows=[],e.data.Categories.All=[],e.data.Categories.Rows=[];var n=e.selected.Season?e.selected.Season.Season:0,i=e.selected.Type?e.selected.Type.Value:v.Empty,l=e.selected.Region?e.selected.Region.Id:null;e.loading=!0,function(e,t,n){var i=o.defer();return T?g.sportFlowersEvents().then(function(e){var t=championshipsUtils.convertSportFlowersChampionships(e,a);i.resolve(t)},function(e){i.reject(e)}):null!=s?d.read({school:s.Symbol}).then(function(e){var t=e.slice(0);if(t=s.ClubsOnly?t.filter(function(e){return 1==e.IS_CLUBS}):t.filter(function(e){return 1!=e.IS_CLUBS}),s.ExcludedCategories){var n=s.ExcludedCategories.toAssociativeArray();t=t.filter(function(e){var t=e.CHAMPIONSHIP_CATEGORY_ID.toString();return!n[t]})}i.resolve(t)},function(e){i.reject(e)}):null!=r&&t&&e&&null!=n?d.read({season:t,region:n,omitEmpty:0}).then(function(t){var n=e==v.Clubs?1:0,a=t.slice(0).filter(function(e){return e.SPORT_ID==r.Seq&&e.IS_CLUBS==n});i.resolve(a)},function(e){i.reject(e)}):i.resolve([]),i.promise}(i,n,l).then(function(n){if(e.loading=!1,n&&n.length>0){if(null!=s){e.data.SportFields={All:[],Rows:[]};for(var a=0;a<n.length;a++){var o=n[a];null==e.data.SportFields.All.findItem(function(e){return e.Seq==o.SPORT_ID})&&e.data.SportFields.All.push({Seq:o.SPORT_ID,Name:o.SPORT_NAME})}var i=sportUtils.SplitArray(e.data.SportFields.All,S);if(i.length>0){for(var r=i[i.length-1],l=S-r.length,a=0;a<l;a++)r.push({Seq:0,Name:"Blank_"+(a+1)});for(var a=0;a<i.length;a++){i[a].sort(function(e,t){return e.Seq-t.Seq})}}e.data.SportFields.Rows=i}var c=n.toAssociativeArray(!0,"CHAMPIONSHIP_NAME","SPORT_ID"),d={};if(e.data.Championships.All=sportUtils.DistinctArray(n.map(function(e){return e.CHAMPIONSHIP_NAME})).map(function(e){return{Name:e,SportField:c[e]}}),u.show_championship_remarks){var p=n.map(function(e){return e.CHAMPIONSHIP_ID}).distinct(),g="/api/sportsman/championship-remarks?championships="+p.join(",");t.get(g).then(function(t){var n=t.data.toAssociativeArray(null,"CHAMPIONSHIP_NAME","REMARKS");e.data.Championships.All.forEach(function(e){e.Remarks=n[e.Name]})},function(e){console.log("error reading championship remarks")})}for(var a=0;a<n.length;a++){var h=n[a],m=h.CATEGORY_NAME,v=h.CHAMPIONSHIP_NAME,y=h.CHAMPIONSHIP_ID+"_"+m;d[y]||(e.data.Categories.All.push({Name:m,Championship:v,ChampionshipId:h.CHAMPIONSHIP_ID,SportField:h.SPORT_ID,CategoryId:h.CHAMPIONSHIP_CATEGORY_ID,Remarks:h.Remarks}),d[y]=!0)}f()}},function(t){e.loading=!1,console.log("error loading championships"),console.log(t)})}var v={Empty:0,Clubs:1,NonClub:2
},S=3,y=3,C={Championship:"",Category:0},I=sportGlobalSettings.FlowersFieldSeq,T=null!=r&&r.Seq==I;null!=r?(e.title="בחירת ",e.title+=r.Seq==sportGlobalSettings.FlowersFieldSeq?"אירוע":"אליפות",e.title+=" "+r.Name):null!=s&&(e.title="בחירת אליפות ",s.ClubsOnly&&(e.title+="מועדונים "),e.title+="עבור "+s.Name),e.selected={Season:0,Type:0,Region:0,Championship:0,Category:0,SportField:0},e.loading=!1,e.flowersFieldSeq=I,e.isFlowers=T,e.schoolTeamSelection=null==r&&null!=s,e.data={Seasons:l,Regions:c,Championships:{All:[],Rows:[]},Categories:{All:[],Rows:[]},Types:[{Name:"מועדון ספורט בית סיפרי",Value:v.Clubs},{Name:"אירועי ספורט משרד החינוך",Value:v.NonClub}]},e.cancelCaption=u&&u.cancelCaption?u.cancelCaption:"ביטול",e.confirmCaption=u&&u.confirmCaption?u.confirmCaption:"אישור",null!=c&&c.findIndex(function(e){return 0==e.Id})<0&&(c.push({Id:0,Name:"אליפויות ארציות"}),c.sort(function(e,t){return e.Id-t.Id})),contentUtils.InitSportFieldColors(t),e.getSportFieldColor=contentUtils.getSportFieldColor,e.getRoundedRectangleClass=sportUtils.getRoundedRectangleClass,null!=s&&null==r&&(e.data.Types=null),u.amount&&window.setTimeout(function(){$(".rating-"+u.amount).click()},500),function(){var n=o.defer();return u.category?T?n.resolve({Championship:u.EventName,Category:u.category}):t.get("/api/sportsman/category-data?category="+u.category).then(function(t){var a=t.data.SEASON,o=1==t.data.IS_CLUBS?v.Clubs:v.NonClub,i=t.data.REGION_ID,r=t.data.CHAMPIONSHIP_NAME,s=t.data.SPORT_ID;p.seasons.inUse().then(function(t){var l=t.findItem(function(e){return e.SeasonCode==a}).Season;e.data.Seasons&&(e.selected.Season=e.data.Seasons.findItem(function(e){return e.Season==l})),e.data.Types&&(e.selected.Type=e.data.Types.findItem(function(e){return e.Value==o})),e.data.Regions&&(e.selected.Region=e.data.Regions.findItem(function(e){return e.Id==i})),n.resolve({Championship:r,SportField:s,Category:u.category})})},function(e){n.reject(e)}):n.resolve(null),n.promise}().then(function(e){null!=e&&(C.Championship=e.Championship,C.Category=e.Category,C.SportId=e.SportField,m())}),u.category||function(){if(e.data.Seasons){var t=e.data.Seasons.filter(function(e){return e.IsCurrent});0==t.length&&(t=[e.data.Seasons.lastItem()]),e.selected.Season=t[0]}m()}(),null!=r&&r.Seq==I&&m(),e.getSportFieldFilterStyle=function(e){var t=e.SportField||e.Seq,n=contentUtils.getSportFieldColor(t);return sportUtils.getRoundedRectangleStyle(e,n)},e.dataChanged=function(e){m()},e.selectChampionship=function(t){e.selected.Championship&&(e.selected.Championship.Selected=!1),e.selected.Category&&(e.selected.Category.Selected=!1,e.selected.Category=0),e.data.RegisteredTeamsCount=0,t.Selected=!0,e.selected.Championship=t,h()},e.selectSportField=function(t){e.selected.SportField&&(e.selected.SportField.Selected=!1),e.selected.Championship&&(e.selected.Championship.Selected=!1,e.selected.Championship=0),e.selected.Category&&(e.selected.Category.Selected=!1,e.selected.Category=0),e.data.RegisteredTeamsCount=0,e.data.Categories.Rows=[],t.Selected=!0,e.selected.SportField=t,f()},e.selectCategory=function(t){if(e.selected.Category&&(e.selected.Category.Selected=!1),t.Selected=!0,e.selected.Category=t,null!=s&&s.Teams){var n=t.CategoryId.toString(),a=s.Teams[n]||[];e.data.RegisteredTeamsCount=a.length}},e.cancel=function(){n.dismiss("cancel")},e.confirm=function(){if(e.selected.Category)if(null==s)n.close(e.selected.Category);else{var t=function(){var e=parseInt($("#TeamsAmount").find(".selected-rating").text());return(isNaN(e)||e<=0)&&(e=1),e>5&&(e=5),e}();if(s.NoConfirmation)n.close({Category:e.selected.Category,Amount:t});else{var a="נא לאשר רישום "+function(e){return 1==e?"קבוצה אחת":e+" קבוצות"}(t)+" ל"+e.selected.Championship.Name+", "+e.selected.Category.Name;i.ask(a).then(function(){n.close({Category:e.selected.Category,Amount:t})})}}}}angular.module("sport").controller("ChampionshipSelectionCtrl",["$scope","$http","$uibModalInstance","$filter","$q","messageBox","sportField","schoolData","allSeasons","allRegions","options","ChampionshipsService","SportService","EventsService",e])}(),function(){"use strict";function e(e,t,n,a){e.calendar=n,e.selectedDate=new Date,e.title=a&&a.title?a.title:"בחירת תאריך",a&&(e.subTitle=a.subTitle,e.info=a.info,a.selectedDate&&(e.selectedDate=a.selectedDate)),e.cancelCaption=a&&a.cancelCaption?a.cancelCaption:"ביטול",e.confirmCaption=a&&a.confirmCaption?a.confirmCaption:"אישור",e.calendar.selectedMonth||e.calendar.selectMonth(),e.cancel=function(){t.dismiss("cancel")},e.confirm=function(){e.calendar.selectedDay&&t.close(e.calendar.selectedDay)},e.getDaysDiff=function(e){var t=new Date;t.setDate(e.day),t.setMonth(e.month),t.setFullYear(e.year);var n=new Date,a=t.getTime()-n.getTime();return parseInt(a/864e5)},e.dayClicked=function(e){n.selectDay(e)},e.generateDayClass=function(t){var n=[];return t.currentMonth&&n.push("current"),t.selected?n.push("bg-primary"):t.day==e.selectedDate.getDate()&&t.month==e.selectedDate.getMonth()&&t.year==e.selectedDate.getFullYear()?n.push("bg-info"):t.currentSelection&&!t.selected&&n.push("bg-success"),t.currentMonth&&t.items.length>0&&n.push("enabled"),n.join(" ")}}function t(e){function t(t,n){return e.open({templateUrl:"views/date-selector.html",controller:"DateSelectorCtrl",resolve:{calendar:function(){return t},options:function(){return n}}}).result}return{select:t}}angular.module("components").controller("DateSelectorCtrl",["$scope","$uibModalInstance","calendar","options",e]).factory("dateSelector",["$uibModal",t])}();var eventsUtils={BuildTeamName:function(e,t){var n=t?"Team"+t+"_School":"SCHOOL_NAME",a=t?"Team"+t+"_City":"CITY_NAME",o=t?"Team"+t+"_Index":"TEAM_INDEX",i=e[n],r=e[a],s=o.length>0?sportUtils.GetHebrewLetter(e[o]):"",l=i+"";return r&&r.length>0&&l.indexOf(r)<0&&(l+=" "+r),s.length>0&&(l+=" "+s+"'"),l.indexOf("-")>0&&(l=l.replace("-"," - ")),l},BuildGameDetails:function(e){return[e.PHASE_NAME,e.ROUND_NAME,e.CYCLE_NAME,e.SPORT_FIELD_NAME].filter(function(e){return null!=e&&e.length>0}).join(", ")},BuildSportsmanDetails:function(e){if(2==e.ChampionshipType)return e.SPORT_FIELD_NAME;if(!e.DailyEvents||e.DailyEvents.length<2){return eventsUtils.BuildTeamName(e,"A")+" מול "+eventsUtils.BuildTeamName(e,"B")}for(var t=e.DailyEvents[0],n=t.PHASE_NAME,a=t.ROUND_NAME,o=t.CYCLE_NAME,i=!0,r=!0,s=!0,l=1;l<e.DailyEvents.length;l++){var c=e.DailyEvents[l];c.PHASE_NAME!=n&&(i=!1),c.ROUND_NAME!=a&&(r=!1),c.CYCLE_NAME!=o&&(s=!1)}return i&&r&&s?[n,a,o].join(", "):i&&r?[n,a].join(", "):i?n:n+" עד "+e.DailyEvents.lastItem().PHASE_NAME}};!function(){"use strict";function e(e,t,n,a,o,i,r,s,l,c,u,d){function p(n,o,i,r,c){var u=l.Width+"x"+l.Height,d=[o,i,r,c].join(",");window.CropperImage_Crop_Now=null,t.post("/api/images/crop",{Data:n,Seq:s.Seq,AspectRatio:u,MetaData:d}).then(function(t){var n=t.data&&t.data.length>0?t.data[0]:"";e.loading=!1,a.close({ImageName:n,X:o,Y:i,Width:r,Height:c})},function(t){e.loading=!1,console.log("error cropping image:"),console.log(t),alert("שגיאה בעת שמירת נתונים, נא לנסות שוב מאוחר יותר")})}void 0!==r&&null!=r&&r||(r="Images"),e.existingImages=d.map(function(e){return e.FileName}),window.CropperImageRatio={Width:l.Width,Height:l.Height},window.CropperImagePath="/content/"+r+"/"+i+"/"+s.FileName,window.CropperImageData=u&&u.Width?u:null,c&&c.Width>0&&c.Height>0&&(window.CropperCanvasWidth=c.Width,window.CropperCanvasHeight=c.Height),e.title=o,e.loading=!1,e.changePicture=function(){n.open({templateUrl:"views/thumbnail-selection.html",controller:"ThumbnailSelectionCtrl",resolve:{pageSeq:function(){return i},images:function(){return e.existingImages}}}).result.then(function(e){var t=e.FileName;if(t==s.FileName)console.log("Same image selected, nothing to do");else{var n={Seq:0},o=d.findItem(function(e){return e.FileName==t});null==o?(n.FileName=t,n.FileSize=e.FileSize):(n.Seq=o.Seq,n.FileName=o.FileName),a.close({ChangeCroppedImage:n})}})},e.cancel=function(){a.dismiss("cancel")},e.confirm=function(){e.loading=!0,window.CropperImage_Crop_Now=p}}angular.module("sport").controller("ImageCropperCtrl",["$scope","$http","$uibModal","$uibModalInstance","title","pageSeq","sourceDirectory","imageData","ratio","canvas","metaData","existingImages",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s){if(e.title="בחירת קישור עבור תמונה",e.selected={LinkType:0,ExternalUrl:"",UploadedFileName:""},e.pageSeq=a,e.imageSeq=o,e.imageFileName=r,e.existingLink=s,e.data={LinkTypes:[{Name:"פתיחה בגלרייה",Value:0},{Name:"קישור חיצוני",Value:1},{Name:"קובץ מצורף",Value:2}]},e.cancelCaption=i&&i.cancelCaption?i.cancelCaption:"ביטול",e.confirmCaption=i&&i.confirmCaption?i.confirmCaption:"אישור",e.selected.LinkType=e.data.LinkTypes[0],e.existingLink)switch(e.existingLink.Type){case 1:e.selected.LinkType=e.data.LinkTypes[1],e.selected.ExternalUrl=e.existingLink.ExternalUrl;break;case 2:e.selected.LinkType=e.data.LinkTypes[2],e.selected.UploadedFileName=e.existingLink.FileName,e.existingLink.IsImage=contentUtils.IsImageFile(e.existingLink.FileName),0==e.existingLink.IsImage&&(e.existingLink.PreviewClass=contentUtils.GeneratePreviewClass(e.existingLink.FileName))}e.dropzoneConfig={options:{paramName:"files",maxFiles:1,url:"/content/ImageAttachments/"+o,autoProcessQueue:!0,dictDefaultMessage:"ניתן לגרור לכאן קובץ, או ללחוץ להעלאה מהמחשב",dictRemoveFile:"הסרת קובץ",dictCancelUploadConfirmation:"ביטול העלאת קובץ",addRemoveLinks:!0},eventHandlers:{success:function(t,n){e.selected.UploadedFileName=t.name},maxfilesexceeded:function(e){var t=this;window.setTimeout(function(){t.removeFile(e)},200)}}},e.isInputValid=function(){if(e.selected.LinkType.Value)switch(e.selected.LinkType.Value){case 1:return sportUtils.ValidateUrl(e.selected.ExternalUrl+"").length>0;case 2:return e.selected.UploadedFileName&&e.selected.UploadedFileName.length>0}return!0},e.Delete=function(){n.ask("האם להסיר קישור מתמונה זו?").then(function(){t.close({Remove:!0})})},e.cancel=function(){t.dismiss("cancel")},e.confirm=function(){t.close({Type:e.selected.LinkType.Value,FileName:e.selected.UploadedFileName,ExternalUrl:sportUtils.ValidateUrl(e.selected.ExternalUrl)})}}angular.module("sport").controller("ImageLinkSelectionCtrl",["$scope","$uibModalInstance","messageBox","pageSeq","imageSeq","options","imageFileName","existingLink",e])}(),function(){"use strict";function e(e){function t(t,n){return e.open({templateUrl:"message.html",controller:"MessageCtrl",resolve:{message:function(){return t},options:function(){return n}}}).result}function n(e,n){return n||(n={}),n.cancelCaption||(n.cancelCaption="ביטול"),n.prompt&&window.setTimeout(function(){$("#userInput").focus()},1e3),t(e,n)}function a(e,n){return n||(n={}),n.isWarning=!0,t(e,n)}return{show:t,ask:n,warn:a}}function t(e,t,n,a,o){e.message=a,e.prompt=!1,e.htmlContents=!1,o&&(e.title=o.title,e.isWarning=o.isWarning,e.subTitle=o.subTitle,e.info=o.info,e.cancelCaption=o.cancelCaption,e.prompt=o.prompt,e.htmlContents=o.htmlContents,o.backgroundImage&&(e.style="background-image: url('"+o.backgroundImage+"');")),e.confirmCaption=o&&o.confirmCaption?o.confirmCaption:"אישור",e.htmlContents&&(e.message=n.trustAsHtml(e.message)),e.confirm=function(){t.close($("#userInput").val())},e.cancel=function(){t.dismiss("cancel")}}angular.module("sport").controller("MessageCtrl",["$scope","$uibModalInstance","$sce","message","options",t]).factory("messageBox",["$uibModal",e])}();var __psAvailablePageSizes=[5,10,20,50,100],__psDefaultPageSize=50,__psDefaultOptions={pageSize:__psDefaultPageSize,applyDataCallback:null},__psUniqueCounter=0,sportCustomizeMethods={AccessibilityComponent:{Customize:function(){var e=$(".accessibility_component .btn_accessibility");if(1==e.length){if(e.text().length>0){var t=e.find("img");e.text(""),e.append(t)}var n=$(window).height();e.css({width:"40px",top:n-60+"px"})}}},OwlCarousel:{SetArrowLocation:function(e,t,n,a){var o=[];return null==t||isNaN(t)||o.push("top: "+t+"px !important;"),null==n||isNaN(n)||o.push("right: "+n+"px !important;"),null==a||isNaN(a)||o.push("left: "+a+"px !important;"),o.length>0&&e.css("cssText",o.join(" ")),o},SetArrowDisplay:function(e,t,n){var a=t.slice(0);a.push("display: "+n+" !important;"),e.css("cssText",a.join(" "))},Customize:function(){$("owl-carousel").each(function(){var e=$(this);if("1"!=e.data("handled")){var t=e.find(".owl-prev"),n=e.find(".owl-next"),a=parseInt(e.data("arrows-top")),o=parseInt(e.data("arrow-right")),i=parseInt(e.data("arrow-left")),r=sportCustomizeMethods.OwlCarousel.SetArrowLocation(t,a,o,null),s=sportCustomizeMethods.OwlCarousel.SetArrowLocation(n,a,null,i);e.bind("mouseover",function(){sportCustomizeMethods.OwlCarousel.SetArrowDisplay(t,r,"block"),sportCustomizeMethods.OwlCarousel.SetArrowDisplay(n,s,"block"),e.mouseOutTimer&&window.clearTimeout(e.mouseOutTimer)}).bind("mouseout",function(){e.mouseOutTimer&&window.clearTimeout(e.mouseOutTimer),e.mouseOutTimer=window.setTimeout(function(){sportCustomizeMethods.OwlCarousel.SetArrowDisplay(t,r,"none"),sportCustomizeMethods.OwlCarousel.SetArrowDisplay(n,s,"none")},500)}),e.data("handled","1")}})}},TeamPunch:{Mobile:{Customize:function(){var e=$(".tp-banner-container");if(e.length>0){var t=e.find(".rev_caption");t.css("margin-right","15px"),t.find("p").css("font-size","12px"),e.find(".event_date").css("margin-bottom","10px")}}}},TopMenu:{Customize:function(e,t){function n(){var e=$("#schoolSportSideNav"),t=0,n=$("<i></i>").addClass("fa").addClass("fa-plus-square-o").css("margin-left","5px"),a=function(e,o,i){void 0!==i&&null!=i||(i=""),t++;var r="schoolSportSideNav_"+t;o.data("menu-id",r),o.attr("href","javascript:void(0)"),o.attr("onclick","OpenSubMenu(this);"),o.prepend(n.clone());var s=$("<div></div>");return s.addClass("sub-menu"),i.length>0&&s.addClass(i),s.attr("id",r),e.find("> ul > li").each(function(){var e=$(this),t=e.find("> a").first();if(1==t.length){var n=e.find("> .sub_menu_inner"),o=null;1==n.length?o=a(n,t,"sub-menu-level2"):t.bind("click",closeNav),s.append(t),null!=o&&s.append(o)}}),s};$(".main_menu>ul>li").each(function(){var t=$(this),n=t.find("a").first();n.find("i").remove();var o=t.find("> .sub_menu_wrap"),i=null;1==o.length?i=a(o,n):n.bind("click",closeNav),e.append(n),null!=i&&e.append(i)})}t&&$(".top_menu_button > .popup").css({right:"0px",left:"0px"});var a=$(".main_menu");if(1==a.length){var o=$("#lnkHome"),i=$("#GoogleMapsFrame");return void(t?(i.hide(),function(e,t){console.log("mobile screen detected"),window.qL_Finish_Now=!0,window.setInterval(function(){$(".accessibility_div_wrap").hide()},1e3),window.setTimeout(function(){$(window).scrollTop(0)},2e3),$(".main_menu > ul > li > a").css({"background-color":"transparent","border-color":"transparent","line-height":"auto",width:"100%","text-align":"right"}),$(".main_menu > ul > li > a > br").replaceWith("<span>&nbsp;</span>"),n()}()):(i.attr("src",i.data("src")),function(t,n){var a=t.width();if(a+n.width()>e&&n.position().left<0&&n.parents("div").first().css("width","100%"),e&&a>e){console.log("menu resize"),$("#MenuContainer").css("left","0%");for(var o=0;o<=20;){var i=0;if($(".main_menu > ul > li > a").each(function(){var e=$(this),t=parseInt(e.css("width"));!isNaN(t)&&t>=70&&(t-=3,e.css("width",t+"px"),i+=t+12)}),i<e)break;o++}}}(a,o)))}window.setTimeout(function(){sportCustomizeMethods.TopMenu.Customize(e,t)},100)}},ScreenSize:{Customize:function(){if(1==$("body").length){var e=$("body").width();if(e>0){var t=sportUtils.IsMobile();return t&&window.setInterval(sportCustomizeMethods.TeamPunch.Mobile.Customize,1500),void window.setTimeout(function(){sportCustomizeMethods.TopMenu.Customize(e,t)},100)}}window.setTimeout(sportCustomizeMethods.ScreenSize.Customize,100)}}};window.setInterval(sportCustomizeMethods.AccessibilityComponent.Customize,1e3),window.setInterval(sportCustomizeMethods.OwlCarousel.Customize,1e3),window.setTimeout(sportCustomizeMethods.ScreenSize.Customize,100),function(){"use strict";function e(e,t,n,a){function o(e){e.FirstDay&&(e.FirstDay=new Date(e.FirstDay)),e.LastDay&&(e.LastDay=new Date(e.LastDay))}function i(){return e.get("/api/seasons?season=all").then(function(e){for(var t=0;t<e.data.length;t++)o(e.data[t]);return e.data})}function r(){return e.get("/api/sportsman/seasons-in-use").then(function(e){for(var t=0;t<e.data.length;t++)o(e.data[t]);return e.data})}return{sportFields:function(t){void 0===t&&(t=!1);return e.get("/api/common/sports").then(function(e){for(var n=e.data,a={},o={},i=0;i<n.length;i++){var r=n[i];a[r.Seq.toString()]=r.Name,o[r.Seq.toString()]=r.ShortName}return t?{Full:a,Short:o}:a})},seasons:{all:i,inUse:r},currentSeason:function(e){void 0===e&&(e=0);var t=a.defer(),n=sportUtils.getCurrentSeason().Season;return e?t.resolve(e):n&&n>0?t.resolve(n):r().then(function(e){e.length>0?(n=e.findItem(function(e){return e.IsCurrent}),null==n&&(e.sort(function(e,t){return e.Season-t.Season}),n=e.lastItem()),t.resolve(n.Season)):t.reject("אין עונות בשימוש")},function(e){t.reject(e)}),t.promise}}}angular.module("sport").factory("SportService",["$http","$httpParamSerializer","$filter","$q",e])}(),String.prototype.compareTo=function(e){return this==e?0:this>e?-1:1},String.prototype.endsWith=function(e){return this.toLowerCase().lastIndexOf(e.toLowerCase())==this.length-e.length},String.prototype.startsWith=function(e){return 0==this.toLowerCase().indexOf(e.toLowerCase())},String.prototype.startsWithEnglishLetter=function(){if(this.length>0){var e=this.charAt(0).toLowerCase();return e>="a"&&e<="z"}return!1},Array.prototype.sortByProperty=function(e){this.sort(function(t,n){var a=t[e],o=n[e];return a<o?-1:a>o?1:0})},Array.prototype.setForAll=function(e,t){this.forEach(function(n){n[e]=t})},Array.prototype.take=function(e){for(var t=[],n=this,a=0;a<n.length&&!(t.length>=e);a++)t.push(n[a]);return t},Array.prototype.partialJoin=function(e,t){for(var n=[],a=this,o=0;o<t.length;o++){var i=t[o];i>=0&&i<a.length&&n.push(a[i])}return n.join(e)},Array.prototype.skip=function(e){for(var t=[],n=this,a=e;a<n.length;a++)t.push(n[a]);return t},Array.prototype.SplitByProperty=function(e){if(void 0===e||!e)return{};for(var t=this,n={},a=0;a<t.length;a++){var o=t[a],i=o[e].toString();n[i]||(n[i]=[]),n[i].push(o)}return n},Array.prototype.expand=function(e,t,n){void 0===n&&(n=!1);for(var a=this.length;a<t;a++)this.push(function(){if(n){var t={};for(var a in e)t[a]=e[a];return t}return e}())},Array.prototype.trimAfter=function(e){this.splice(e)},Array.prototype.removeItem=function(e,t){var n=this;void 0===t&&(t=n.indexOf(e)),t>=0&&n.splice(t,1)},Array.prototype.indexOf=function(e){for(var t=this,n=-1,a=0;a<t.length;a++)if(t[a]==e){n=a;break}return n},Array.prototype.moveItem=function(e,t){var n=this;n.splice(t,0,n.splice(e,1)[0])},Array.prototype.appendArray=function(e){if(null!=e&&e.hasOwnProperty("length"))for(var t=0;t<e.length;t++)this.push(e[t])},Array.prototype.mergeWith=function(e){for(var t=this,n=[],a=0;a<t.length;a++)n.push(t[a]);if(void 0!==e&&e.length)for(var a=0;a<e.length;a++)n.push(e[a]);return n},Array.prototype.lastItem=function(){var e=this;return 0==e.length?null:e[e.length-1]},Array.prototype.firstOrDefault=function(e){var t=this;return 0==t.length?e:t[0]},[].findIndex||(Array.prototype.findIndex=function(e){for(var t=this,n=0;n<t.length;n++)if(1==e(t[n]))return n;return-1}),[].findItem||(Array.prototype.findItem=function(e){for(var t=this,n=0;n<t.length;n++){var a=t[n];if(1==e(a))return a}return null}),Array.prototype.toAssociativeArray=function(e,t,n){var a=this;void 0===e&&(e=!0),void 0===t&&(t=""),void 0===n&&(n="");for(var o={},i=0;i<a.length;i++){var r=a[i],s=t.length>0&&r.hasOwnProperty(t)?r[t].toString():r.toString(),l=n.length>0&&r.hasOwnProperty(n)?r[n]:e;o[s]=l}return o},Array.prototype.distinct=function(){for(var e=this,t={},n=[],a=0;a<e.length;a++){var o=null==e[a]?"":e[a],i=o.toString();t[i]||(n.push(o),t[i]=!0)}return n},Array.prototype.Sum=function(e){void 0===e&&(e="");var t=this;e.length>0&&(t=t.map(function(t){return t[e]}));for(var n=0,a=0;a<t.length;a++){var o=null==t[a]?0:parseInt(t[a],10);isNaN(o)||(n+=o)}return n},Date.prototype.withoutTime=function(){var e=new Date(this);return e.setHours(0,0,0,0,0),e},Date.prototype.isSameDate=function(e){var t=this;return t.getFullYear()==e.getFullYear()&&t.getMonth()==e.getMonth()&&t.getDate()==e.getDate()};var sportGlobalSettings={RecentAmount:999,RecentFlowersContent:8,YoungSportsmenSeq:998,FlowersFieldSeq:999,GeneralSportFieldSeq:1e3,LocalStorageKeys:{CurrentSeason:{Name:"school_sport_season_name",Year:"school_sport_season_hebrew_year"}}},sportUtils={scrollToTopInterval:0,scrollToTopEventsAttached:!1,scrollToTopCounter:0,hebrewLetters:["א","ב","ג","ד","ה","ו","ז","ח","ט","י","כ","ל","מ","נ","ס","ע","פ","צ","ק","ר","ש","ת"],grades:["א'","ב'","ג'","ד'","ה'","ו'","ז'","ח'","ט'","י'",'י"א','י"ב'],hebrewNumbers:{Asarot:["","עשרים","שלושים","ארבעים","חמישים","שישים","שבעים","שמונים","תשעים"],OneToTenMale:["אחד","שני","שלושה","ארבעה","חמישה","שישה","שבעה","שמונה","תשעה","עשרה"],OneToTenFemale:["אחת","שתי","שלוש","ארבע","חמש","שש","שבע","שמונה","תשע","עשר"]},IsMobile:function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},GetCurrentDate:function(){return new Date},FocusElement:function(e){var t=$(e).first();if(1==t.length){var n=$("input").attr("type","text");return n.prependTo(t),n.focus(),n.remove(),window.scrollY}return 0},HideWhenFramed:function(e){"1"==sportUtils.ParseQueryString().iframe&&e.forEach(function(e){e.length>0&&$(e).hide()})},ApplyEnglishChampionship:function(){function e(e){e.children("div").eq(0).appendTo(e),e.children("div").eq(1).prependTo(e)}function t(){function e(e){for(var t in e){$("#"+t).parents(".col-lg-4").first().find(".tabs_nav>li").each(function(){$(this).css("float","left")})}}var n={lblChoosePhase:"Choose phase",lblChooseGroup:"Choose group",lblChooseRound:"Choose round",lblGamesPlan:"Games Plan",lblTeamsList:"Teams List",lblFacilitiesList:"Facilities List"};if(3!=$("#pnlCategoryChooseFilters>div").length)window.setTimeout(t,100);else{$("#pnlCategoryChooseFilters>div").eq(0).appendTo($("#pnlCategoryChooseFilters")),$("#pnlCategoryChooseFilters>div").eq(1).prependTo($("#pnlCategoryChooseFilters")),$("#pnlGamesAndTeams>div").eq(0).appendTo($("#pnlGamesAndTeams")),$("#pnlTeamsList").css("text-align","left"),$("#pnlFacilitiesList").css("text-align","left"),$("#lblRankingTable").text("Ranking Table"),$("#lblRankingTable").css("text-transform","none"),$("#pnlFullTableButton").removeClass("pull-left").addClass("pull-right"),$("#lblFullTableButton").text("Full table"),$("#lblRankingTableTeamName").text("Team Name"),$("#lblRankingTableScore").text("Score"),$("#lblFullTableButton")[0].style.setProperty("margin-left","50px","important"),$("#lblFullTableButton").parents("a").first().css({width:"200px",height:"32px"}),$(".tabs_container").each(function(){this.style.setProperty("float","left","important")});for(var a in n){var o=$("#"+a);o.text(n[a]),o.css({"text-align":"left","text-transform":"none"}),o.parents(".col-lg-4").first().find(".tabs_nav>li").each(function(t){"lblChoosePhase"==a&&0==t&&$(this).text("All phases"),$(this).bind("click",function(){window.setTimeout(function(){e(n)},500)})})}e(n);var i=$("#lblFullChampionshipName").text().split(" ");if(i.length>2){var r=i.take(i.length-2);$("#lblFullChampionshipName").text(r.join(" "))}}}var n=sportUtils.ParseQueryString();"1"!=n.English&&"1"!=n.english||($(".section_title").css("text-align","left"),window.setTimeout(t,100),window.setInterval(function(){$("h3").css("text-align","left"),$(".match-group").css("direction","ltr"),$(".match-row").each(function(){var t=$(this);"1"!=t.data("switched-cells")&&(e(t),t.data("switched-cells","1"),t.find(".match-facility-container").css("text-align","left"),t.find(".facility-label").text("Facility:"),t.find(".match-time-container").css("text-align","left"),t.find(".time-label").text("Time:"),t.find(".match-delayed-game").hide())}),$(".match-date-label").each(function(){var e=$(this);"1"!=e.data("replaced-text")&&(e.text(e.text().replace("תאריך:","Date:")),e.data("replaced-text","1"))})},1e3))},MobileStyle:function(e,t,n){void 0===t&&(t=""),void 0===n&&(n="");var a=n;return a+=function(e,t){var n="";return t.length>0&&(e.length>0&&(n+=" "),n+=t),n}(a,sportUtils.IsMobile()?t:e)},TranslateGrade:function(e,t){if(null!=e&&e>0&&null!=t){var n=t-e;if(n>=0&&n<sportUtils.grades.length)return sportUtils.grades[n]}return""},WaitForElements:function(e,t){function n(a,o){if(200*o>1e3*t)a.reject("timeout");else{var i={},r=0;e.forEach(function(e){var t=$(e);t.length>0&&(i[e]=t,r++)}),r>=e.length?a.resolve(i):window.setTimeout(function(){n(a,o+1)},200)}}var a=jQuery.Deferred();return n(a,0),a.promise()},DoWhenReady:function(e,t,n){if(void 0===n&&(n=0),!(n>1e4)){var a=$(e);if(a.length>0)return void t(a);window.setTimeout(function(){sportUtils.DoWhenReady(e,t,n+1)},2e3)}},CssWhenReady:function(e,t,n){sportUtils.DoWhenReady(e,function(e){var a=null;void 0===n?a=t:(a={},a[t]=n),e.css(a)})},Login:function(e,t,n,a){var o=e.defer(),i=$.trim(n||""),r=a||"";return i.length>0&&r.length>0?t.post("/api/login",{username:i,password:r}).then(function(e){var t=e.data;window.localStorage.setItem("logged_username",i),window.localStorage.setItem("logged_display_name",t.displayName),window.localStorage.setItem("logged_role",t.role),window.localStorage.setItem("logged_user_seq",t.seq),o.resolve(e.data)},function(e){e&&401==e.status?o.reject("שם משתמש ו/או סיסמה שגויים"):o.reject("שגיאה בעת התחברות")}):o.reject("יש להזין שם  וסיסמא"),o.promise},IsValidEmail:function(e){var t=$.trim((e||"").toString());if(0==t.length)return!0;var n=t.split("@");if(2!=n.length)return!1;var a=$.trim(n[0]),o=$.trim(n[1]);return 0!=a.length&&0!=o.length&&!("."==o.substr(0,1)||"."==o.substr(o.length-1,1)||o.indexOf(".")<0)},ParseHebrewCurrency:function(e){function t(e){var t="";e=e.filter(function(e){return e.length>0});for(var n=0;n<e.length;n++){var a=e[n];n>0&&(t+=" ",e.length>1&&n==e.length-1&&(t+="ו","שני"!=a&&"שתי"!=a||(a+="ם"))),t+=a}return t}function n(e,a,o){if(void 0===o&&(o=[]),(e=Math.floor(e))>=1e5)return e.toString();var i=Math.floor(e/1e3);if(i>0){var r=e%1e3,s="";s=1==i?"אלף":2==i?"אלפיים":n(i,!1)+" אלף",o.push(s);var l=n(r,a);return o.push(l),t(o)}var c=Math.floor(e/100);if(c>0){var r=e%100,u="";u=1==c?"מאה":2==c?"מאתיים":n(c,!1)+" מאות",o.push(u);var l=n(r,a);return o.push(l),t(o)}if(e<=0)return t(o);if(1==e)return o.push(a?"אחד":"אחת"),t(o);var d=a?sportUtils.hebrewNumbers.OneToTenMale:sportUtils.hebrewNumbers.OneToTenFemale;if(e<=10)return o.push(d[e-1]),t(o);if(e%10==0){var p=Math.floor(e/10);return o.push(sportUtils.hebrewNumbers.Asarot[p-1]),t(o)}if(e<20){e-=10;var g=d[e-1];2==e&&(g+="ם");var h=a?sportUtils.hebrewNumbers.OneToTenFemale[9]:sportUtils.hebrewNumbers.OneToTenMale[9];return o.push(g+" "+h),t(o)}var f=e%10,m=n(e-f,!1);return o.push(m),o.push(n(f,a)),t(o)}for(;e.indexOf(",")>0;)e=e.replace(",","");e=e.replace("/","."),e=e.replace("\\","."),e=e.replace("|",".");var a=parseFloat(e);if(!isNaN(a)){var o=parseInt(a),i=parseInt(a%1*100+.5);if(o>0&&i>=0){var r=n(o,!0);1==o?r="שקל "+r:r+=" שקלים";var s=n(i,!1),l=r+"";return s.length>0&&(1==i?s="אגורה "+s:s+=" אגורות",l+=" ו"+s),l+" בלבד"}}return""},IsValidInteger:function(e){return!isNaN(Number(e))&&e%1==0},IsValidPhoneNumber:function(e){var t=$.trim((e||"").toString()).replace("+","").replace("972","").replace("-","");return 0==t.length||!(t.length<9)&&sportUtils.IsValidInteger(t)},ParseQueryString:function(e){if((void 0===e||null==e)&&(e=window.location.search||"",0==e.length)){var t=window.location.hash||"",n=t.indexOf("?");n>=0&&(e=t.substr(n))}var a={};if(0==e.indexOf("?"))for(var o=e.substr(1).split("&"),i=0;i<o.length;i++){var r=o[i];if(r.length>0){var s=r.split("=");2==s.length&&s[0].length>0&&(a[s[0]]=s[1]||"")}}return a},RemoveSpecialCharacters:function(e){for(var t="`~!@#$%^&*()-=_+/\\[]{};:'\"|,<>?",n="",a=0;a<e.length;a++){var o=e.charAt(a);t.indexOf(o)<0&&(n+=o)}return n},GetHebrewLetter:function(e){if(null!=e&&e){var t=e-1;if(t>=0&&t<sportUtils.hebrewLetters.length)return sportUtils.hebrewLetters[t]}return""},InitCustomSelect:function(){$(".custom_select").each(function(){var e=$(this).children("ul"),t=$(this).find("select"),n=$(this).find(".select_title");if($(this).find("[data-filter]").length)for(var a=0,o=t.children("option").length;a<o;a++)e.append('<li data-filter="'+t.children("option").eq(a).data("filter")+'">'+t.children("option").eq(a).text()+"</li>");else for(var a=0,o=t.children("option").length;a<o;a++)e.append("<li>"+t.children("option").eq(a).text()+"</li>");t.hide(),n.on("click",function(){e.slideToggle(400),$(this).toggleClass("active")}),e.on("click","li",function(){var a=$(this).text();n.text(a),e.slideUp(400),t.val(a),n.toggleClass("active")})})},ValidateUrl:function(e){return void 0!==e&&null!=e&&e&&0!=e.toString().length?e.indexOf(".")<1?"":(e=e.toLowerCase(),e.indexOf("http://")<0&&e.indexOf("https://")<0&&(e="http://"+e),e):""},countWords:function(e){if(null==e||!e||0==e.toString().length)return 0;for(var t=e.toString();t.indexOf("  ")>0;)t=t.replace("  "," ");return t.split(" ").length},parseDate:function(e){if(null!=e&&8==e.toString().length){var t=parseInt(e.substr(0,2)),n=parseInt(e.substr(2,2)),a=parseInt(e.substr(4,4));if(!isNaN(t)&&t>0&&t<=31&&!isNaN(n)&&n>0&&n<=12&&!isNaN(a)&&a>1900&&a<=2100)return new Date(a,n-1,t)}return null},isNullOrEmpty:function(e){return void 0===e||(null==e||0==$.trim(e.toString()).length)},shallowCopy:function(e){var t={};if(null!=e)for(var n in e)t[n]=e[n];return t},VerifyUser:function(e,t,n,a){function o(){t.Unauthorized=!0,window.qL_Finish_Now=!0,null!=a&&a(!1)}function i(){null!=a?a(!0):ChainFactory.Next()}void 0===n&&(n=[]),void 0===a&&(a=null),e.get("/api/login").then(function(e){e&&e.data?(t.LoggedInUser=sportUtils.shallowCopy(e.data),1==e.data.role?i():n.indexOf(e.data.role)>=0?i():o()):o()},function(e){console.log("error verifying user"),console.log(e),o()})},AttachAutoClick:function(){
$(".auto-click").off("keypress"),$(".auto-click").keypress(function(e){var t=$(this),n=t.data("button-id");if(n){13==(e.keyCode||e.which)&&(e.preventDefault(),$("#"+n).trigger("click"),t.trigger("change"))}})},AddIfDoesNotExist:function(e,t,n){var a=t.toString();e[a]||(e[a]=n)},FlattenAssociativeArray:function(e,t){void 0===t&&(t=null);var n=[];for(var a in e)null!=t&&e[a]!=t||n.push(a);return n},SplitArray:function(e,t){(void 0===t||t<1)&&(t=1);for(var n=[],a=[],o=0;o<e.length;o++){var i=e[o];o>0&&o%t==0&&(n.push(a),a=[]),a.push(i)}return a.length>0&&n.push(a),n},CopyArray:function(e,t){if(e&&t)for(var n=0;n<e.length;n++){var a=e[n];t.push(a)}},InsertIntoArray:function(e,t){for(var n=[t],a=0;a<e.length;a++)n.push(e[a]);return n},DistinctArray:function(e,t){void 0===t&&(t="");for(var n={},a=[],o=0;o<e.length;o++){var i=null==e[o]?"":e[o],r=t.length>0?(i[t]||"").toString():i.toString();n[r]||(a.push(i),n[r]=!0)}return a},IsArray:function(e){return!!e&&e.constructor===Array},EncodeHTML:function(e){void 0!==e&&null!=e||(e="");for(var t=e.toString();t.indexOf("\r\n")>=0;)t=t.replace("\r\n","\n");for(;t.indexOf("\n\r")>=0;)t=t.replace("\n\r","\n");for(;t.indexOf("\n")>=0;)t=t.replace("\n","<br />");return t},StripHtmlTags:function(e){var t="";if(e&&e.length>0)for(var n=!1,a="",o=0;o<e.length;o++){var i=e.charAt(o);n&&">"==i?(n=!1,a=""):("<"==i&&(n=!0,a=""),n?a+=i:t+=i)}return a.length>0&&(t+=a),t},CreateShortVersion:function(e,t,n){var a=this;if(null==e||!e||0==e.length)return"";void 0===n&&(n=!0);var o=a.StripHtmlTags(e);if(o.length>t){for(var i=" ,.-()[]{}?!",r=t;r>=0&&!(i.indexOf(o.charAt(r))>=0);)r--;r>0&&(o=o.substr(0,r),n&&(o+="..."))}return o},HebrewMonthName:function(e){switch(e){case 1:return"ינואר";case 2:return"פברואר";case 3:return"מרץ";case 4:return"אפריל";case 5:return"מאי";case 6:return"יוני";case 7:return"יולי";case 8:return"אוגוסט";case 9:return"ספטמבר";case 10:return"אוקטובר";case 11:return"נובמבר";case 12:return"דצמבר"}return""},InitJackbox:function(){$(".jackbox[data-group]").length&&($(".jackbox[data-group]").each(function(){var e=$(this),t=10;try{e.jackBox("removeItem")}catch(e){t=1e3}window.setTimeout(function(){e.jackBox("init",{showInfoByDefault:!1,deepLinking:!1,preloadGraphics:!1,fullscreenScalesContent:!0,autoPlayVideo:!1,flashVideoFirst:!1,defaultVideoWidth:960,defaultVideoHeight:540,baseName:".jackbox",className:".jackbox",useThumbs:!0,thumbsStartHidden:!1,thumbnailWidth:75,thumbnailHeight:50,useThumbTooltips:!1,showPageScrollbar:!1,useKeyboardControls:!0})},t)}),window.setInterval(function(){var e=$(".jackbox-content");if(e.length>0){for(var t=e.attr("src"),n=null,a=$("#galleryContainer").find("img"),o=0;o<a.length;o++){var i=a.eq(o);if(i.attr("src")==t){n=i;break}}if(null!=n){var r=$.trim(n.parents("li").find(".image-description").text());$(".jackbox-custom-title").text(r)}}},1e3))},autoSizeFrames:[],autoSizeTimer:0,FrameAutoSize:function(e){sportUtils.IsMobile()||e&&e.Id&&e.Id.length>0&&sportUtils.autoSizeFrames.indexOf(e.Id)<0&&(sportUtils.autoSizeFrames.push(e),sportUtils.autoSizeTimer||(sportUtils.autoSizeTimer=window.setInterval(function(){for(var e=0;e<sportUtils.autoSizeFrames.length;e++){var t=sportUtils.autoSizeFrames[e],n=t.Id,a=$("#"+n);if(1==a.length){var o=a.parent();if(o.length>0){var i=o.width();if(i>0){var r=parseInt(a.data("previousParentWidth"));if(isNaN(r)||r!=i){var s=t.Src.replace("$width",i.toString());a.attr("src",s),a.data("previousParentWidth",i)}}}}}},1e3)))},IsInteger:function(e){return parseInt(e,10)==e},getRoundedRectangleClass:function(e,t){var n=["common_rounded_rectangle"];return e.Selected?n.push("selected_rounded_rectangle"):n.push("transparent_rounded_rectangle"),void 0!==t&&t&&n.push(t),n.join(" ")},getRoundedRectangleStyle:function(e,t){var n="border-color: "+t+";";return e.Selected&&(n+=" background-color: "+t+";"),n},getCurrentSeason:function(){return{Name:localStorage[sportGlobalSettings.LocalStorageKeys.CurrentSeason.Name]||"",Season:localStorage[sportGlobalSettings.LocalStorageKeys.CurrentSeason.Year]||0}},setCurrentSeason:function(e){null!=e&&e.Season>0?(localStorage[sportGlobalSettings.LocalStorageKeys.CurrentSeason.Name]=e.Name,localStorage[sportGlobalSettings.LocalStorageKeys.CurrentSeason.Year]=e.Season):(localStorage.removeItem(sportGlobalSettings.LocalStorageKeys.CurrentSeason.Name),localStorage.removeItem(sportGlobalSettings.LocalStorageKeys.CurrentSeason.Year))},IsValidIdNumber:function(e){var t=String(e);if(t.length>9||t.length<5||isNaN(t))return!1;for(;t.length<9;)t="0"+t;for(var n,a=0,o=0;o<9;o++)n=Number(t.charAt(o)),n*=o%2+1,n>9&&(n-=9),a+=n;return a%10==0},HandleFinalsTree:function(){function e(e){return $.trim(e.find(".team-name").text())}function t(e){return parseInt($.trim(e.find(".team-score").text()))}if($(".quarter-finals-right-side").length>0){var n=$(".quarter-finals-right-side").first(),a=$(".FinalsTreeContainer"),o=n.position().left+n.width(),i=$(".FinalsTreeContainer").parents(".row").first().width();if(i>o){var r=Math.floor((i-o)/2);a.css("left",r+"px")}var s=$(".team-box.finals");if(2==s.length){var l=s.eq(0),c=s.eq(1),u={},d={};u[e(l)]=!0,u[e(c)]=!0;var p=t(l),g=t(c);isNaN(p)||isNaN(p)||(p>g?l.addClass("winner-team"):g>p&&c.addClass("winner-team"))}$(".team-box.semi-finals-right-side,.team-box.semi-finals-left-side").each(function(){var t=$(this),n=e(t);d[n]=!0,1==u[n]&&t.addClass("winner-team")}),$(".team-box.quarter-finals-left-side,.team-box.quarter-finals-right-side").each(function(){var t=$(this),n=e(t);1==d[n]&&t.addClass("winner-team")})}window.setTimeout(sportUtils.HandleFinalsTree,500)},InitiateScrollToTopProcess:function(){function e(t){sportUtils.scrollToTopInterval&&(t.target&&"qLoverlay"==t.target.id||(window.clearInterval(sportUtils.scrollToTopInterval),sportUtils.scrollToTopInterval=0,$(document).unbind("mousemove keyup keydown touchstart touchmove mousewheel",e)))}0==sportUtils.scrollToTopInterval&&(sportUtils.scrollToTopInterval=window.setInterval(function(){if(sportUtils.scrollToTopCounter>=50)return void window.clearInterval(sportUtils.scrollToTopInterval);document&&document.body&&document.body.scrollTop>0&&(document.body.scrollTop=0,sportUtils.scrollToTopCounter++,sportUtils.scrollToTopEventsAttached||($(document).bind("mousemove keyup keydown touchstart touchmove mousewheel",e),sportUtils.scrollToTopEventsAttached=!0))},100))},IntegerOnlyTextbox:function(e){var t=$("#"+e);1==t.length&&(t.unbind("keypress",IntegerTextboxKeyPress).unbind("blur",IntegerTextboxBlur),t.bind("keypress",IntegerTextboxKeyPress).bind("blur",IntegerTextboxBlur))},SerializeForQueryString:function(e,t,n){void 0===n&&(n=!1);var a=[];for(var o in e){var i=e[o];if(null!=i&&(0==n||1==n&&!isNaN(parseInt(i)))){var r=t+o.toString();a.push(r+"="+encodeURIComponent(i))}}return a.join("&")}},ChainFactory={Callbacks:[],CurrentIndex:0,Next:function(){if(this.CurrentIndex<this.Callbacks.length){var e=this.CurrentIndex;this.CurrentIndex++,this.Callbacks[e]()}},Execute:function(){this.Callbacks=[],this.CurrentIndex=0;for(var e=0;e<arguments.length;e++){var t=arguments[e];"function"==typeof t&&this.Callbacks.push(t)}this.Next()}},_sportUtilMiscTimer_Counter=0,_sportUtilMiscTimer=window.setInterval(TimedFunctions,200);!function(){"use strict";function e(e,t,n,a,o,i){function r(t,n){var o=5242880,i=function(){var e=n.type;return e&&0!=e.length&&"image"==e.split("/")[0].toLowerCase()?n.size>o?"גודל קובץ מקסימלי הוא "+(o/1048576).toFixed(1)+" מגהבייט":"":"ניתן להעלות קובץ תמונה בלבד"}();return!(i.length>0)||(e.$apply(function(){e.imageUploadError=i}),window.setTimeout(function(){t.removeFile(n)},200),a(function(){e.imageUploadError=""},5e3),!1)}e.imageFileNames=i,e.pageSeq=o,e.imageUploadError="",e.selectImage=function(e,t){void 0===t&&(t=0),n.close({FileName:e,FileSize:t})},e.dropzoneConfig={options:{paramName:"files",maxFiles:1,url:"/content/Images/"+o,autoProcessQueue:!0,dictDefaultMessage:"אפשר לגרור לכאן תמונה חדשה, או ללחוץ להעלאה מהמחשב",dictRemoveFile:"הסרת תמונה",dictCancelUploadConfirmation:"ביטול העלאת תמונה",addRemoveLinks:!0},eventHandlers:{success:function(t,n){r(this,t)&&e.selectImage(t.name,t.size)},maxfilesexceeded:function(e){var t=this;window.setTimeout(function(){t.removeFile(e)},200)}}},e.cancel=function(){n.dismiss("cancel")}}angular.module("sport").controller("ThumbnailSelectionCtrl",["$scope","$http","$uibModalInstance","$timeout","pageSeq","images",e])}();var bannerUtils={ApplyFrequencyPercentage:function(e){if(e.length>0){var t=e.Sum("Frequency");if(1==e.length||0==t){e[0].FrequencyPercentage=100;for(var n=1;n<e.length;n++)e[n].FrequencyPercentage=0}else e.forEach(function(e){var n=Math.floor(e.Frequency/t*100+.5);e.FrequencyPercentage=n})}},ApplyDirtyState:function(e){if(e.Seq){if(!e.original_Seq){var t=[];for(var n in e)-1==n.indexOf("$")&&"FrequencyPercentage"!=n&&"Submitting"!=n&&t.push(n);e.OriginalProperties=t,t.forEach(function(t){e["original_"+t]=e[t]})}if(e.OriginalProperties&&e.OriginalProperties.length>0){for(var a=!1,o=0;o<e.OriginalProperties.length;o++){var n=e.OriginalProperties[o];if(e["original_"+n]!=e[n]){a=!0;break}}e.IsDirty=a}}}};!function(){"use strict";function e(e,t,n,a,o,i,r){function s(){sportUtils.VerifyUser(n,e,[3]),window.qL_step_finished=!0}function l(){e.generalData.NewBanner={CanSave:!1,Frequency:10},e.generalData.NewBanner.Location=e.generalData.possibleLocations[0]}function c(t){var n=e.banners.filter(function(e){return e.BannerType==t});bannerUtils.ApplyFrequencyPercentage(n)}function u(){for(var t=0;t<e.banners.length;t++){var n=e.banners[t];n.VideoPath="/content/Banners/"+n.Seq+"/"+n.FileName,n.Location=e.generalData.possibleLocations.findItem(function(e){return e.BannerType==n.BannerType})}e.banners.map(function(e){return e.BannerType}).distinct().forEach(function(e){c(e)}),window.qL_step_finished=!0,window.qL_Finish_Now=!0}function d(){e.error=!1,n.get("/api/banners").then(function(t){if(e.banners=[],t.data&&t.data.length)for(var n=0;n<t.data.length;n++)e.banners.push(t.data[n]);u()},function(t){console.log("error reading banners"),console.log(t),e.error=!0,window.qL_step_finished=!0,window.qL_Finish_Now=!0})}function p(t,n){function a(t,n){var a=null;null!=(a="new"==t?e.generalData.NewBanner:e.banners.findItem(function(e){return e.Seq==t}))&&(a.uploadError=n)}var i=function(){var e=n.type,t=!e||0==e.length,a=e.split("/")[1].toLowerCase();return t||"webm"!=a&&"mp4"!=a?"ניתן להעלות קובץ webm או mp4 בלבד":""}();return!(i.length>0)||(e.$apply(function(){a(g.ActiveBannerSeq,i)}),window.setTimeout(function(){t.removeFile(n)},200),o(function(){a(g.ActiveBannerSeq,"")},5e3),!1)}var g={ActiveBannerSeq:0},h={};e.banners=[],e.Unauthorized=!1,e.generalData={possibleLocations:[{BannerType:1,Name:"עמוד הבית"}]},l(),i(function(){for(var t=0;t<e.banners.length;t++){var n=e.banners[t];bannerUtils.ApplyDirtyState(n)}e.generalData.NewBanner.CanSave=e.generalData.NewBanner.BannerName&&e.generalData.NewBanner.FileName&&e.generalData.NewBanner.FileSize},1e3),e.dropzoneConfig={options:{paramName:"files",maxFiles:1,url:"/content/Banners/temp",autoProcessQueue:!0,dictDefaultMessage:"ניתן לגרור לכאן סרטון, או ללחוץ להעלאה מהמחשב",dictRemoveFile:"הסרת סרטון",dictCancelUploadConfirmation:"ביטול העלאת קובץ",addRemoveLinks:!0},eventHandlers:{success:function(t,n){var a=this;if(g.ActiveBannerSeq=$(this.element).parents(".banner-section").first().data("uniqueid"),p(this,t)){var o=null;o="new"==g.ActiveBannerSeq?e.generalData.NewBanner:e.banners.findItem(function(e){return e.Seq==g.ActiveBannerSeq}),null!=o&&(o.FileName=t.name,o.FileSize=t.size,h[g.ActiveBannerSeq.toString()]=a)}},maxfilesexceeded:function(e){var t=this;window.setTimeout(function(){t.removeFile(e)},200)}}},ChainFactory.Execute(s,d),window.qL_steps_amount=2,e.FocusNewBanner=function(){var e=$("#txtNewBannerName");if(e.length>0){var t=e.offset().top;document.body.scrollTop=t-120,e.focus()}},e.GetNewBannerSaveButtonStyle=function(){var t=["margin-bottom: 15px;"];return e.generalData.NewBanner.CanSave?t.push("cursor: pointer;"):(t.push("background-color: gray;"),t.push("text-decoration: none;")),t.join(" ")},e.GetNewBannerSaveButtonIconStyle=function(){return e.generalData.NewBanner.CanSave?"":"color: #d0d0d0; background-color: gray;"},e.GetFrequencyClass=function(e,t){var n="button button_type_icon_small icon button_grey_light";0==t&&(n+=" button_grey_light_zero");var a="button_grey_light_hover";return 0==t&&(a+="_zero"),e.Frequency==t&&(n+=" "+a),n},e.ChooseFrequency=function(e,t){e.Frequency=t,c(e.BannerType)},e.DeleteBanner=function(t){function a(t,n){if(t.Deleting.Active=!1,o(function(){t.Deleting=null},5e3),n){var a=e.banners.findIndex(function(e){return e.Seq==t.Seq});a>=0&&(e.banners.splice(a,1),c(t.BannerType))}else t.Deleting.Error=!0}var i="האם למחוק ";i+=t.BannerName?"את הפרסומת "+t.BannerName:"פרסומת זו",i+="?",i+="<br />פעולה זו אינה הפיכה!",r.ask(i).then(function(){t.Deleting={Active:!0},n.delete("/api/banners/"+t.Seq).then(function(e){a(t,!0)},function(e){a(t,!1)})})},e.Save=function(t){function a(e){e.IsDirty=!1,e.OriginalProperties&&e.OriginalProperties.forEach(function(t){e["original_"+t]=e[t]})}function i(e,t){e.Submitting.Active=!1,o(function(){e.Submitting=null},5e3),t?(e.Submitting.Success=!0,a(e)):e.Submitting.Error=!0}function r(e){var t=h[e.toString()];if(t)for(var n=0;n<t.files.length;n++){var a=t.files[n];t.removeFile(a)}}if(t.Seq||t.CanSave)if(t.Location&&(t.BannerType=t.Location.BannerType),t.Submitting={Active:!0},t.Seq)n.put("/api/banners",t).then(function(e){t.AttachmentSeq=e.data.AttachmentSeq,t.VideoPath="/content/Banners/"+t.Seq+"/"+t.FileName,i(t,!0),r(t.Seq)},function(e){i(t,!1)});else{var s=sportUtils.shallowCopy(e.generalData.NewBanner);s.BannerType=s.Location?s.Location.BannerType:1,n.post("/api/banners",s).then(function(t){s.Seq=t.data.BannerSeq,s.AttachmentSeq=t.data.AttachmentSeq,s.DateCreated=t.data.DateCreated,s.UploadedBy={Seq:e.LoggedInUser.seq,Login:e.LoggedInUser.name,Name:e.LoggedInUser.displayName,Role:e.LoggedInUser.role},s.VideoPath="/content/Banners/"+s.Seq+"/"+s.FileName,i(s,!0),r("new"),e.banners.push(s),l(),c(s.BannerType),o(function(){a(s)},1200)},function(e){i(s,!1)})}}}angular.module("sport.banners").controller("BannersController",["$scope","$state","$http","$filter","$timeout","$interval","messageBox",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s,l,c,u,d){function p(){o.get("/api/sportsman/regions").then(function(t){if(e.allRegions=t.data.slice(0),null!=e.region){var n=e.region.REGION_ID;e.allRegions.forEach(function(e){e.REGION_ID==n&&(e.Selected=!0)})}})}function g(){e.sportFieldsInUse.All=sportUtils.DistinctArray(w.map(function(e){return e.SPORT_ID})).map(function(e){return{Id:e,Name:T[e.toString()]}});var t=sportUtils.SplitArray(e.sportFieldsInUse.All,D);if(t.length>0){for(var n=t[t.length-1],a=D-n.length,o=0;o<a;o++)n.push({Id:0,Name:"Blank_"+(o+1)});for(var o=0;o<t.length;o++){t[o].sort(function(e,t){return e.Id-t.Id})}}e.sportFieldsInUse.Rows=t}function h(){if(0==e.championshipsFilters.SportField)return e.championshipsFilters.Championship="",void(e.championshipsInUse.Rows=[]);var t=e.championshipsInUse.All.filter(function(t){return t.SportField==e.championshipsFilters.SportField}),n=sportUtils.SplitArray(t,P);if(n.length>0){for(var a=n[n.length-1],o=P-a.length,i=0;i<o;i++)a.push({SportField:0,Name:"Blank_"+(i+1)});for(var i=0;i<n.length;i++){n[i].sort(function(e,t){return e.SportField-t.SportField})}}e.championshipsInUse.Rows=n}function f(){if(""==e.championshipsFilters.Championship)return void(e.categoriesInUse.Rows=[]);var t=e.categoriesInUse.All.filter(function(t){return t.Championship==e.championshipsFilters.Championship});t.sortByProperty("Name");var n=sportUtils.SplitArray(t,F);if(n.length>0){for(var a=n[n.length-1],o=F-a.length,i=0;i<o;i++)a.push({SportField:0,Name:"Blank_"+(i+1)});for(var i=0;i<n.length;i++){n[i].sort(function(e,t){return e.SportField-t.SportField})}}e.categoriesInUse.Rows=n}function m(){l.sportFields().then(function(e){T=e,window.qL_step_finished=!0,ChainFactory.Next()},function(e){console.log("error reading sport fields: "+e),window.qL_step_finished=!0,ChainFactory.Next()})}function v(){function t(){var t=a.defer();return 0==n.region&&0==e.isClubs?u.sportFlowersEvents().then(function(e){t.resolve(e)},function(e){t.reject("שגיאה בעת  טעינת נתונים מהשרת")}):t.resolve([]),t.promise}var r=a.defer();return w=[],e.loading=!0,c.read({region:n.region,omitEmpty:0}).then(function(n){t().then(function(t){_=t.slice(0),o.get("/api/sportsman/permanent-championships").then(function(a){var o=a.data.slice(0),s={};o.forEach(function(e){s[e.CHAMPIONSHIP_CATEGORY_ID.toString()]=!0}),e.loading=!1;var l=1==e.isClubs?1:0;w=n.slice(0).filter(function(e){return e.IS_CLUBS==l&&!s[e.CHAMPIONSHIP_CATEGORY_ID.toString()]});for(var c=championshipsUtils.convertSportFlowersChampionships(t,i),u=0;u<c.length;u++){var d=c[u];w.push(d)}var p=w.toAssociativeArray(!0,"CHAMPIONSHIP_NAME","SPORT_ID");e.championshipsInUse.All=sportUtils.DistinctArray(w.map(function(e){return e.CHAMPIONSHIP_NAME})).map(function(e){return{Name:e,SportField:p[e]}}),h(),e.categoriesInUse.All=[];for(var m={},u=0;u<w.length;u++){var v=w[u],S=v.CATEGORY_NAME,y=v.CHAMPIONSHIP_NAME,C=v.SPORT_ID+"_"+y+"_"+S;v.SPORT_ID==sportGlobalSettings.FlowersFieldSeq&&(C+="_"+v.CHAMPIONSHIP_ID+"_"+v.CHAMPIONSHIP_CATEGORY_ID),m[C]||(e.categoriesInUse.All.push({Name:S,Championship:y,SportField:v.SPORT_ID,CategoryId:v.CHAMPIONSHIP_CATEGORY_ID,SportType:v.SPORT_TYPE}),m[C]=!0)}f(),g(),r.resolve("done")},function(t){e.loading=!1,r.reject(t)})},function(t){e.loading=!1,r.reject(t)})},function(t){e.loading=!1,r.reject("שגיאה בעת  טעינת נתונים מהשרת")}),r.promise}function S(t){I();var n=C(t);if(e.selectedCategory.Name=n,e.selectedCategory.ID=t.CategoryId,t.SportField!=sportGlobalSettings.FlowersFieldSeq)u.sportsmanEvents({category:t.CategoryId}).then(function(n){window.qL_step_finished=!0,n.sort(function(e,t){return e.Date.getTime()-t.Date.getTime()}),d.championship(t.CategoryId).then(function(a){window.qL_step_finished=!0,a&&a.length>0&&(e.selectedCategory.Pages=a,e.selectedCategory.Pages.forEach(function(e){e.BannerButtonClass="button banner_button "+contentUtils.GetBannerType(e.Type),e.HebrewType=contentUtils.HebrewPageType(e.Type)}),contentUtils.ApplyPagesData(e.selectedCategory.Pages));var r=60*(new Date).getTimezoneOffset()*1e3,l=t.Championship&&t.Championship.indexOf("כדורעף")>=0,u=n.map(function(e,t){var n=!1;return l||(n=!!e.DATE_CHANGED_DATE),{SPORT_ID:e.SPORT_ID,ROUND_NAME:e.ROUND_NAME,CYCLE_NAME:e.CYCLE_NAME,PHASE_NAME:e.PHASE_NAME,GROUP_NAME:e.GROUP_NAME,Date:e.Date,Group:e.NGROUP,Phase:e.PHASE,GameDetails:eventsUtils.BuildGameDetails(e),TeamA:eventsUtils.BuildTeamName(e,"A"),TeamB:eventsUtils.BuildTeamName(e,"B"),TeamA_Score:e.TEAM_A_SCORE,TeamB_Score:e.TEAM_B_SCORE,TeamA_Id:e.TEAM_A_ID,TeamB_Id:e.TEAM_B_ID,FacilityName:e.FACILITY_NAME,FacilityAddress:e.FACILITY_ADDRESS,FacilityCity:e.FACILITY_CITY,Result:e.RESULT,TimeWithoutZone:new Date(e.TimeWithoutZone),SecondsSinceEpoch:e.SecondsSinceEpoch,LocalTime:new Date(1e3*e.SecondsSinceEpoch+r),FormattedTime:e.FormattedTime,PartsData:championshipsUtils.ConvertPartsResult(e.PARTS_RESULT),HideDelayedMessage:l,IsDelayed:n,Id:t+1}});e.selectedCategory.LoadingPhases=!0,c.teams(t.CategoryId,u,t.SportType).then(function(n){var a=n.Teams,r={};if(a.Competitors)for(var l=0;l<a.Competitors.length;l++){var d=a.Competitors[l],p=d.TeamId;if(p){var g=d.PhaseIndex,h=p+"_"+g;r[h]||(r[h]=[]),r[h].push(d)}}var f=n.Tree;window.qL_step_finished=!0,c.selectedPhase(t.CategoryId).then(function(n){window.qL_step_finished=!0,e.selectedCategory.LoadingPhases=!1,e.selectedCategory.FinalsTree=f,e.selectedCategory.Matches=u,e.selectedCategory.SportType=t.SportType,sportUtils.HideWhenFramed(["#main_header",".breadcrumb","#pnlRegionSelection","#pnlChampionshipFiles","#pnlCategoryChooseFilters","#pnlChooseRegion","#pnlChooseSportAndCategory","#pnlChangeChampionship",".footer"]),sportUtils.ApplyEnglishChampionship();var l=function(t,n){void 0===n&&(n=null),t&&(e.selectedCategory.ShowMatches=!1),s(function(){e.selectedCategory.ShowMatches=!0,null!=n&&n()},1e3)},c={},d={};if(e.selectedCategory.Matches.forEach(function(e){c[e.TeamA]=e.TeamA_Id,c[e.TeamB]=e.TeamB_Id,e.FacilityName&&e.FacilityName.length>0&&(d[e.FacilityName]={Address:e.FacilityAddress,City:e.FacilityCity})}),1!=t.SportType){var p=[];for(var g in c)p.push({Name:g,Id:c[g]});var h=[];for(var m in d){var v=d[m],S="";v.Address&&v.Address.length>0&&(S=v.Address),v.City&&v.City.length>0&&S.indexOf(v.City)<0&&(S.length>0&&(S+=", "),S+=v.City),h.push({Name:m,FullAddress:S})}e.selectedCategory.AllTeams=p.filter(championshipsUtils.actualTeamsFilter),e.selectedCategory.AllFacilities=h,championshipsUtils.InitTeamNamesHeightTimer()}e.selectedCategory.selectedTeam=null,e.selectedCategory.selectedFacility=null,e.selectedCategory.prevSelectedTeam="",e.selectedCategory.prevSelectedFacility="",e.selectedCategory.FilteredMatches=e.selectedCategory.Matches,e.selectedCategory.setSelectedTeam=function(t,n){if(void 0!==n){var a=t;1==n&&(e.selectedCategory.selectedTeam=a.Team,e.selectedCategory.selectedFacility=null,e.selectedCategory.selectedPlayers=null)}else if(l(!0),e.selectedCategory.selectedTeam=t,e.selectedCategory.selectedFacility=null,e.selectedCategory.selectedPlayers=null,null!=t){var i=c[t.Name];if(i){var s=null;if(e.selectedCategory.SelectedMatchesGroup&&e.selectedCategory.SelectedMatchesGroup.Teams&&(s=e.selectedCategory.SelectedMatchesGroup.Teams.findItem(function(e){return e.TEAM_ID==i})),null==s){var u=null,d=null;e.selectedCategory.Phases.forEach(function(e){null==s&&e.AllGroups&&e.AllGroups.forEach(function(t){null==s&&t.Teams&&null!=(s=t.Teams.findItem(function(e){return e.TEAM_ID==i}))&&(u=e,d=t)})}),null!=u&&null!=d&&e.selectedCategory.changeMatchesPhase&&(e.selectedCategory.changeMatchesPhase(u),e.selectedCategory.changeGroup(d))}o.get("/api/sportsman/teams/"+i+"/players").then(function(t){e.selectedCategory.selectedPlayers=t.data})}}if(null!=e.selectedCategory.selectedTeam){var i=e.selectedCategory.selectedTeam.Id,p=e.selectedCategory.Phases.findIndex(function(e){return 1==e.Selected}),g=i+"_"+p,h=r[g];h&&(e.selectedCategory.selectedTeam.Competitors=h)}},e.selectedCategory.setSelectedCompetitor=function(t){e.selectedCategory.selectedCompetitor=t},e.selectedCategory.setSelectedCompetition=function(t,n){void 0===n&&(n=!1),e.selectedCategory.setSelectedCompetitor(null),e.selectedCategory.selectedCompetition=t,n&&(document.body.scrollTop=50)},e.selectedCategory.setSelectedFacility=function(t,n){if(void 0===n&&(n=null),e.selectedCategory.Matches&&e.selectedCategory.Matches.forEach(function(e){e.ShowFacilityDetails=!1}),null!=n&&(n.ShowFacilityDetails=!0,null==t&&e.selectedCategory.AllFacilities&&(t=e.selectedCategory.AllFacilities.findItem(function(e){return e.Name==n.FacilityName}))),null!=t&&e.selectedCategory.Matches){var a=!1;if(e.selectedCategory.SelectedMatchesRound&&e.selectedCategory.SelectedMatchesRound.Cycles)for(var o=0;o<e.selectedCategory.SelectedMatchesRound.Cycles.length;o++){var i=e.selectedCategory.SelectedMatchesRound.Cycles[o];if(i.MatchGroups)for(var r=0;r<i.MatchGroups.length;r++){var s=i.MatchGroups[r];if(s.Matches)for(var c=0;c<s.Matches.length;c++){var u=s.Matches[c];if(u.FacilityName==t.Name){a=!0;break}}if(a)break}if(a)break}if(!a){var d=e.selectedCategory.Matches.findItem(function(e){return e.FacilityName==t.Name});if(null!=d&&e.selectedCategory.Phases){var p=e.selectedCategory.Phases.findItem(function(e){return e.Index==d.Phase});if(null!=p&&(e.selectedCategory.changeMatchesPhase(p),p.AllGroups)){var g=p.AllGroups.findItem(function(e){return e.Index==d.Group});if(null!=g&&(e.selectedCategory.changeGroup(g),p.Rounds)){var h=p.Rounds.findItem(function(e){return e.Name==d.ROUND_NAME});null!=h&&e.selectedCategory.changeMatchesRound(h)}}}}}l(!0),e.selectedCategory.selectedFacility=t,null!=n&&(n.ShowFacilityDetails=!0)},e.selectedCategory.IsDateVisible=function(t){var n=e.selectedCategory.FilteredMatches.findIndex(function(e){return e.Id==t.Id});if(n>0){var a=e.selectedCategory.FilteredMatches[n-1];return i("date")(a.Date,"dd/MM/yyyy")!=i("date")(t.Date,"dd/MM/yyyy")}return!0},e.selectedCategory.getTeamRowStyle=function(t,n){var a=null==e.selectedCategory.selectedTeam?"":e.selectedCategory.selectedTeam.Name;return n?a==t?"background-color: #00ADEE;":"":a==t.Name?"background-color: #00ADEE;":""},e.selectedCategory.getCompetitorRowStyle=function(t){var n=null==e.selectedCategory.selectedCompetitor?"":e.selectedCategory.selectedCompetitor.ShirtNumber,a=t.CellValues[0];return n&&n==a?"background-color: #00ADEE;":""};var y=[];1==t.SportType?a.RankingTables&&a.RankingTables.length>0&&(y=a.RankingTables.map(function(e){return{Name:e.PhaseName}})):y=sportUtils.DistinctArray(e.selectedCategory.Matches,"PHASE_NAME").map(function(e){return{Name:e.PHASE_NAME}});var C=n||0;if(C>=y.length&&(C=0),1==t.SportType){if(e.selectedCategory.AllTeams=[],e.selectedCategory.AllCompetitions=[],a.RankingTables&&a.RankingTables.length>0){var I=a.RankingTables[C];e.selectedCategory.AllTeams=I.Teams,e.selectedCategory.AllCompetitions=I.Competitions}e.selectedCategory.CompetitorMapping=r}var T=[],w=[];if(y.length>0){y[C].Selected=!0;for(var _=0;_<y.length;_++){var D=y[_];if(D.Index=_,1==t.SportType){var P=[];if(a.RankingTables&&a.RankingTables.length>0){var F=a.RankingTables[_],N={};if(F.Competitions){var b={},A=0;if(F.Competitions.forEach(function(e){N[e.GroupName]=e.GroupIndex;var t=e.Name;b[t]||(b[t]=[],A++),b[t].push(e)}),F.Competitions.length>A){var E=[];for(var R in b){var M=b[R],U={};M.forEach(function(e){U[e.GroupIndex.toString()]=e}),E.push({Name:R,GroupCompetitions:U})}F.Competitions=E}else F.Competitions.forEach(function(e){e.GroupCompetitions={},e.GroupCompetitions[e.GroupIndex.toString()]=e})}w=F.Teams,P=F.Competitions,T=sportUtils.DistinctArray(F.Rows.map(function(e){return e.GroupName})).map(function(e){return{Name:e,Index:N[e],ColumnTitles:F.ColumnTitles,Rows:F.Rows.filter(function(t){return t.GroupName==e})}})}D.Teams=w,D.Competitions=P,D.AllGroups=T,_==C&&(e.selectedCategory.AllCompetitions=P)}else{w=a.filter(function(e){return e.PHASE_NAME==D.Name}),T=sportUtils.DistinctArray(w,"GROUP_NAME").map(function(e){return{Name:e.GROUP_NAME}});for(var x=0;x<T.length;x++){var O=T[x];O.Teams=w.filter(function(e){return e.GROUP_NAME==O.Name}),O.Teams.forEach(function(e){e.Name=eventsUtils.BuildTeamName(e,null)}),O.Index=x}D.AllGroups=T}}}if(e.selectedCategory.Phases=[],y.length>0){var H=[],p=[];y.forEach(function(e){e.AllGroups.forEach(function(e){p.appendArray(e.Teams)})}),H.push({Index:-1,Name:"כל הבתים",Selected:!1,Teams:p}),y.forEach(function(e){H.appendArray(e.AllGroups)}),e.selectedCategory.Phases.push({Index:-1,Name:"כל השלבים",Selected:!1,AllGroups:H}),e.selectedCategory.Phases.appendArray(y)}if(e.selectedCategory.Phases.length>0&&(e.selectedCategory.SelectedPhase=e.selectedCategory.Phases[C],e.selectedCategory.FinalsTree)){championshipsUtils.ApplyFinalsTree(e.selectedCategory.FinalsTree,e.selectedCategory.Phases,e.selectedCategory.Matches);var $=e.selectedCategory.Phases.length,q={Name:"משחקי הצלבה",Index:$,TreePhase:!0,Selected:!0};e.selectedCategory.Phases.forEach(function(e){e.Selected=!1}),e.selectedCategory.Phases.push(q),e.selectedCategory.SelectedPhase=q}var k="/api/sportsman/championship-category/"+t.CategoryId+"/grades";o.get(k).then(function(t){for(var n={},a=0;a<t.data.length;a++){var o=t.data[a];n[(o.TEAM_NUMBER||"").toString()]=o.GRADE_NAME}e.selectedCategory.GradeMapping=n},function(e){console.log("error loading grades"),console.log(e)}),window.qL_Finish_Now=!0,l(!1,function(){window.setTimeout(function(){contentUtils.CarouselAutoSlide("matchesCarousel")},100)}),sportUtils.HandleFinalsTree()},function(t){console.log("error loading teams"),console.log(t),window.qL_Finish_Now=!0,e.selectedCategory.LoadingPhases=!1})},function(t){console.log("error loading active phase"),console.log(t),window.qL_Finish_Now=!0,e.selectedCategory.LoadingPhases=!1})},function(t){console.log("error loading championships"),console.log(t),window.qL_Finish_Now=!0,e.selectedCategory.LoadingPhases=!1})},function(t){console.log("error loading matches"),console.log(t),window.qL_Finish_Now=!0,e.selectedCategory.LoadingPhases=!1});else{var a=_.findItem(function(e){return e.Seq==t.CategoryId});if(null!=a){e.selectedCategory.Name="פרחי ספורט - "+a.EventName;var r=a.SportFieldName;a.FacilityName&&(r+=" "+a.FacilityName),e.selectedCategory.SportFlowersData={Description:r,Date:a.DateTime,FacilityName:a.FacilityName},d.championship("sf-"+t.CategoryId).then(function(t){window.qL_step_finished=!0,t&&t.length>0&&(e.selectedCategory.Pages=t,e.selectedCategory.Pages.forEach(function(e){e.BannerButtonClass="button banner_button "+contentUtils.GetBannerType(e.Type),e.HebrewType=contentUtils.HebrewPageType(e.Type)}),contentUtils.ApplyPagesData(e.selectedCategory.Pages))})}}}function y(){function t(t){var n=w.filter(function(e){return e.CHAMPIONSHIP_CATEGORY_ID==t});if(n.length>0){var a=n[0],o=e.sportFieldsInUse.All.filter(function(e){return e.Id==a.SPORT_ID});if(o.length>0){e.toggleSportFieldFilter(o[0]);var i=e.championshipsInUse.All.filter(function(e){return e.Name==a.CHAMPIONSHIP_NAME});if(i.length>0){e.toggleChampionshipFilter(i[0]);var r=e.categoriesInUse.All.filter(function(e){return e.CategoryId==t});if(r.length>0){var s=r[0];return s.Selected=!0,s}}}}return null}v().then(function(){window.qL_step_finished=!0;var a=!1;if(n.category){var i=0,r=!1;if(0==n.category.indexOf("sf-")?(i=parseInt(n.category.replace("sf-","")),r=!0):n.category>0&&(i=parseInt(n.category)),!isNaN(i)&&i>0){var s=null;e.showPermanentChampionships?o.get("/api/sportsman/category-data?category="+i).then(function(e){s={Name:e.data.CATEGORY_NAME,Championship:e.data.CHAMPIONSHIP_NAME,SportField:e.data.SPORT_ID,SportType:e.data.SPORT_TYPE,CategoryId:i},a=!0,S(s)}):null!=(s=t(i))&&(r||(a=!0),S(s))}}a||(window.qL_Finish_Now=!0),ChainFactory.Next()},function(t){e.error=t,window.qL_Finish_Now=!0,ChainFactory.Next()})}function C(e){if(e.SportField==sportGlobalSettings.FlowersFieldSeq)return"פרחי ספורט";var t=e.Name,n=e.Championship;return t!=n&&(n+=" "+t),n}function I(){e.selectedCategory={Name:"",Matches:[]}}var T={},w=[],_=[],D=4,P=4,F=4;if(e.championshipsFilters={SportField:0,Championship:""},e.sportFieldsInUse={All:[],Rows:[]},e.championshipsInUse={All:[],Rows:[]},e.categoriesInUse={All:[],Rows:[]},e.selectedCategory=null,e.error="",e.loading=!0,e.region=null,e.isClubs=1==n.clubs,e.showPermanentChampionships="p"==n.region,e.currentSeason=sportUtils.getCurrentSeason(),e.championshipChoosingTitle="",e.categoryChoosingTitle="",n.category&&n.category>0&&!e.showPermanentChampionships){var N=n.category;o.get("/api/sportsman/category-data?category="+N).then(function(a){window.qL_step_finished=!0;var o=a.data.SEASON,i=a.data.CHAMPIONSHIP_NAME,r=a.data.IS_CLUBS,s=a.data.REGION_ID;null!=o&&o||t.go("championships",{clubs:n.clubs,region:n.region}),l.seasons.inUse().then(function(a){window.qL_step_finished=!0;var c=a.filter(function(e){return e.SeasonCode==o});if(0==c.length)e.error="לא נמצאה עונה עבור האליפות "+i;else{var u=c[0].Season;l.currentSeason().then(function(e){if(window.qL_Finish_Now=!0,u!=e)t.go("championships",{clubs:n.clubs,region:n.region});else{var a=1==n.clubs?1:0;if(r!=a||s!=n.region)return void t.go("championships.region.championship",{clubs:r,region:s,category:N})}})}})})}if(contentUtils.InitSportFieldColors(o,function(){window.qL_step_finished=!0}),null!=n.region){var b=n.region,A=n.category;"p"==b?o.get("/api/sportsman/permanent-championships").then(function(t){if(e.permanentChampionships=t.data.slice(0),A)for(var n=0;n<e.permanentChampionships.length;n++){var a=e.permanentChampionships[n];if(a.CHAMPIONSHIP_CATEGORY_ID==A){a.Selected=!0;break}}}):o.get("/api/sportsman/regions").then(function(t){var n=t.data.filter(function(e){return e.REGION_ID==b})
;n.length>0&&(e.region=n[0],o.get("/api/pages?region="+b).then(function(t){var n=t.data.slice(0);n.length>0&&(e.regionPages=n.take(8),contentUtils.ApplyPagesData(e.regionPages),e.regionPages.forEach(function(e){e.Date=new Date(e.Date),e.HebrewType=contentUtils.HebrewPageType(e.Type),e.BannerButtonClass="button banner_button "+contentUtils.GetBannerType(e.Type)})),p()}))})}else p();ChainFactory.Execute(m,y),window.qL_steps_amount=7,r(function(){if(e.selectedCategory&&e.selectedCategory.Matches&&e.selectedCategory.Matches.length>0){var t=null==e.selectedCategory.selectedTeam?"":e.selectedCategory.selectedTeam.Name,n=e.selectedCategory.prevSelectedTeam,a=null==e.selectedCategory.selectedFacility?"":e.selectedCategory.selectedFacility.Name,o=e.selectedCategory.prevSelectedFacility;if(t!=n||a!=o){e.selectedCategory.FilteredMatches=[];var i=e.selectedCategory.Matches.filter(function(e){var n=0==t.length||e.TeamA==t||e.TeamB==t,o=0==a.length||e.FacilityName==a;return n&&o});s(function(){e.selectedCategory.FilteredMatches=i,e.selectedCategory.OnFilteredMatchesChange&&e.selectedCategory.OnFilteredMatchesChange()},100),e.selectedCategory.prevSelectedTeam=t,e.selectedCategory.prevSelectedFacility=a}}},100),e.getSportFieldColor=contentUtils.getSportFieldColor,e.getRegionColor=contentUtils.getRegionColor,e.getRoundedRectangleClass=sportUtils.getRoundedRectangleClass,e.getSportFieldStyle=function(e){var t=contentUtils.getSportFieldColor(e);return"background-color: "+t+"; border-color: "+t+";"},e.totalChampionshipsCount=function(){return w.length},e.getSportFieldFilterStyle=function(e){var t=e.Id||e.SportField,n=contentUtils.getSportFieldColor(t),a=sportUtils.getRoundedRectangleStyle(e,n);return e.SportWordCount&&e.SportWordCount>2&&(a+=" line-height: inherit;"),a},e.getRegionFilterStyle=function(e){var t=contentUtils.getRegionColor(e.REGION_ID);return sportUtils.getRoundedRectangleStyle(e,t)},e.getPermanentChampionshipFilterStyle=function(e){var t=contentUtils.getSportFieldColor(e.SPORT_ID);return sportUtils.getRoundedRectangleStyle(e,t)},e.toggleSportFieldFilter=function(t){var n=t.Id;if(e.championshipChoosingTitle=n==sportGlobalSettings.FlowersFieldSeq?"אירוע פרחי ספורט:":"אליפות:",e.clearChampionshipFilter(),e.championshipsFilters.SportField){var a=e.sportFieldsInUse.All.filter(function(t){return t.Id==e.championshipsFilters.SportField});a.length>0&&(a[0].Selected=!1)}t.Selected=!t.Selected,e.championshipsFilters.SportField=n,e.championshipsInUse.All.filter(function(e){return e.SportField==n&&e.Selected}).forEach(function(t){e.toggleChampionshipFilter(t)}),h(),e.championshipsFilters.Championship="",I(),f()},e.toggleChampionshipFilter=function(t){var n=t.Name;if(e.categoryChoosingTitle=e.championshipsFilters.SportField==sportGlobalSettings.FlowersFieldSeq?"פעילות פרחי ספורט:":"קטגוריית אליפות:",e.championshipsFilters.Championship.length>0){var a=e.championshipsInUse.All.filter(function(t){return t.Name==e.championshipsFilters.Championship});a.length>0&&(a[0].Selected=!1)}t.Selected=!t.Selected,e.championshipsFilters.Championship=n,I(),f()},e.ChangeChampionshipClicked=function(){document.location.hash="#/m?c="+e.selectedCategory.ID},e.RegionClicked=function(e){t.go("championships.region",{clubs:n.clubs,region:e.REGION_ID})},e.PermanentChampionshipClicked=function(e){t.go("championships.region.championship",{clubs:0,region:"p",category:e.CHAMPIONSHIP_CATEGORY_ID})},e.JumpToCategory=function(e){var a=e.SportField==sportGlobalSettings.FlowersFieldSeq?"sf-"+e.CategoryId:e.CategoryId;t.go("championships.region.championship",{clubs:n.clubs,region:n.region,category:a})},e.clearSportFieldFilter=function(){e.championshipsFilters.SportField=0;for(var t=0;t<e.sportFieldsInUse.All.length;t++)e.sportFieldsInUse.All[t].Selected=!1;h(),f(),e.clearChampionshipFilter()},e.clearChampionshipFilter=function(){e.championshipsFilters.Championship="";for(var t=0;t<e.championshipsInUse.Rows.length;t++)for(var n=e.championshipsInUse.Rows[t],a=0;a<n.length;a++)n[a].Selected=!1}}function t(e,t,n,a,o,i){function r(){if(e.category&&(e.category.changeMatchesPhase||(e.category.changeMatchesPhase=e.changeMatchesPhase),e.category.changeGroup||(e.category.changeGroup=e.changeGroup),e.category.changeMatchesRound||(e.category.changeMatchesRound=e.changeMatchesRound),e.category.OnFilteredMatchesChange||(e.category.OnFilteredMatchesChange=function(){var t=e.category.SelectedMatchesPhase;t&&e.changeMatchesPhase(t)}),e.category.Matches&&e.category.Matches.length>0)){e.changeMatchesPhase(e.category.Phases[0]);var t=sportUtils.GetCurrentDate().withoutTime(),o=e.category.Matches.findItem(function(e){return e.Date.withoutTime()>=t});if(null!=o){var i=n("date")(o.Date,"dd/MM/yyyy"),s='div[data-date="'+i+'"]',l=0;window.setTimeout(function(){if((l=sportUtils.FocusElement(s))>0){var e=!1,t=new Date;$(window).scroll(function(){if(0==window.scrollY&&!e){(new Date).getTime()-t.getTime()<=2e3&&(e=!0,window.scrollTo(0,l))}})}},200)}}else a(r,100)}contentUtils.InitSportFieldColors(t),contentUtils.InitRegionColors(t),e.getRoundedRectangleClass=sportUtils.getRoundedRectangleClass,e.IsMobileDevice=i.IsMobileDevice,a(r,100),e.getMatchStyle=function(e,t){var n="background-color: "+contentUtils.getSportFieldColor(e.SPORT_ID)+";";return t&&t.length>0&&(n+=" color: "+t+";"),n},e.getScoreStyle=function(e,t,n){if(void 0!==n&&e.PartsData){var a=t,o="A"==a?"B":"A";return e.PartsData["Team"+a][n]<e.PartsData["Team"+o][n]?"font-weight: normal;":"font-weight: bold;"}var i="font-size: 50px; line-height: 40px; margin-bottom: 10px; text-align: center;";return(1!=e.Result&&3!=e.Result||"B"!=t)&&(2!=e.Result&&4!=e.Result||"A"!=t)||(i+=" font-weight: normal;"),i},e.openFullRankingTable=function(){null!=e.category.SelectedMatchesPhase&&null!=e.category.SelectedMatchesGroup&&o.open({templateUrl:"views/ranking-table-dialog.html",controller:"RankingTableDialogCtrl",resolve:{categoryData:function(){return{Category:{Id:e.category.ID,Name:e.category.Name},Phase:{Index:e.category.SelectedMatchesPhase.Index,Name:e.category.SelectedMatchesPhase.Name},Group:{Index:e.category.SelectedMatchesGroup.Index,Name:e.category.SelectedMatchesGroup.Name},RankingTables:e.category.RankingTables||null}}}}).result.then(function(t){e.category.RankingTables=t})},e.changePhase=function(t){e.category.Phases.filter(function(e){return e.Selected}).forEach(function(e){e.Selected=!1}),e.category.setSelectedCompetition(null),e.category.setSelectedTeam(null),t.Selected=!0,e.category.SelectedPhase=t,t.Teams&&(e.category.AllTeams=t.Teams),t.Competitions&&(e.category.AllCompetitions=t.Competitions)},e.changeGroup=function(t){if(t.hasOwnProperty("Index")){var n=t;e.category.SelectedMatchesGroup=n,e.category.SelectedMatchesPhase.AllGroups.forEach(function(e){e.SelectedForMatches=!1}),n.SelectedForMatches=!0,e.category.OnFilteredMatchesChange&&e.category.OnFilteredMatchesChange()}else{var a=parseInt(t);if(!isNaN(a)){var o=e.category.SelectedMatchesGroup.Index,i=o+a;i>=e.category.SelectedMatchesPhase.AllGroups.length&&(i=0),i<0&&(i=e.category.SelectedMatchesPhase.AllGroups.length-1),e.changeGroup(e.category.SelectedMatchesPhase.AllGroups[i])}}},e.changeMatchesPhase=function(t){if(null!=e.category.SelectedMatchesPhase&&e.category.SelectedMatchesPhase&&e.category.SelectedMatchesPhase.Index==t.Index||(e.category.Phases.filter(function(e){return e.SelectedForMatches}).forEach(function(e){e.SelectedForMatches=!1}),e.category.SelectedMatchesGroup=null,e.category.setSelectedCompetition(null),e.category.setSelectedTeam(null),t.SelectedForMatches=!0,e.category.SelectedMatchesPhase=t,e.category.SelectedMatchesPhase.AllGroups&&e.category.SelectedMatchesPhase.AllGroups.length>0&&(e.category.SelectedMatchesPhase.AllGroups.forEach(function(e){e.SelectedForMatches=!1}),e.category.SelectedMatchesGroup=e.category.SelectedMatchesPhase.AllGroups[0],e.category.SelectedMatchesGroup.SelectedForMatches=!0)),t.Rounds=[],e.category.FilteredMatches){var n=e.category.SelectedMatchesGroup?e.category.SelectedMatchesGroup.Index:-1;t.Index<0&&t.Rounds.push({Index:-1,Name:"כל הסיבובים"}),t.Rounds.appendArray(e.category.FilteredMatches.filter(function(e){return(t.Index<0||e.Phase==t.Index)&&(n<0||e.Group==n)}).map(function(e){return e.ROUND_NAME}).distinct().map(function(e,t){return{Index:t,Name:e}})),t.Rounds.length>0&&e.changeMatchesRound(t.Rounds[0])}},e.changeMatchesRound=function(t){function a(e,t,n,a,o){e.Matches.forEach(function(e){e.HideDelayedMessage||(e.IsDelayed=!1)});var i=e.CycleName;if(!e[o]&&t[i])for(var r=n;r<a.length;r++){var s=a[r];if(s.CycleName!=e.CycleName)break;s.Matches.forEach(function(e){e.HideDelayedMessage||(e.IsDelayed=!0,e.OriginalDate=t[i].Date)})}t[i]||(t[i]=e)}e.category.SelectedMatchesPhase.Rounds.filter(function(e){return e.Selected}).forEach(function(e){e.Selected=!1}),t.Selected=!0,e.category.SelectedMatchesRound=t,t.Cycles=[];var o=e.category.SelectedMatchesPhase.Index,i=e.category.SelectedMatchesGroup?e.category.SelectedMatchesGroup.Index:-1;if(e.category.FilteredMatches&&(e.category.FilteredMatches.sort(function(e,t){return e.Date-t.Date}),t.Matches=e.category.FilteredMatches.filter(function(e){return(o<0||e.Phase==o)&&(t.Index<0||e.ROUND_NAME==t.Name)&&(i<0||e.Group==i)}),t.MatchGroups=[],t.Matches.length>0)){t.Matches.sortByProperty("Date");var r=t.Matches.map(function(e){return n("date")(e.Date,"dd/MM/yyyy")}).distinct();t.MatchGroups=r.map(function(e){var a=t.Matches.filter(function(t){return n("date")(t.Date,"dd/MM/yyyy")==e}),o=a[0];return{Date:e,Matches:a,CycleName:o.CYCLE_NAME,GameDetails:o.GameDetails}});var s="",l="";t.MatchGroups.forEach(function(e){var t=e.GameDetails,n=e.CycleName;s.length>0&&s==t&&(e.SameDetails=!0),l.length>0&&l==n&&(e.SameCycle=!0),s=t,l=n});var c={};if(t.Index<0){var u={};t.MatchGroups.forEach(function(e){var t=e.GameDetails.split(", "),n=t.partialJoin("_",[0,1,3]);u[n]||(u[n]=[]),u[n].push(e)});for(var d in u){c={};var p=u[d];p.forEach(function(e,t){a(e,c,t,p,"SameDetails")})}}else t.MatchGroups.forEach(function(e,n){a(e,c,n,t.MatchGroups,"SameCycle")})}},e.getTableSectionTitle=function(){return e.category.selectedTeam&&e.category.selectedTeam.FullReportTables&&e.category.selectedTeam.FullReportTables.length>0?"סיכום קבוצתי מפורט - "+e.category.selectedTeam.Name:e.category.selectedCompetition?"דירוג אישי למקצוע - "+e.category.selectedCompetition.Name:1==e.category.SportType?"טבלת דירוג כללי":"טבלאות"},e.isTeamFullReportTableVisible=function(t){return!e.category.selectedCompetition||t.Caption.indexOf(e.category.selectedCompetition.Name)>=0},e.isGroupVisible=function(t){return!!t.Name&&(1!=e.category.SportType||(!e.category.selectedTeam||e.category.selectedTeam.GroupIndex==t.Index))},e.getCompetitorGrade=function(t){if(!e.category.GradeMapping)return"";var n=t.CellValues[0];return e.category.GradeMapping[n.toString()]||""}}function n(e,t,n){}function a(e,t,n,a){function o(){sportUtils.VerifyUser(t,e,[2]),window.qL_step_finished=!0}function i(){for(var t={},n=0;n<u.length;n++){var a=u[n];sportUtils.AddIfDoesNotExist(t,a.REGION_ID,a.REGION_NAME)}e.data.Regions=[];for(var o in t)e.data.Regions.push({REGION_ID:parseInt(o),REGION_NAME:t[o]});e.data.Regions.sort(function(e,t){return t.REGION_ID-e.REGION_ID}),1==e.data.Regions.length&&e.RegionClicked(e.data.Regions[0]),window.qL_Finish_Now=!0,l()}function r(){for(var t={},n=0;n<e.data.Matches.length;n++){var a=e.data.Matches[n];sportUtils.AddIfDoesNotExist(t,a.PHASE,a.PHASE_NAME)}e.data.Phases=[];for(var o in t){var i=parseInt(o),r=e.data.Matches.filter(function(e){return e.PHASE==i});e.data.Phases.push({Index:parseInt(i),Name:t[o],Matches:r})}e.data.Phases.sort(function(e,t){return t.Index-e.Index}),e.data.Phases.length>0&&e.PhaseClicked(e.data.Phases[0])}function s(){function n(e){for(var t=0;t<u.length;t++){var n=u[t];if(n.PartsData=championshipsUtils.ConvertPartsResult(n.PARTS_RESULT),null!=n.OVERRIDEN_PARTS_RESULT&&(n.PartsData=championshipsUtils.ConvertPartsResult(n.OVERRIDEN_PARTS_RESULT)),null!=n.OVERRIDEN_RESULT&&(n.RESULT=n.OVERRIDEN_RESULT),null==n.RESULT?(n.TEAM_A_SCORE=null,n.TEAM_B_SCORE=null):3==n.RESULT?n.TechnicalWin_A=!0:4==n.RESULT&&(n.TechnicalWin_B=!0),null!=e){var a=n.CHAMPIONSHIP_CATEGORY_ID+"_"+n.match_number;n.UploadedFileUrl=e[a]||null}}i()}e.loading=!0,t.get("/api/sportsman/past-matches").then(function(a){e.loading=!1,u=a.data.slice(0),t.get("/api/common/match-forms").then(function(e){var t={};e.data&&e.data.forEach(function(e){var n=e.CHAMPIONSHIP_CATEGORY_ID+"_"+e.match_number;t[n]=e.ContentPath}),n(t)},function(e){console.log("error loading match forms"),n(null)})},function(t){e.loading=!1,console.log(t),e.error="שגיאה בעת טעינת נתונים"})}function l(){var t=sportUtils.ParseQueryString(),n=t.v;if(n&&parseInt(n)>0){var a=u.findItem(function(e){return e.CHAMPIONSHIP_CATEGORY_ID==n});if(null!=a){var o=e.data.Regions.findItem(function(e){return e.REGION_ID==a.REGION_ID});if(null!=o){e.RegionClicked(o);var i=e.data.SportFields.findItem(function(e){return e.SPORT_ID==a.SPORT_ID});if(null!=i){e.SportFieldClicked(i);var r=e.data.Championships.findItem(function(e){return e.CHAMPIONSHIP_ID==a.CHAMPIONSHIP_ID});null!=r&&(e.ChampionshipClicked(r),e.CategoryClicked(a))}}}}}function c(n,a){1==e.LoggedInUser.role&&t.get("/api/sportsman/data-gateway").then(function(e){var o=e.data+"?ccid="+n.CHAMPIONSHIP_CATEGORY_ID+"&action=set_match_result";o+="&match_number="+n.match_number,3==a?o+="&technical_A=1":4==a&&(o+="&technical_B=1"),t.get(o).then(function(e){if(!e.data||!e.data.Message||"OK"!=e.data.Message){var t=e.data.Error||"failed to set result in sportsman";console.log(t)}},function(e){console.log("error while setting result in sportsman")})})}var u=[],d=0;e.Unauthorized=!1,e.selected={Region:null,SportField:null,Championship:null,Category:null},e.data={Regions:[],Categories:[],Championships:[],SportFields:[],Matches:[],Phases:[]},e.MobileStyle=sportUtils.MobileStyle,window.qL_steps_amount=2,ChainFactory.Execute(o,s),contentUtils.InitSportFieldColors(t),contentUtils.InitRegionColors(t),e.getSportFieldColor=contentUtils.getSportFieldColor,e.getRegionColor=contentUtils.getRegionColor,e.getRoundedRectangleClass=sportUtils.getRoundedRectangleClass,e.getSportFieldStyle=function(e){var t=contentUtils.getSportFieldColor(e);return"background-color: "+t+"; border-color: "+t+";"},e.getMatchStyle=function(e,t){var n="background-color: "+contentUtils.getSportFieldColor(e.SPORT_ID)+";";return t&&t.length>0&&(n+=" color: "+t+";"),n},e.getRegionFilterStyle=function(e){var t=contentUtils.getRegionColor(e.REGION_ID);return sportUtils.getRoundedRectangleStyle(e,t)},e.getSportFieldFilterStyle=function(e){var t=e.SPORT_ID,n=contentUtils.getSportFieldColor(t),a=sportUtils.getRoundedRectangleStyle(e,n);return e.SportWordCount&&e.SportWordCount>2&&(a+=" line-height: inherit;"),a},e.getScoreStyle=function(t,n,a){if(t.PartsData){var o=n,i="A"==o?"B":"A",r=t.PartsData["Team"+o][a],s=t.PartsData["Team"+i][a],l=[];return l.push(r<s?"font-weight: normal;":"font-weight: bold;"),e.HasPendingPartScore(t)&&l.push("border: 1px dashed black;"),l.join(" ")}return""},e.$watch("Unauthorized",function(e){1==e&&window.setTimeout(function(){championshipsUtils.BindDummyLogin(),$("#txtDummyUserName").focus()},500)}),e.totalChampionshipsCount=function(){return u.length},e.CategoryClicked=function(n){if(!n||!e.selected.Category||e.selected.Category.CHAMPIONSHIP_CATEGORY_ID!=n.CHAMPIONSHIP_CATEGORY_ID)if(e.selected.Category=n,championshipsUtils.InitTeamNamesHeightTimer(),e.data.Categories.forEach(function(e){e.Selected=!!n&&e.CHAMPIONSHIP_CATEGORY_ID==n.CHAMPIONSHIP_CATEGORY_ID}),null!=n&&null!=e.selected.Region&&null!=e.selected.SportField&&null!=e.selected.Championship){var a=e.selected.Region.REGION_ID,o=e.selected.SportField.SPORT_ID,i=e.selected.Championship.CHAMPIONSHIP_ID;if(e.data.Matches=championshipsUtils.ExtractDistinctMatches(u.filter(function(e){return e.REGION_ID==a&&e.SPORT_ID==o&&e.CHAMPIONSHIP_ID==i&&e.CHAMPIONSHIP_CATEGORY_ID==n.CHAMPIONSHIP_CATEGORY_ID})),r(),championshipsUtils.InitPhaseVisibility(),!n.TechnicalRule&&!n.TechnicalRuleLoading){var s="/api/sportsman/data-gateway";n.TechnicalRuleLoading=!0,t.get(s).then(function(e){s=e.data,s+="?ccid="+n.CHAMPIONSHIP_CATEGORY_ID+"&technical=1",t.get(s).then(function(e){n.TechnicalRuleLoading=!1,null!=e.data.Winner?n.TechnicalRule=sportUtils.shallowCopy(e.data):n.TechnicalRule={}},function(e){n.TechnicalRuleLoading=!1})})}}else e.data.Matches=[]},e.ChampionshipClicked=function(t){if(!t||!e.selected.Championship||e.selected.Championship.CHAMPIONSHIP_ID!=t.CHAMPIONSHIP_ID)if(e.CategoryClicked(null),e.selected.Championship=t,e.data.Championships.forEach(function(e){e.Selected=!!t&&e.CHAMPIONSHIP_ID==t.CHAMPIONSHIP_ID}),null!=t&&null!=e.selected.Region&&null!=e.selected.SportField){var n=e.selected.Region.REGION_ID,a=e.selected.SportField.SPORT_ID;e.data.Categories=championshipsUtils.ExtractDistinctMatches(u.filter(function(e){return e.REGION_ID==n&&e.SPORT_ID==a&&e.CHAMPIONSHIP_ID==t.CHAMPIONSHIP_ID}),["CHAMPIONSHIP_CATEGORY_ID"]),e.data.Categories.forEach(function(e){e.Selected=!1}),1==e.data.Categories.length&&e.CategoryClicked(e.data.Categories[0])}else e.data.Categories=[]},e.SportFieldClicked=function(t){if(!t||!e.selected.SportField||e.selected.SportField.SPORT_ID!=t.SPORT_ID)if(e.ChampionshipClicked(null),e.selected.SportField=t,e.data.SportFields.forEach(function(e){e.Selected=!!t&&e.SPORT_ID==t.SPORT_ID}),null!=t&&null!=e.selected.Region){var n=e.selected.Region.REGION_ID;e.data.Championships=championshipsUtils.ExtractDistinctMatches(u.filter(function(e){return e.REGION_ID==n&&e.SPORT_ID==t.SPORT_ID}),["CHAMPIONSHIP_ID"]),e.data.Championships.forEach(function(e){e.Selected=!1}),1==e.data.Championships.length&&e.ChampionshipClicked(e.data.Championships[0])}else e.data.Championships=[]},e.RegionClicked=function(t){t&&e.selected.Region&&e.selected.Region.REGION_ID==t.REGION_ID||(e.SportFieldClicked(null),e.selected.Region=t,e.data.Regions.forEach(function(e){e.Selected=!!t&&e.REGION_ID==t.REGION_ID}),null!=t?(e.data.SportFields=championshipsUtils.ExtractDistinctMatches(u.filter(function(e){return e.REGION_ID==t.REGION_ID}),["SPORT_ID"]),e.data.SportFields.forEach(function(e){e.Selected=!1}),1==e.data.SportFields.length&&e.SportFieldClicked(e.data.SportFields[0])):e.data.SportFields=[])},e.HasPendingScore=function(e){return championshipsUtils.HasPendingScore(e)},e.HasPendingPartScore=function(e){return championshipsUtils.HasPendingPartScore(e)},e.getEditIconStyle=function(e){var t="font-size: 60px; margin-top: 10px;",n="";return null!=e.OVERRIDEN_TEAM_A_SCORE&&null!=e.OVERRIDEN_TEAM_B_SCORE&&(n=1!=e.OverridenScoreApproved?"#ED0013":"#00ADEE"),n.length>0&&(t+=" color: "+n+";"),t},e.getPhaseRowStyle=function(e){var t="margin-bottom: 10px;",n="";return e.Expanded&&(n="#5bc0de"),n.length>0&&(t+=" background-color: "+n+";"),t},e.getTeamScoreClass=function(t,n){var a=e.HasPendingScore(t);if(a||null!=t.TEAM_A_SCORE&&null!=t.TEAM_A_SCORE){var o=["team-score","label","label-info"];if(a)o.push("pending-score");else{var i=t.TEAM_A_SCORE,r=t.TEAM_B_SCORE;if(i!=r){var s=i>r?"A":"B";o.push(n==s?"winner-team":"loser-team")}}return o.join(" ")}return""},e.editScore=function(n){d&&window.clearInterval(d),d=window.setInterval(function(){window.match_uploaded_file&&(n.UploadedFileUrl="NULL"==window.match_uploaded_file?null:window.match_uploaded_file,window.match_uploaded_file=null)},200),a.open({templateUrl:"views/match-results-dialog.html",controller:"MatchResultDialogCtrl",resolve:{match:function(){return sportUtils.shallowCopy(n)},technicalRule:function(){return e.selected.Category.TechnicalRule}}}).result.then(function(e){t.post("/api/sportsman/match-result",{Match:e}).then(function(t){n.ORIGINAL_SCORE_A=t.data.ORIGINAL_SCORE_A,n.ORIGINAL_SCORE_B=t.data.ORIGINAL_SCORE_B,n.OverridenScoreApproved=t.data.OverridenScoreApproved,n.OVERRIDEN_TEAM_A_SCORE=e.OVERRIDEN_TEAM_A_SCORE,n.OVERRIDEN_TEAM_B_SCORE=e.OVERRIDEN_TEAM_B_SCORE,n.TEAM_A_SCORE=n.OVERRIDEN_TEAM_A_SCORE,n.TEAM_B_SCORE=n.OVERRIDEN_TEAM_B_SCORE,n.PartsData=championshipsUtils.ConvertPartsResult(e.OVERRIDEN_PARTS_RESULT),n.RESULT=e.RESULT,3==n.RESULT?n.TechnicalWin_A=!0:4==n.RESULT&&(n.TechnicalWin_B=!0),c(n,e.RESULT)},function(e){console.log(e),alert("שגיאה בעת עדכון תוצאה, נא לנסות שוב מאוחר יותר")})})},e.PhaseClicked=function(e){e.Expanded=!e.Expanded,window["toggle-phase-visibility"]=e.Index},e.approvePendingScore=function(e){t.put("/api/sportsman/pending-score",{Match:e}).then(function(t){e.TEAM_A_SCORE=e.OVERRIDEN_TEAM_A_SCORE,e.TEAM_B_SCORE=e.OVERRIDEN_TEAM_B_SCORE,e.OverridenScoreApproved=1,c(e,e.RESULT)},function(e){console.log(e),alert("שגיאה בעת אישור תוצאה, נא לנסות שוב מאוחר יותר")})},e.rejectPendingScore=function(e){var n="/api/sportsman/pending-score?"+sportUtils.SerializeForQueryString(e,"Match_");t.delete(n).then(function(t){e.OverridenScoreApproved=null,e.OVERRIDEN_TEAM_A_SCORE=null,e.OVERRIDEN_TEAM_B_SCORE=null},function(e){console.log(e),alert("שגיאה בעת מחיקת תוצאה, נא לנסות שוב מאוחר יותר")})}}angular.module("sport.championships").controller("ChampionshipsController",["$scope","$state","$stateParams","$q","$http","$filter","$interval","$timeout","SportService","ChampionshipsService","EventsService","ContentService",e]).controller("ChampionshipCategoryCtrl",["$scope","$http","$filter","$timeout","$uibModal","$rootScope",t]).controller("ChampionshipCategoryFinalsTreeCtrl",["$scope","$http","$filter",n]).controller("EditResultsController",["$scope","$http","$filter","$uibModal",a])}(),function(){"use strict";function e(e,t,n,a){return{read:function(n){void 0===n&&(n={});var o=n.region||null,i=n.omitEmpty||0,r=n.season||0,s=n.school||null;return a.currentSeason(r).then(function(n){var a="/api/sportsman/championships";return a+="?"+t({season:n,region:o,omitEmpty:i,school:s}),e.get(a).then(function(e){for(var t=0;t<e.data.length;t++)e.data[t];return e.data})})},teams:function(n,a,o){function i(e,t){var n=e.findItem(function(e){return e.TEAM_ID==t});if(null!=n){var a=n.NGROUP,o=e.filter(function(e){return e.NGROUP==a});return{TeamA:o[0],TeamB:o[1]}}return null}void 0===o&&(o=0);var r={};null!=a&&a.length>0&&a.forEach(function(e){var t=e.FacilityName,n=e.Date,a=[e.Phase,e.Group,e.TeamA_Id].join("_"),o=[e.Phase,e.Group,e.TeamB_Id].join("_");r[a]||(r[a]=[]),r[o]||(r[o]=[]),r[a].push({Score:e.TeamA_Score,Facility:t,Date:n}),r[o].push({Score:e.TeamB_Score,Facility:t,Date:n})});var s="";if(1==o)return s="/api/sportsman/data-gateway",e.get(s).then(function(t){return s=t.data,s+="?ccid="+n,e.get(s).then(function(e){return{Teams:e.data,Tree:null}})});s="/api/sportsman/category-teams";var l=t({category:n});return s+="?"+l,e.get(s).then(function(e){for(var t=e.data.Tree?e.data.Teams:e.data,n=[],a=0;a<t.length;a++){var o=t[a];n.push(o)}var s=e.data.Tree;if(null!=s&&s){for(var l in s)for(var c=s[l],a=0;a<c.length;a++){var u=c[a],d=[u.PHASE,u.NGROUP,u.TEAM_ID].join("_");u.Matches=r[d],u.Match=null!=u.Matches?u.Matches[0]:null,u.Name=eventsUtils.BuildTeamName(u,null)}var p=s.Finals.slice(0);s.Finals={TeamA:p[0],TeamB:p[1]};var g=s.SemiFinals.slice(0);s.SemiFinals={Group1:i(g,s.Finals.TeamB.TEAM_ID),Group2:i(g,s.Finals.TeamA.TEAM_ID)};var h=s.QuarterFinals.slice(0);s.QuarterFinals={Group1:i(h,s.SemiFinals.Group1.TeamA.TEAM_ID),Group2:i(h,s.SemiFinals.Group1.TeamB.TEAM_ID),Group3:i(h,s.SemiFinals.Group2.TeamA.TEAM_ID),Group4:i(h,s.SemiFinals.Group2.TeamB.TEAM_ID)}}return{Teams:n,Tree:s}})},selectedPhase:function(n){var a="/api/sportsman/active-phase";return a+="?"+t({category:n}),e.get(a).then(function(e){return e.data.ActivePhase})}}}angular.module("sport.events").factory("ChampionshipsService",["$http","$httpParamSerializer","$filter","SportService",e])}();var championshipsUtils={_dummyLoginTimer:0,_phaseVisibilityTimer:0,_teamNamesHeightTimer:0,convertSportFlowersChampionships:function(e,t){for(var n=[],a=0;a<e.length;a++){var o=e[a],i={CHAMPIONSHIP_CATEGORY_ID:o.Seq,CATEGORY_NAME:o.FacilityName||t("date")(o.DateTime,"dd/MM"),CHAMPIONSHIP_ID:o.EventSeq,CHAMPIONSHIP_NAME:o.EventName,SPORT_ID:sportGlobalSettings.FlowersFieldSeq,IS_CLUBS:0,SPORT_NAME:"פרחי ספורט",TotalTeams:1};n.push(i)}return n},ConvertPartsResult:function(e){var t=null;if(null!=e&&e&&e.length>0){var n=[];e.split("|").forEach(function(e){if(e.length>0){var t=e.split("-");if(2==t.length){var a=parseInt(t[0]),o=parseInt(t[1]);!isNaN(a)&&a>=0&&!isNaN(o)&&o>=0&&n.push({TeamA:a,TeamB:o})}}}),n.length>0&&(t={TeamA:n.map(function(e){return e.TeamA}),TeamB:n.map(function(e){return e.TeamB})})}return t},CreatePartsResult:function(e){var t=null;return null!=e&&e.length>0&&(t=e.map(function(e){return null!=e.ScoreA&&null!=e.ScoreB?[e.ScoreA,e.ScoreB].join("-"):""}).filter(function(e){return e.length>0}).join("|")),t},HasPendingScore:function(e){return null!=e.OVERRIDEN_TEAM_A_SCORE&&null!=e.OVERRIDEN_TEAM_B_SCORE&&1!=e.OverridenScoreApproved},HasPendingPartScore:function(e){return null!=e.OVERRIDEN_PARTS_RESULT&&1!=e.OverridenScoreApproved},actualTeamsFilter:function(e){var t=e.Name;return t.indexOf("מנצחת משחק")<0&&t.indexOf("מפסידת משחק")<0&&t.indexOf(" מיקום ")<0},ExtractTreeMatches:function(e){function t(e,t,n){return!(!e||!t)&&(n.push({TeamA_Id:e.TEAM_ID,TeamB_Id:t.TEAM_ID,PhaseIndex:e.PHASE}),!0)}var n=[];for(var a in e){var o=e[a];if(!t(o.TeamA,o.TeamB,n))for(var i in o){var r=o[i];t(r.TeamA,r.TeamB,n)}}return n},ApplyFinalsTree:function(e,t,n){if(e&&t&&0!=t.length&&n&&0!=n.length){var a=n.SplitByProperty("Phase"),o=championshipsUtils.ExtractTreeMatches(e),i={};o.forEach(function(e){var t=[e.PhaseIndex,e.TeamA_Id,e.TeamB_Id].join("_");i[t]=!0});var r=sportUtils.ParseQueryString();"1"!=r.English&&"1"!=r.english&&t.forEach(function(e){if(e.Index>=0){var t=a[e.Index.toString()],n=t.filter(function(e){var t=[e.Phase,e.TeamA_Id,e.TeamB_Id].join("_"),n=[e.Phase,e.TeamB_Id,e.TeamA_Id].join("_");return i[t]||i[n]});n.length>0&&(n.length==t.length?e.Hidden=!0:e.Name="משחקי מבחן")}})}},ExtractDistinctMatches:function(e,t){void 0!==t&&null!=t&&0!=t.length||(t=["CHAMPIONSHIP_CATEGORY_ID","PHASE","NGROUP","ROUND","MATCH","CYCLE"]);var n=[],a={};return e.forEach(function(e){var o=t.map(function(t){return e[t]}).join("_");a[o]||(n.push(sportUtils.shallowCopy(e)),a[o]=!0)}),n},BindDummyLogin:function(){sportUtils.AttachAutoClick(),$("#txtDummyUserName").bind("change",function(){$("#username").val($(this).val()),$("#username").trigger("change")}),$("#txtDummyPassword").bind("change",function(){$("#password").val($(this).val()),$("#password").trigger("change")}),$("#btnDummyLogin").bind("click",function(){$("#btnLogin").trigger("click")}),championshipsUtils._dummyLoginTimer&&window.clearInterval(championshipsUtils._dummyLoginTimer);var e=$("#pnlLoginError");championshipsUtils._dummyLoginTimer=window.setInterval(function(){var t=$.trim($("#loginErrorPanel").text());e.text(t),t.length>0?e.show():e.hide()},100)},InitPhaseVisibility:function(){championshipsUtils._phaseVisibilityTimer&&window.clearInterval(championshipsUtils._phaseVisibilityTimer),championshipsUtils._phaseVisibilityTimer=window.setInterval(function(){var e=window["toggle-phase-visibility"];if(null!=e){window["toggle-phase-visibility"]=null;var t=$('.phase-contents[data-phase-index="'+e+'"]');if(1==t.length){t.is(":visible")?t.hide("slow"):t.show("slow")}}},100)},InitTeamNamesHeightTimer:function(){championshipsUtils._teamNamesHeightTimer&&window.clearInterval(championshipsUtils._teamNamesHeightTimer),championshipsUtils._teamNamesHeightTimer=window.setInterval(function(){var e=$(".match-row");e.length>0&&e.each(function(){var e=$(this),t=e.find(".team_name");if(2==t.length){var n=t.eq(0),a=t.eq(1),o=n.height(),i=a.height();if(o!=i){var r=Math.max(o,i);(r==o?a:n).css("height",r+"px")}}})},200)}};!function(){"use strict";function e(e,t,n,a,o,i,r,s,l){function c(t,n){if(null!=e.match.PartsData){var a=e.match.PartsData["Team"+t];if(n>=0&&n<a.length)return a[n]}return null}function u(t,n,a){e.fileUploadError=t,window.setTimeout(function(){n.removeFile(a)},200),o(function(){e.fileUploadError=""},5e3)}function d(e,t){var n=function(){var e=t.type,n=!e||0==e.length,a=!n&&"image"==e.split("/")[0].toLowerCase(),o=!n&&"pdf"==e.split("/")[1].toLowerCase();return a||o?"":"ניתן להעלות קובץ תמונה או PDF בלבד"}();return!(n.length>0)||(u(n,e,t),!1)}function p(){championshipsUtils.HasPendingScore(s)?(e.match.NewScore_A=e.match.OVERRIDEN_TEAM_A_SCORE,e.match.NewScore_B=e.match.OVERRIDEN_TEAM_B_SCORE):(e.match.NewScore_A=e.match.TEAM_A_SCORE,e.match.NewScore_B=e.match.TEAM_B_SCORE)}var g=s.UploadedFileUrl&&s.UploadedFileUrl.length>0,h="/content/Matches/"+[s.CHAMPIONSHIP_CATEGORY_ID,s.match_number,"form"].join("/"),f="ניתן לגרור לכאן טופס ";g&&(f+="חדש "),f+="או ללחוץ להעלאה",e.match=s,e.match.OriginalResult=e.match.RESULT,e.match.OverridenPartScore=null,null!=e.match.PartsData&&(e.match.ShowPartScore=!0),window.setTimeout(function(){var e=sportUtils.IsMobile()?"edTeamA_Score_mobile":"edTeamA_Score",t=sportUtils.IsMobile()?"edTeamB_Score_mobile":"edTeamB_Score";$("#"+e).focus(),sportUtils.IntegerOnlyTextbox(e),sportUtils.IntegerOnlyTextbox(t)},500),t.get("/api/sportsman/data-gateway").then(function(n){var a=n.data+"?ccid="+s.CHAMPIONSHIP_CATEGORY_ID;t.get(a).then(function(t){if(null!=t.data&&null!=t.data.GameStructure&&t.data.GameStructure.PartCount){e.match.OverridenPartScore=[];for(var n=0;n<t.data.GameStructure.PartCount;n++){var a=c("A",n),o=c("B",n);e.match.OverridenPartScore.push({ScoreA:a,OriginalScoreA:a,ScoreB:o,OriginalScoreB:o,IsExtension:!1})}if(t.data.GameStructure.ExtensionCount)for(var n=0;n<t.data.GameStructure.ExtensionCount;n++){var a=c("A",n+t.data.GameStructure.PartCount),o=c("B",n+t.data.GameStructure.PartCount),i={ScoreA:a,OriginalScoreA:a,ScoreB:o,OriginalScoreB:o,IsExtension:!0};0==n&&(i.FirstExtension=!0),e.match.OverridenPartScore.push(i)}}})}),e.dropzoneConfig={options:{paramName:"files",maxFiles:1,url:h,autoProcessQueue:!0,dictDefaultMessage:f,dictRemoveFile:"הסרת טופס",dictCancelUploadConfirmation:"ביטול העלאת קובץ",addRemoveLinks:!0},eventHandlers:{success:function(n,a){e.fileUploadError="",e.fileUploaded=!1;var o=this;if(d(o,n)){var i=h+"/"+n.name,r={Category:e.match.CHAMPIONSHIP_CATEGORY_ID,Match:e.match.match_number,Path:i};t.post("/api/common/match-forms",r).then(function(){e.match.UploadedFileUrl=i,e.fileUploaded=!0,window.match_uploaded_file=i},function(e){u("שגיאה בעת העלאת קובץ נא לנסות שוב מאוחר יותר",o,n)})}},maxfilesexceeded:function(e){var t=this;window.setTimeout(function(){t.removeFile(e)},200)},removedfile:function(e){console.log("file removed: "+e.name),window.match_uploaded_file="NULL"}}},p(),e.getPartScoreStyle=function(e){return e.FirstExtension?"margin-bottom: 10px;":""},e.getFileUploadIconStyle=function(){var t="font-size: 70px; margin-top: 20px;";return e.fileUploaded&&(t+=" color: green; margin-top: -10px;"),t},e.isConfirmDisabled=function(){if(null!=e.match.OverridenPartScore){if(null!=e.match.OverridenPartScore.findItem(function(e){return e.OriginalScoreA!=e.ScoreA||e.OriginalScoreB!=e.ScoreB}))return!1}if(e.match.OriginalResult==e.match.RESULT){if(null==e.match.NewScore_A||""==e.match.NewScore_A)return!0;if(null==e.match.NewScore_B||""==e.match.NewScore_B)return!0;if(e.match.NewScore_A==e.match.TEAM_A_SCORE&&e.match.NewScore_B==e.match.TEAM_B_SCORE)return!0}return!1},e.TechnicalWinChanged=function(t){if(e.match["TechnicalWin_"+t]){var n="A"==t?"B":"A";e.match["TechnicalWin_"+n]=!1,null!=l&&null!=l.Winner&&(e.match["NewScore_"+t]=l.Winner,e.match["NewScore_"+n]=l.Loser)}else p();e.match.TechnicalWin_A?e.match.RESULT=3:e.match.TechnicalWin_B?e.match.RESULT=4:e.match.RESULT=null},e.deleteMatchForm=function(){r.ask("האם למחוק את טופס המשחק?").then(function(){var n="/api/common/match-forms?category="+e.match.CHAMPIONSHIP_CATEGORY_ID+"&match="+e.match.match_number;t.delete(n).then(function(t){e.match.UploadedFileUrl=null,window.match_uploaded_file="NULL"},function(e){
alert("שגיאה בעת מחיקת טופס משחק מהמערכת, נא לנסות שוב מאוחר יותר"),console.log("error deleting match form"),console.log(e)})})},e.clearPartsData=function(){e.match.OverridenPartScore&&e.match.OverridenPartScore.forEach(function(e){e.ScoreA=null,e.ScoreB=null})},e.cancel=function(){n.dismiss("cancel")},e.confirm=function(){e.match.OVERRIDEN_TEAM_A_SCORE=e.match.NewScore_A,e.match.OVERRIDEN_TEAM_B_SCORE=e.match.NewScore_B,e.match.OVERRIDEN_PARTS_RESULT=championshipsUtils.CreatePartsResult(e.match.OverridenPartScore),n.close(e.match)}}angular.module("sport").controller("MatchResultDialogCtrl",["$scope","$http","$uibModalInstance","$filter","$timeout","$q","messageBox","match","technicalRule",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s){function l(){return null==e.data.AllTables?void(e.error="לא קיימים נתונים עבור אליפות זו"):s.Phase.Index>=e.data.AllTables.length?void(e.error="אין נתוני דירוג עבור שלב אליפות נבחר"):(e.data.RankingTable=e.data.AllTables[s.Phase.Index],e.data.RankingTable.GroupRows=[],e.data.RankingTable.Rows&&(e.data.RankingTable.GroupRows=e.data.RankingTable.Rows.filter(function(e){return e.GroupName==s.Group.Name}),e.data.RankingTable.GroupRows.sortByProperty("Position")),void window.setTimeout(function(){var e=$(".modal-content");if(e.length>0){var t=$("#tblRanking").width(),n=e.width();if(t>n){var a=Math.floor((t-n)/2);e.css("width",t+50+"px"),e.css("left",a+"px")}}},500))}e.data={FullCaption:s.Category.Name+", "+s.Phase.Name+", "+s.Group.Name,AllTables:s.RankingTables,RankingTable:null},null==e.data.AllTables?(console.log("reading from server..."),e.loading=!0,t.get("/api/sportsman/data-gateway").then(function(n){var a=n.data;a+="?ccid="+s.Category.Id,t.get(a).then(function(t){e.loading=!1,e.data.AllTables=t.data.RankingTables,l()})},function(t){e.loading=!1,e.error="שגיאה בעת טעינת נתונים מהשרת, נא לנסות שוב מאוחר יותר"})):l(),window.setInterval(function(){var e=$("#lbDots");if(e.parents("div").first().is(":visible")){var t=e.text().length;++t>3&&(t=1);var n=Array(t+1).join(".");e.text(n)}},1e3),e.close=function(){n.close(e.data.AllTables)}}angular.module("sport").controller("RankingTableDialogCtrl",["$scope","$http","$uibModalInstance","$filter","$timeout","$q","messageBox","categoryData",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s){function l(){n.get("/api/school-club/team-orders").then(function(t){e.school.OrdersBasket=t.data,e.school.OrdersBasket.forEach(function(e,t){e.Index=t+1})},function(e){console.log("error getting orders basket")})}function c(){var t=e.loggedUser.SchoolSymbol;n.get("/api/sportsman/school-data?symbol="+t).then(function(t){e.isClubSchool=1==t.data.CLUB_STATUS}),t&&registerUtils.buildSchoolName(n,t).then(function(t){e.loggedUser.SchoolName=t},function(e){console.log("error reading school name"),console.log(e)})}function u(t){e.data.clubFormTabs.forEach(function(e){e.Index!=t.Index&&(e.Active=!1)}),t.Active=!0,e.data.selectedTab=t}function d(){return e.data.clubFormTabs.findItem(function(e){return 1==e.Active})}function p(e,t,n,a){if(void 0===a&&(a=[]),e.length>0){if(0==n.length){var o={};a.forEach(function(e){o[e]=!0});for(var i in e[0])o[i]||n.push(i)}var r=t;e.forEach(function(e){n.forEach(function(t){e[t+"TabIndex"]=r,r++})})}}function g(t){function n(t){var n=e.school[t.Property],a=!1;switch(t.Type){case"boolean":a=1==n;break;case"not-empty":a=n&&n.toString().length>0}return a}var a=T[t.Index.toString()]||[];if(a.length>0){var o=a.filter(function(e){return 0==n(e)}).map(function(e){return e.Message});if(o.length>0){var i="יש למלא את השדות הבאים: <br />"+o.join("<br />");return s.warn(i,{title:"שדות דרושים חסרים",htmlContents:!0}),!1}}return!0}function h(t){function a(e,t){return t.length>0&&!t.endsWith("_")&&(t+="_"),e.filter(function(e){return e.PropertyName.startsWith(t)})}function o(e,t,n,o,i){function r(e,t){var n=o[e];if(n&&null!=t){if(n.IsBoolean)return"1"==t;if(n.IsArray)return t.split(",");var a=n.Items.findItem(function(e){return e[n.KeyProperty]==t});if(null!=a)return a}return t}void 0!==o&&null!=o||(o={}),"undefined"==i&&(i=!1);var s=a(t,n);0!=s.length&&s.forEach(function(t){var n=t.PropertyName.split("_"),a=n.lastItem(),o=null;if(3==n.length){var s=n[1];e.hasOwnProperty(s)&&(o=e[s])}if(n.length>3&&(a=n.skip(2).join("_")),null==o&&(o=e),a&&(o.hasOwnProperty(a)||i)){var l=t.PropertyValue;o[a]=r(a,l)}})}function i(e,t,n,i,r){void 0===i&&(i={}),"undefined"==r&&(r=!1);var s=a(t,n);e.forEach(function(e,t){var a=e.Id||e.Index;a||(a=t+1),o(e,s,n+"_"+a,i,r)})}function r(e,t,n,a){var o=e[n];o&&(t[a]=o)}void 0===t&&(t=null),n.get("/api/school-club/data").then(function(a){var s=a.data;S=s.slice(0),i(e.data.coachesData,s,"Coach",{AuthorizationLevel:{Items:e.data.authorizationLevels,KeyProperty:"Id"},PassedCoachTraining:{Items:e.data.yesNoOptions,KeyProperty:"Id"}}),o(e.school,s,"School",{IsAssociation:{IsBoolean:!0},IsAssociationConfirmed:{IsBoolean:!0},HasConfirmedClubTerms:{IsBoolean:!0},HasConfirmedFacilityTerms:{IsBoolean:!0}},!0),i(e.data.managementBoardMembers,s,"ManagementBoardMember",{},!0),i(e.data.hostingDays,s,"HostingDay",{},!0),e.data.hostingDays.forEach(function(e){e.Categories.forEach(function(t){r(e,t,"Category_"+t.Index+"_Name","Name"),r(e,t,"Category_"+t.Index+"_Weekday","Weekday"),r(e,t,"Category_"+t.Index+"_HostingHour","HostingHour")})}),n.get("/api/common/school-user-data").then(function(a){var o=sportUtils.shallowCopy(a.data);n.get("/api/common/club-facility-data").then(function(n){var a=n.data.filter(function(e){return e.REGION_ID==o.REGION_ID});e.data.facilitySportFields=sportUtils.DistinctArray(a,"SportFieldSeq").map(function(e){return{Id:e.SportFieldSeq,Name:e.SportFieldName}}),i(e.data.facilitySportFields,S,"FacilitySportField",{},!0),p(e.data.facilitySportFields,3,["Address","Contact","HostingHours"]),null!=t&&t("SUCCESS")},function(e){console.log("error reading facility data"),null!=t&&t("ERROR")})},function(e){console.log("error reading school data"),null!=t&&t("ERROR")})},function(e){console.log("error reading school club data"),null!=t&&t("ERROR")})}function f(){var t="/api/sportsman/school/"+e.loggedUser.SchoolSymbol+"/personnel";n.get(t).then(function(t){var n=t.data,a={ManagerEmail:"SCHOOL_EMAIL",ManagerName:"SCHOOL_MANAGER_NAME",FaxNumber:"SCHOOL_FAX",PhoneNumber:"SCHOOL_PHONE",ChairmanAddress:"CHAIRMAN_ADDRESS",ChairmanName:"CHAIRMAN_NAME",ChairmanZipCode:"CHAIRMAN_ZIP_CODE",ChairmanCity:"CHAIRMAN_CITY_NAME",ChairmanFax:"CHAIRMAN_FAX",ChairmanPhoneNumber:"CHAIRMAN_PHONE",CoordinatorAddress:"COORDINATOR_ADDRESS",CoordinatorName:"COORDINATOR_NAME",CoordinatorZipCode:"COORDINATOR_ZIP_CODE",CoordinatorCity:"COORDINATOR_CITY_NAME",CoordinatorCellPhone:"COORDINATOR_CELL_PHONE",CoordinatorPhoneNumber:"COORDINATOR_PHONE",CoordinatorFax:"COORDINATOR_FAX",CoordinatorEmailAddress:"COORDINATOR_EMAIL"};for(var o in a){var i=e.school[o];void 0!==i&&null!=i&&0!=i.toString().length||(e.school[o]=n[a[o]])}},function(e){console.log("error reading school personnel")})}function m(e,t,a,o,i){void 0===a&&(a=[]),void 0===o&&(o=null),void 0===i&&(i=null),a.findIndex(function(e){return"Id"==e})<0&&a.push("Id"),a.findIndex(function(e){return"Index"==e})<0&&a.push("Index"),t.length>0&&!t.endsWith("_")&&(t+="_");var r={Data:e,Prefix:t,Excluded:a};n.post("/api/school-club/data",r).then(function(e){null!=o&&o(e)},function(e){null!=i&&i(e)})}function v(e,t,n,a,o,i){if(a>=e.length)return void o();var r=e[a],s=r.Id||r.Index;if(s){m(r,t+"_"+s+"_",n,function(){v(e,t,n,a+1,o,i)},function(e){null!=i&&i(e)})}else i("no id found for item in index "+a)}var S=null,y=["ראשונה","שנייה","שלישית","רביעית","חמישית","שישית","שביעית","שמינית","תשיעית","עשירית"],C={1:"padding: 5px 5px 5px 5px;",2:""},I={1:"background-color: #00ADEE;",2:"color: white;"},T={1:[{Property:"HasConfirmedClubTerms",Type:"boolean",Message:"אישור קריאת התחייבות"}],4:[{Property:"HasConfirmedFacilityTerms",Type:"boolean",Message:"אישור קריאת התחייבות"}]};e.loggedUser=null,e.hasConfirmedFinalSubmission=!1,e.data={selectedTab:null,authorizationLevels:registerUtils.sharedClubData.authorizationLevels,yesNoOptions:registerUtils.sharedClubData.yesNoOptions,clubFormTabs:[{Index:1,Caption:'פרטי ביה"ס'},{Index:2,Caption:"רישום קבוצות",NoData:!0},{Index:3,Caption:"דמי רישום"},{Index:4,Caption:"מתקני פעילות"},{Index:5,Caption:"חברי הנהלת מועדון"},{Index:6,Caption:"נתוני מאמנים"}],facilitySportFields:[],hebrewWeekDays:[{Index:1,Name:"א'"},{Index:2,Name:"ב'"},{Index:3,Name:"ג'"},{Index:4,Name:"ד'"},{Index:5,Name:"ה'"}],managementBoardMembers:[{Id:1,Caption:'יו"ר'},{Id:2,Caption:'סגן יו"ר'},{Id:3,Caption:"רכז מועדון"},{Id:4,Caption:"חבר"},{Id:5,Caption:"חבר"},{Id:6,Caption:"חבר"}],hostingDays:[{Id:1,SportField:"כדורעף",Categories:[{Index:1,Name:"",Weekday:"",HostingHour:""},{Index:2,Name:"",Weekday:"",HostingHour:""},{Index:3,Name:"",Weekday:"",HostingHour:""},{Index:4,Name:"",Weekday:"",HostingHour:""},{Index:5,Name:"",Weekday:"",HostingHour:""},{Index:6,Name:"",Weekday:"",HostingHour:""}]},{Id:2,SportField:"כדוריד",Categories:[{Index:1,Name:"",Weekday:"",HostingHour:""},{Index:2,Name:"",Weekday:"",HostingHour:""}]},{Id:3,SportField:"כדורגל",Categories:[{Index:1,Name:"",Weekday:"",HostingHour:""}]},{Id:4,SportField:"כדורסל",Categories:[{Index:1,Name:"",Weekday:"",HostingHour:""}]},{Id:5,SportField:"טניס שולחן",Categories:[{Index:1,Name:"",Weekday:"",HostingHour:""}]},{Id:6,SportField:"בדמינטון",Categories:[{Index:1,Name:"",Weekday:"",HostingHour:""}]}],coachesData:[]},e.school={OrdersBasket:[],Cheque:{}},l(),e.data.clubFormTabs.length>0&&u(e.data.clubFormTabs[0]);for(var w=0;w<=6;w++)e.data.coachesData.push({Id:w+1,SportField:"",Name:"",IdNumber:"",AgeRange:"",Gender:"",AuthorizationLevel:null,PassedCoachTraining:null,Cellular:"",Address:"",Email:""});if(p(e.data.managementBoardMembers,1,["Name","Role"]),p(e.data.coachesData,1,[],["Id"]),e.data.hostingDays.length>0){var _=1;e.data.hostingDays.forEach(function(e){p(e.Categories,_,["Name","Weekday","HostingHour"]),_+=3*e.Categories.length,e.Categories.forEach(function(t){t.NamePlaceholder="קטגוריית "+e.SportField,e.Categories.length>1&&(t.NamePlaceholder+=" "+y[t.Index-1]),t.WeekdayPlaceholder="יום פעילות עבור ",t.HostingHoursPlaceholder="שעות אירוח עבור ",e.Categories.length>1?(t.WeekdayPlaceholder+=t.NamePlaceholder,t.HostingHoursPlaceholder+=t.NamePlaceholder):(t.WeekdayPlaceholder+=e.SportField,t.HostingHoursPlaceholder+=e.SportField)})})}i(function(){"1"==window.reload_orders_basket&&(console.log("reloading orders basket due to trigger..."),window.reload_orders_basket=null,l())},1e3),n.get("/api/login").then(function(n){n&&n.data&&null!=n.data&&(e.loggedUser={Seq:n.data.seq,Login:n.data.name,DisplayName:n.data.displayName,Role:n.data.role,SchoolSymbol:n.data.schoolSymbol},n.data.isClubUser?(c(),h(function(){f()})):t.go("register"))},function(e){console.log("error getting logged in user"),console.log(e)}),o(function(){window.qL_Finish_Now=!0},1e3),i(function(){$("form").each(function(){var t=$(this);if("1"==t.data("is-dirty")){var n=parseInt(t.data("tab-index"));if(!isNaN(n)&&n>0){var a=e.data.clubFormTabs.findItem(function(e){return e.Index==n});null!=a&&(a.IsDirty=!0)}}})},500),e.getFormTabStyle=function(e,t){var n=C[t.toString()];return e.Active&&(n+=" "+I[t.toString()]),n},e.tabClicked=function(t){var n=d();if(null==n)return void u(t);n.Index!=t.Index&&g(n)&&e.saveTab(n,function(){u(t)})},e.getAuthorizationLevelClass=function(e,t){return e.AuthorizationLevel&&e.AuthorizationLevel.Id==t.Id?"fa fa-check":"fa fa-circle-o"},e.getPassedCoachTrainingClass=function(e,t){return e.PassedCoachTraining&&e.PassedCoachTraining.Id==t.Id?"fa fa-check":"fa fa-circle-o"},e.getAssociationClass=function(){return e.school.IsAssociation?"fa fa-check-square-o":"fa fa-square-o"},e.authorizationLevelClicked=function(e,t){t.AuthorizationLevel=e},e.passedCoachTrainingClicked=function(e,t){t.PassedCoachTraining=e},e.associationClicked=function(){e.school.IsAssociation=!e.school.IsAssociation},e.getAssociationConfirmedClass=function(){return e.school.IsAssociationConfirmed?"fa fa-check-square-o":"fa fa-square-o"},e.associationConfirmedClicked=function(){e.school.IsAssociationConfirmed=!e.school.IsAssociationConfirmed},e.getHasConfirmedClubTermsClass=function(){return e.school.HasConfirmedClubTerms?"fa fa-check-square-o":"fa fa-square-o"},e.getHasConfirmedFacilityTermsClass=function(){return e.school.HasConfirmedFacilityTerms?"fa fa-check-square-o":"fa fa-square-o"},e.getFacilitySportWeekdayClass=function(e,t){return e.Days&&e.Days.indexOf(t.Index)>=0?"fa fa-check-square-o":"fa fa-square-o"},e.getHasConfirmedFinalSubmissionClass=function(){return e.hasConfirmedFinalSubmission?"fa fa-check-square-o":"fa fa-square-o"},e.hasConfirmedClubTermsClicked=function(){e.school.HasConfirmedClubTerms=!e.school.HasConfirmedClubTerms},e.hasConfirmedFacilityTermsClicked=function(){e.school.HasConfirmedFacilityTerms=!e.school.HasConfirmedFacilityTerms},e.hasConfirmedFinalSubmissionClicked=function(){e.hasConfirmedFinalSubmission=!e.hasConfirmedFinalSubmission},e.facilitySportWeekdayClicked=function(e,t){e.Days||(e.Days=[]);var n=e.Days.indexOf(t.Index);n>=0?e.Days.removeItem(t.Index,n):e.Days.push(t.Index)},e.ParseChequeSum=function(){var t=e.school.Cheque.Sum;return t&&t.length>0?sportUtils.ParseHebrewCurrency(t):""},e.focusFacilityField=function(e,t){$(".facility-"+t+'[data-sportfield-id="'+e.Id+'"]').find("input").focus()},e.addTeam=function(){var t=e.school.OrdersBasket.map(function(e){return e.CHAMPIONSHIP_CATEGORY_ID});r.open({templateUrl:"views/championship-selection.html",controller:"ChampionshipSelectionCtrl",resolve:{schoolData:function(){return{Name:e.loggedUser.SchoolName,Symbol:e.loggedUser.SchoolSymbol,ClubsOnly:!0,NoConfirmation:!0,ExcludedCategories:t}},sportField:function(){return null},allSeasons:function(){return null},allRegions:function(){return null},options:function(){return{show_championship_remarks:!0}}}}).result.then(function(e){var t={Category:e.Category.CategoryId,Amount:e.Amount};n.put("/api/school-club/team-order",t).then(function(e){l()},function(e){console.log("error posting new order")})})},e.coachIdNumberChanged=function(t){var n=t.IdNumber?parseInt(t.IdNumber):0;if(!isNaN(n)&&n>0){var a=e.data.coachesData.findItem(function(e){return e.Id!=t.Id&&e.IdNumber&&parseInt(e.IdNumber)==n});if(null!=a)for(var o in a)if("Id"!=o&&"IdNumber"!=o){var i=a[o];null!=i&&""!=i&&(t[o]=i)}}},e.deleteTeamOrder=function(e){s.ask("האם למחוק הזמנה זו?").then(function(){n.delete("/api/school-club/team-order?category="+e.CHAMPIONSHIP_CATEGORY_ID).then(function(){l()},function(e){console.log(e),alert("שגיאה בעת מחיקת קבוצה, נא לנסות מאוחר יותר")})})},e.editTeamOrder=function(t){var a=e.school.OrdersBasket.map(function(e){return e.CHAMPIONSHIP_CATEGORY_ID}),o=a.filter(function(e){return e!=t.CHAMPIONSHIP_CATEGORY_ID});r.open({templateUrl:"views/championship-selection.html",controller:"ChampionshipSelectionCtrl",resolve:{schoolData:function(){return{Name:e.loggedUser.SchoolName,Symbol:e.loggedUser.SchoolSymbol,ClubsOnly:!0,NoConfirmation:!0,ExcludedCategories:o}},sportField:function(){return null},allSeasons:function(){return null},allRegions:function(){return null},options:function(){return{category:t.CHAMPIONSHIP_CATEGORY_ID,amount:t.Amount,show_championship_remarks:!0}}}}).result.then(function(e){var a={OldCategory:t.CHAMPIONSHIP_CATEGORY_ID,NewCategory:e.Category.CategoryId,Amount:e.Amount};n.post("/api/school-club/team-order",a).then(function(e){l()},function(e){console.log("error updating order"),alert("שגיאה בעת עדכון נתוני קבוצה, נא לנסות שוב מאוחר יותר")})})},e.saveTab=function(t,n){if(void 0!==t&&null!=t||(t=d()),void 0===n&&(n=null),null==t)return console.log("no active tab"),void(null!=n&&n());console.log("saving tab "+t.Index+"...");var a=null,i=null,r="",s=[];switch(t.Index){case 1:i=e.school,r="School_Data",s.push("OrdersBasket"),s.push("Cheque"),s.push("HasConfirmedFacilityTerms");break;case 3:i=e.school.Cheque,r="School_Cheque";break;case 4:a=e.data.facilitySportFields,r="FacilitySportField",s.push("Name");break;case 5:a=e.data.managementBoardMembers,r="ManagementBoardMember",s.push("Caption");break;case 6:a=e.data.coachesData,r="Coach"}var l=function(){4==t.Index&&m({HasConfirmedFacilityTerms:e.school.HasConfirmedFacilityTerms},"School_Facility",[],null,null),t.SaveInProgress=!1,t.SavedSuccessfully=!0,t.IsDirty=!1,null!=n&&n("success"),o(function(){t.SavedSuccessfully=!1},5e3)},c=function(){t.SaveInProgress=!1,t.SaveFailed=!0,null!=n&&n("error"),o(function(){t.SaveFailed=!1},5e3)};null!=a?(t.SaveInProgress=!0,v(a,r,s,0,l,c)):null!=i?(t.SaveInProgress=!0,m(i,r,s,l,c)):null!=n&&n()},e.saveAndMove=function(){var t=d();null!=t&&(6==t.Index?e.hasConfirmedFinalSubmission||s.warn("נא לאשר שליחת נתונים ורישום קבוצות",{title:"הדפסת טופס רישום"}):e.saveTab(t,function(){var n=t.Index+1,a=e.data.clubFormTabs.findItem(function(e){return e.Index==n});null!=a&&e.tabClicked(a)}))}}function t(e,t,n,a){e.confirm=function(){t.close("OK")}}angular.module("sport.club-register").controller("ClubRegisterController",["$scope","$state","$http","$filter","$timeout","$interval","$uibModal","messageBox",e]).controller("ClubRegisterWelcomeDialogCtrl",["$scope","$uibModalInstance","$sce","school",t])}(),function(){"use strict";function e(e){return{link:function(t,n){var a=n.parents("#items-container").first().find("#slider"),o=n.parents("#items-container").first().find("#carousel"),i=a.find("ul"),r=o.find("ul");e(function(){i.append($("<li>"+n.html()+"</li>"));var e=n.find("img.carousel-image");0==e.length&&(e=n.find("img")),e.length>0?r.append($('<li><img src="'+e.attr("src")+'" alt=""></li>')):r.append($('<li><img src="" alt=""></li>')),n.find(".jackbox").removeAttr("data-group");var t=i.find("li").length;o.css("display",o.data("flexCarouselHidden")||t<=1?"none":"block"),a.removeData("flexslider"),a.flexslider({animation:"slide",controlNav:!1,animationLoop:!1,directionNav:t>1,animationSpeed:1e3,prevText:"",nextText:"",slideshow:!1,sync:"#carousel"})})}}}function t(e){return{template:'<div id="items-container"><div id="slider" class="flexslider">  <ul class="slides">  </ul></div><div id="carousel" class="flexslider">  <ul class="slides">  </ul></div><div id="items" style="display: none;" ng-transclude></div></div>',transclude:!0,link:function(t,n,a){var o=n.find("#slider"),i=n.find("#carousel");null==a.carousel||getBooleanValue(a.carousel)||(i.data("flexCarouselHidden",!0),i.css("display","none")),e(function(){i.flexslider({animation:"slide",controlNav:!1,directionNav:!1,animationLoop:!1,slideshow:!1,prevText:"",nextText:"",itemWidth:100,asNavFor:"#slider"}),o.flexslider({animation:"slide",controlNav:!1,animationLoop:!1,directionNav:!1,animationSpeed:1e3,prevText:"",nextText:"",slideshow:!1,sync:"#carousel"})})}}}angular.module("components").directive("flexItem",["$timeout",e]).directive("flexSlider",["$timeout",t])}(),function(){"use strict";function e(e){return{link:function(t,n){e(function(){for(var e=n.parents("#items-container").first().find(".owl-carousel"),t=n.prev(),a=void 0;t.length>0;){var o=t.data("owlPosition");if(null!=o){a=o+1;break}t=t.prev()}var i=0;for(t=n.next();t.length>0;){var o=t.data("owlPosition");null!=o&&(i=o,void 0===a&&(a=o),t.data("owlPosition",o+1)),t=t.next()}n.data("owlPosition",a||0);var r=n.find(".owl-video").length>0?"item":"item-video";e.owlCarousel("add",$('<div class="'+r+'">'+n.html()+"</div>"),a>i?void 0:a),e.owlCarousel("refresh")}),n.on("$destroy",function(){var e=n.data("owlPosition");if(null!=e){var t=n.parents("#items-container").first().find(".owl-carousel");t.owlCarousel("remove",e),t.owlCarousel("refresh")}})}}}function t(){return{template:'<div id="items-container" class="owl-theme"><div class="owl-carousel"></div><div id="items" style="display: none;" ng-transclude></div></div>',transclude:!0,link:function(e,t,n){var a={rtl:null==n.rtl||getBooleanValue(n.rtl),autoWidth:!0,items:n.items||3,navSpeed:n.navSpeed||800,navigation:!0,nav:null==n.nav||getBooleanValue(n.nav),dots:null!=n.dots&&getBooleanValue(n.dots),margin:null==n.margin?12:n.margin,loop:null==n.loop||getBooleanValue(n.loop),video:null==n.video||getBooleanValue(n.video),navText:null==n.navText?["",""]:getBooleanValue(n.navText),responsive:{0:{items:n.itemsSm||1},481:{items:n.itemsMd||2},980:{items:n.itemsLg||3}}};t.find(".owl-carousel").owlCarousel(a)}}}angular.module("components").directive("owlCarousel",t).directive("owlItem",["$timeout",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s,l){function c(e){if(1==e.Type||5==e.Type){e.Attachments=(e.Data||[]).slice(0),5==e.Type&&(e.Attachments=e.Attachments.filter(function(e){return e.Description&&e.Description.length>0}));for(var t=0;t<e.Attachments.length;t++){var n=e.Attachments[t];n.Index=t,n.DateUploaded&&(n.DateUploaded=new Date(n.DateUploaded)),5==e.Type&&(n.FileType=contentUtils.ParseFileType(n.FileName))}}switch(e.Type){case 2:e.EncodedData=sportUtils.EncodeHTML(e.Data);break;case 3:var a={};contentUtils.TryParseVideo(e.Data,a)?e.VideoUrl=o.trustAsResourceUrl(a.embed):e.VideoUrl="";break;case 6:e.Data.AboutMe&&(e.Data.AboutMe=sportUtils.EncodeHTML(e.Data.AboutMe))}}function u(){window.qL_steps_amount=3,l.read(h).then(function(a){if(window.qL_step_finished=!0,a.Type&&a.Type!=contentUtils.ParsePageType(e.pageType))return"1"==r.get("edit.controller.abort")?(r.remove("edit.controller.abort"),void(window.qL_Finish_Now=!0)):void t.go(contentUtils.ParsePageType(a.Type),{page:h});if(void 0===a.Sections||null==a.Sections)return void t.go("home");for(var o=0;o<a.Sections.length;o++){var i=a.Sections[o];if(c(i),6==i.Type){for(var s=i,l=o-1;l>=0;l--){var u=a.Sections[l];6==u.Type&&(s=u)}s.Contacts||(s.Contacts=[]),i.Data.SectionIndex=i.Index,s.Contacts.push(i.Data)}}for(var o=0;o<a.Sections.length;o++){var i=a.Sections[o];if(6==i.Type&&i.Contacts){i.Contacts.sort(function(e,t){return e.SectionIndex-t.SectionIndex}),i.ContactRows=sportUtils.SplitArray(i.Contacts,2);for(var d=i.ContactRows[i.ContactRows.length-1],p=2-d.length,l=0;l<p;l++)d.push({Name:""})}}window.qL_step_finished=!0,a.Author&&a.Author.AboutMe&&(a.Author.AboutMe=sportUtils.EncodeHTML(a.Author.AboutMe)),e.pageData=a,e.pageData.Seq=h,n.get("/api/common/contacts?type=2&apply=pages").then(function(e){window.qL_step_finished=!0;for(var t=[],n=0;n<e.data.length;n++)t.push(e.data[n]);for(var n=0;n<a.Sections.length;n++){var o=a.Sections[n];if(6==o.Type&&o.ContactRows&&o.ContactRows.length>0)for(var i=0;i<o.ContactRows.length;i++)for(var r=o.ContactRows[i],s=0;s<r.length;s++){var l=r[s];if(l.Picture){var c=l.Picture.Seq,u=t.findItem(function(e){return e.PictureSeq==c});null!=u&&u.PicturePageSeq&&(l.Picture.PageSeq=u.PicturePageSeq)}}}window.qL_Finish_Now=!0}),ChainFactory.Next()},function(e){alert("שגיאה בעת טעינת נתונים מהשרת"),ChainFactory.Next()})}function d(){l.list(null,null).then(function(t){var a=t.filter(function(t){return t.Seq!=e.pageData.Seq&&t.SportFieldSeq==e.pageData.SportFieldSeq&&t.DefaultImageSeq});e.recentPages=a.take(2),contentUtils.InitCroppedImages(n,function(){for(var t=0;t<e.recentPages.length;t++){var n=e.recentPages[t];n.HebrewType=contentUtils.HebrewPageType(n.Type,!1),n.DefaultImagePath=contentUtils.BuildDefaultImagePath(n),contentUtils.BuildCroppedImages(n)}}),ChainFactory.Next()},function(e){console.log("error reading recent pages"),console.log(e),ChainFactory.Next()})}function p(){if("gallery"==e.pageType){e.pageData.GalleryImages=e.pageData.Sections[0].Data.slice(0);for(var t=0;t<e.pageData.GalleryImages.length;t++){e.pageData.GalleryImages[t].Index=t}e.pageData.GalleryImageRows=contentUtils.BuildImageRows(e.pageData.GalleryImages,4),ChainFactory.Next()}else ChainFactory.Next()}function g(){window.setTimeout(function(){sportUtils.InitJackbox()},1e3),ChainFactory.Next()}var h=a.page;e.pageData=null,e.loggedInUser=null,e.pageType=t.current.data.contentType,e.pluralCaption=contentUtils.HebrewPageType(e.pageType,!0),e.singularCaption=contentUtils.HebrewPageType(e.pageType,!1),i.$on("$locationChangeSuccess",function(){i.actualLocation=s.path()}),i.$watch(function(){return s.path()},function(e,n){if(i.actualLocation===e&&r.get("scs_pages.manage")==t.current.name){var a=r.getAll();for(var o in a)0==o.indexOf("scs_")&&r.remove(o);r.put("content.controller.abort","1"),t.go("pages.manage")}});var f=new Date;n.get("/api/common/logged-user?nnn="+f.getTime()).then(function(t){e.loggedInUser=t.data},function(e){console.log("error reading logged in user"),console.log(e)}),ChainFactory.Execute(u,d,p,g),e.croppedContactPicturePath=function(e){var t=e.Seq,n=contentUtils.getCroppedImage(t,"1x1");return n.File.length>0?"/content/Cropped/"+t+"/"+n.File:"/content/Contacts/"+e.PageSeq+"/"+e.FileName},e.canEditContent=function(){return null!=e.loggedInUser&&(1==e.loggedInUser.Role||3==e.loggedInUser.Role)}}angular.module("sport.content").controller("ContentController",["$scope","$state","$http","$stateParams","$sce","$rootScope","$cookies","$location","ContentService",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s,l,c,u,d,p,g,h,f){function m(t){var n=z[e.pageType];return!(null==n||!n)&&("all"==n||n.indexOf(t.Id)>=0)}function v(){var t=k.filter(function(e){return 1==e.Seq});t.length>0&&(e.selected.AuthorName=t[0].Name)}function S(){sportUtils.VerifyUser(a,e,[3])}function y(){e.generalData.sportFields=[],a.get("/api/common/sports").then(function(t){L=t.data;for(var n=0;n<L.length;n++)e.generalData.sportFields.push(L[n]);window.qL_step_finished=!0,ChainFactory.Next()},function(e){alert("error loading sports: "+e),window.qL_step_finished=!0,ChainFactory.Next()})}function C(){e.generalData.Tags=[],a.get("/api/common/tags?type=1").then(function(t){q=t.data;for(var n=0;n<q.length;n++)e.generalData.Tags.push(q[n]);window.qL_step_finished=!0,ChainFactory.Next()},function(e){alert("error loading tags: "+e),window.qL_step_finished=!0,ChainFactory.Next()})}function I(){contentUtils.InitCroppedImages(a,function(){window.qL_step_finished=!0,ChainFactory.Next()})}function T(){e.generalData.Authors=[],a.get("/api/common/contacts?type=1").then(function(t){k=t.data;for(var n=0;n<k.length;n++){var a=k[n];a.AboutMe&&(a.AboutMe=sportUtils.EncodeHTML(a.AboutMe)),e.generalData.Authors.push(a.Name)}"new"==G&&v(),window.qL_step_finished=!0,ChainFactory.Next()},function(e){alert("error loading authors: "+e),window.qL_step_finished=!0,ChainFactory.Next()})}function w(){e.generalData.Contacts=[],a.get("/api/common/contacts?type=2&apply=pages").then(function(t){e.generalData.Contacts=[];for(var n=0;n<t.data.length;n++)e.generalData.Contacts.push(t.data[n]);for(var n=0;n<e.generalData.Contacts.length;n++){var a=e.generalData.Contacts[n];a.PictureName&&a.PicturePageSeq&&(a.Picture={Seq:a.PictureSeq,FileName:a.PictureName,PageSeq:a.PicturePageSeq}),a.DisplayName=a.Name,a.Role&&(a.DisplayName+=" ("+a.Role+")")}window.qL_step_finished=!0,ChainFactory.Next()},function(e){alert("error loading contacts: "+e),window.qL_step_finished=!0,ChainFactory.Next()})}function _(){e.generalData.Seasons=[],f.seasons.inUse().then(function(t){t.length>0&&(e.generalData.Seasons=t.slice(0),e.generalData.Seasons.sort(function(e,t){return e.Season-t.Season})),window.qL_step_finished=!0,ChainFactory.Next()},function(e){console.log("error getting seasons"),console.log(e),window.qL_step_finished=!0,ChainFactory.Next()})}function D(){e.generalData.Regions=[],a.get("/api/sportsman/regions").then(function(t){e.generalData.Regions=t.data.filter(function(e){return e.REGION_ID>0}),e.generalData.Regions.forEach(function(e){e.Id=e.REGION_ID,e.Name=e.REGION_NAME}),window.qL_step_finished=!0,ChainFactory.Next()},function(e){console.log("error getting regions"),console.log(e),window.qL_step_finished=!0,ChainFactory.Next()})}function P(e){var t=contentUtils.ExtractAllAttachments(e),n=t.filter(function(e){return e.IsDefault}),a=n.length>0?n[0]:{Seq:0,FileName:""};return 0==a.Seq&&t.length>0&&(a=t[0]),a}function F(e,t,n,a,o){void 0===o&&(o="");var i=contentUtils.getCroppedImage(t,a).File,r="";i.length>0?r="/content/Cropped/"+t+"/"+i:o&&o.length>0&&(r="/content/Images/"+e.Seq+"/"+o),r.length>0&&(e.CroppedImages[n]=r)}function N(e){e.CroppedImages={Slider:"",Homepage:""};var t=P(e),n=e.SliderThumbnailSeq||t.Seq,a=e.HomepageThumbnailSeq||t.Seq;n&&(console.log(n),F(e,n,"Slider","214x234",e.SliderThumbnailImage)),a&&F(e,a,"Homepage","383x100",e.HomepageThumbnailImage)}function b(){function n(){function t(n,o,r){if(!o||0==o.length||r>=o.length)return void n.resolve(o);var s=o[r],l=s.CategoryId;if(0==l.indexOf("sf-")){var c=l.replace("sf-","");a.get("/api/flowers/events?activity="+c).then(function(e){if(e.data&&e.data.length>0){var a=championshipsUtils.convertSportFlowersChampionships([e.data[0]],i)[0];s.CategoryId=c,s.Championship=a.CHAMPIONSHIP_NAME,s.Name=a.CATEGORY_NAME,t(n,o,r+1)}},function(e){t(n,o,r+1)})}else a.get("/api/sportsman/category-data?category="+l).then(function(a){if(a.data.SPORT_ID==e.selected.sportField.Seq){var i=a.data.CHAMPIONSHIP_NAME,l=a.data.CATEGORY_NAME;s.Championship=i,s.Name=l,t(n,o,r+1)}else t(n,o,r+1)},function(e){t(n,o,r+1)})}var n=o.defer();if(e.pageData.ChampionshipCategoryIds&&e.pageData.ChampionshipCategoryIds.length>0&&e.selected.sportField){var r=[];e.pageData.ChampionshipCategoryIds.forEach(function(e){r.push({CategoryId:e,Championship:"",Name:""})}),t(n,r,0)}else n.resolve(null);return n.promise}"new"!=G?h.read(G).then(function(o){if(o.Type&&o.Type!=contentUtils.ParsePageType(e.pageType))return void t.go(contentUtils.ParsePageType(o.Type)+".edit",{page:G});var i=o.SportFieldSeq;if(i){var r=e.generalData.sportFields.filter(function(e){return e.Seq==i});r.length>0&&(e.selected.sportField=r[0])}if(o.Sections&&o.Sections.length>0)for(var s=0;s<o.Sections.length;s++){var l=o.Sections[s];A(o,l)}if(N(o),e.pageData=o,e.pageData.Sections)for(var s=0;s<e.pageData.Sections.length;s++){var l=e.pageData.Sections[s];if(null==l.Index&&(l.Index=s),B++,l.UniqueId="section_"+B,6==l.Type&&l.Data&&l.Data.Picture){var c=l.Data.Picture.Seq,u=e.generalData.Contacts.findItem(function(e){return e.PictureSeq==c});null!=u&&u.PicturePageSeq&&(l.Data.Picture.PageSeq=u.PicturePageSeq)}}e.pageData.ShowAuthorDetails&&$("#chkAuthorDetails").prop("checked",!0),e.pageData.AuthorSeq?e.selected.AuthorName=e.pageData.AuthorName:v(),n().then(function(t){null!=t&&t.length>0&&(e.pageData.ChampionshipCategories=t),a.get("/api/pages/region-pages").then(function(t){var n=t.data.slice(0),a=n.findItem(function(t){return t.ContentPageSeq==e.pageData.Seq});if(null!=a){var o=a.REGION_ID;e.pageData.OriginalRegion=o,e.pageData.Region=o,e.selected.region=e.generalData.Regions.findItem(function(e){return e.REGION_ID==o})}})}),window.qL_Finish_Now=!0,ChainFactory.Next()},function(){window.qL_Finish_Now=!0,alert("שגיאה בעת טעינת נתונים"),ChainFactory.Next()}):(window.qL_Finish_Now=!0,ChainFactory.Next())}function A(t,n){var a=t.DefaultImageSeq;if(n.HebrewType=contentUtils.HebrewSectionType(n.Type),n.Title=contentUtils.HebrewSectionTitle(n.Type),(1==n.Type||5==n.Type||6==n.Type)&&n.Data)if(6==n.Type)n.Data.Picture&&(n.Data.Picture.DateUploaded&&(n.Data.Picture.DateUploaded=new Date(n.Data.Picture.DateUploaded)),n.Data.Picture.PageSeq=G);else{n.Attachments=n.Data.slice(0);for(var o=0;o<n.Attachments.length;o++){var i=n.Attachments[o];i.Index=o,i.DateUploaded&&(i.DateUploaded=new Date(i.DateUploaded)),1==n.Type&&(i.IsDefault=!a&&"gallery"==e.pageType&&0==o||i.Seq==a)}1==n.Type&&(n.ImageRows=contentUtils.BuildImageRows(n.Attachments,V.ImagesPerRow))}}function E(){var t=$.trim(e.selected.AuthorName).toLowerCase(),n=k.filter(function(e){return e.Name.toLowerCase()==t});return n.length>0?n[0]:{Seq:0,Name:t}}function R(){var e=[];$(".dropzone").each(function(){var t=$(this),n=t.attr("id");n||(V.DropZoneCounter++,n="dropzone_"+V.DropZoneCounter,t.attr("id",n)),e.push(n)});for(var t=0;t<e.length;t++)Dropzone.forElement("#"+e[t]).removeAllFiles(!0)}function M(e){switch(e.Type){case 1:
e.ImageRows=contentUtils.BuildImageRows(e.Attachments,V.ImagesPerRow);break;case 5:e.Attachments.sort(function(e,t){return e.Index-t.Index})}}function U(t,n){var a=t.Index+n;if(a>=0&&a<e.pageData.Sections.length){var o=e.pageData.Sections.filter(function(e){return e.Index==a});o.length>0&&(o[0].Index=t.Index),t.Index=a}}function x(e,t,n,a,o,i,r,s,l){if(e&&e.Seq){var c=o+"x"+i,u=null,d=contentUtils.getCroppedImage(e.Seq,c).Data;if(d&&d.length>0){var g=d.split(",");g.length>3&&(u={X:parseInt(g[0]),Y:parseInt(g[1]),Width:parseInt(g[2]),Height:parseInt(g[3])})}p.open({templateUrl:"views/image-cropper.html",controller:"ImageCropperCtrl",resolve:{title:function(){return r},pageSeq:function(){return a},sourceDirectory:function(){return n},imageData:function(){return e},ratio:function(){return{Width:o,Height:i}},canvas:function(){return s>0?{Width:s,Height:s}:{Width:5*o,Height:5*i}},metaData:function(){return u},existingImages:function(){return t}}}).result.then(function(t){if(t.ChangeCroppedImage)l&&l(t.ChangeCroppedImage);else{var n=t.ImageName,a=n.split("/").slice(-1),r=[t.X,t.Y,t.Width,t.Height].join(",");contentUtils.setCroppedImage(e.Seq,o+"x"+i,a,r),l&&l(e)}})}else console.log("no image to crop")}function O(e){switch(e){case 1:return V.ImageUploadMapping;case 5:return V.FileUploadMapping;case 6:return V.ContactUploadMapping}return{}}function H(t,n){function a(e){switch(e){case 1:if(t.files.length>V.MaxImages)return"ניתן להעלות עד "+V.MaxImages+" תמונות בלבד";break;case 5:if(t.files.length>V.MaxFiles)return"ניתן להעלות עד "+V.MaxFiles+" קבצים בלבד";break;case 6:if(t.files.length>1)return"ניתן להעלות תמונה אחת בלבד"}var a=n.type,o=!a||0==a.length,i=!o&&"image"==a.split("/")[0].toLowerCase();return 1!=e&&6!=e||i?n.size>V.MaxFileSize?"גודל קובץ מקסימלי הוא "+(V.MaxFileSize/1048576).toFixed(1)+" מגהבייט":"":"ניתן להעלות קובץ תמונה בלבד"}function o(t,n){var a=e.pageData.Sections.filter(function(e){return e.UniqueId==t});0==a.length&&(a=e.pageData.Sections.slice(0));for(var o=0;o<a.length;o++)a[o].attachmentUploadError=n}var i=function(){var o=1,i=e.pageData.Sections.findItem(function(e){return e.UniqueId==V.ActiveSectionId});null!=i&&(o=i.Type);var r=contentUtils.ExtractAllAttachments(e.pageData),s=r.filter(function(e){return e.SectionType==o&&e.FileName.toLowerCase()==n.name.toLowerCase()});if(s.length>0){var l=s[0];return t.cancelUpload(n),1==o||6==o?"תמונה בעלת שם זהה כבר קיימת במקטע מספר "+(l.SectionIndex+1)+" (אינדקס תמונה "+(l.Index+1)+")":"קובץ בעל שם זהה כבר קיים במקטע מספר "+(l.SectionIndex+1)+" (אינדקס קובץ "+(l.Index+1)+")"}var c=V.GetAllFiles(),u=O(o),d=c.filter(function(e){return u[e]!=V.ActiveSectionId&&e.toLowerCase()==n.name.toLowerCase()});if(d.length>0){var p=d[0],g=u[p];if(null!=(i=e.pageData.Sections.findItem(function(e){return e.UniqueId==g})))return 1==o?"תמונה בעלת שם זהה כבר הועלתה למקטע מספר "+(i.Index+1):"קובץ בעל שם זהה כבר הועלה למקטע מספר "+(i.Index+1)}return a(o)}();if(i.length>0)return e.$apply(function(){o(V.ActiveSectionId,i)}),window.setTimeout(function(){t.removeFile(n)},200),r(function(){o(V.ActiveSectionId,"")},5e3),!1;for(var s={},l=0;l<t.files.length-1;l++){var c=t.files[l],u=c.name.toLowerCase();s[u]&&(console.log("removing file with same name: "+c.name),t.removeFile(c)),s[u]=!0}return!0}var q=[],k=[],L=[],G=n.page,B=0,V={MaxImages:20,MaxFiles:20,MaxContacts:1,DropZoneCounter:0,MaxFileSize:5242880,UploadContactUrl:"/content/Contacts/"+G,UploadImageUrl:"/content/Images/"+G,UploadFileUrl:"/content/Files/"+G,ImagesPerRow:6,ActiveSectionId:"",FileSizeMapping:{},ImageUploadMapping:{},FileUploadMapping:{},ContactUploadMapping:{},GetAllFiles:function(){for(var e=[],t=0;t<$(".dz-filename").length;t++){var n=$(".dz-filename").eq(t);e.push(n.find("span").text())}return sportUtils.DistinctArray(e)}};u.$on("$locationChangeSuccess",function(){u.actualLocation=d.path()}),u.$watch(function(){return d.path()},function(e,t){}),contentUtils.InitSportFieldColors(a),e.pageData={Tags:[],Sections:[],CroppedImages:{}},e.pageType=t.current.data.contentType,null!=e.pageType&&e.pageType||(e.pageType=""),e.pageTypeHebrew=contentUtils.HebrewPageType(e.pageType),e.pageTypeIsHebrewMale=contentUtils.IsHebrewMalePageType(e.pageType),e.generalData={sportFields:[],Tags:[],Authors:[],Seasons:[],Regions:[],Contacts:[]},e.selected={AuthorName:"",AuthorDetails:{Seq:0}},e.sectionTypes=contentUtils.GetSectionTypes(),e.submitting=!1,e.deleting=!1,e.validationErrors=[],e.Unauthorized=!1,e.flowersFieldSeq=sportGlobalSettings.FlowersFieldSeq;var z={article:"all",event:"all"};e.sectionTypes.forEach(function(e){e.Allowed=m(e)}),ChainFactory.Execute(S,y,C,I,T,w,_,D,b),window.qL_steps_amount=8,e.getSportFieldColor=contentUtils.getSportFieldColor,e.getRoundedRectangleClass=sportUtils.getRoundedRectangleClass,e.allowedSectionTypeCount=function(){return e.sectionTypes.map(function(e){return e.Allowed?1:0}).reduce(function(e,t){return e+t})},e.gotCroppedContactPicture=function(e){return contentUtils.getCroppedImage(e,"1x1").File.length>0},e.croppedContactPicturePath=function(e){var t=e.Seq,n=contentUtils.getCroppedImage(t,"1x1");return n.File.length>0?"/content/Cropped/"+t+"/"+n.File:"/content/Contacts/"+e.PageSeq+"/"+e.FileName},e.canApplyChampionships=function(){if(e.selected.sportField){var t=e.selected.sportField.Seq;return t!=sportGlobalSettings.GeneralSportFieldSeq&&t!=sportGlobalSettings.YoungSportsmenSeq}return!1},e.getApplyChampionshipText=function(){return e.selected.sportField&&e.selected.sportField.Seq==e.flowersFieldSeq?"הוספת אירוע משוייך":"הוספת אליפות משוייכת"},e.getSportFieldFilterStyle=function(e){e.Selected=!0;var t=contentUtils.getSportFieldColor(e.Seq),n=sportUtils.getRoundedRectangleStyle(e,t);return n.length>0&&(n+="; "),n+="margin-bottom: 5px; position: relative;"},"gallery"!=e.pageType&&s(function(){contentUtils.ApplyVideoData(e.pageData.Sections,l)},1e3),"article"==e.pageType&&s(function(){e.pageData.ShowAuthorDetails=1==$("#chkAuthorDetails").prop("checked")?1:0,e.selected.AuthorDetails=E()},500),e.dropzoneContactsConfig={options:{paramName:"files",maxFiles:V.MaxContacts,url:V.UploadContactUrl,autoProcessQueue:!0,dictDefaultMessage:"ניתן לגרור לכאן תמונה, או ללחוץ להעלאה מהמחשב",dictRemoveFile:"הסרת תמונה",dictCancelUploadConfirmation:"ביטול העלאת קובץ",addRemoveLinks:!0},eventHandlers:{success:function(e,t){V.ActiveSectionId=$(this.element).parents(".content-section").first().data("uniqueid"),H(this,e)&&(V.FileSizeMapping[e.name]=e.size,V.ContactUploadMapping[e.name]=V.ActiveSectionId)},maxfilesexceeded:function(e){var t=this;window.setTimeout(function(){t.removeFile(e)},200)}}},e.dropzoneImagesConfig={options:{paramName:"files",maxFiles:V.MaxImages,url:V.UploadImageUrl,autoProcessQueue:!0,dictDefaultMessage:"ניתן לגרור לכאן תמונה, או ללחוץ להעלאה מהמחשב",dictRemoveFile:"הסרת תמונה",dictCancelUploadConfirmation:"ביטול העלאת קובץ",addRemoveLinks:!0},eventHandlers:{sending:function(e,t,n){},success:function(e,t){V.ActiveSectionId=$(this.element).parents(".content-section").first().data("uniqueid"),H(this,e)&&(V.FileSizeMapping[e.name]=e.size,V.ImageUploadMapping[e.name]=V.ActiveSectionId)},removedfile:function(e){},maxfilesexceeded:function(e){var t=this;window.setTimeout(function(){t.removeFile(e)},200)}}},e.dropzoneFilesConfig={options:{paramName:"files",maxFiles:V.MaxFiles,url:V.UploadFileUrl,autoProcessQueue:!0,dictDefaultMessage:"ניתן לגרור לכאן קובץ, או ללחוץ להעלאה מהמחשב",dictRemoveFile:"הסרת קובץ",dictCancelUploadConfirmation:"ביטול העלאת קובץ",addRemoveLinks:!0},eventHandlers:{success:function(e,t){V.ActiveSectionId=$(this.element).parents(".content-section").first().data("uniqueid"),H(this,e)&&(V.FileSizeMapping[e.name]=e.size,V.FileUploadMapping[e.name]=V.ActiveSectionId)},maxfilesexceeded:function(e){var t=this;window.setTimeout(function(){t.removeFile(e)},200)}}};var Y=null;if(e.getAuthors=function(t){var n=e.generalData.Authors.slice();return t&&t.length>0&&0==n.filter(function(e){return e.toLowerCase()==t.toLowerCase()}).length&&(n.unshift(t),Y&&r.cancel(Y),Y=r(function(){e.generalData.Authors.push(t)},1500)),n},e.OpenCropDialog=function(t){var n=contentUtils.GetThumbnailType(t),o=n.RatioWidth,i=n.RatioHeight,r=n.Title,s={Seq:0,FileName:""};switch(t){case 1:s.Seq=e.pageData.SliderThumbnailSeq,s.FileName=e.pageData.SliderThumbnailImage;break;case 2:s.Seq=e.pageData.HomepageThumbnailSeq,s.FileName=e.pageData.HomepageThumbnailImage}s.Seq||(s=P(e.pageData));var l=contentUtils.ExtractAllAttachments(e.pageData).filter(function(e){return 1==e.SectionType}).map(function(e){return{FileName:e.FileName,Seq:e.Seq}});e.pageData.SliderThumbnailSeq&&null==l.findItem(function(t){return t.FileName==e.pageData.SliderThumbnailImage})&&l.push({FileName:e.pageData.SliderThumbnailImage,Seq:e.pageData.SliderThumbnailSeq}),e.pageData.HomepageThumbnailSeq&&null==l.findItem(function(t){return t.FileName==e.pageData.HomepageThumbnailImage})&&l.push({FileName:e.pageData.HomepageThumbnailImage,Seq:e.pageData.HomepageThumbnailSeq}),x(s,l,null,e.pageData.Seq,o,i,r,0,function(n){if(n){var o="/api/pages/"+G+"/thumbnail";a.post(o,{ThumbnailType:t,ThumbnailSeq:n.Seq||0,FileName:n.FileName,FileSize:n.FileSize}).then(function(a){var o=a.data.Seq,i=n.FileName;switch(t){case 1:e.pageData.SliderThumbnailSeq=o,e.pageData.SliderThumbnailImage=i;break;case 2:e.pageData.HomepageThumbnailSeq=o,e.pageData.HomepageThumbnailImage=i}N(e.pageData),e.OpenCropDialog(t)},function(e){console.log("error setting thumbnail image"),console.log(e)})}else{N(e.pageData);var i=(new Date).getTime();$("#imgCroppedHomepage").attr("src",$("#imgCroppedHomepage").attr("src")+"?nnn="+i),$("#imgCroppedSlider").attr("src",$("#imgCroppedSlider").attr("src")+"?nnn="+i)}})},e.CropContactPicture=function(e){var t=e.Picture;if(t&&t.Seq){x({Seq:t.Seq,FileName:t.FileName},null,"Contacts",t.PageSeq,1,1,e.Name,120,function(){var e=(new Date).getTime();$(".contact-picture").each(function(){var t=$(this);t.attr("src",t.attr("src")+"?nnn="+e)})})}},e.loadTags=function(e){var t=o.defer(),n=q.filter(function(t){return t.Name==e}),a=q.filter(function(t){return t.Name.indexOf(e)>=0}),i=q.filter(function(t){return t.Name.indexOf(e)<0}),r=n.length>0?n[0]:{Seq:-1,Name:e,Temporary:!0};a.sort(function(t,n){return t.Name.indexOf(e)-n.Name.indexOf(e)}),i.sort(function(e,t){return t.Name.compareTo(e.Name)});for(var s=[r],l=0;l<a.length;l++){var c=a[l];c.Name!=e&&s.push(c)}for(var l=0;l<i.length;l++)s.push(i[l]);return t.resolve(s),t.promise},e.assignChampionship=function(t){if(void 0===t&&(t=null),e.selected.sportField){var n=null!=t?t.CategoryId:0,a=null!=t?t.Championship:"";p.open({templateUrl:"views/championship-selection.html",controller:"ChampionshipSelectionCtrl",resolve:{sportField:function(){return e.selected.sportField},allSeasons:function(){return e.generalData.Seasons},allRegions:function(){return e.generalData.Regions},schoolData:function(){return null},options:function(){return{category:n,EventName:a}}}}).result.then(function(t){e.pageData.ChampionshipCategories||(e.pageData.ChampionshipCategories=[]),e.pageData.ChampionshipCategories.push(t)})}},e.removeChampionship=function(t){e.pageData.ChampionshipCategories=e.pageData.ChampionshipCategories.filter(function(e){return e.CategoryId!=t.CategoryId})},e.GetLinkTooltip=function(e){var t="הגדרת קישור. מצב קיים: ",n="פתיחה בגלריה";if(null!=e.CustomLink)switch(e.CustomLink.Type){case 1:n="קישור חיצוני";break;case 2:n="קישור לקובץ"}return t+=n},e.GetLinkStyle=function(e){var t=["cursor: pointer;"],n="";if(e.CustomLink)switch(e.CustomLink.Type){case 1:n="#197bbe";break;case 2:n="#ec2913"}return n.length>0&&t.push("color: "+n+";"),t.join(" ")},e.OpenLinkSelection=function(e,t){function n(e){var t=e?e.Type:0;switch(t){case 1:return{Type:t,ExternalUrl:e.ExternalUrl};case 2:return{Type:t,FileName:e.FileName}}return null}p.open({templateUrl:"views/image-link-selection.html",controller:"ImageLinkSelectionCtrl",resolve:{pageSeq:function(){return G},imageSeq:function(){return t.Seq},imageFileName:function(){return t.FileName},options:function(){return{}},existingLink:function(){return t.CustomLink}}}).result.then(function(e){t.CustomLink=n(e)})},e.clearChampionships=function(){e.pageData.ChampionshipCategories=[]},e.clearRegion=function(){e.pageData.Region=null,e.selected.region=null},e.removeContactPicture=function(e){e.Data.Picture=null},e.applyExistingContact=function(e){e.Data=e.selectedContact},e.clearSelectedContact=function(t){t.selectedContact=null,e.applyExistingContact(t)},e.changeIndex=function(e,t,n){var a=t.Index,o=t.Index+n;if(!(o>=e.Attachments.length||o<0)){var i=e.Attachments.filter(function(e){return e.Index==o});i.length>0&&(i[0].Index=a),t.Index=o,M(e)}},e.MakeDefaultImage=function(t,n){for(var a=n.Seq,o=e.pageData.Sections.filter(function(e){return 1==e.Type&&e.Attachments}),i=0;i<o.length;i++)for(var r=o[i],s=0;s<r.Attachments.length;s++){var l=r.Attachments[s];l.IsDefault=l.Seq==a}N(e.pageData)},e.deleteAttachment=function(e,t){var n="";switch(e.Type){case 1:case 6:n="האם להסיר תמונה זו?";break;case 5:n="האם להסיר קובץ זה?"}n.length>0&&g.ask(n).then(function(){if(6==e.Type)e.Attachments=[],e.Data.Picture=null;else{e.Attachments=e.Attachments.filter(function(e){return e.Seq!=t.Seq});for(var n=0;n<e.Attachments.length;n++)e.Attachments[n].Index=n;M(e)}})},e.AddSection=function(t){e.pageData.Sections||(e.pageData.Sections=[]);var n=e.pageData.Sections.length;B++,e.pageData.Sections.push({Type:t,Index:n,HebrewType:contentUtils.HebrewSectionType(t),Title:contentUtils.HebrewSectionTitle(t),UniqueId:"section_"+B})},e.MoveSectionDown=function(e){U(e,1)},e.MoveSectionUp=function(e){U(e,-1)},e.DeleteSection=function(t){function n(){e.pageData.Sections=e.pageData.Sections.filter(function(e){return e.Index!=t.Index}),contentUtils.RearrangeSections(e.pageData)}var a=$.trim(t.Data||"").length>0;if(!a)if(1==t.Type){for(var o in V.ImageUploadMapping)if(V.ImageUploadMapping[o]==t.UniqueId){a=!0;break}}else if(5==t.Type){for(var o in V.FileUploadMapping)if(V.FileUploadMapping[o]==t.UniqueId){a=!0;break}}else if(6==t.Type)for(var o in V.ContactUploadMapping)if(V.ContactUploadMapping[o]==t.UniqueId){a=!0;break}if(a){var i="האם להסיר את מקטע מספר "+(t.Index+1)+" מה"+e.pageTypeHebrew+"?";g.ask(i).then(function(){n()})}else n()},"new"==G)switch(e.pageData.Date=new Date,e.pageData.Sections||(e.pageData.Sections=[]),e.pageType){case"gallery":e.AddSection(1);break;case"article":e.AddSection(2);break;case"video":e.AddSection(3);break;case"files":e.AddSection(2),e.AddSection(5)}e.buildImageCellClass=function(e){var t="col-md-"+e.ColWidth;return e.ColOffset&&(t+=" col-md-offset-"+e.ColOffset),t},e.Delete=function(){var n="האם למחוק "+e.pageTypeHebrew+" זו מהמערכת?";g.ask(n).then(function(){h.delete(G).then(function(e){t.go("home")},function(e){alert("שגיאה בעת מחיקה, אנא נסו שוב מאוחר יותר")})})},e.Submit=function(){function n(t){e.submitting=!1,e.submitError="שגיאה בעת שמירת נתונים"}function o(e,t){var n=t.NewAttachments||[];if(e.NewAttachments&&e.NewAttachments.length>0){e.Attachments||(e.Attachments=[]);for(var a={},o=0;o<n.length;o++)a[n[o].Name]=n[o].Seq;for(var i=e.Attachments.length,o=0;o<e.NewAttachments.length;o++){var r=e.NewAttachments[o],s=a[r.Name]||0;e.Attachments.push({Seq:s,FileName:r.Name,FileSize:r.Size,DateUploaded:r.DateUploaded,Description:"",Index:i}),i++}e.ImageRows=contentUtils.BuildImageRows(e.Attachments,V.ImagesPerRow)}}function i(t){function n(o,i){function r(){n(o,i+1)}if(i>=o.length)return e.pageData.OriginalRegion=e.pageData.Region,void t();var s=o[i];switch(s.Method){case"delete":a.delete(s.Url).then(r,r);break;case"put":a.put(s.Url,s.Params).then(r,r)}}void 0!==t&&null!=t||(t=function(){});var o=e.pageData.OriginalRegion||null,i=e.pageData.Region||null;if(o!=i){var r=[];null!=o&&r.push({Method:"delete",Url:"/api/pages/region-page?page="+e.pageData.Seq+"&region="+o,Params:null}),null!=i&&r.push({Method:"put",Url:"/api/pages/region-page",Params:{PageSeq:e.pageData.Seq,Region:i}}),n(r,0)}else t()}e.pageData.Sections||(e.pageData.Sections=[]);for(var s=V.GetAllFiles(),l=0;l<e.pageData.Sections.length;l++){var c=e.pageData.Sections[l];if(1==c.Type||5==c.Type||6==c.Type){var u=O(c.Type);if(c.PageSeq="new"==G?0:G,6==c.Type){var d=s.filter(function(e){return u[e]==c.UniqueId});d.length>0&&(c.NewContactPicture=d.map(function(e){return{Name:e,Size:V.FileSizeMapping[e],DateUploaded:new Date}})[0])}else{var p="";c.Attachments&&(c.Attachments.sort(function(e,t){return e.Index-t.Index}),p=c.Attachments.map(function(e){return e.Seq}).join(",")),c.Data=p,c.AttachmentsData=(c.Attachments||[]).map(function(e){return{Seq:e.Seq,Description:e.Description,CustomLink:e.CustomLink}}),c.NewAttachments=s.filter(function(e){return u[e]==c.UniqueId}).map(function(e){return{Name:e,Size:V.FileSizeMapping[e],DateUploaded:new Date}})}}}if(e.validationErrors=function(){var t=[],n=$.trim(e.pageData.Description),a=e.selected.sportField?e.selected.sportField.Name:"",o=Date.parse(e.pageData.Date),i=e.pageData.Tags||[];if(0==n.length&&t.push({Message:"תיאור "+e.pageTypeHebrew+" חסר"}),0==a.length&&t.push({Message:"יש לבחור ענף ספורט"}),(isNaN(o)||new Date(o).getFullYear()<1900)&&t.push({Message:"תאריך חסר או שגוי"}),0==i.length&&t.push({Message:"יש להזין לפחות תגית אחת"}),e.pageData.Sections){e.pageData.Sections=e.pageData.Sections.filter(function(e){return(e.SectionType||e.Type)>0});for(var r=e.pageData.Sections.length>1,s=0;s<e.pageData.Sections.length;s++){var l=e.pageData.Sections[s];if(!contentUtils.GotValidData(l)){var c=function(e,t,n){var a="יש להזין ";switch(e.Type){case 1:a="יש להעלות לפחות תמונה אחת";break;case 2:a+="טקסט";break;case 3:a+="כתובת URL",n||(a+=" חוקית ");break;case 5:a="יש להעלות לפחות קובץ אחד";break;case 6:a+=" שם איש קשר"}return t&&(a+=" במקטע מספר "+(e.Index+1)),a}(l,r,!l.Data||0==l.Data.length);t.push({Message:c})}}}if(e.pageData.Seq&&"files"!=e.pageType&&e.pageData.DefaultImageSeq){contentUtils.ExtractAllAttachments(e.pageData).filter(function(e){return 1==e.SectionType}).length>0&&sportUtils.isNullOrEmpty(e.pageData.CroppedImages.Slider)&&t.push({Message:"יש להגדיר תמונת סליידר ממוזערת"})}return t}(),e.showSubmitSuccessMessage=!1,0==e.validationErrors.length){e.submitting=!0;var g=E(),f=contentUtils.ExtractAllAttachments(e.pageData).filter(function(e){return 1==e.SectionType});contentUtils.RearrangeSections(e.pageData),e.pageData.SportFieldSeq=e.selected.sportField.Seq,e.pageData.Type=contentUtils.ParsePageType(e.pageType),0==f.length?e.pageData.DefaultImageSeq=null:e.pageData.DefaultImageSeq=5==e.pageData.Type||6==e.pageData.Type?null:P(e.pageData).Seq,e.pageData.CreatorSeq=e.LoggedInUser?e.LoggedInUser.seq:1,e.pageData.ShowAuthorDetails=1==$("#chkAuthorDetails").prop("checked")?1:0,e.pageData.AuthorSeq=g.Seq,e.pageData.AuthorName=g.Name,e.pageData.Region=null==e.selected.region?null:e.selected.region.REGION_ID,e.pageData.ChampionshipCategories&&e.pageData.ChampionshipCategories.length>0?e.pageData.ChampionshipCategoryIds=e.pageData.ChampionshipCategories.map(function(t){var n=t.CategoryId;return e.pageData.SportFieldSeq==sportGlobalSettings.FlowersFieldSeq&&(n="sf-"+n),n}):e.pageData.ChampionshipCategoryIds=null,"new"==G?h.create(e.pageData).then(function(n){i(function(){e.submitting=!1;var a=n.Seq;t.go(e.pageType+".edit",{page:a})})},n):h.update(e.pageData).then(function(t){e.submitting=!1,e.showSubmitSuccessMessage=!0;for(var n=0;n<e.pageData.Sections.length;n++){var a=e.pageData.Sections[n];1==a.Type||5==a.Type?o(a,t.Sections[n]):6==a.Type&&a.NewContactPicture&&(a.Data.Picture={Seq:t.Sections[n].NewContactPicture.Seq,FileName:a.NewContactPicture.Name,PageSeq:G})}R(),i(function(){r(function(){e.showSubmitSuccessMessage=!1},5e3)})},n)}}}angular.module("sport.content").controller("ContentEditController",["$scope","$state","$stateParams","$http","$q","$filter","$timeout","$interval","$sce","$cookies","$rootScope","$location","$uibModal","messageBox","ContentService","SportService",e])}(),function(){"use strict";function e(e,t,n,a,o,i){function r(){function t(e){e.Pages=[];for(var t=0;t<e.length;t++){var n=e[t];n.HebrewType=contentUtils.HebrewPageType(n.Type,!1),n.DefaultImagePath=contentUtils.BuildDefaultImagePath(n),e.Pages.push(n)}for(var t=e.length;t<l;t++)e.Pages.push({Seq:0})}var n=contentUtils.ParsePageType(e.pageType);i.list(n,null).then(function(n){contentUtils.InitCroppedImages(o,function(){for(var e=0;e<n.length;e++){var t=n[e];contentUtils.BuildCroppedImages(t)}}),e.pageRows=sportUtils.SplitArray(n,l);for(var a=0;a<e.pageRows.length;a++){t(e.pageRows[a])}window.qL_step_finished=!0,ChainFactory.Next()},function(e){alert("שגיאה בעת טעינת נתונים מהשרת"),window.qL_step_finished=!0,ChainFactory.Next()})}function s(){e.data.AllTags=[],window.setTimeout(function(){window.qL_Finish_Now=!0},1e3),ChainFactory.Next()}var l=3;e.pageRows=null,e.pageType=t.current.data.contentType,e.pluralCaption=contentUtils.HebrewPageType(e.pageType,!0),e.data={AllTags:[]},ChainFactory.Execute(r,s),window.qL_steps_amount=2}angular.module("sport.content").controller("ContentListController",["$scope","$state","$stateParams","$sce","$http","ContentService",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s,l,c){function u(){sportUtils.VerifyUser(t,e,[3],function(t){e.LoggedInUser&&2==e.LoggedInUser.role&&n.go("register"),ChainFactory.Next(),window.qL_step_finished=!0})}function d(){function t(e){return(e.Name||e).indexOf(n)>=0}var n=$.trim(e.data.contentSearch),a=_.slice(0);return a=i("orderBy")(a,e.sortColumn),n.length>0&&(a=a.filter(function(e){return!![e.SportFieldName,e.Description,e.HebrewType,e.CreatorDisplayName].some(t)||!(!e.Tags||!e.Tags.some(t))})),e.selectedPageType>0&&(a=a.filter(function(t){return t.Type==e.selectedPageType})),a}function p(){if(e.recentPageTypes=[],P=_.filter(function(e){return e.PageIndex>0}),P.length>0){P.sort(function(e,t){return e.PageIndex-t.PageIndex});var t=sportUtils.DistinctArray(P.map(function(e){return e.Type}));t.sort(function(e,t){return e-t});for(var n=0;n<t.length;n++){var a=t[n],o=P.filter(function(e){return e.Type==a}).take(e.recentAmount);e.recentPageTypes.push({Type:a,HebrewPluralType:contentUtils.HebrewPageType(a,!0),Pages:o})}}for(var n=0;n<e.recentPageTypes.length;n++){var i=e.recentPageTypes[n];i.Rows=sportUtils.SplitArray(i.Pages,3)}}function g(e){var t="button button_type_icon_small icon button_grey_light",n="button_grey_light_hover";e.AddToRecentCssClass=t,e.AddToFeaturedCssClass=t,e.HidePageCssClass=t,e.FeaturedIndex>0&&(e.AddToFeaturedCssClass+=" "+n),e.PageIndex>0&&(e.AddToRecentCssClass+=" "+n),e.IsHidden&&(e.HidePageCssClass+=" "+n)}function h(){D=_.filter(function(e){return e.FeaturedIndex>0}),D.sort(function(e,t){return e.FeaturedIndex-t.FeaturedIndex}),e.featuredPageRows=sportUtils.SplitArray(D,3)}function f(e,t,n,a,o){if(0==n)return!1;var i=e[t],r=i+n;if(r<1||r>a)return!1;var s=o.filter(function(e){return e[t]==r});return s.length>0&&(s[0][t]=i),e[t]=r,!0}function m(e,t,n,a){void 0===n&&(n=null),void 0===a&&(a=0);var o=t.map(function(e){return{Seq:e.Seq,Index:e.PageIndex}}),i=function(e){n&&(n.AddingToRecent=!1,g(n),p())},r=function(e){n?(n.AddingToRecent=!1,alert("פעולה נכשלה, אנא נסו שוב מאוחר יותר"),n.PageIndex=a):console.log("error setting recent pages: "+e)};n&&a>0?c.removeRecentPage(n.Seq).then(i,r):c.setRecentPages(o,e).then(i,r)}function v(e,t){void 0===e&&(e=null),void 0===t&&(t=0);var n=D.map(function(e){return{Seq:e.Seq,Index:e.FeaturedIndex}});c.setFeaturedPages(n).then(function(t){e&&(e.AddingToFeatured=!1,g(e),h())},function(n){e?(e.AddingToFeatured=!1,alert("פעולה נכשלה, אנא נסו שוב מאוחר יותר"),e.FeaturedIndex=t):console.log("error setting featured pages: "+n)})}function S(t,n){var a=e.recentPageTypes.filter(function(e){return e.Type==t.Type})[0].Pages;f(t,"PageIndex",n,e.recentAmount,a)&&(p(),m(t.Type,a))}function y(e,t){f(e,"FeaturedIndex",t,D.length,D)&&(h(),v())}function C(){c.list(null,null,!0).then(function(t){window.qL_step_finished=!0;for(var n=0;n<t.length;n++){var a=t[n];a.DefaultImagePath=contentUtils.BuildDefaultImagePath(a),a.HebrewType=contentUtils.HebrewPageType(a.Type),a.IsHebrewMale=contentUtils.IsHebrewMalePageType(a.Type),a.BannerButtonClass="button banner_button "+contentUtils.GetBannerType(a.Type),g(a)}_=t.slice(0),e.contentPagingService.setData(d()),p(),h(),ChainFactory.Next()},function(e){ChainFactory.Next()})}function I(){var t=$.trim($("#ddlSortBy").find(".select_title").text()),n=e.sortFields.filter(function(e){return e.Name==t});if(n.length>0){return n[0].Value}return""}function T(){var t=$.trim($("#ddlPageType").find(".select_title").text()),n=e.availablePageTypes.filter(function(e){return e.PluralHebrewType==t});return n.length>0?n[0].Type:0}function w(){o(function(){var t=I(),n=T(),a=t.length>0&&t!=F.SortBy,o=n!=F.PageType,i=e.data.contentSearch!=F.Search;(a||i||o)&&(e.sortColumn=t,e.selectedPageType=n,e.contentPagingService.setData(d())),t.length>0&&(F.SortBy=t),F.Search=e.data.contentSearch,F.PageType=n},500),ChainFactory.Next(),window.qL_step_finished=!0,window.qL_Finish_Now=!0}var _=[],D=[],P=[],F={SortBy:"-Date",Search:"",PageType:0};e.recentAmount=sportGlobalSettings.RecentAmount,e.sortFields=[{Name:"תאריך יצירה",Value:"-Date"},{Name:"תיאור",Value:"+Description"},{Name:"ענף ספורט",Value:"+SportFieldName"}],e.pageTypes=contentUtils.GetPageTypes(),e.availablePageTypes=e.pageTypes.map(function(e){return{Type:e.Id}}),e.sortColumn="-Date",e.selectedPageType=0,e.getSportFieldColor=contentUtils.getSportFieldColor,e.Unauthorized=!1,e.data={contentSearch:""},r.$on("$stateChangeSuccess",function(e,t,n,a,o){contentUtils.storeStateChange(s,a,t)});for(var N=0;N<e.availablePageTypes.length;N++){var b=e.availablePageTypes[N];b.HebrewType=contentUtils.HebrewPageType(b.Type),b.pageTypeIsHebrewMale=contentUtils.IsHebrewMalePageType(b.Type),b.PluralHebrewType=contentUtils.HebrewPageType(b.Type,!0),b.BannerButtonClass="button banner_button "+contentUtils.GetBannerType(b.Type),b.IconCss=contentUtils.GetPageIcon(b.Type)}contentUtils.InitSportFieldColors(t),e.contentPagingService=new PagingService(d(),{pageSize:20}),e.pages=[],e.contentPagingService.applyPaging(e.pages),window.qL_steps_amount=3,ChainFactory.Execute(u,C,w),e.FeaturedPageCount=function(){return D.length},e.getPageIcon=function(e){return contentUtils.GetPageIcon(e.Type)},e.AddToFeaturedTitle=function(e){return e.FeaturedIndex>0?"הסרה מעמוד הבית":"הצגה בעמוד הבית"},e.HideTitle=function(e){return e.IsHidden?"ביטול  מצב מוסתר":"הסתרה"},e.AddToRecentTitle=function(e){var t=contentUtils.HebrewPageType(e.Type,!0),n=contentUtils.IsHebrewMalePageType(e.Type);return(e.PageIndex>0?"הסרה מ":"הוספה ל")+t+" "+(n?"אחרונים":"אחרונות")},e.Delete=function(t){var n=t.Seq,a="האם למחוק "+t.HebrewType+" "+t.Description+"?";l.ask(a).then(function(){t.deleting=!0,c.delete(n).then(function(a){_=_.filter(function(e){return e.Seq!=n}),e.contentPagingService.setData(d()),t.deleting=!1},function(e){t.deleting=!1,alert("שגיאה בעת מחיקה, אנא נסו שוב מאוחר יותר")})})},e.getSportFieldStyle=function(e){return"background-color: "+contentUtils.getSportFieldColor(e)+";"},e.ToggleFeatured=function(e){e.AddingToFeatured=!0;var t=e.FeaturedIndex;if(e.FeaturedIndex>0){D=D.filter(function(t){return t.Seq!=e.Seq});for(var n=0;n<D.length;n++)D[n].FeaturedIndex=n+1;e.FeaturedIndex=0}else{for(var n=0;n<D.length;n++)D[n].FeaturedIndex++;e.FeaturedIndex=1,D.push(e)}v(e,t)},e.ToggleHidden=function(e){e.Hiding=!0,1==e.IsHidden?c.unhide(e.Seq).then(function(t){e.Hiding=!1,e.IsHidden=0,g(e)},function(t){e.Hiding=!1,alert("פעולה נכשלה, אנא נסו שוב מאוחר יותר")}):c.hide(e.Seq).then(function(t){e.Hiding=!1,e.IsHidden=1,g(e)},function(t){e.Hiding=!1,alert("פעולה נכשלה, אנא נסו שוב מאוחר יותר")})},e.RemoveFromFeatured=function(t){l.ask("האם להסיר מרשימת תוכן מקודם?").then(function(){e.ToggleFeatured(t)})},e.ToggleRecent=function(t){t.AddingToRecent=!0;var n=t.Type,a=t.PageIndex,o=P.filter(function(e){return e.Type==n});t.PageIndex>0?(t.PageIndex=0,o=o.filter(function(e){return e.Seq!=t.Seq})):(t.PageIndex=1,o=sportUtils.InsertIntoArray(o,t));for(var i=0;i<o.length;i++)o[i].PageIndex=i>=e.recentAmount?0:i+1;m(n,o,t,a)},e.RemoveFromRecent=function(t){l.ask("האם להסיר מרשימה זו?").then(function(){e.ToggleRecent(t)})},e.MoveRecentRight=function(e){S(e,-1)},e.MoveRecentLeft=function(e){S(e,1)},e.MoveFeaturedRight=function(e){y(e,-1)},e.MoveFeaturedLeft=function(e){y(e,1)}}angular.module("sport.content").controller("ContentManageController",["$scope","$http","$state","$timeout","$interval","$filter","$rootScope","$cookies","messageBox","ContentService",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s,l,c){function u(){sportUtils.VerifyUser(t,e,[3],function(t){e.LoggedInUser&&2==e.LoggedInUser.role&&n.go("register"),ChainFactory.Next(),window.qL_step_finished=!0})}function d(){t.get("/api/sportsman/regions").then(function(t){e.data.Regions=t.data.slice(0),window.setTimeout(function(){sportUtils.InitCustomSelect();window.setTimeout(function(){var e=$("#ddlRegion").find("option[value='0']").index();$("#selected_region").find("li").eq(e).click()},500)},200),ChainFactory.Next(),window.qL_step_finished=!0},function(e){ChainFactory.Next(),window.qL_step_finished=!0})}function p(){function t(e){return!(null==e||!e)&&(e.Name||e).indexOf(n)>=0}var n=$.trim(e.data.contentSearch),a=I.slice(0);return a=i("orderBy")(a,e.sortColumn),n.length>0&&(a=a.filter(function(e){return!![e.SportFieldName,e.Description,e.HebrewType,e.CreatorDisplayName].some(t)||!(!e.Tags||!e.Tags.some(t))})),e.selectedPageType>0&&(a=a.filter(function(t){return t.Type==e.selectedPageType})),null!=e.selectedRegion&&(a=a.filter(function(t){return t.Region&&t.Region.REGION_ID==e.selectedRegion.Id})),a}function g(e){var t="button button_type_icon_small icon button_grey_light",n="button_grey_light_hover";e.AddToRecentCssClass=t,e.AddToFeaturedCssClass=t,e.HidePageCssClass=t,e.RegionIndex>0&&(e.AddToFeaturedCssClass+=" "+n),e.PageIndex>0&&(e.AddToRecentCssClass+=" "+n),e.IsHidden&&(e.HidePageCssClass+=" "+n)}function h(){T=p().filter(function(e){return e.RegionIndex>0}),T.sort(function(e,t){return e.RegionIndex-t.RegionIndex}),e.featuredPageRows=sportUtils.SplitArray(T,3)}function f(n,a){if(null!=e.selectedRegion){var o=e.selectedRegion.Id,i=(n.RegionIndex||0)+a;i<1&&(i=1);var r={PageSeq:n.Seq,Region:o,PageIndex:i};t.post("/api/pages/region-page",r).then(function(e){if(e.data&&e.data.OriginalIndex){var t=p().findItem(function(t){return t.Seq==e.data.PageWithOriginalIndex});null!=t&&(t.RegionIndex=e.data.OriginalIndex)}n.RegionIndex=i,h(),g(n)},function(e){alert("שגיאה בעת עדכון מיקום, נא לנסות שוב מאוחר יותר")})}}function m(){t.get("/api/pages/region-pages").then(function(n){var a={};n.data.forEach(function(e){a[e.ContentPageSeq.toString()]=e.PageIndex}),c.list(null,null,!0).then(function(n){window.qL_step_finished=!0;for(var o=0;o<n.length;o++){var i=n[o];i.DefaultImagePath=contentUtils.BuildDefaultImagePath(i),i.HebrewType=contentUtils.HebrewPageType(i.Type),i.IsHebrewMale=contentUtils.IsHebrewMalePageType(i.Type),i.BannerButtonClass="button banner_button "+contentUtils.GetBannerType(i.Type),i.RegionIndex=a[i.Seq.toString()]||null,g(i)}I=n.slice(0);var r=I.map(function(e){return e.ChampionshipCategoryId}).filter(function(e){return null!=e}).distinct(),s="/api/sportsman/category-regions?categories="+r.join(",");t.get(s).then(function(t){var n=t.data.slice(0),a={};n.forEach(function(e){a[e.CHAMPIONSHIP_CATEGORY_ID.toString()]=e}),I.forEach(function(e){e.ChampionshipCategoryId&&(e.Region=a[e.ChampionshipCategoryId.toString()])}),e.contentPagingService.setData(p()),h(),ChainFactory.Next()},function(t){e.contentPagingService.setData(p()),h(),ChainFactory.Next()})},function(e){ChainFactory.Next()})},function(e){ChainFactory.Next()})}function v(){var t=$.trim($("#ddlRegion").find(".select_title").text()),n=e.data.Regions.filter(function(e){return e.REGION_NAME==t});if(n.length>0){return{Id:n[0].REGION_ID,Name:t}}return null}function S(){
var t=$.trim($("#ddlSortBy").find(".select_title").text()),n=e.sortFields.filter(function(e){return e.Name==t});if(n.length>0){return n[0].Value}return""}function y(){var t=$.trim($("#ddlPageType").find(".select_title").text()),n=e.availablePageTypes.filter(function(e){return e.PluralHebrewType==t});return n.length>0?n[0].Type:0}function C(){o(function(){var t=S(),n=y(),a=v(),o=t.length>0&&t!=w.SortBy,i=n!=w.PageType,r=null!=a&&null==w.Region||null!=a&&null!=w.Region&&a.Id!=w.Region.Id,s=e.data.contentSearch!=w.Search;(o||s||r||i)&&(e.sortColumn=t,e.selectedPageType=n,e.selectedRegion=a,e.contentPagingService.setData(p()),h()),t.length>0&&(w.SortBy=t),w.Search=e.data.contentSearch,w.PageType=n,w.Region=a},500),ChainFactory.Next(),window.qL_step_finished=!0,window.qL_Finish_Now=!0}var I=[],T=[],w={SortBy:"-Date",Search:"",PageType:0,Region:-1};e.recentAmount=sportGlobalSettings.RecentAmount,e.sortFields=[{Name:"תאריך יצירה",Value:"-Date"},{Name:"תיאור",Value:"+Description"},{Name:"ענף ספורט",Value:"+SportFieldName"}],e.pageTypes=contentUtils.GetPageTypes(),e.availablePageTypes=e.pageTypes.map(function(e){return{Type:e.Id}}),e.sortColumn="-Date",e.selectedPageType=0,e.selectedRegion=null,e.getSportFieldColor=contentUtils.getSportFieldColor,e.Unauthorized=!1,e.data={contentSearch:"",Regions:[]};for(var _=0;_<e.availablePageTypes.length;_++){var D=e.availablePageTypes[_];D.HebrewType=contentUtils.HebrewPageType(D.Type),D.pageTypeIsHebrewMale=contentUtils.IsHebrewMalePageType(D.Type),D.PluralHebrewType=contentUtils.HebrewPageType(D.Type,!0),D.BannerButtonClass="button banner_button "+contentUtils.GetBannerType(D.Type),D.IconCss=contentUtils.GetPageIcon(D.Type)}contentUtils.InitSportFieldColors(t),e.contentPagingService=new PagingService(p(),{pageSize:20}),e.pages=[],e.contentPagingService.applyPaging(e.pages),window.qL_steps_amount=4,ChainFactory.Execute(u,d,m,C),e.FeaturedPageCount=function(){return T.length},e.getPageIcon=function(e){return contentUtils.GetPageIcon(e.Type)},e.AddToFeaturedTitle=function(e){return e.RegionIndex>0?"הסרה מעמוד הבית":"הצגה בעמוד הבית"},e.HideTitle=function(e){return e.IsHidden?"ביטול  מצב מוסתר":"הסתרה"},e.AddToRecentTitle=function(e){var t=contentUtils.HebrewPageType(e.Type,!0),n=contentUtils.IsHebrewMalePageType(e.Type);return(e.PageIndex>0?"הסרה מ":"הוספה ל")+t+" "+(n?"אחרונים":"אחרונות")},e.Delete=function(t){var n=t.Seq,a="האם למחוק "+t.HebrewType+" "+t.Description+"?";l.ask(a).then(function(){t.deleting=!0,c.delete(n).then(function(a){I=I.filter(function(e){return e.Seq!=n}),e.contentPagingService.setData(p()),t.deleting=!1},function(e){t.deleting=!1,alert("שגיאה בעת מחיקה, אנא נסו שוב מאוחר יותר")})})},e.getSportFieldStyle=function(e){return"background-color: "+contentUtils.getSportFieldColor(e)+";"},e.ToggleFeatured=function(n){function a(e){n.AddingToFeatured=!1,n.RegionIndex=e,h(),g(n)}function o(){alert("שגיאה בעת שמירת נתונים, נא לנסות שוב מאוחר יותר"),n.AddingToFeatured=!1}if(null!=e.selectedRegion){n.AddingToFeatured=!0;var i=(n.RegionIndex,e.selectedRegion.Id);if(n.RegionIndex>0){var r="/api/pages/region-page?page="+n.Seq+"&region="+i;t.delete(r).then(function(e){a(0)},o)}else{var s={PageSeq:n.Seq,Region:i};t.put("/api/pages/region-page",s).then(function(e){a(e.data.Index)},o)}}},e.RemoveFromFeatured=function(t){l.ask("האם להסיר מרשימת תוכן מקודם?").then(function(){e.ToggleFeatured(t)})},e.MoveFeaturedRight=function(e){f(e,-1)},e.MoveFeaturedLeft=function(e){f(e,1)}}angular.module("sport.content").controller("ContentRegionsController",["$scope","$http","$state","$timeout","$interval","$filter","$rootScope","$cookies","messageBox","ContentService",e])}(),function(){"use strict";function e(e,t){function n(e){e.Date=new Date(e.Date)}return{list:function(a,o,i){void 0===i&&(i=!1);var r="/api/pages",s=t({type:a,recent:o});return s&&(r+="?"+s),e.get(r).then(function(e){for(var t=0;t<e.data.length;t++)n(e.data[t]);return i?e.data:e.data.filter(function(e){return 1!=e.IsHidden})})},featured:function(){return e.get("/api/pages").then(function(e){var t=e.data.slice(0).filter(function(e){return e.FeaturedIndex>0});return t.sort(function(e,t){return e.FeaturedIndex-t.FeaturedIndex}),t.filter(function(e){return 1!=e.IsHidden})})},recent:function(t,a){void 0===a&&(a={});var o=a.amount||sportGlobalSettings.RecentAmount,i=a.sportField||0,r=a.takeAll||!1;t.hasOwnProperty("length")||(t=[t]);var s="/api/pages?type=0";return i>0&&(s+="&sport="+i),e.get(s).then(function(e){var a={},i=e.data.slice(0);return t.forEach(function(e){var t=i.filter(function(t){return(0==e||t.Type==e)&&1!=t.IsHidden});r||(t=t.filter(function(e){return e.PageIndex>0})),t=t.take(o);for(var s=0;s<t.length;s++)n(t[s]);t.sort(function(e,t){return r?t.Date.getTime()-e.Date.getTime():e.PageIndex-t.PageIndex}),a["Type_"+e]=t}),a})},championship:function(t){var a="/api/pages/championship/"+t;return e.get(a).then(function(e){for(var t=0;t<e.data.length;t++)n(e.data[t]);return e.data})},create:function(t){return e.post("/api/pages",{page:t}).then(function(e){return e.data})},read:function(t){return e.get("/api/pages/"+t).then(function(e){return n(e.data),e.data})},update:function(t){return e.put("/api/pages",{pageData:t}).then(function(e){return e.data})},delete:function(t){return e.delete("/api/pages/"+t)},setFeaturedPages:function(t){return e.post("/api/pages/featured",{pages:t})},setRecentPages:function(t,n){return e.post("/api/pages/recent",{pages:t,type:n})},removeRecentPage:function(t){return e.delete("/api/pages/recent?page="+t)},hide:function(t){return e.put("/api/pages/"+t+"/hide",{})},unhide:function(t){return e.put("/api/pages/"+t+"/unhide",{})}}}angular.module("sport.content").factory("ContentService",["$http","$httpParamSerializer",e])}();for(var _schoolSportPageTypes=[{Id:1,Name:"gallery",Hebrew:{Singular:"גלריית תמונות",Plural:"גלריות תמונות",Male:!1},Icon:"fa fa-picture-o",Banner:"business"},{Id:2,Name:"article",Hebrew:{Singular:"כתבה",Plural:"כתבות",Male:!1},Icon:"fa fa-file-text",Banner:"sport"},{Id:3,Name:"video",Hebrew:{Singular:"סרטון",Plural:"ספריית VOD",Male:!0},Icon:"fa fa-video-camera",Banner:"travel"},{Id:5,Name:"files",Hebrew:{Singular:"טבלת קבצים",Plural:"טבלאות קבצים",Male:!1},Icon:"fa fa-files-o",Banner:"education"},{Id:7,Name:"event",Hebrew:{Singular:"אירוע",Plural:"אירועים",Male:!0},Icon:"fa fa-calendar",Banner:"politics"}],_schoolSportSectionTypes=[{Id:1,Name:"pictures",Hebrew:"תמונות",Title:"הוספת תמונות"},{Id:2,Name:"text",Hebrew:"טקסט",Title:"נא להזין טקסט"},{Id:3,Name:"video",Hebrew:"סרטון",Title:"הוספת סרטון"},{Id:5,Name:"files",Hebrew:"קבצים",Title:"הוספת קבצים"},{Id:6,Name:"contact",Hebrew:"איש קשר",Title:"הוספת איש קשר",Icon:"fa fa-user"}],_schoolSportThumbnailTypes={1:{RatioWidth:214,RatioHeight:234,Title:"סליידר"},2:{RatioWidth:383,RatioHeight:100,Title:"עמוד הבית"}},_schoolSportPageTypeMappings={MapByName:{},MapById:{}},i=0;i<_schoolSportPageTypes.length;i++){var curPageType=_schoolSportPageTypes[i];_schoolSportPageTypeMappings.MapByName[curPageType.Name]=curPageType,_schoolSportPageTypeMappings.MapById[curPageType.Id.toString()]=curPageType}for(var _schoolSportSectionMappings={BySectionName:{},BySectionId:{}},i=0;i<_schoolSportSectionTypes.length;i++){var curSectionType=_schoolSportSectionTypes[i],matchingPage=_schoolSportPageTypeMappings.MapById[curSectionType.Id.toString()];matchingPage&&(curSectionType.Icon=matchingPage.Icon),_schoolSportSectionMappings.BySectionName[curSectionType.Name]=curSectionType,_schoolSportSectionMappings.BySectionId[curSectionType.Id.toString()]=curSectionType}var contentUtils={pageTypeMapping:{},sportFieldColorMapping:{},regionColorMapping:{},croppedImagesMapping:{},GetThumbnailType:function(e){return _schoolSportThumbnailTypes[e.toString()]||{}},GetPageTypes:function(){for(var e=[],t=0;t<_schoolSportPageTypes.length;t++){var n=_schoolSportPageTypes[t],a={};for(var o in n)a[o]=n[o];e.push(a)}return e},GetPageTypeMapping:function(){return sportUtils.shallowCopy(contentUtils.pageTypeMapping)},GetPageTypeBySeq:function(e){return contentUtils.pageTypeMapping[e.toString()]||null},GetSectionTypes:function(){for(var e=[],t=0;t<_schoolSportSectionTypes.length;t++){var n=_schoolSportSectionTypes[t],a={};for(var o in n)a[o]=n[o];e.push(a)}return e},HebrewPageType:function(e,t){isNaN(parseInt(e))||(e=this.ParsePageType(e)),void 0===t&&(t=!1);var n=t?"Plural":"Singular",a=_schoolSportPageTypeMappings.MapByName[e];return a?a.Hebrew[n]:""},IsHebrewMalePageType:function(e){isNaN(parseInt(e))||(e=this.ParsePageType(e));var t=_schoolSportPageTypeMappings.MapByName[e];return!!t&&t.Hebrew.Male},HebrewSectionType:function(e){var t=_schoolSportSectionMappings.BySectionId[e.toString()];return t?t.Hebrew:""},HebrewSectionTitle:function(e){var t=_schoolSportSectionMappings.BySectionId[e.toString()];return t?t.Title:""},GetPageIcon:function(e){var t=_schoolSportPageTypeMappings.MapById[e.toString()];return t?t.Icon:""},GetBannerType:function(e){var t=_schoolSportPageTypeMappings.MapById[e.toString()];return t?t.Banner:""},ParsePageType:function(e){if(isNaN(parseInt(e))){var t=_schoolSportPageTypeMappings.MapByName[e];return t?t.Id:0}var t=_schoolSportPageTypeMappings.MapById[e.toString()];return t?t.Name:""},ExtractAllAttachments:function(e){var t=[];if(e.Sections)for(var n=0;n<e.Sections.length;n++){var a=e.Sections[n],o=a.Attachments||a.Data;if((1==a.Type||5==a.Type||6==a.Type)&&o&&o.length>0){for(var i=o.slice(0),r=0;r<i.length;r++){var s=i[r];s.SectionIndex=n,s.SectionType=a.Type,s.Index=r}sportUtils.CopyArray(i,t)}}return t},ExtractFirstVideo:function(e){var t="";if(e.Sections){var n=e.Sections.filter(function(e){return 3==e.Type});n.length>0&&(t=n[0].Data||"")}return t},BuildImageRows:function(e,t){var n=e.slice(0);n.sort(function(e,t){return e.Index-t.Index}),n=t>0?sportUtils.SplitArray(n,t):[n];for(var a=0;a<n.length;a++){var o=n[a];!function(e){var n=t>0?Math.floor(12/t):0;e.ImageCells=[];for(var a=0,o=0;o<e.length;o++){var i=e[o];n>0&&(i.ColWidth=n,a+=n,i.ColOffset=o==e.length-1?12-a:0),e.ImageCells.push(i)}}(o)}return n},RearrangeSections:function(e){if(e.Sections){e.Sections.sort(function(e,t){return e.Index-t.Index});for(var t=0;t<e.Sections.length;t++)e.Sections[t].Index=t}},GotValidData:function(e){if(6==e.Type){return(e.Data&&e.Data.Name?$.trim(e.Data.Name):"").length>0}var t=$.trim(e.Data||"");return 3==e.Type?0!=t.length&&(e.Video&&e.Video.Valid):t.length>0||!(1!=e.Type&&5!=e.Type||!e.NewAttachments||!(e.NewAttachments.length>0))},TryParseVideo:function(e,t){function n(t){var n="",a=e.lastIndexOf(t);if(a>=0){n=e.substring(a+t.length);var o=n.indexOf("?")+1||n.indexOf("&")+1;o>0&&(n=n.substring(0,o-1))}return n}if(!e||0==e.length)return!1;if(e.indexOf("youtu.be/")>=0||e.indexOf("youtube.com/")>=0){var a=n("?v=");if(0==a.length&&(a=n("/")),a.length>0)return t.id=a,t.url="https://www.youtube.com/watch?v="+a,t.embed="https://www.youtube.com/embed/"+a+"?autoplay=1",t.thumbnail="https://img.youtube.com/vi/"+a+"/0.jpg",!0}else if(e.indexOf("vimeo.com/")>=0){var a=n("/");if(a.length>0&&parseInt(a)==a)return t.id=a,t.url="https://vimeo.com/"+a,t.embed="https://player.vimeo.com/video/"+a+"?autoplay=1",t.thumbnail="",!0}return!1},BuildDefaultImagePath:function(e){var t=this,n="";if(3==e.Type){var a=t.ExtractFirstVideo(e);if(a.length>0){var o={};t.TryParseVideo(a,o)&&(n=o.thumbnail)}}else if(e.DefaultImage){e.DefaultImage.Seq;n="/content/Images/"+e.Seq+"/"+e.DefaultImage.Name}return n.length>0?n:"images/default_content_image.png"},BuildCroppedImages:function(e){function t(t,a){var o=0,i="";switch(a){case 1:o=e.SliderThumbnailSeq,i=e.SliderThumbnailImage;break;case 2:o=e.HomepageThumbnailSeq,i=e.HomepageThumbnailImage}0!=o&&null!=o||!e.DefaultImage||(o=e.DefaultImage.Seq);var r=e.DefaultImagePath;if(o){var s=o+"_"+t,l=n.croppedImagesMapping[s];l?r="/content/Cropped/"+o+"/"+l.File:i&&i.length>0&&(r="/content/Images/"+e.Seq+"/"+i)}return r}var n=this;e.CroppedImage_Slider=t("214x234",1),e.CroppedImage_Homepage=t("383x100",2)},ApplyVideoData:function(e,t){var n=this;if(e)for(var a=e.filter(function(e){return 3==e.Type}),o=0;o<a.length;o++){var i=a[o];if(i.Video||(i.Video={Valid:!1}),i.Data){var r={};n.TryParseVideo(i.Data,r)?(i.Data=r.url,i.Video.Url=t.trustAsResourceUrl(r.embed),i.Video.Valid=!0):(i.Video.Url="",i.Video.Valid=!1)}else i.Video.Url="",i.Video.Valid=!1}},InitPageTypes:function(e){if(null!=e)for(var t=this,n=0;n<e.length;n++){var a=e[n];t.pageTypeMapping[a.Seq.toString()]=_schoolSportPageTypeMappings.MapById[a.Type.toString()]}},InitSportFieldColors:function(e,t){void 0===t&&(t=null);var n=this;e.get("/api/common/sportFieldColors").then(function(e){for(var a=0;a<e.data.length;a++){var o=e.data[a];n.sportFieldColorMapping[o.SportFieldSeq.toString()]=o.Color}t&&t("OK")},function(e){console.log("error loading colors: "+e),t&&t("ERROR")})},InitRegionColors:function(e,t){void 0===t&&(t=null);var n=this;e.get("/api/common/regionColors").then(function(e){for(var a=0;a<e.data.length;a++){var o=e.data[a];n.regionColorMapping[o.RegionId.toString()]=o.Color}t&&t("OK")},function(e){console.log("error loading colors: "+e),t&&t("ERROR")})},InitCroppedImages:function(e,t){void 0===t&&(t=null);var n=this;n.croppedImagesMapping={},e.get("/api/images/cropped").then(function(e){var a=e.data;if(a)for(var o=0;o<a.length;o++){var i=a[o],r=i.ImageSeq+"_"+i.AspectRatio;n.croppedImagesMapping[r]={File:i.FileName,Data:i.MetaData}}t&&t("OK")},function(e){console.log("error loading cropped images:"),console.log(e),t&&t("ERROR")})},getSportFieldColor:function(e){if(e){var t=e.toString();return contentUtils.sportFieldColorMapping[t]||"#c0c0c0"}return"transparent"},getRegionColor:function(e){var t=e.toString();return contentUtils.regionColorMapping[t]||"transparent"},getCroppedImage:function(e,t){var n=this,a=e+"_"+t;return n.croppedImagesMapping[a]||{File:""}},setCroppedImage:function(e,t,n,a){var o=this,i=e+"_"+t;o.croppedImagesMapping[i]={File:n,Data:a}},storeStateChange:function(e,t,n){var a="scs_"+t.name,o=n.name;e.put(a,o)},ApplyPagesData:function(e){for(var t=0;t<e.length;t++){var n=e[t];n.DefaultImagePath=contentUtils.BuildDefaultImagePath(n),contentUtils.BuildCroppedImages(n),n.EncodedSubCaption=sportUtils.EncodeHTML(n.SubCaption),n.ShortSubCaption=sportUtils.EncodeHTML(sportUtils.CreateShortVersion(n.SubCaption,80,!1))}},ExtractFileExtension:function(e){return(e||"").split(".").slice(-1)[0].toLowerCase()},IsImageFile:function(e,t){return void 0===t&&(t=contentUtils.ExtractFileExtension(e)),"jpg"==t||"jpeg"==t||"png"==t||"gif"==t||"bmp"==t},GeneratePreviewClass:function(e,t){void 0===t&&(t=contentUtils.ExtractFileExtension(e));var n="";switch(t){case"xls":case"xlsx":n="excel";break;case"pdf":n="pdf";break;case"ppt":case"pptx":n="powerpoint";break;case"txt":n="text";break;case"doc":case"docx":n="word";break;case"zip":n="zip"}var a="fa-file";return n.length>0&&(a+="-"+n),"fa "+(a+="-o")},ParseFileType:function(e){var t=contentUtils.ExtractFileExtension(e);if(""==t)return"ללא סיומת";if(contentUtils.IsImageFile(e,t))return"תמונה";switch(t){case"doc":case"docx":return"מסמך וורד";case"xls":case"xlsx":return"גיליון אקסל";case"pdf":return"PDF";case"txt":return"קובץ טקסט";case"zip":case"7z":case"rar":return"קובץ מכווץ";case"mp4":case"mpg":case"mpeg":case"avi":return"סרטון"}return"אחר"},CarouselAutoSlide:function(e){var t=$("#"+e);if(1==t.length){var n=t.find(".owl-next"),a=t.find(".owl-prev"),o=parseInt(t.data("auto-slide-stop-after"));if(!isNaN(o)&&o>=0)for(var i=0;i<o;i++)n.trigger("click");else{var r=parseInt(t.data("auto-slide-seconds"));(isNaN(r)||r<=0)&&(r=3);var s=0,l=function(){s&&window.clearTimeout(s),s=window.setTimeout(function(){n.trigger("click")},1e3*r)};n.bind("click",l),a.bind("click",l),n.trigger("click")}}else window.setTimeout(function(){contentUtils.CarouselAutoSlide(e)},100)},ReadContentDescriptionAndImages:function(e,t){return t.read(e).then(function(e){var t=contentUtils.ExtractAllAttachments(e).filter(function(e){return 1==e.SectionType});return{Description:e.Description,Images:t}})},ApplyPageTypes:function(e){function t(e){if(null!=e){var n=e.hasOwnProperty("Seq");if(sportUtils.IsInteger(e)||n){var a=n?e.Seq:e,o=contentUtils.GetPageTypeBySeq(a),i=o?o.Name:"page";return n?(e.Type=i,e):{Seq:a,Type:i}}if(e.hasOwnProperty("length"))for(var r=0;r<e.length;r++){var s=e[r];e[r]=t(s)}else for(var l in e)if(l){var c=e[l];e[l]=t(c)}}return e}for(var n in e){var a=e[n];e[n]=t(a)}}};!function(){"use strict";function e(e,t,n,a,o,i,r,s,l,c,u,d,p,g){function h(t){var n=e.eventFilters.Calendar?e.eventFilters.Calendar.SelectedDate:null;return!n||t.DateWithoutTime.isSameDate(n)}function f(){var t=[],n=e.eventFilters.SportFields.length;if(n>0){var a=e.eventFilters.Championships.length,o=e.eventFilters.Categories.length,i=e.eventFilters.SportFields.toAssociativeArray(),s=e.eventFilters.Championships.toAssociativeArray(),l=e.eventFilters.Categories.toAssociativeArray();t=F.filter(h).filter(function(e){if(o>0)return l[e.Description];if(a>0){var t=e.CHAMPIONSHIP_NAME;return s[t]}return!(n>0)||i[e.SPORT_ID.toString()]}),t=r("orderBy")(t,e.sortColumn)}return t}function m(){e.pagingService.setData(f())}function v(){e.sportFieldsInUse=sportUtils.DistinctArray(F.filter(h).map(function(e){return e.SPORT_ID})).map(function(e){return{Id:e,Name:P.Full[e.toString()]}});for(var t=0;t<e.sportFieldsInUse.length;t++){var n=e.sportFieldsInUse[t];n.SportWordCount=sportUtils.countWords(n.Name)}if(e.sportFieldsInUse.length>0){for(var a=12-e.sportFieldsInUse.length,t=0;t<a;t++)e.sportFieldsInUse.push({Id:0,Name:"Blank_"+(t+1)});e.sportFieldsInUse.sort(function(e,t){return e.Id-t.Id})}e.noEventsInRange=0==e.sportFieldsInUse.length}function S(){if(0==e.eventFilters.SportFields.length)return e.eventFilters.Championships=[],void(e.championshipsInUse.Rows=[]);var t=e.eventFilters.SportFields.toAssociativeArray(),n=e.championshipsInUse.All.filter(function(e){return t[e.SportField.toString()]});e.championshipsInUse.Matching=n;var a=sportUtils.SplitArray(n,6);if(a.length>0){for(var o=a[a.length-1],i=6-o.length,r=0;r<i;r++)o.push({SportField:0,Name:"Blank_"+(r+1)});for(var r=0;r<a.length;r++){a[r].sort(function(e,t){return e.SportField-t.SportField})}}e.championshipsInUse.Rows=a}function y(){if(0==e.eventFilters.Championships.length)return e.eventFilters.Categories=[],void(e.categoriesInUse.Rows=[]);var t=e.eventFilters.Championships.toAssociativeArray(),n=e.categoriesInUse.All.filter(function(e){return t[e.Championship]});e.categoriesInUse.Matching=n;var a=sportUtils.SplitArray(n,6);if(a.length>0){for(var o=a[a.length-1],i=6-o.length,r=0;r<i;r++)o.push({SportField:0,Name:"Blank_"+(r+1)});for(var r=0;r<a.length;r++){a[r].sort(function(e,t){return e.SportField-t.SportField})}}e.eventFilters.Categories=[],e.categoriesInUse.Rows=a}function C(t,n,a,o){void 0!==a&&null!=a||(a=t),void 0===o&&(o=!1),e.eventFilters.Calendar=p.create(F,a);var i=[{Date:t},{Date:n}];if(e.eventFilters.Calendar.addItems(i,function(e,t){}),e.eventFilters.Calendar.selectedDate=a,e.eventFilters.Calendar.generateDayClass=function(e){var t=[];return e.currentMonth&&t.push("current-calendar-month"),e.selected?t.push("bg-primary"):this.selectedDate&&(e.currentMonth&&e.day==this.selectedDate.getDate()&&e.month==this.selectedDate.getMonth()&&e.year==this.selectedDate.getFullYear()?t.push("bg-info"):e.currentSelection&&!e.selected&&t.push("bg-success")),e.currentMonth&&e.items.length>0&&t.push("enabled"),t.join(" ")},e.eventFilters.Calendar.dayClicked=function(t){if(null==t||!t)return this.clearDaySelection(),e.eventFilters.Calendar.SelectedDate=null,v(),e.clearSportFieldFilter(),void m();if(t.currentMonth){this.selectDay(t),e.eventFilters.Calendar.SelectedDate=new Date(t.year,t.month,t.day),v(),e.clearSportFieldFilter(),m();for(var n=0;n<e.sportFieldsInUse.length;n++)e.toggleSportFieldFilter(e.sportFieldsInUse[n])}},e.eventFilters.Calendar.selectMonth(),o){var r=a.getFullYear(),s=a.getMonth(),a=a.getDate();l(function(){for(var t=!1,n=0;n<e.eventFilters.Calendar.selectedMonth.weeks.length&&!t;n++)for(var o=e.eventFilters.Calendar.selectedMonth.weeks[n],i=0;i<o.days.length;i++){var l=o.days[i];if(l.currentMonth&&l.year==r&&l.month==s&&l.day==a){t=!0,e.eventFilters.Calendar.dayClicked(l);break}}},500)}}function I(){function t(){if(e.seasons&&e.seasons.length>0){var t=$.trim($("#ddlSeason").find(".select_title").text()),n=e.seasons.filter(function(e){return e.Name==t});if(n.length>0){return n[0]}}return null}s(function(){var n=t();null!=n&&n.Season!=e.eventFilters.Season&&(e.eventFilters.Season=n.Season,_().then(function(){e.eventFilters.Calendar.dayClicked(null),C(n.FirstDay,n.LastDay,null,!1),e.clearSportFieldFilter()}))},500)}function T(){u.sportFields(!0).then(function(e){window.qL_step_finished=!0,P=e,ChainFactory.Next()},function(e){console.log("error reading sport fields: "+e),window.qL_step_finished=!0,ChainFactory.Next()})}function w(){e.seasons=[],u.seasons.inUse().then(function(t){window.qL_step_finished=!0,t.sort(function(e,t){return e.Season-t.Season});for(var n=0;n<t.length;n++){var a=t[n];(0==e.currentSeason.Season&&a.IsCurrent||e.currentSeason.Season>0&&a.Season==e.currentSeason.Season)&&(e.currentSeason=a,e.eventFilters.Season=e.currentSeason.Season),e.seasons.push(a)}window.setTimeout(function(){sportUtils.InitCustomSelect()},100),ChainFactory.Next()},function(e){console.log("error getting seasons"),console.log(e),window.qL_step_finished=!0,ChainFactory.Next()})}function _(){var t=o.defer();F=[];var n=e.eventFilters.Season||0,a={mergeSameDayEvents:!1};n>0&&(a.season=n);var i=n>0?{season:n}:{};return c.sportsmanEvents(a).then(function(n){window.qL_step_finished=!0;for(var a=0;a<n.length;a++){var o=n[a];o.TeamA=eventsUtils.BuildTeamName(o,"A"),o.TeamB=eventsUtils.BuildTeamName(o,"B"),o.Description=o.CHAMPIONSHIP_NAME+" "+o.CATEGORY_NAME,o.GameDetails=eventsUtils.BuildGameDetails(o),o.EventType=1,F.push(o)}c.sportFlowersEvents(i).then(function(n){window.qL_step_finished=!0;for(var a=0;a<n.length;a++){var o=n[a];o.SPORT_NAME=b,o.SPORT_ID=sportGlobalSettings.FlowersFieldSeq,o.Description=o.SportFieldName+" "+(o.FacilityName||""),o.FACILITY_NAME=o.FacilityName,o.CHAMPIONSHIP_NAME=N+" "+o.EventName,o.GameDetails="",o.EventType=2,F.push(o)}c.practiceCampEvents(i).then(function(n){window.qL_step_finished=!0;for(var a=0;a<n.length;a++){var o=n[a];o.SPORT_ID=sportGlobalSettings.YoungSportsmenSeq,o.Description="מחנה אימון "+o.SPORT_NAME,o.GameDetails="",o.EventType=3,F.push(o)}d.list(7,0,!1).then(function(n){window.qL_step_finished=!0;for(var a=0;a<n.length;a++){var o=n[a];o.SPORT_ID=o.SportFieldSeq,o.SPORT_NAME=P.Full[o.SPORT_ID.toString()]||"אירוע",o.GameDetails="",o.EventType=5,F.push(o)}F.forEach(function(e){e.DateWithoutTime=e.Date.withoutTime(),e.ShortSportName=P.Short[e.SPORT_ID.toString()]||e.SPORT_NAME,e.SportWordCount=sportUtils.countWords(e.ShortSportName)}),F.sort(function(e,t){return e.Date.getTime()-t.Date.getTime()});var i=F.toAssociativeArray(!0,"CHAMPIONSHIP_NAME","SPORT_ID");e.championshipsInUse.All=sportUtils.DistinctArray(F.map(function(e){return e.CHAMPIONSHIP_NAME})).map(function(e){return{Name:e,SportField:i[e]||sportGlobalSettings.FlowersFieldSeq}}),S(),e.categoriesInUse.All=[];for(var r={},a=0;a<F.length;a++){var o=F[a],s=o.SPORT_ID==sportGlobalSettings.FlowersFieldSeq?o.Description:o.CATEGORY_NAME,l=o.SPORT_ID==sportGlobalSettings.FlowersFieldSeq?o.Description:o.CHAMPIONSHIP_NAME,c=o.SPORT_ID+"_"+s;r[c]||(e.categoriesInUse.All.push({Name:s,Championship:l,SportField:o.SPORT_ID}),r[c]=!0)}y(),v(),m(),window.qL_Finish_Now=!0,t.resolve("done")},function(e){console.log("error reading custom events"),window.qL_Finish_Now=!0,console.log(e),t.reject("שגיאה בעת  טעינת נתונים מהשרת")})},function(e){console.log("error reading practice camp events"),window.qL_Finish_Now=!0,console.log(e),t.reject("שגיאה בעת  טעינת נתונים מהשרת")})},function(e){console.log("error reading sportsman events"),window.qL_Finish_Now=!0,console.log(e),t.reject("שגיאה בעת  טעינת נתונים מהשרת")})},function(e){console.log("error reading sport flowers events"),window.qL_Finish_Now=!0,console.log(e),t.reject("שגיאה בעת  טעינת נתונים מהשרת")}),t.promise}function D(){b=P.Full[sportGlobalSettings.FlowersFieldSeq.toString()],0==N.length&&(N="אירוע "+b),_().then(function(){var t=n.date,a=!0,o=sportUtils.parseDate(t);if(null==o){a=!1;var i=new Date;o=i>=e.currentSeason.FirstDay&&i<=e.currentSeason.LastDay?i:e.currentSeason.FirstDay}if(C(e.currentSeason.FirstDay,e.currentSeason.LastDay,o,a),I(),localStorage.EventsSportFieldFilter){var r=parseInt(localStorage.EventsSportFieldFilter),s=e.sportFieldsInUse.findItem(function(e){return e.Id==r});null!=s&&(localStorage.removeItem("EventsSportFieldFilter"),e.toggleSportFieldFilter(s))}ChainFactory.Next()},function(t){e.error=t,ChainFactory.Next()})}var P={},F=[],N="",b=((new Date).withoutTime(),"");e.eventFilters={SportFields:[],Championships:[],Categories:[],Calendar:null,Season:0},e.sportFieldsInUse=[],e.championshipsInUse={All:[],Rows:[]},e.categoriesInUse={All:[],Rows:[]},e.seasons=[],e.currentSeason=sportUtils.getCurrentSeason(),e.sortColumn="+Date",e.error="",e.noEventsInRange=!1,e.sportFlowersSeq=sportGlobalSettings.FlowersFieldSeq,contentUtils.InitSportFieldColors(i,function(){window.qL_step_finished=!0}),e.pagingService=new PagingService(f()),e.events=[],e.pagingService.applyPaging(e.events),ChainFactory.Execute(T,w,D),window.qL_steps_amount=6,e.sortBy=function(t){e.sortColumn==="+"+t?e.sortColumn="-"+t:e.sortColumn="+"+t,m()},e.getSportFieldColor=contentUtils.getSportFieldColor,e.getRoundedRectangleClass=sportUtils.getRoundedRectangleClass,e.getDateFilterText=function(e){return null!=e&&e?r("date")(e,"dd/MM/yyyy"):"[ללא הגבלה]"},e.sportFlowersChampFilterCount=function(){if(e.championshipsInUse.Rows.length>0){for(var t=0,n=0;n<e.championshipsInUse.Rows.length;n++){t+=e.championshipsInUse.Rows[n].filter(function(e){return 0==e.Name.indexOf(N)}).length}return t}return 0},e.totalChampionshipsInUse=function(){for(var t=0,n=0;n<e.championshipsInUse.Rows.length;n++)t+=e.championshipsInUse.Rows[n].filter(function(e){return e.SportField>0}).length;return t},e.getSportFieldFilterStyle=function(e){var t=e.Id||e.SportField,n=contentUtils.getSportFieldColor(t),a=sportUtils.getRoundedRectangleStyle(e,n);return e.SportWordCount&&e.SportWordCount>2&&(a+=" line-height: inherit;"),a},e.getSportFieldStyle=function(e){var t=contentUtils.getSportFieldColor(e);return"background-color: "+t+"; border-color: "+t+";"},e.toggleSportFieldFilter=function(t){var n=t.Id,a=n.toString(),o=e.eventFilters.SportFields.toAssociativeArray();o[a]=!o[a],t.Selected=o[a],e.eventFilters.SportFields=sportUtils.FlattenAssociativeArray(o,!0),e.championshipsInUse.All.filter(function(e){return e.SportField==n&&e.Selected}).forEach(function(t){e.toggleChampionshipFilter(t)}),S(),m()},e.toggleChampionshipFilter=function(t){var n=t.Name,a=e.eventFilters.Championships.toAssociativeArray();a[n]=!a[n],t.Selected=a[n],e.eventFilters.Championships=sportUtils.FlattenAssociativeArray(a,!0),y(),m()},e.toggleCategoryFilter=function(t){var n=t.Name,a=t.Championship,o=a;n!=a&&(o+=" "+n);var i=e.eventFilters.Categories.toAssociativeArray();i[o]=!i[o],t.Selected=i[o],e.eventFilters.Categories=sportUtils.FlattenAssociativeArray(i,!0),m()},e.clearSportFieldFilter=function(){e.eventFilters.SportFields=[];for(var t=0;t<e.sportFieldsInUse.length;t++)e.sportFieldsInUse[t].Selected=!1;S(),y(),m()},e.clearChampionshipFilter=function(){e.eventFilters.Championships=[];for(var t=0;t<e.championshipsInUse.Rows.length;t++)for(var n=e.championshipsInUse.Rows[t],a=0;a<n.length;a++)n[a].Selected=!1;e.clearCategoriesFilter(),m()},e.clearCategoriesFilter=function(){e.eventFilters.Categories=[];for(var t=0;t<e.categoriesInUse.Rows.length;t++)for(var n=e.categoriesInUse.Rows[t],a=0;a<n.length;a++)n[a].Selected=!1;y(),m()}}angular.module("sport.events").controller("EventsController",["$scope","$state","$stateParams","$sce","$q","$http","$filter","$interval","$timeout","EventsService","SportService","ContentService","calendarService","dateSelector",e])}(),function(){"use strict";function e(e){if(e.Date&&e.Date.getFullYear){var t=e.Date.getFullYear();return t>=2e3&&t<=2100}return!0}function t(t,n,a,o){function i(e){e.StartDate?e.Date=new Date(e.StartDate):e.DateTime?e.Date=new Date(e.DateTime):e.TIME&&(e.Date=new Date(e.TIME)),e.Date&&(e.MonthName=sportUtils.HebrewMonthName(e.Date.getMonth()+1)),(e.TEAM_A_SCORE||e.TEAM_B_SCORE)&&null==e.MatchResult&&(e.TEAM_A_SCORE=null,e.TEAM_B_SCORE=null)}return{sportFlowersEvents:function(a){void 0===a&&(a={});var o=a.season,r="/api/flowers/events";if(o){r+="?"+n({season:o})}return t.get(r).then(function(t){for(var n=0;n<t.data.length;n++)i(t.data[n]);return t.data.filter(e)})},sportsmanEvents:function(r){void 0===r&&(r={});var s=r.mergeSameDayEvents||!1;return o.currentSeason(r.season).then(function(o){var l=r.category||0,c="/api/sportsman/events";if(o||l){c+="?"+n({season:o,category:l})}return t.get(c).then(function(t){for(var n=0;n<t.data.length;n++)i(t.data[n]);if(s){for(var o={},n=0;n<t.data.length;n++){var r=t.data[n],l=r.Date?r.Date:new Date,c=a("date")(l,"dd/MM/yyyy")+"_"+r.CHAMPIONSHIP_NAME+" "+r.CATEGORY_NAME;o[c]||(o[c]=[]),o[c].push(r)}var u=[];for(var c in o){var d=o[c];if(d.length<=1)sportUtils.CopyArray(d,u);else{var p=d[0];p.DailyEvents=[],sportUtils.CopyArray(d,p.DailyEvents),u.push(p)}}return u.filter(e)}return t.data.filter(e)})})},practiceCampEvents:function(e){return void 0===e&&(e={}),o.currentSeason(e.season).then(function(e){var a="/api/sportsman/practice-camps";if(e){a+="?"+n({season:e})}return t.get(a).then(function(e){for(var t=0;t<e.data.length;t++){var n=e.data[t];n.DATE_START=new Date(n.DATE_START),n.DATE_FINISH=new Date(n.DATE_FINISH),n.Date=n.DATE_START}return e.data})})},eventsRange:function(){return t.get("/api/common/eventsRange").then(function(e){for(var t in e.data)e.data[t]=new Date(e.data[t]);return e.data})}}}angular.module("sport.events").factory("EventsService",["$http","$httpParamSerializer","$filter","SportService",t])}(),function(){"use strict";function e(e,t,n,a,o,i,r){function s(t){console.log("general error"),console.log(t),window.qL_Finish_Now=!0,e.error=!0,ChainFactory.Next()}function l(){contentUtils.InitSportFieldColors(n,function(){window.qL_step_finished=!0,ChainFactory.Next()})}function c(){r.sportFields().then(function(e){h=e,window.qL_step_finished=!0,ChainFactory.Next()},function(e){console.log("error reading sport fields"),console.log(e),window.qL_step_finished=!0,ChainFactory.Next()})}function u(){n.get("/api/flowers/attachments").then(function(t){e.attachments=t.data;for(var n=0;n<e.attachments.length;n++){var a=e.attachments[n];a.DateUploaded&&(a.DateUploaded=new Date(a.DateUploaded)),a.FileType=contentUtils.ParseFileType(a.FileName)}window.qL_step_finished=!0,ChainFactory.Next()},function(t){console.log("error loading attachments"),console.log(t),window.qL_step_finished=!0,e.attachmentsLoadingError=!0,ChainFactory.Next()})}function d(){n.get("/api/flowers/messages").then(function(t){e.messages=t.data;for(var n=0;n<e.messages.length;n++){var a=e.messages[n];a.DateCreated&&(a.DateCreated=new Date(a.DateCreated))}window.qL_step_finished=!0,ChainFactory.Next()},function(t){console.log("error loading messages"),console.log(t),window.qL_step_finished=!0,e.messageLoadingError=!0,ChainFactory.Next()})}function p(){e.upcomingEvents=[];var t=(new Date).withoutTime();i.sportFlowersEvents().then(function(n){for(var a=[],o=0;o<n.length;o++){var i=n[o];i.Date.withoutTime()>=t&&(i.SportFieldSeq=sportGlobalSettings.FlowersFieldSeq,i.Name=h[sportGlobalSettings.FlowersFieldSeq.toString()]+" "+i.SportFieldName,i.Details=i.FacilityName,a.push(i))}a.sort(function(e,t){return e.Date.getTime()-t.Date.getTime()}),e.upcomingEvents=a,window.qL_step_finished=!0,ChainFactory.Next()},s)}function g(){o.recent(0,{amount:sportGlobalSettings.RecentFlowersContent,sportField:sportGlobalSettings.FlowersFieldSeq,
takeAll:!0}).then(function(t){e.recentContent=t.Type_0,contentUtils.ApplyPagesData(e.recentContent);for(var n=0;n<e.recentContent.length;n++){var a=e.recentContent[n];a.HebrewType=contentUtils.HebrewPageType(a.Type),a.BannerButtonClass="button banner_button "+contentUtils.GetBannerType(a.Type)}window.qL_Finish_Now=!0,ChainFactory.Next()},s)}var h={};e.upcomingEvents=[],e.recentContent=[],e.messages=[],e.attachments=[],e.error=!1,e.messageLoadingError=!1,e.attachmentsLoadingError=!1,e.contentAutoSlideInterval=5,ChainFactory.Execute(c,l,p,d,u,g),window.qL_steps_amount=6,window.setTimeout(function(){contentUtils.CarouselAutoSlide("contentCarousel")},1e3*e.contentAutoSlideInterval),e.getSportFieldStyle=function(e){return"background-color: "+contentUtils.getSportFieldColor(e)+";"},e.GoToEvent=function(e){t.go("events.date",{date:a("date")(e.Date,"ddMMyyyy")})},e.getEventDateStyle=function(t,n){var a=[],o=0==n?10:0;return a.push(e.getSportFieldStyle(t.SportFieldSeq)),a.push("width: 60px;"),a.push("color: white;"),a.push("padding: 5px 5px 5px 5px;"),a.push("margin-top: "+o+"px;"),a.push("border: 2px solid "+contentUtils.getSportFieldColor(t.SportFieldSeq)+";"),a.push("border-radius: 5px;"),a.push("cursor: pointer"),a.join(" ")}}angular.module("sport.flowers").controller("FlowersController",["$scope","$state","$http","$filter","ContentService","EventsService","SportService",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s){function l(e,t){if(_){var n="";switch(t){case 1:n="reading ";break;case 2:n="finished to read ";break;case 3:n="error while reading "}n+=e+(1==t?"...":""),console.log(n)}}function c(t,n){void 0===n&&(n=!0),window.qL_step_finished=!0,t&&t.length>0&&(e[t+"LoadFinished"]=!0),n&&ChainFactory.Next()}function u(t,n){return void 0===n&&(n=null),function(){t&&t.length>0&&(e[t+"LoadError"]=!0),c(t,!1),ChainFactory.Next(),null!=n&&n()}}function d(){e.upcomingEvents=T.filter(function(t){return 1==e.activeEventsTab||e.activeEventsTab-1==t.Type}),window.setTimeout(function(){"undefined"!=typeof EventsLoadedHandler&&EventsLoadedHandler()},500)}function p(e){void 0===e&&(e=null),l("sport field colors",1),contentUtils.InitSportFieldColors(n,function(){l("sport field colors",2),ChainFactory.Next(),null!=e&&e()})}function g(e){void 0===e&&(e=null),l("cropped images",1),contentUtils.InitCroppedImages(n,function(){l("cropped images",2),ChainFactory.Next(),null!=e&&e()})}function h(e){void 0===e&&(e=null),l("sport fields",1),s.sportFields().then(function(t){l("sport fields",2),w=t,c("sportFields"),null!=e&&e()},u("sportFields",e))}function f(){l("featured pages",1),i.featured().then(function(t){e.featuredPages=t,contentUtils.ApplyPagesData(e.featuredPages);for(var n=0;n<e.featuredPages.length;n++){var a=e.featuredPages[n];a.BannerCssClass="button banner_button "+contentUtils.GetBannerType(a.Type),a.HebrewType=contentUtils.HebrewPageType(a.Type,!1)}l("featured pages",2),c("featuredPages"),sportUtils.DoWhenReady(".tp-bgimg.defaultimg",function(e){var t=e.css("background-image");if(null==t||!t||"none"==t){var n=e.data("src");n&&n.length>0&&e.css("background-image",'url("'+n+'")')}})},u("featuredPages"))}function m(t){void 0===t&&(t=null),l("advertisements",1);var a=(new Date).getTime();n.get("/api/Banners?type=1&randomize=1&nnn="+a).then(function(n){n.data&&n.data.Seq&&(e.advertisementBanner=n.data,e.advertisementBanner.VideoPath="/content/Banners/"+e.advertisementBanner.Seq+"/"+e.advertisementBanner.FileName),l("advertisements",2),c("advertisements"),null!=t&&t()},u("advertisements",t))}function v(t){void 0===t&&(t=null),l("recent pages",1),i.recent([3,1,2]).then(function(n){e.recentVideos=n.Type_3,contentUtils.ApplyPagesData(e.recentVideos),e.recentGalleries=n.Type_1,contentUtils.ApplyPagesData(e.recentGalleries),e.recentArticles=n.Type_2,contentUtils.ApplyPagesData(e.recentArticles),l("recent pages",2),c("recentPages"),null!=t&&t()},u("recentPages",t))}function S(e){void 0===e&&(e=null),T=[];var t=(new Date).withoutTime();l("flowers events",1),r.sportFlowersEvents().then(function(n){l("flowers events",2);for(var a=0;a<n.length;a++){var o=n[a];o.Date.withoutTime()>=t&&(o.SportFieldSeq=sportGlobalSettings.FlowersFieldSeq,o.Type=1,o.Name=w[sportGlobalSettings.FlowersFieldSeq.toString()]+" "+o.SportFieldName,o.Details=o.FacilityName,T.push(o))}l("sportsman events",1),r.sportsmanEvents({mergeSameDayEvents:!0}).then(function(n){l("sportsman events",2);for(var a=0;a<n.length;a++){var o=n[a];o.Date.withoutTime()>=t&&(o.SportFieldSeq=o.SPORT_ID,o.Type=1==parseInt(o.IS_CLUBS)?5:4,o.Name=o.CHAMPIONSHIP_NAME+" "+o.CATEGORY_NAME,o.Details=eventsUtils.BuildSportsmanDetails(o),T.push(o))}T.sort(function(e,t){return e.Date.getTime()-t.Date.getTime()}),d(),l("all events",2),c("events"),null!=e&&e()},u("events",e))},u("events",e))}function y(){window.setTimeout(function(){$(".tp-banner").revolution({delay:9e3,autoStart:!1,startwidth:1170,startheight:500,fullWidth:"on",hideTimerBar:"on",navigationType:"none",navigationArrows:"solo",navigationStyle:"square",soloArrowLeftVOffset:80,soloArrowRightVOffset:80})},50),ChainFactory.Next()}function C(t){void 0===t&&(t=null),n.get("/api/common/content-mapping").then(function(n){e.contentMapping=n.data;var a=e.contentMapping.RoadTripPartners;contentUtils.ReadContentDescriptionAndImages(a,i).then(function(n){e.contentMapping.RoadTripPartners={Seq:a,Images:n.Images,Description:n.Description},window.setTimeout(function(){contentUtils.CarouselAutoSlide("sponsorsCarousel")},1e3);var o=e.contentMapping.BusinessPartners;contentUtils.ReadContentDescriptionAndImages(o,i).then(function(n){e.contentMapping.BusinessPartners={Seq:o,Images:n.Images,Description:n.Description},window.setTimeout(function(){contentUtils.CarouselAutoSlide("partnersCarousel")},1e3),null!=t&&t()},function(e){console.log("error reading Business Partners images"),console.log(e),null!=t&&t()})},function(e){console.log("error reading Road Trip Partners images"),console.log(e),null!=t&&t()})})}function I(){h(),p(),S(),C(),g(),v(),m()}var T=[],w={},_=!1;if(e.error=!1,e.activeEventsTab=1,e.sponsorAutoSlideInterval=5,e.partnersAutoSlideInterval=5,e.contentMapping={},e.sportFlowersSeq=sportGlobalSettings.FlowersFieldSeq,sportUtils.IsMobile())return void t.go("home-mobile");sportUtils.FrameAutoSize({Id:"facebook_likebox_frame",Src:"https://www.facebook.com/plugins/likebox.php?href=http%3A%2F%2Fwww.facebook.com%2Fisrschspo&width=$width&colorscheme=light&show_faces=true&border_color&stream=true&height=462"});var D=setInterval(function(){"complete"==document.readyState&&(clearInterval(D),o(function(){I()},1e3))},100);ChainFactory.Execute(f,y),window.qL_steps_amount=2,window.setTimeout(function(){window.qL_Finish_Now=!0},5e3),sportUtils.InitiateScrollToTopProcess(),e.changeEventsTab=function(t){e.activeEventsTab=t,d()},e.getSportFieldStyle=function(e){return"background-color: "+contentUtils.getSportFieldColor(e)+";"},e.GoToPage=function(e){t.go("page",{page:e})},e.GoToEvent=function(e){t.go("events.date",{date:a("date")(e.Date,"ddMMyyyy")})},e.getEventDateStyle=function(t,n){var a=[],o=0==n?10:0;return a.push(e.getSportFieldStyle(t.SportFieldSeq)),a.push("width: 60px;"),a.push("color: white;"),a.push("padding: 5px 5px 5px 5px;"),a.push("margin-top: "+o+"px;"),a.push("border: 2px solid "+contentUtils.getSportFieldColor(t.SportFieldSeq)+";"),a.push("border-radius: 5px;"),a.push("cursor: pointer"),a.join(" ")}}angular.module("sport.home").controller("HomeController",["$scope","$state","$http","$filter","$timeout","ContentService","EventsService","SportService",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s){function l(t){e[t+"LoadFinished"]=!0}function c(t,n){return void 0===n&&(n=null),function(){t&&t.length>0&&(e[t+"LoadError"]=!0),l(t),null!=n&&n()}}function u(e){void 0===e&&(e=null),contentUtils.InitCroppedImages(n,function(){null!=e&&e()})}function d(t){void 0===t&&(t=null),i.recent([3,1,2]).then(function(n){e.recentVideos=n.Type_3,contentUtils.ApplyPagesData(e.recentVideos),e.recentGalleries=n.Type_1,contentUtils.ApplyPagesData(e.recentGalleries),e.recentArticles=n.Type_2,contentUtils.ApplyPagesData(e.recentArticles),null!=t&&t()},c("recentPages",t))}function p(t){void 0===t&&(t=null),e.contentMapping=sportUtils.shallowCopy(e.globalData.contentMapping);var n=e.contentMapping.RoadTripPartners;contentUtils.ReadContentDescriptionAndImages(n,i).then(function(a){e.contentMapping.RoadTripPartners={Seq:n,Images:a.Images,Description:a.Description},window.setTimeout(function(){contentUtils.CarouselAutoSlide("mobileSponsorsCarousel")},1e3);var o=e.contentMapping.BusinessPartners;contentUtils.ReadContentDescriptionAndImages(o,i).then(function(n){e.contentMapping.BusinessPartners={Seq:o,Images:n.Images,Description:n.Description},window.setTimeout(function(){contentUtils.CarouselAutoSlide("mobilePartnersCarousel")},1e3),null!=t&&t()},c("BusinessPartners",t))},c("RoadTripPartners",t))}function g(t){void 0===t&&(t=null);var a=(new Date).getTime();n.get("/api/Banners?type=1&randomize=1&nnn="+a).then(function(n){n.data&&n.data.Seq&&(e.advertisementBanner=n.data,e.advertisementBanner.VideoPath="/content/Banners/"+e.advertisementBanner.Seq+"/"+e.advertisementBanner.FileName),l("advertisements"),null!=t&&t()},c("advertisements",t))}function h(t){void 0===t&&(t=null),n.get("/api/pages").then(function(n){var a=n.data.slice(0),o=a.filter(function(e){return e.FeaturedIndex>0&&1!=e.IsHidden}),i=a.filter(function(e){return e.PageIndex>0&&1!=e.IsHidden});o.sort(function(e,t){return e.FeaturedIndex-t.FeaturedIndex}),i.sort(function(e,t){return e.PageIndex-t.PageIndex});var r=o.filter(function(e){return 2==e.Type}),s=o.filter(function(e){return 1==e.Type});if(0==r.length&&i.length>0){var c=i.findItem(function(e){return 2==e.Type});null!=c&&r.push(c)}if(0==s.length&&i.length>0){var u=i.findItem(function(e){return 1==e.Type});null!=u&&s.push(u)}var d=null;r.length>0&&(d=r[0],contentUtils.ApplyPagesData([d]),e.firstFeaturedArticle={Seq:d.Seq,Title:d.Description,ImagePath:d.CroppedImage_Slider||d.DefaultImagePath}),s.length>0&&(d=s[0],contentUtils.ApplyPagesData([d]),e.firstFeaturedGallery={Seq:d.Seq,Title:d.Description,ImagePath:d.CroppedImage_Slider||d.DefaultImagePath}),l("featuredPages"),null!=t&&t()},c("featuredPages",t))}function f(e,t,n,a,o){void 0===o&&(o="");var i=t.ValidItems,r=n>4?3:2,s=2==r?"mobile-wide-button-half":"mobile-wide-button-third";if(a.length>0&&(s+=" "+a),t.ValidItems++,e.ClassName=s,o.length>0&&(e[o]=r),e.Top=t.CurrentTop,e.Right=null,e.Left=null,n<5)i%2==0?e.Right=15:e.Left=15;else switch(i%3){case 0:e.Right=15;break;case 1:var l=Math.floor($(window).width()/3);e.Left=l+7;break;case 2:e.Left=15}t.ValidItems%r==0&&(t.CurrentTop+=65)}function m(e,t,n){if(e.CATEGORY_NAME){var a=e.CATEGORY_NAME.split(" ");if(2==a.length){e.CategoryGrades=a[0];var o=a[1];"תלמידות"==o?e.CategoryGenderClass="flaticon-female-silhouette":"תלמידים"==o&&(e.CategoryGenderClass="flaticon-man-standing-up"),e.PermanentChampionshipTitle&&(e.PermanentChampionshipTitle.indexOf("ישיבות")>=0&&(e.CategoryGrades="ישיבות"),e.PermanentChampionshipTitle.indexOf("גליל")>=0&&(e.CategoryGrades="גליל")),f(e,n,t,"mobile-category-grade-and-gender-panel","CategoriesInColumn")}}}function v(e){var t=e.filter(function(e){return null!=e.PermanentChampionshipIndex});t=sportUtils.DistinctArray(t,"CHAMPIONSHIP_CATEGORY_ID"),t.sortByProperty("PermanentChampionshipIndex");var n={ValidItems:0,CurrentTop:0};return t.forEach(function(e){m(e,t.length,n)}),t.ValidItems=n.ValidItems,t.Height=n.CurrentTop,t}function S(e,t,n,a){void 0===a&&(a=!0);var o=e.filter(t);o=sportUtils.DistinctArray(o,"CHAMPIONSHIP_CATEGORY_ID");var i={};return o.forEach(function(e){var t=(e[n]||"").toString();if(t.length>0){i[t]||(i[t]=[]);var o=sportUtils.shallowCopy(e);a&&(o.PermanentChampionshipTitle=null),i[t].push(o)}}),i}function y(e){var t=sportUtils.FlattenAssociativeArray(e),n=[],a=0;return t.length>0&&(t.forEach(function(t){var o=e[t],i=o[0].CHAMPIONSHIP_NAME,r={ValidItems:0,CurrentTop:25};o.forEach(function(e){m(e,o.length,r)}),n.push({ChampionshipName:i,Categories:o,Top:a});var s=r.CurrentTop-25;(o.length<5&&r.ValidItems%2!=0||o.length>=5&&r.ValidItems%3!=0)&&(s+=65),a+=35+s}),n.sortByProperty("ChampionshipName")),n.Height=a,n}function C(e,t){var n=S(e,function(e){return t?1==e.IS_CLUBS:1!=e.IS_CLUBS&&e.REGION_ID>0},"REGION_ID"),a=sportUtils.FlattenAssociativeArray(n),o=[],i={ValidItems:0,CurrentTop:0};return a.length>0&&(a.forEach(function(e){var t=n[e],r=S(t,function(e){return!0},"CHAMPIONSHIP_ID"),s=t[0].REGION_NAME,l=y(r),c={RegionName:s,Championships:l};f(c,i,a.length,"mobile-region-panel"),o.push(c)}),o.sortByProperty("RegionName")),o.Height=i.CurrentTop,(a.length<5&&i.ValidItems%2!=0||a.length>=5&&i.ValidItems%3!=0)&&(o.Height+=65),o}function I(e){return y(S(e,function(e){return 1!=e.IS_CLUBS&&0==e.REGION_ID},"CHAMPIONSHIP_ID"))}function T(t){void 0===t&&(t=null);var a=localStorage[sportGlobalSettings.LocalStorageKeys.CurrentSeason.Name]||"",i="/api/sportsman/championship-categories-data?season="+a;n.get(i).then(function(n){e.categoriesLoadFinished=!0;var a=S(n.data,function(e){return!0},"SPORT_NAME",!1),i=sportUtils.FlattenAssociativeArray(a);i.sort(),i.forEach(function(t){var n=t.split(" ").length,o="mobile-category-panel-sport-field-name";n>2&&(o+=" sport-field-name-small-font");var i=a[t],r=i[0].SPORT_ID,s=v(i),l=C(i,!0);l.OriginalHeight=l.Height;var c=C(i,!1);c.OriginalHeight=c.Height;var u=I(i);s.ValidItems%2!=0&&(s.Height+=65),e.categoriesData.push({SportFieldName:t,SportFieldSeq:r,SportFieldClass:o,IconClass:e.globalData.sportFieldIcons[r.toString()]||"",PermanentChampionships:s,ClubChampionships:l,RegionalChampionships:c,CentralRegionChampionships:u})}),null!=t&&t(),P&&o(function(){e.ToggleGamePlans()},500)},function(n){console.log("Error loading categories"),e.categoriesLoadError=!0,null!=t&&t()})}function w(t){void 0===t&&(t=null);n.get("/api/links").then(function(n){e.linksLoadFinished=!0,e.links=n.data,null!=t&&t()},function(n){console.log("Error loading links"),e.linksLoadError=!0,null!=t&&t()})}function _(){u(function(){o(function(){h(function(){o(function(){d(function(){o(function(){p(function(){o(function(){g(function(){o(function(){T(function(){o(function(){w()},500)})},500)})},500)})},500)})},500)})},500)})}e.firstFeaturedArticle=null,e.firstFeaturedGallery=null,e.categoriesData=[],e.links=null,e.sponsorAutoSlideInterval=5,e.partnersAutoSlideInterval=5,window.setTimeout(function(){window.qL_Finish_Now=!0},1e3);var D=sportUtils.ParseQueryString(),P=D.c||0;e.MoreArticlesClicked=function(){t.go("articles")},e.MoreGalleriesClicked=function(){t.go("galleries")},e.ToggleMoreLinks=function(){$("#mobileMoreLinksPlaceholder").toggle("slow")},e.ToggleGamePlans=function(){$("#mobileGamePlansPlaceholder").toggle("slow",function(){if(P){var t=!1;e.categoriesData.forEach(function(n){!t&&n.CentralRegionChampionships&&n.CentralRegionChampionships.forEach(function(a){t||a.Categories.forEach(function(a){a.CHAMPIONSHIP_CATEGORY_ID==P&&(e.ToggleSportFieldCategories(n,function(){e.ToggleCentralRegionChampionships(n),P=0}),t=!0)})}),!t&&n.ClubChampionships&&n.ClubChampionships.forEach(function(a){t||a.Championships.forEach(function(i){i.Categories.forEach(function(i){i.CHAMPIONSHIP_CATEGORY_ID==P&&(e.ToggleSportFieldCategories(n,function(){e.ToggleClubChampionships(n,function(){o(function(){e.clubRegionClicked(n,a),P=0},500)})}),t=!0)})})}),!t&&n.PermanentChampionships&&n.PermanentChampionships.forEach(function(a){a.CHAMPIONSHIP_CATEGORY_ID==P&&(e.ToggleSportFieldCategories(n),P=0,t=!0)}),!t&&n.RegionalChampionships&&n.RegionalChampionships.forEach(function(a){t||a.Championships.forEach(function(i){i.Categories.forEach(function(i){i.CHAMPIONSHIP_CATEGORY_ID==P&&(e.ToggleSportFieldCategories(n,function(){e.ToggleRegionalChampionships(n,function(){o(function(){e.regionalRegionClicked(n,a),P=0},500)})}),t=!0)})})})})}})},e.ToggleSportFieldCategories=function(e,t){void 0!==t&&null!=t||(t=function(){});var n=e.SportFieldSeq,a=$(".mobile-sport-field-category-list[data-sport-field-seq='"+n+"']");P&&a.parents("div").first().get(0).scrollIntoView(),a.toggle("slow",t)},e.TogglePermanentChampionships=function(e){var t=e.SportFieldSeq;$(".mobile-sport-field-category-list[data-sport-field-seq='"+t+"']").find(".mobile-permanent-championships-categories-list").toggle("slow")},e.ToggleCentralRegionChampionships=function(e){var t=e.SportFieldSeq;$(".mobile-sport-field-category-list[data-sport-field-seq='"+t+"']").find(".mobile-central-region-championships-list").toggle("slow")},e.ToggleClubChampionships=function(e,t){void 0!==t&&null!=t||(t=function(){});var n=e.SportFieldSeq;$(".mobile-sport-field-category-list[data-sport-field-seq='"+n+"']").find(".mobile-club-championships-placeholder").toggle("slow",t)},e.ToggleRegionalChampionships=function(e,t){void 0!==t&&null!=t||(t=function(){});var n=e.SportFieldSeq;$(".mobile-sport-field-category-list[data-sport-field-seq='"+n+"']").find(".mobile-regional-championships-placeholder").toggle("slow",t)},e.CategoryClicked=function(e){var n=e.CHAMPIONSHIP_CATEGORY_ID,a=e.PermanentChampionshipTitle?"p":e.REGION_ID;t.go("championships.region.championship",{clubs:e.IS_CLUBS,region:a,category:n})},e.clubRegionClicked=function(e,t){t.ClassName.indexOf("mobile-region-selected")>=0||(e.ClubChampionships.forEach(function(e){e.ClassName=e.ClassName.replace("mobile-region-selected","mobile-region-panel")}),t.ClassName=t.ClassName.replace("mobile-region-panel","mobile-region-selected")),e.SelectedClubRegion=t,e.ClubChampionships.Height=e.ClubChampionships.OriginalHeight+t.Championships.Height+10},e.regionalRegionClicked=function(e,t){t.ClassName.indexOf("mobile-region-selected")>=0||(e.RegionalChampionships.forEach(function(e){e.ClassName=e.ClassName.replace("mobile-region-selected","mobile-region-panel")}),t.ClassName=t.ClassName.replace("mobile-region-panel","mobile-region-selected")),e.SelectedRegionalRegion=t,e.RegionalChampionships.Height=e.RegionalChampionships.OriginalHeight+t.Championships.Height+10};var F=setInterval(function(){"complete"==document.readyState&&(clearInterval(F),o(function(){_()},1e3))},100);window.setInterval(function(){var e=$(".progress-dot");e.length>0&&e.each(function(){var e=$(this);if(e.parents("div").first().is(":visible")){var t=e.text().length;++t>3&&(t=1);var n=Array(t+1).join(".");e.text(n)}});var t=$(".mobile-image-slider");if(t.length>0){var n=$("#wrapper_container_mobile").offset().top;t.each(function(){var e=$(this),t=e.offset().top,a=e.find(".sponsor-img");if(a.length>0){var o=n>t?"0.2":"1";a.css("opacity",o)}})}},1e3)}angular.module("sport.mobile").controller("HomeMobileController",["$scope","$state","$http","$filter","$timeout","ContentService","EventsService","SportService",e])}(),function(){"use strict";function e(e,n,a,o,i,r,s,l,c,u){function d(){function t(e,t,n,a){var o=t[n]||"";"function"==typeof a&&(o=a(o)),$(e).val(o)}function a(e,t,n){var a="1"==t[n]?"1":"0";$("input[name='"+e+"'][value='"+a+"']").prop("checked",!0)}function o(e,t,n,a){var o=n[a]||"",i="",r="";if(o.indexOf("-")>0){var s=o.split("-").filter(function(e){return e.length>0});s.length>2&&(i=s[0],r=s.skip(1).join(""))}0==r.length&&(r=o),$(e).val(i),$(t).val(r)}function i(e,t){function a(e,t){var n=e.find("td");n.first().text(t.Name);var a=[];if(t.WeekdaysData.forEach(function(e){var t=e.WeekDay;if(t>0){var o=sportUtils.EncodeHTML(e.RawData);n.eq(t).html(o),a.push(t)}}),a.length>0)for(var o=a.toAssociativeArray(),i=1;i<n.length;i++)o[i.toString()]||n.eq(i).text("")}function o(t,n,a){function o(a,o){var i=t.find(".facility-"+a).find("input");if(1==i.length){var r="FacilitySportField_"+n.Seq+"_"+o,s=e[r]||"";i.val(s)}}var i=t.find("td");i.eq(0).text(a+1+"."),i.eq(1).text(n.Name),o("address","Address"),o("hours","HostingHours"),o("contact","Contact")}var i=$(".SportFieldDays"),r=$("#tblFacilities"),s=$("#sportFieldDaysRowTemplate"),l=$("#sportFieldFacilitiesRowTemplate");i.length>0&&r.length>0&&1==s.length&&1==l.length&&n.get("/api/common/school-user-data").then(function(e){var t=sportUtils.shallowCopy(e.data);n.get("/api/common/club-facility-data").then(function(e){var n=e.data.filter(function(e){return e.REGION_ID==t.REGION_ID}),c={};n.forEach(function(e){var t=e.SportFieldSeq.toString();c[t]||(c[t]={Name:e.SportFieldName,Seq:e.SportFieldSeq,WeekdaysData:[]}),c[t].WeekdaysData.push(e)});var u=0;for(var d in c){var p=s.clone(),g=l.clone();a(p,c[d]),o(g,c[d],u),p.show(),i.append(p),g.show(),r.append(g),u++}})})}function s(e,t,n){function a(e,n,a,o){var i=a.replace("$index",o.toString()),r=t[i]||"";if(r.length>0){e.eq(n).find("input").val(r)}}var o=$(e);if(o.length>0)for(var i=o.find("tr"),r=2;r<i.length;r++){var s=i.eq(r),l=s.find("td"),c=parseInt(l.eq(0).text().replace(".",""));!isNaN(c)&&c>0&&(a(l,2,n[0],c),a(l,4,n[1],c))}}function l(e,t,n){function a(e,n,a,o,i){var r=a.replace("$sport",o.toString()).replace("$category",i.toString()),s=t[r]||"";if(s.length>0){i>1&&n--;e.eq(n).find("input").val(s)}}var o=$(e);if(o.length>0)for(var i=o.find("tr"),r=1;r<i.length;r++){var s=i.eq(r),l=parseInt(s.data("sportfield-index"));if(!isNaN(l)&&l>0){var c=parseInt(s.data("category-index"));(isNaN(c)||c<=0)&&(c=1);var u=s.find("td");a(u,1,n[0],l,c),a(u,2,n[1],l,c),a(u,3,n[2],l,c)}}}function c(e,t,n,a){function o(e,n,o,i){var r=o.replace("$index",i.toString()),s=t[r]||"";if(s.length>0){var l=e.eq(n),c=l.find("input"),u=a[o]||null;if(null!=u){var d=registerUtils.sharedClubData[u],p=d.findItem(function(e){return e.Id==s});null!=p&&(s=p.Caption)}c.val(s)}}var i=$(e);if(i.length>0)for(var r=i.find("tr"),s=1;s<r.length;s++){var l=r.eq(s),c=l.find("td");n.forEach(function(e,t){o(c,t+1,e,s)})}}function u(){function e(e){var t=$("<td></td>");return t.text(e.toString()),t}var t=$("#tblSchoolTeamOrders"),n=$("#tblMunicipalityChampionships");if(t.length>0&&n.length>0){n.find("tr:gt(0)").remove();var a=0;t.find("tr:gt(0)").each(function(){var t=$(this),o=t.find("td"),i=o.eq(1).text(),r=o.eq(3).text(),s=$("<tr></tr>");s.append(e(a+1)),s.append(e(i)),s.append(e(r)),n.append(s),a++})}}function d(){var e=$("#pnlClubsChampionshipsTable");if(1!=e.length)window.setTimeout(d,100);else{var t=$("#tblSchoolTeamOrders");if(1==t.length){e.html("");t.find("tr").length<2?e.html("אין קבוצות מוזמנות"):(e.append(t),t.show(),u())}}}function p(t,a){if(null==e.schoolOrdersBasket||t>=e.schoolOrdersBasket.length)return console.log("All teams registered"),void a();var o=e.schoolOrdersBasket[t],i={ChampionshipId:o.CHAMPIONSHIP_ID,CategoryId:o.CHAMPIONSHIP_CATEGORY_ID};registerUtils.registerTeams(n,e.loggedUser,i,o.Amount,function(){p(t+1,a)},function(e){console.log("error registering team for "+o.CHAMPIONSHIP_CATEGORY_ID)})}n.get("/api/school-club/data").then(function(e){var u=e.data,d=u.toAssociativeArray(null,"PropertyName","PropertyValue");t("#school_manager",d,"School_Data_ManagerName"),t("#school_phone",d,"School_Data_PhoneNumber"),t("#school_fax",d,"School_Data_FaxNumber"),t("#school_email",d,"School_Data_ManagerEmail"),t("#ini_chairman_name",d,"School_Data_ChairmanName"),t("#ini_chairman_address",d,"School_Data_ChairmanAddress"),t("#ini_chairman_city",d,"School_Data_ChairmanCity"),t("#ini_chairman_zipcode",d,"School_Data_ChairmanZipCode"),t("#ini_chairman_phone",d,"School_Data_ChairmanPhoneNumber"),t("#ini_chairman_fax",d,"School_Data_ChairmanFax"),t("#coordinator_name",d,"School_Data_CoordinatorName"),t("#coordinator_address",d,"School_Data_CoordinatorAddress"),t("#ini_coordinator_city",d,"School_Data_CoordinatorCity"),t("#coordinator_zipcode",d,"School_Data_CoordinatorZipCode"),t("#coordinator_phone",d,"School_Data_CoordinatorPhoneNumber"),t("#coordinator_cellphone",d,"School_Data_CoordinatorCellPhone"),t("#coordinator_fax",d,"School_Data_CoordinatorFax"),t("#coordinator_email",d,"School_Data_CoordinatorEmailAddress"),a("ini_is_association",d,"School_Data_IsAssociation"),t("input[name='ini_txtAssociationNumber']",d,"School_Data_AssociationNumber"),a("ini_got_confirmation",d,"School_Data_IsAssociationConfirmed"),t("#txtRegisterChequeSum",d,"School_Cheque_Sum"),t("#txtRegisterChequeNumber",d,"School_Cheque_Number"),t("#txtRegisterChequeBank",d,"School_Cheque_Bank"),t("#txtRegisterChequeBranch",d,"School_Cheque_Branch"),t("#txtRegisterChequeWords",d,"School_Cheque_Sum",function(e){return e.length>0?sportUtils.ParseHebrewCurrency(e):""}),t("#txtMunicipalityName",d,"School_Data_SchoolMunicipalityName"),t("#txtMunicipalitySymbol",d,"School_Data_MunicipalityNumber"),i(d,"FacilitySportField_$sport_Days"),t("#txtInspectorName",d,"School_Data_SupervisorName"),t("#txtMunicipalityName",d,"School_Data_SchoolMunicipalityName"),t("#txtMunicipalityAddress",d,"School_Data_MunicipalityAddress"),t("#txtMunicipalityCity",d,"School_Data_MunicipalityCityName"),t("#txtMunicipalityZipCode",d,"School_Data_MunicipalityZipCode"),t("#txtRecommenderFirstName",d,"School_Data_RecommenderFirstName"),t("#txtRecommenderLastName",d,"School_Data_RecommenderLastName"),t("#txtRecommenderRole",d,"School_Data_RecommenderRole"),o("#txtRecommenderPhonePrefix","#txtRecommenderPhoneNumber",d,"School_Data_RecommenderPhoneNumber"),o("#txtRecommenderFaxPrefix","#txtRecommenderFaxNumber",d,"School_Data_RecommenderFax"),t("#txtRecommenderEmail",d,"School_Data_RecommenderEmailAddress"),s("#tblBoardMembers",d,["ManagementBoardMember_$index_Name","ManagementBoardMember_$index_Role"]),l("#tblCourtHours",d,["HostingDay_$sport_Category_$category_Name","HostingDay_$sport_Category_$category_Weekday","HostingDay_$sport_Category_$category_HostingHour"]),c("#tblCoaches",d,["Coach_$index_SportField","Coach_$index_Name","Coach_$index_AgeRange","Coach_$index_Gender","Coach_$index_AuthorizationLevel","Coach_$index_PassedCoachTraining","Coach_$index_Cellular","Coach_$index_Address","Coach_$index_Email"],{Coach_$index_AuthorizationLevel:"authorizationLevels",Coach_$index_PassedCoachTraining:"yesNoOptions"}),r(function(){var e={ManagerName:d.School_Data_ManagerName,PhoneNumber:d.School_Data_PhoneNumber,FaxNumber:d.School_Data_FaxNumber,ManagerEmail:d.School_Data_ManagerEmail};n.post("/api/sportsman/school/personnel",e).then(function(){console.log("Data posted to server successfully"),"1"==sportUtils.ParseQueryString().preview?console.log("preview mode"):p(0,function(){n.delete("/api/school-club/team-order?category=all").then(function(){console.log("Orders basket cleared"),window.opener&&(window.opener.reload_orders_basket="1")},function(e){console.log(e)})})})},1e3)},function(e){console.log("error reading school club data")}),n.get("/api/school-club/team-orders").then(function(t){e.schoolOrdersBasket=t.data,e.schoolOrdersBasket.forEach(function(e,t){e.Index=t+1}),window.setTimeout(function(){d()},200)},function(e){console.log("error getting orders basket")})}var p=sportUtils.ParseQueryString(),g=parseInt(p.s);if(e.now=new Date,e.schoolOrdersBasket=[],e.loggedUser=null,n.get("/api/login").then(function(t){e.loggedUser=t.data,null!=e.loggedUser&&e.loggedUser.schoolSymbol||(e.error="אינך מורשה לראות עמוד זה, נא להתחבר למערכת")},function(t){console.log("error getting logged in user"),console.log(t),e.error="אינך מורשה לראות עמוד זה, נא להתחבר למערכת"}),isNaN(g)||g<0)e.error="אין סמל בית ספר";else{var h="/api/sportsman/data-gateway";e.loading=!0,n.get(h).then(function(a){h=a.data;var i=h.substring(0,h.lastIndexOf("/")+1);h+="?symbol="+g,n.get(h).then(function(n){var a=n.data;e.loading=!1,e.RawHTML=o.trustAsHtml(a),window.setTimeout(function(){t(i)},500),window.setTimeout(d,50)},function(t){e.error="שגיאה בעת טעינת נתוני בית ספר",console.log(t),e.loading=!1})},function(t){e.error="שגיאה בעת טעינת נתונים",console.log(t),e.loading=!1})}window.qL_steps_amount=1,r(function(){window.qL_Finish_Now=!0},1e3)}function t(e){$("img").each(function(){var t=$(this),n=t.attr("src");0!=n.indexOf("http")&&(n=e+n,t.attr("src",n))})}angular.module("sport.register").controller("ClubRegisterFormController",["$scope","$http","$q","$sce","$uibModal","$timeout","$interval","$filter","$rootScope","messageBox",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r){e.FileUrl="/content/PlayerFile?type="+r.FileType+"&id="+r.IdNumber,e.PlayerIdNumber=r.IdNumber,e.PlayerName=r.Name,e.FileTitle=r.FileTitle,e.PDF=r.PDF,e.cancel=function(){n.dismiss("cancel")},e.confirm=function(){n.close("OK")},e.delete=function(){i.ask("האם למחוק קובץ זה? הפעולה לא הפיכה!").then(function(){t.delete(e.FileUrl).then(function(){n.close("DELETED")},function(e){console.log(e),alert("שגיאה בעת מחיקת קובץ, נא לנסות מאוחר יותר")})})}}angular.module("sport").controller("PlayerFileCtrl",["$scope","$http","$uibModalInstance","$filter","$q","messageBox","PlayerInfo",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s,l){var c=["TEAM_NUMBER","STATUS","REGISTRATION_DATE","FIRST_NAME","LAST_NAME","BIRTH_DATE","ID_NUMBER","GRADE","GRADE_NAME"],u={};c.forEach(function(e){u[e]=""});var d=sportUtils.ParseQueryString(),p=parseInt(d.t);if(e.now=new Date,isNaN(p)||p<0)e.error="אין זיהוי קבוצה";else{var g="/api/sportsman/team/"+p+"/full-details";t.get(g).then(function(t){if(t.data&&t.data.TEAM_ID==p)if(e.team=t.data,0==e.team.Players.length)e.error="לקבוצה זו אין שחקנים רשומים";else{if(e.team.CATEGORY_NAME){var n=e.team.CATEGORY_NAME.split(" ");n.length>1&&(e.team.CategoryGrades=n[0],e.team.CategoryGender=n[1])}var a=20;e.team.Players.length>20&&(a=40),e.team.Players.trimAfter(a);for(var o=0;o<e.team.Players.length;o++){var i=e.team.Players[o];i.REGISTRATION_DATE&&(i.REGISTRATION_DATE=r("date")(i.REGISTRATION_DATE,"dd/MM/yyyy")),i.BIRTH_DATE&&(i.BIRTH_DATE=r("date")(i.BIRTH_DATE,"dd/MM/yyyy"))}e.team.Players.expand(u,a,!0),window.setTimeout(function(){$("#btnPrint").click()},1500)}else e.error="זיהוי קבוצה שגוי או קבוצה לא קיימת"},function(t){e.error="שגיאה בעת טעינת נתוני קבוצה",console.log(t)})}window.qL_steps_amount=1,o(function(){window.qL_Finish_Now=!0},1e3)}angular.module("sport.register").controller("PlayerRegisterFormController",["$scope","$http","$q","$uibModal","$timeout","$interval","$filter","$rootScope","messageBox",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s){function l(e){var t={};for(var n in e)t[n]=e[n];return t}function c(){for(var t={},n=0;n<e.selected.Players.length;n++){var o=e.selected.Players[n].ID_NUMBER.toString();t[o]=!0}var i=p.filter(function(e){return!t[e.ID_NUMBER.toString()]&&!g[e.ID_NUMBER.toString()]}),r=e.parsedSearchTerm();return r.length>0&&(i=a("filter")(i,r)),i}function u(t){var n=t.toString();n.length>=9&&sportUtils.IsValidIdNumber(n)?(e.data.NewStudent={IdNumber:n.toString()},o(function(){e.data.NewStudent&&$("#txtNewStudentFirstName").focus()},500)):e.data.invalidIdNumber=9==n.length,e.data.matchingStudent=null}function d(e){if(null==e||!e||0==e.length)return 0;var t=e.indexOf("<PlayerRegStatus>");return t>=0&&"1"==e.substr(t+"<PlayerRegStatus>".length,1)?1:0}var p=[],g={},h={IdNumber:"ID_NUMBER",FirstName:"FIRST_NAME",LastName:"LAST_NAME",Birthday:"BIRTH_DATE",Gender:"SEX_TYPE"};if(e.data={ChampionshipFullName:s.ChampionshipName,AvailablePlayers:[],search:"",matchingStudent:null,NewStudent:null,invalidIdNumber:!1,alreadyInTeam:null,Grades:sportUtils.grades.map(function(e,t){return{Index:t+1,Name:e}})},e.selected={Players:[]},e.latestSeason=s.LatestSeason,s.ExistingPlayers)for(var f=0;f<s.ExistingPlayers.length;f++){var m=s.ExistingPlayers[f],v=m.ID_NUMBER.toString();g[v]=m}if(s.EditStudent){e.data.NewStudent={};for(var S in h){var y=s.EditStudent[h[S]];e.data.NewStudent[S]=y,e.data.NewStudent["Original_"+S]=y}e.data.NewStudent.Grade=e.data.Grades.findItem(function(e){return e.Name==s.EditStudent.ParsedGrade}),e.data.NewStudent.Original_Grade=null==e.data.NewStudent.Grade?0:e.data.NewStudent.Grade.Index,e.data.NewStudent.IsEditMode=!0;var C="/api/sportsman/student/"+e.data.NewStudent.IdNumber+"/candelete";t.get(C).then(function(t){e.data.NewStudent.CanDelete=t.data.CanDelete},function(e){console.log("error checking if can delete student"),console.log(e)})}
if(e.parsedSearchTerm=function(){var t=$.trim(e.data.search);return t.length>0&&sportUtils.IsInteger(t)&&(t=parseInt(t)+""),t},o(function(){t.get("/api/sportsman/latest-season").then(function(e){var t=e.data.Season;t&&p.forEach(function(e){e.GRADE&&(e.ParsedGrade=sportUtils.TranslateGrade(e.GRADE,t))})})},500),e.pagingService=new PagingService(c(),{pageSize:20}),e.data.AvailablePlayers=[],e.pagingService.applyPaging(e.data.AvailablePlayers),s.CategoryId){var C="/api/sportsman/matching-students?category="+s.CategoryId+"&school="+s.SchoolSymbol;t.get(C).then(function(t){p=t.data,e.pagingService.setData(c())})}e.$watch("data.search",function(n){if(!s.EditStudent)if(e.pagingService&&e.pagingService.setData(c()),e.data.NewStudent=null,e.data.invalidIdNumber=!1,e.data.alreadyInTeam=null,e.data.doubleRegistration=null,n&&n.length>0&&sportUtils.IsInteger(n)&&n.length>5&&n.length<=9){var a=parseInt(n),o=e.selected.Players.findIndex(function(e){return parseInt(e.ID_NUMBER)==a})>=0,i=p.findIndex(function(e){return parseInt(e.ID_NUMBER)==a});e.data.alreadyInTeam=g[a.toString()];var r=s.ChampionshipName.indexOf("ז'-ח'")>=0||s.ChampionshipName.indexOf("ז-ח")>=0;!e.data.alreadyInTeam&&!o&&i<0?t.get("/api/sportsman/student?id="+a+"&sport="+s.SportID).then(function(t){var n=t.data,o=d(n.IfaRegisterStatus);r&&1==o?e.data.doubleRegistration="כדורגל":n.STUDENT_ID?(e.data.matchingStudent=n,n.SYMBOL!=s.SchoolSymbol&&(e.data.matchingStudent.DifferentSchool={Symbol:n.SYMBOL,Name:n.SCHOOL_NAME})):u(a)},function(e){console.log("failed to get matching student"),console.log(e),u(a)}):e.data.matchingStudent=null}else e.data.matchingStudent=null}),e.SelectPlayer=function(t){e.selected.Players.push(l(t));var n=e.selected.Players.length;e.selected.Players.moveItem(n-1,0),e.pagingService.setData(c()),e.data.matchingStudent=null,e.data.search="",e.pagingService.setData(c())},e.RemoveSelectedPlayer=function(t){var n=e.selected.Players.findIndex(function(e){return e.ID_NUMBER==t.ID_NUMBER});n>=0&&(e.selected.Players.splice(n,1),e.pagingService.setData(c()))},e.deleteStudent=function(){r.ask("האם למחוק תלמיד מהמערכת? פעולה זו אינה הפיכה!").then(function(){var a="/api/sportsman/student?id="+e.data.NewStudent.IdNumber;t.delete(a).then(function(e){n.close("DELETED")},function(e){alert("שגיאה בעת מחיקת שחקן מהמערכת, נא לנסות שוב מאוחר יותר"),console.log("error deleting student"),console.log(e)})})},e.isConfirmDisabled=function(){if(null==e.data.NewStudent)return!e.selected.Players||0==e.selected.Players.length;if(!(e.data.NewStudent.FirstName&&e.data.NewStudent.LastName&&e.data.NewStudent.Birthday&&e.data.NewStudent.Grade&&e.data.NewStudent.Grade.Index))return!0;if(e.data.NewStudent.IsEditMode){var t=!1;for(var n in h){if($.trim(e.data.NewStudent[n])!=$.trim(e.data.NewStudent["Original_"+n])){t=!0;break}}return(null==e.data.NewStudent.Grade?0:e.data.NewStudent.Grade.Index)!=e.data.NewStudent.Original_Grade&&(t=!0),!t}return!1},e.cancel=function(){null==e.data.NewStudent||null!=e.data.NewStudent&&e.data.NewStudent.IsEditMode?n.dismiss("cancel"):(e.data.NewStudent=null,e.data.search="",e.pagingService.setData(c()))},e.confirm=function(){if(e.isConfirmDisabled())return void(e.data.TriedToSubmit=!0);if(null==e.data.NewStudent)e.selected.Players&&e.selected.Players.length>0&&n.close(e.selected.Players);else if(e.data.TriedToSubmit=!0,e.data.NewStudent.IsEditMode)n.close(e.data.NewStudent);else{var a={};for(var o in e.data.NewStudent){var i=e.data.NewStudent[o];null!=e.latestSeason&&"Grade"==o&&(i=e.latestSeason-(i.Index-1)),a[o]=i}t.post("/api/sportsman/student",{Student:a}).then(function(t){for(var n in h)e.data.NewStudent[h[n]]=e.data.NewStudent[n];e.data.NewStudent.STUDENT_ID=t.data.STUDENT_ID,e.data.NewStudent.GRADE=a.Grade,p.push(l(e.data.NewStudent)),e.SelectPlayer(e.data.NewStudent),e.data.NewStudent=null},function(e){alert("שגיאה בעת הוספת שחקן למערכת, נא לנסות שוב מאוחר יותר"),console.log(e)})}}}angular.module("sport").controller("PlayerSelectionCtrl",["$scope","$http","$uibModalInstance","$filter","$timeout","$q","messageBox","championshipData",e])}(),function(){"use strict";function e(e,t,n,a,o,i,r,s,l){function c(e,t){switch(void 0===t&&(t=!1),e){case 1:return"תמונה";case 2:return"טופס בדיקה"+(t?" רפואית":"");case 3:return'ספח ת"ז'}}function u(e,t){var n={HasFile:!1},a=$(".dropzone[data-player-id='"+e+"']");if(a.length>0)for(var o=0;o<a.length;o++){var i=a.eq(o);if(i.data("file-type")==t.toString()){var r=i.parents(".player-file").first();n.HasFile="1"==r.data("has-file"),n.PDF="1"==r.data("is-pdf"),n.MessagePanel=r.find(".dz-message")}}return n}function d(e,t){var n=e.type,a=!n||0==n.length,o=!a&&"image"==n.split("/")[0].toLowerCase(),i=!a&&"pdf"==n.split("/")[1].toLowerCase(),r="";switch(t){case 1:o||(r="ניתן להעלות קובץ תמונה בלבד");break;case 2:case 3:o||i||(r="ניתן להעלות תמונה או קובץ PDF בלבד")}return r}function p(e,t,n){var a=d(t,n);if(a.length>0){if(e.ValidFile=!1,e.element){$(e.element).find(".fa").first().hide();var o=$(e.element).find(".upload-error");o.html(a),o.show(),window.setTimeout(function(){o.html(""),o.hide(),$(e.element).find(".fa").first().show()},5e3)}window.setTimeout(function(){e.removeAllFiles(!0)},200)}else e.ValidFile=!0}function g(e){var t=c(e);return{options:{paramName:"files",maxFiles:1,url:"/content/PlayerFile?type="+e+"&id=$id",autoProcessQueue:!0,dictRemoveFile:"הסרת "+t,addRemoveLinks:!0},eventHandlers:{sending:function(t,n,a,o){p(t,n,e)},success:function(e,t){var n=this;if(n.ValidFile&&n.element){var a=$(n.element),o=a.find(".dz-message"),i=a.find(".dz-preview");o.data("handled","0"),window.setTimeout(function(){i.hide(),o.show()},200)}},maxfilesexceeded:function(e){var t=this;window.setTimeout(function(){t.removeFile(e)},200)}}}}function h(n){void 0===n&&(n=null);var a=e.loggedUser.SchoolSymbol;t.get("/api/sportsman/school-data?symbol="+a).then(function(t){e.isClubSchool=1==t.data.CLUB_STATUS}),e.selected.team=null,a&&(registerUtils.buildSchoolName(t,a).then(function(t){e.loggedUser.SchoolName=t},function(e){console.log("error reading school name"),console.log(e)}),t.get("/api/sportsman/school/"+a+"/teams").then(function(a){e.schoolTeams=a.data,e.schoolTeams.sort(function(e,t){var n=t.IsPending-e.IsPending;if(0!=n)return n;var a=t.SPORT_ID-e.SPORT_ID;if(0!=a)return a;var o=t.CHAMPIONSHIP_ID-e.CHAMPIONSHIP_ID;return 0!=o?o:e.TEAM_INDEX-t.TEAM_INDEX});for(var o={},i=0;i<e.schoolTeams.length;i++){var r=e.schoolTeams[i];r.TEAM_INDEX&&(r.HebrewIndex=sportUtils.GetHebrewLetter(r.TEAM_INDEX)),r.REGISTRATION_DATE&&(r.REGISTRATION_DATE=new Date(r.REGISTRATION_DATE)),r.Players&&(r.Players.forEach(function(e){o[e.STUDENT_ID.toString()]=e,e.BIRTH_DATE&&(e.BIRTH_DATE=new Date(e.BIRTH_DATE)),e.Status={Description:registerUtils.ParsePlayerStatus(e.STATUS),Style:registerUtils.PlayerStatusStyle(e.STATUS),Tooltip:registerUtils.PlayerStatusTitle(e)}}),r.Players=registerUtils.SplitPlayersByStatus(r.Players),r.RegisteredPlayersCountHebrew=registerUtils.HebrewCount(r.Players.RegisteredPlayers.length,!0,"שחקן רשום","שחקנים רשומים"),r.ConfirmedPlayersCountHebrew=registerUtils.HebrewCount(r.Players.ConfirmedPlayers.length,!0,"שחקן מאושר","שחקנים מאושרים"),r.UnConfirmedPlayersCountHebrew=registerUtils.HebrewCount(r.Players.UnConfirmedPlayers.length,!0,"שחקן לא מאושר","שחקנים לא מאושרים"))}t.get("/api/sportsman/latest-season").then(function(t){var n=t.data.Season;n&&(e.latestSeason=n,e.schoolTeams.forEach(function(e){f(e).forEach(function(e){e.GRADE&&(e.ParsedGrade=sportUtils.TranslateGrade(e.GRADE,n))})}))}),registerUtils.InitTeamPanelsTimer(),t.get("/api/sportsman/school-change-requests").then(function(e){for(var t=0;t<e.data.length;t++){var a=e.data[t],i=a.STUDENT_ID,r=o[i.toString()];r&&(r.DifferentSchool={Symbol:a.SYMBOL,Name:a.SCHOOL_NAME})}null!=n&&n()},function(e){console.log("error loading school change requests"),console.log(e),null!=n&&n()})},function(e){console.log("error reading school teams"),console.log(e)}))}function f(e){return e.Players?e.Players.RegisteredPlayers.concat(e.Players.ConfirmedPlayers).concat(e.Players.UnConfirmedPlayers):[]}function m(t,n,o){a.open({templateUrl:"views/player-selection.html",controller:"PlayerSelectionCtrl",resolve:{championshipData:function(){if(null==t)return{ChampionshipName:"",LatestSeason:e.latestSeason,CategoryId:0,SchoolSymbol:"0",ExistingPlayers:[],EditStudent:n};var a=f(t);return{ChampionshipName:t.CHAMPIONSHIP_NAME+", "+t.CATEGORY_NAME,CategoryId:t.CHAMPIONSHIP_CATEGORY_ID,SchoolSymbol:e.loggedUser.SchoolSymbol,LatestSeason:e.latestSeason,ExistingPlayers:a,SportID:t.SPORT_ID}},options:function(){return{}}}}).result.then(function(e){o&&o(e)})}var v=!1;e.userInput={username:"",password:""},e.selected={team:null},e.loggedUser=null,e.schoolTeams=[],e.isClubSchool=!1,e.latestSeason=null,o(function(){$("#register_username").focus()},500),window.qL_steps_amount=5,t.get("/api/seasons/current").then(function(e){var t=sportUtils.getCurrentSeason();if(null!=t&&t.Season){if(e.data.Year!=t.Season)return sportUtils.setCurrentSeason(null),void document.location.reload(!0)}}),e.dropzoneConfig_Picture=g(1),e.dropzoneConfig_MedicalForm=g(2),e.dropzoneConfig_IdVoucher=g(3),contentUtils.InitSportFieldColors(t,function(){}),t.get("/api/login").then(function(t){t&&t.data&&null!=t.data&&(e.loggedUser={Seq:t.data.seq,Login:t.data.name,DisplayName:t.data.displayName,Role:t.data.role,SchoolSymbol:t.data.schoolSymbol},h())},function(e){console.log("error getting logged in user"),console.log(e)}),o(function(){window.qL_Finish_Now=!0},1e3),e.getSportFieldStyle=function(e){return"background-color: "+contentUtils.getSportFieldColor(e)+";"},e.deletePlayer=function(n){var a=n.PLAYER_ID,i=e.selected.team.TEAM_ID,r="האם להסיר את "+n.FIRST_NAME+" "+n.LAST_NAME+" מ"+e.selected.team.CHAMPIONSHIP_NAME+"?";l.ask(r).then(function(){t.delete("/api/sportsman/player?player="+a).then(function(){h(function(){o(function(){var t=e.schoolTeams.findIndex(function(e){return e.TEAM_ID==i});t>=0&&e.selectTeam(e.schoolTeams[t])},500)})},function(e){console.log(e),alert("שגיאה בעת מחיקת שחקן, נא לנסות מאוחר יותר")})})},e.deleteTeam=function(e){var n=e.TEAM_ID;l.ask("האם למחוק קבוצה זו? הפעולה בלתי הפיכה!").then(function(){e.deleting=!0,t.delete("/api/sportsman/team?team="+n).then(function(){e.deleting=!1,h()},function(t){e.deleting=!1,console.log(t),alert("שגיאה בעת מחיקת קבוצה, נא לנסות מאוחר יותר")})})},e.registerTeam=function(){for(var n={},o=0;o<e.schoolTeams.length;o++){var i=e.schoolTeams[o],r=i.CHAMPIONSHIP_CATEGORY_ID.toString();n[r]||(n[r]=[]),n[r].push(i)}a.open({templateUrl:"views/championship-selection.html",controller:"ChampionshipSelectionCtrl",resolve:{schoolData:function(){return{Name:e.loggedUser.SchoolName,Symbol:e.loggedUser.SchoolSymbol,Teams:n}},sportField:function(){return null},allSeasons:function(){return null},allRegions:function(){return null},options:function(){return{}}}}).result.then(function(n){registerUtils.registerTeams(t,e.loggedUser,n.Category,n.Amount,function(){h()},null)})},e.registerNewPlayers=function(n){m(n,null,function(a){var i=n.TEAM_ID;t.put("/api/sportsman/team/"+i+"/players",{Players:a}).then(function(t){h(function(){o(function(){var t=e.schoolTeams.findIndex(function(e){return e.TEAM_ID==i});t>=0&&e.selectTeam(e.schoolTeams[t])},500)})},function(e){alert("שגיאה בעת הוספת שחקנים לקבוצה, אנא נסו שוב מאוחר יותר"),console.log(e)})})},e.PlayerFileClicked=function(e,t){var n=e.ID_NUMBER,o=u(n,t);o.HasFile&&a.open({templateUrl:"views/player-file.html",controller:"PlayerFileCtrl",resolve:{PlayerInfo:function(){return{IdNumber:e.ID_NUMBER,Name:e.FIRST_NAME+" "+e.LAST_NAME,FileTitle:c(t),FileType:t,PDF:o.PDF}},options:function(){return{}}}}).result.then(function(e){"DELETED"==e&&o.MessagePanel.data("handled","0")})},e.selectTeam=function(t){if(v)return void(v=!1);e.selected.team=t,registerUtils.InitPlayerPlaceholdersTimer(),registerUtils.InitPlayerFilesTimer();var n=e.schoolTeams.findIndex(function(e){return e.TEAM_ID==t.TEAM_ID});e.schoolTeams.moveItem(n,0),document.documentElement.scrollTop=50},e.selectPlayer=function(t){if(null!=e.selected.team&&null!=e.selected.team.Players){f(e.selected.team).forEach(function(e){e.Selected=!1}),t.Selected=!0,document.body.scrollTop=50}},e.editPlayer=function(n){m(null,n,function(a){if("DELETED"==a){var i=e.selected.team.TEAM_ID;h(function(){o(function(){var t=e.schoolTeams.findIndex(function(e){return e.TEAM_ID==i});t>=0&&e.selectTeam(e.schoolTeams[t])},500)})}else{a.Id=n.PLAYER_ID;var r={};for(var s in a){var l=a[s];null!=e.latestSeason&&"Grade"==s&&(l=e.latestSeason-(l.Index-1)),r[s]=l}t.put("/api/sportsman/player",{Player:r}).then(function(){n.FIRST_NAME=a.FirstName,n.LAST_NAME=a.LastName,n.BIRTH_DATE=a.Birthday,n.GRADE=r.Grade,n.ParsedGrade=sportUtils.TranslateGrade(n.GRADE,e.latestSeason)},function(e){console.log(e),alert("שגיאה בעת עריכת פרטי  שחקן, נא לנסות מאוחר יותר")})}})},e.getTeamPanelStyle=function(t){return null!=e.selected.team&&e.selected.team.TEAM_ID==t.TEAM_ID?"background-color: #AFD2DB;":""},e.getPlayerPanelStyle=function(e){return e.Selected?"background-color: #AFD2DB;":""},e.removePendingTeam=function(n){v=!0;l.ask("האם לבטל רישום של קבוצה זו?").then(function(){t.delete("/api/sportsman/pending-team?team="+n.TEAM_ID).then(function(){e.schoolTeams=e.schoolTeams.filter(function(e){return e.TEAM_ID!=n.TEAM_ID})},function(e){console.log(e),alert("שגיאה בעת מחיקת קבוצה, נא לנסות מאוחר יותר")})})},e.login=function(){e.errorMessage=null,sportUtils.Login(n,t,e.userInput.username,e.userInput.password).then(function(t){e.loggedUser={Seq:t.seq,Login:e.username,DisplayName:t.displayName,Role:t.role,SchoolSymbol:t.schoolSymbol},h()},function(t){e.errorMessage=t})}}angular.module("sport.register").controller("RegisterController",["$scope","$http","$q","$uibModal","$timeout","$interval","$filter","$rootScope","messageBox",e])}();var registerUtils={_playerPlaceholdersTimer:0,_playerFilesTimer:0,_teamPanelsTimer:0,sharedClubData:{authorizationLevels:[{Id:1,Caption:"מורה"},{Id:2,Caption:"מדריך/ה"},{Id:3,Caption:"מאמן/ת"}],yesNoOptions:[{Id:1,Caption:"כן"},{Id:2,Caption:"לא"}]},registerTeams:function(e,t,n,a,o,i){function r(e){console.log("error while registering new team"),console.log(e),alert("כשלון בעת  שמירת נתונים, נא לנסות שוב מאוחר יותר"),null!=i&&i()}function s(t,n){if(n>=a)return void(null!=o&&o());e.post("/api/sportsman/team",t).then(function(e){s(t,n+1)},r)}a>2&&(a=2),s({User:t.Seq||t.seq,School:t.SchoolSymbol||t.schoolSymbol,Championship:n.ChampionshipId,Category:n.CategoryId},0)},getSchoolDetails:function(e,t){return e.get("/api/sportsman/school/"+t+"/details")},buildSchoolName:function(e,t){return registerUtils.getSchoolDetails(e,t).then(function(e){var t=e.data.SCHOOL_NAME,n=e.data.CITY_NAME;return n&&n.length>0&&t.indexOf(n)<0&&(t+=" "+n),t})},SplitPlayersByStatus:function(e){for(var t={length:e.length,RegisteredPlayers:[],ConfirmedPlayers:[],UnConfirmedPlayers:[]},n=0;n<e.length;n++){var a=e[n];switch(a.STATUS){case 1:t.RegisteredPlayers.push(a);break;case 2:t.ConfirmedPlayers.push(a);break;case 3:t.UnConfirmedPlayers.push(a)}}return t},HebrewCount:function(e,t,n,a){if(e<1)return"אין "+a;if(1==e){return n+" "+(t?"אחד":"אחת")}return e+" "+a},ParsePlayerStatus:function(e){switch(e){case 1:return"רשום";case 2:return"מאושר";case 3:return"לא מאושר"}return"לא ידוע"},PlayerStatusStyle:function(e){var t="";switch(e){case 1:t="#d9edf7";break;case 2:t="#dff0d8";break;case 3:t="#f2dede"}var n="color: #3b5998;";return t.length>0&&(n+="background-color: "+t),n},PlayerStatusTitle:function(e){return 3==e.STATUS?e.RejectReason||"":""},InitPlayerPlaceholdersTimer:function(){window.clearInterval(registerUtils._playerPlaceholdersTimer),registerUtils._playerPlaceholdersTimer=window.setInterval(function(){var e=$(".player-placeholder");e.length>0&&e.each(function(){var e=$(this),t=e.find(".different-school-notice");e.width()<680?(e.removeClass("player-placeholder-normal"),e.addClass("player-placeholder-small-screen"),t.addClass("different-school-notice-small-screen")):(e.removeClass("player-placeholder-small-screen"),e.addClass("player-placeholder-normal"),t.removeClass("different-school-notice-small-screen"))})},500)},InitTeamPanelsTimer:function(){window.clearInterval(registerUtils._teamPanelsTimer),registerUtils._teamPanelsTimer=window.setInterval(function(){var e=$(".team-panel");e.length>0&&e.each(function(){var e=$(this),t=e.find("h3").first();e.width()<360?(e.addClass("team-panel-small-screen"),t.css("width","200px")):(e.removeClass("team-panel-small-screen"),t.css("width","inherit"))})},500)},InitPlayerFilesTimer:function(){function e(e){var t=e.parents(".dropzone").first();if(1==t.length){var n=t.data("player-id"),a=t.data("file-type"),o=e.find(".fa").first(),i=e.find(".picture-preview"),r=e.find(".file-pdf");if(n&&a)var s="/content/PlayerFile?type="+a+"&id="+n,l=$.get(s,function(){var t=e.parents(".player-file").first(),n=l.getResponseHeader("content-Type"),a=!1,c="0";n&&(0==n.indexOf("image/")?(i.attr("src",s),i.show(),a=!0):n.indexOf("/pdf")>0&&1==r.length&&(r.show(),a=!0,c="1")),a?(o.hide(),t.data("has-file","1")):(o.show(),t.data("has-file","0")),t.data("is-pdf",c)})}}window.clearInterval(registerUtils._playerFilesTimer),registerUtils._playerFilesTimer=window.setInterval(function(){var t=$(".dz-message");t.length>0&&t.each(function(){var t=$(this);if("1"!=t.data("handled")){var n=t.parents(".player-file").first().data("file-container");if(n&&n.length>0){var a=$("#"+n);t.html(a.html()),e(t)}t.data("handled","1")}});var n=$(".player-file");n.length>0&&window._AllDropZones_&&n.each(function(){var e=$(this),t=e.find(".dropzone"),n=t.data("player-id"),a=t.data("file-type");if(n&&a){var o="1"==e.data("has-file"),i=n+"_"+a,r=window._AllDropZones_[i];r&&$(r.hiddenFileInput).prop("disabled",o)}})},200)}};!function(){"use strict";function e(e,t,n,a,o,i,r){function s(){var t=$.trim(e.data.Search),n=c.slice(0);if(t.length>0&&(n=a("filter")(n,t)),n=reportUtils.applyFilters(e.data.Fields,n),null!=e.data.Sort){var o=e.data.Sort.Column||"";o.length>0&&reportUtils.sort(n,o,e.data.Fields,e.data.Sort.Descending)}return n}function l(){$(".report-file").each(function(){var e=$(this);if("1"!=e.data("handled")&&"1"!=e.data("in_progress")){var t=e.data("idnumber"),n=u.replace("$type",e.data("type")).replace("$id",t);e.data("in_progress","1");var a=e.find(".file-loading-icon");a.show();var o=$.get(n,function(){e.data("in_progress","0"),a.hide();var t=!1,i=o.getResponseHeader("content-Type");if(i)if(0==i.indexOf("image/")){var r=e.find(".file-image");r.attr("src",n),r.show(),t=!0}else if(i.indexOf("/pdf")>0){var s=e.find(".file-pdf");1==s.length&&(s.show(),t=!0)}if(t){var l=e.find("a");l.attr("href",n),l.show()}e.data("handled","1")})}})}var c=[],u="/content/PlayerFile?type=$type&id=$id",d=0;e.error="",e.data={SelectedSeason:{Name:localStorage[sportGlobalSettings.LocalStorageKeys.CurrentSeason.Name]||"",Year:localStorage[sportGlobalSettings.LocalStorageKeys.CurrentSeason.Year]||0},CurrentSeasonYear:0,Search:"",Sort:null,Loading:!1,Error:"",Views:[],Fields:null,Rows:null,ExcelInProgress:!1,AvailableColumnsVisible:!1,HiddenColumnExists:!1},e.selected={View:null},function(){sportUtils.VerifyUser(n,e),window.qL_step_finished=!0}(),n.get("/api/sportsman/views").then(function(t){e.data.Views=t.data.slice(0)},function(t){console.log(t),e.error="failed to load views"}),n.get("/api/seasons/current").then(function(t){e.data.CurrentSeasonYear=t.data.Year}),e.pagingService=new PagingService(s(),{pageSize:20}),e.data.Rows=[],e.pagingService.applyPaging(e.data.Rows),e.$watch("data.Search",function(t){e.pagingService&&c.length>0&&e.pagingService.setData(s())}),e.viewSelected=function(){function t(e,t){return{Name:e,Title:e,FileType:t,Visible:!0,Index:-1,IsFile:!0}}c=[];var o="/api/sportsman/views/"+e.selected.View.VIEW_ID,i=e.data.SelectedSeason.Name;i&&i.length>0&&(o+="?season="+i),e.data.Loading=!0,e.data.Fields=[],n.get(o).then(function(n){e.data.Loading=!1,reportUtils.InitClearFiltersPositionTimer();for(var o=0;o<n.data.Fields.length;o++){var i=n.data.Fields[o],r={Name:i,Type:reportUtils.parseFieldType(i),Title:reportUtils.cleanFieldName(i),Visible:!i.startsWithEnglishLetter(),Index:o+1};e.data.Fields.push(r)}"ViewPlayers"==e.selected.View.VIEW_NAME&&(e.data.Fields.push(t("תמונה",1)),e.data.Fields.push(t("בדיקה רפואית",2)),e.data.Fields.push(t('ספח ת"ז',3))),c=n.data.Rows,"ViewPlayers"==e.selected.View.VIEW_NAME&&c.forEach(function(e){e.IdNumber=e["מספר זהות"]}),reportUtils.applyFieldTypes(e.data.Fields,c,a);var u=reportUtils.applySpecialCases(e.selected.View.VIEW_NAME,c,a);null!=u&&(e.data.Sort=u),e.pagingService.setData(s()),d&&window.clearInterval(d),d=window.setInterval(l,200),window.setTimeout(function(){var e=$("#lnkChooseTableColumns"),t=$("#pnlAvailableColumns"),n=e.position().left+10,a=e.outerWidth()-1;t.css({left:n+"px",width:a+"px"}),$(".available-columns-title").css("width",a-48+"px")},500)},function(t){e.data.Loading=!1,e.data.Error='שגיאה בעת טעינת דו"ח',console.log(t),e.pagingService.setData(s())})},e.changeSort=function(t){t.IsFile||(null!=e.data.Sort&&e.data.Sort.Column==t.Title?e.data.Sort.Descending=!e.data.Sort.Descending:e.data.Sort={Column:t.Title,Descending:!1},e.pagingService.setData(s()))},e.toggleFilter=function(t){e.data.Fields.forEach(function(e){e.Index!=t.Index&&(e.Filtered=!1)}),t.Filtered=!t.Filtered,t.Filtered&&window.setTimeout(function(){$('input[data-field-index="'+t.Index+'"]').focus()},500)},e.getFilterStyle=function(e){return e.FilterText&&e.FilterText.length>0?"color: #00ADEE;":""},e.filterChanged=function(t){e.pagingService.setData(s())},e.clearFilter=function(t){t.FilterText="",t.Filtered=!1,e.filterChanged(t)},e.clearAllFilters=function(){e.data.Fields.forEach(function(t){e.clearFilter(t)})},e.gotFilters=function(){if(e.data.Fields)for(var t=0;t<e.data.Fields.length;t++){var n=e.data.Fields[t];if(n.FilterText)return!0}return!1},e.chooseColumns=function(){e.data.AvailableColumnsVisible=!e.data.AvailableColumnsVisible},e.availableColumnClicked=function(t){t.IsHidden=!t.IsHidden,e.data.HiddenColumnExists=e.data.Fields.findIndex(function(e){return e.IsHidden})>=0},e.undoColumnSelection=function(){e.data.Fields.setForAll("IsHidden",!1),e.data.HiddenColumnExists=!1},e.exportExcel=function(){e.data.ExcelInProgress=!0;var t=e.data.Fields.filter(function(e){return e.Visible&&!e.IsHidden}).map(function(e){return e.Title}),a={};e.data.Fields.forEach(function(e){a[e.Title]=e.Name});var o=e.pagingService.getAllData().map(function(e){console.log(e);var n=[];return t.forEach(function(t){n.push(e[a[t]])}),n});console.log("rows count: "+o.length);var i=new Date,r=e.selected.View.VIEW_NAME,s="/api/common/excel?name="+sportUtils.RemoveSpecialCharacters(r)+"&sheet="+encodeURIComponent(r);n.post(s,{Headers:t,Rows:o}).then(function(t){e.data.ExcelInProgress=!1;var n=new Date,a=n.getTime()-i.getTime();console.log("generating excel took "+a+" miliseconds, which are "+a/1e3+" seconds");var o=t.data,r="/content/Excel/"+o;window.setTimeout(function(){var e=$("<iframe></iframe>");e.attr("src",r),$("body").append(e),e.hide()},1e3)},function(t){e.data.ExcelInProgress=!1,alert("שגיאה בעת  יצירת גיליון אקסל, נא לנסות שוב מאוחר יותר"),console.log(t)})}}angular.module("sport.reports").controller("ReportsController",["$scope","$state","$http","$filter","$timeout","$interval","messageBox",e])}();var reportUtils={_clearFiltersPositionTimer:0,FieldType:{Ordinary:1,Date:2},_possibleFieldTypes:[],possibleFieldTypes:function(){return 0==reportUtils._possibleFieldTypes.length&&reportUtils._possibleFieldTypes.push({Key:"date",Type:reportUtils.FieldType.Date}),reportUtils._possibleFieldTypes},parseFieldType:function(e){for(var t=0;t<reportUtils.possibleFieldTypes().length;t++){var n=reportUtils.possibleFieldTypes()[t];if(e.endsWith("|"+n.Key))return n.Type}return reportUtils.FieldType.Ordinary},cleanFieldName:function(e){var t=e+"";return reportUtils.possibleFieldTypes().forEach(function(e){t=t.replace("|"+e.Key,"")}),t},applySpecialCases:function(e,t,n){if("ViewTeams"==e||"ViewPlayers"==e){for(var a=0;a<t.length;a++){var o=t[a];o["שם קבוצה"]=reportUtils.buildTeamName(o)}return{Column:"תאריך רישום",Descending:!0}}if("ViewMatches"==e){for(var a=0;a<t.length;a++){var o=t[a];if(console.log(o.PreviousGroupName_A),o["קבוצה א'"]=reportUtils.getPreviousPhaseTeam(o,"A")||eventsUtils.BuildTeamName(o,"A"),o["קבוצה ב'"]=reportUtils.getPreviousPhaseTeam(o,"B")||eventsUtils.BuildTeamName(o,"B"),o["תוצאה"]=reportUtils.buildGameResult(o),o.RawDate){var i=reportUtils.parseRawDate(o.RawDate);o["תאריך"]=i.Date,o["שעה"]=i.Time}}return{Column:"אליפות",Descending:!1}}return null},getPreviousPhaseTeam:function(e,t){var n=e["PreviousGroupIndex_"+t];if(null!=n){var a=e["PreviousGroupName_"+t];if(null!=a&&a.length>0)return a+" מיקום "+(n+1)}return null},buildGameResult:function(e){var t="",n=e.RESULT,a=e.TEAM_A_SCORE,o=e.TEAM_B_SCORE;e.PARTS_RESULT;return null!=n&&null!=a&&null!=o&&(t=a+" - "+o),t},parseRawDate:function(e){var t="",n="",a=e.split("T");return 2==a.length&&(dateParts=a[0].split("-"),timeParts=a[1].split(":"),3==dateParts.length&&(t=[dateParts[2],dateParts[1],dateParts[0]].join("/")),timeParts.length>2&&(n=[timeParts[0],timeParts[1]].join(":"))),{Date:t,Time:n}},buildTeamName:function(e){var t=e.SCHOOL_NAME,n=e.CITY_NAME||"",a=t;return a.indexOf(n)<0&&(a+=" "+n),a},applyFieldTypes:function(e,t,n){var a=e.filter(function(e){return e.Type==reportUtils.FieldType.Date});if(a.length>0)for(var o=0;o<t.length;o++){var i=t[o];a.forEach(function(e){var t=e.Name,a=i[t];i["original_"+t]=a,i[t]=n("date")(a,"dd/MM/yyyy")})}},applyFilters:function(e,t){if(!e||0==e.length||!t||0==t.length)return[];var n=e.filter(function(e){return e.FilterText&&e.FilterText.length>0});if(n.length>0){for(var a=[],o=0;o<t.length;o++){for(var i=t[o],r=!0,s=0;s<n.length;s++){var l=n[s];if((i[l.Name]||"").toString().indexOf(l.FilterText)<0){r=!1;break}}r&&a.push(i)}return a}return t},sort:function(e,t,n,a){if(e&&0!=e.length&&t&&n&&0!=n.length){void 0===a&&(a=!1);var o=n.findItem(function(e){return e.Title==t});if(null!=o){var i=o.Type==reportUtils.FieldType.Date?"original_"+o.Name:o.Name,r=a?-1:1,s=a?1:-1;e.sort(function(e,t){var n=e[i],a=t[i];return n>a?r:n<a?s:0})}}},InitClearFiltersPositionTimer:function(){reportUtils._clearFiltersPositionTimer&&window.clearInterval(reportUtils._clearFiltersPositionTimer),reportUtils._clearFiltersPositionTimer=window.setInterval(function(){$(".clear-filter:visible").each(function(){var e=$(this);1==e.parents("th").find(".sortIcon:visible").length?e.css("top","35px"):e.css("top","15px")})},500)}};!function(){"use strict";function e(e,t,n,a,o,i,r){function s(){upyaUtils.ReadPracticeCamps(e,n,a,function(){e.data.IsLoading=!1,n.get("/api/common/hidden-practice-camps").then(function(t){if(t.data.length>0){for(var n=0;n<t.data.length;n++)c[t.data[n].PRACTICE_CAMP_ID.toString()]=!0;e.data.availableCamps=e.data.availableCamps.filter(function(e){return!c[e.PRACTICE_CAMP_ID.toString()]})}ChainFactory.Next()},function(e){ChainFactory.Next()})})}function l(){var e=$("#g-recaptcha-response").val(),t=!1;return t=void 0===e||e.length>0,t?e:""}var c={};e.data={IsLoading:!0,availableCamps:[],genders:[{Id:1,Name:"זכר"},{Id:2,Name:"נקבה"}]},e.participant={},window.qL_steps_amount=1,ChainFactory.Execute(s),window.setTimeout(function(){window.qL_Finish_Now=!0},1500),e.IsPracticeCampHidden=function(e){return 1==c[e.PRACTICE_CAMP_ID]},e.SubmitForm=function(){e.formValidationErrors=[],e.participant.practiceCamp||e.formValidationErrors.push("יש לבחור מחנה אימון"),e.participant.Name||e.formValidationErrors.push("יש להזין שם"),e.participant.Email?sportUtils.IsValidEmail(e.participant.Email)||e.formValidationErrors.push("כתובת דואר אלקטרוני לא תקינה"):e.formValidationErrors.push("יש להזין דואר אלקטרוני"),e.participant.Address||e.formValidationErrors.push("יש להזין כתובת");var t=e.participant.Cellular,o=e.participant.Phone;t||o?(o&&!sportUtils.IsValidPhoneNumber(o)&&e.formValidationErrors.push("טלפון בית לא תקין"),t&&!sportUtils.IsValidPhoneNumber(t)&&e.formValidationErrors.push("טלפון סלולרי לא תקין")):e.formValidationErrors.push("יש להזין טלפון בית או סלולרי");var i=l();if(0==i.length&&e.formValidationErrors.push("יש לוודא שהינך לא רובוט"),0==e.formValidationErrors.length){e.participant.Birthday&&(e.participant.ParsedBirthday=function(e){return e&&e.getFullYear?a("date")(e,"dd/MM/yyyy"):e}(e.participant.Birthday)),e.formSending=!0;var r={captchaResponse:i,Participant:e.participant};n.post("/api/sportsman/practice-camps",r).then(function(t){e.formSending=!1,e.sendResult={Success:!0}},function(t){e.formSending=!1,e.sendResult={Error:"שגיאה בעת שליחת נתונים"}})}}}function t(e,t,n,a,o,i,r){function s(){sportUtils.VerifyUser(n,e,[3]),window.qL_step_finished=!0}function l(e){e.StateClass="button button_type_icon_small icon button_grey_light",e.IconClass="fa fa-eye",e.Hidden?(e.IconClass+="-slash",e.Tooltip="מחנה אימון מוסתר, יש ללחוץ כדי לבטל הסתרה"):(e.StateClass+=" button_grey_light_hover",e.Tooltip="מחנה אימון גלוי, ניתן ללחוץ על כפתור זה כדי להסתיר את מחנה האימון")}function c(){upyaUtils.ReadPracticeCamps(e,n,a,function(){n.get("/api/common/hidden-practice-camps").then(function(t){for(var n={},a=0;a<t.data.length;a++)n[t.data[a].PRACTICE_CAMP_ID.toString()]=!0;e.data.availableCamps.forEach(function(e){e.Hidden=n[e.PRACTICE_CAMP_ID.toString()],l(e)}),ChainFactory.Next()},function(t){e.data.availableCamps.forEach(function(e){l(e)}),ChainFactory.Next()})})}e.data={availableCamps:[]},window.qL_steps_amount=2,ChainFactory.Execute(s,c),window.setTimeout(function(){window.qL_Finish_Now=!0},1500),e.ToggleState=function(e){var t={PRACTICE_CAMP_ID:e.PRACTICE_CAMP_ID};n.post("/api/common/toggle-practice-camp",t).then(function(t){e.Hidden=!e.Hidden,l(e)},function(e){console.log("error toggling practice camp"),alert("שגיאה בעת עדכון נתוני מחנה אימון נא לנסות שוב מאוחר יותר")})}}angular.module("sport.UPYA").controller("UPYA_Controller",["$scope","$state","$http","$filter","$timeout","$interval","messageBox",e]).controller("UPYA_Manage_Controller",["$scope","$state","$http","$filter","$timeout","$interval","messageBox",t])}();var upyaUtils={ReadPracticeCamps:function(e,t,n,a){t.get("/api/sportsman/practice-camps").then(function(t){window.qL_step_finished=!0,e.data.availableCamps=t.data,e.data.availableCamps.forEach(function(e){var t=n("date")(e.DATE_START,"dd/MM/yyyy"),a=n("date")(e.DATE_FINISH,"dd/MM/yyyy");e.Name="מחנה אימון "+e.SPORT_NAME+" מ-"+t+" עד "+a,e.REMARKS&&(e.Name+=" ("+e.REMARKS+")")}),null!=a&&a()},function(e){console.log("error reading practice camps"),console.log(e),window.qL_step_finished=!0,window.qL_Finish_Now=!0,ChainFactory.Next()})}};